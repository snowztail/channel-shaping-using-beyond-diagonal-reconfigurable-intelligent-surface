\documentclass[journal]{IEEEtran}
% \documentclass[journal,12pt,onecolumn,draftclsnofoot]{IEEEtran}

\usepackage[table]{xcolor}
\usepackage{adjustbox}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{bookmark}
\usepackage{booktabs}
\usepackage[makeroom]{cancel}
\usepackage[american]{circuitikz}
\usepackage{cite}
% \usepackage{fixmath}
\usepackage[acronym]{glossaries-extra}
\usepackage{hyperref}
\usepackage{import}
\usepackage{mathtools}
\usepackage{microtype}
\usepackage[short]{optidef}
\usepackage{pgfplots}
\usepackage{ragged2e}
\usepackage[subtle]{savetrees}
\usepackage{siunitx}
\usepackage{stfloats}
\usepackage[caption=false,font=footnotesize,subrefformat=parens,labelformat=parens]{subfig}
\usepackage{tabularx}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{multirow}
\usepackage{booktabs}
% \usepackage{cleveref}

% page limit hacks
% \usepackage{setspace}
% ! \usepackage[top=1cm, bottom=1cm, left=1cm, right=1cm]{geometry}
% \abovedisplayskip=1mm
% \belowdisplayskip=1mm
% \abovedisplayshortskip=1mm
% \belowdisplayshortskip=1mm
% \setlength{\jot}{0.1mm}
% \setlength{\floatsep}{1mm}
% \setlength{\textfloatsep}{1mm}
% \setlength{\intextsep}{1mm}
% \setlength{\skip\footins}{2mm}


% amsthm
\newtheorem{proposition}{Proposition}
\newtheorem{remark}{Remark}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}[proposition]

% PGF/TikZ
\usetikzlibrary{arrows,calc,matrix,patterns,plotmarks,positioning,shapes}
\usetikzlibrary{decorations.pathmorphing,decorations.pathreplacing,decorations.shapes,shapes.geometric}
\usepgfplotslibrary{groupplots,patchplots}
\pgfplotsset{compat=newest}
\pgfplotsset{every axis/.append style={
	title style={font=\Large},
	label style={font=\Large},
	tick label style={font=\Large},
	legend style={font=\Large},
}}

% Double superscript
\newcommand\herm[2][-4]{{#2}^{\mkern#1mu\mathsf{H}}}

% algpseudocode
\makeatletter
\renewcommand{\fnum@algorithm}{\fname@algorithm{} \thealgorithm:}
\newcommand\setalgorithmcaptionfont[1]{%
	\let\my@floatc@ruled\floatc@ruled          % save \floatc@ruled
	\def\floatc@ruled{%
		\global\let\floatc@ruled\my@floatc@ruled % restore \floatc@ruled
		#1\floatc@ruled}}
\makeatother

\algrenewcommand{\algorithmicrequire}{\textbf{Input:}}
\algrenewcommand{\algorithmicensure}{\textbf{Output:}}
\algrenewcommand{\algorithmicwhile}{\textbf{While}}
\algrenewcommand{\algorithmicend}{\textbf{End}}
\algrenewcommand{\algorithmicrepeat}{\textbf{Repeat}}
\algrenewcommand{\algorithmicuntil}{\textbf{Until}}
\algrenewcommand{\algorithmicfor}{\textbf{For}}
\algrenewcommand{\algorithmicif}{\textbf{If}}
\algrenewcommand{\algorithmicelse}{\textbf{Else}}
\algrenewcommand{\algorithmicdo}{}
\algrenewcommand{\algorithmicthen}{}
\algnewcommand{\Initialize}[1]{%
	\State \textbf{Initialize }{#1}
}

% glossaries-extra
\glsdisablehyper
\setabbreviationstyle[acronym]{long-short}
\newacronym{ao}{AO}{Alternating Optimization}
\newacronym{bd}{BD}{Beyond-Diagonal}
\newacronym{bcd}{BCD}{Block Coordinate Descent}
\newacronym{dof}{DoF}{Degree of Freedom}
\newacronym{siso}{SISO}{Single-Input Single-Output}
\newacronym{miso}{MISO}{Multiple-Input Single-Output}
\newacronym{mimo}{MIMO}{Multiple-Input Multiple-Output}
\newacronym{rcg}{RCG}{Riemannian Conjugate Gradient}
\newacronym{ris}{RIS}{Reconfigurable Intelligent Surface}
\newacronym{pc}{PC}{Point-to-point Channel}
\newacronym{ic}{IC}{Interference Channel}
\newacronym{snr}{SNR}{Signal-to-Noise Ratio}
\newacronym{wsr}{WSR}{Weighted Sum-Rate}
\newacronym{svd}{SVD}{Singular Value Decomposition}
\newacronym{mmse}{MMSE}{Minimum Mean-Square Error}
\newacronym{wmmse}{WMMSE}{Weighted \gls{mmse}}
\newacronym{mse}{MSE}{Mean-Square Error}
\newacronym{los}{LoS}{Line-of-Sight}
\newacronym{csi}{CSI}{Channel State Information}
\newacronym{cscg}{CSCG}{Circularly Symmetric Complex Gaussian}
\newacronym{sca}{SCA}{Successive Convex Approximation}
\newacronym{kkt}{KKT}{Karush-Kuhn-Tucker}


\begin{document}
\title{Channel Shaping Using Beyond Diagonal Reconfigurable Intelligent Surfaces}
\author{
	\IEEEauthorblockN{
		Yang~Zhao,~\IEEEmembership{Member,~IEEE,}
		Hongyu~Li,~\IEEEmembership{Graduate Student Member,~IEEE,}\\
		Massimo~Franceschetti,~\IEEEmembership{Fellow,~IEEE,}
		and~Bruno~Clerckx,~\IEEEmembership{Fellow,~IEEE}
	}
	\thanks{
		Yang Zhao, Hongyu Li, and Bruno Clerckx are with the Department of Electrical and Electronic Engineering, Imperial College London, London SW7 2AZ, U.K. (e-mail: \{\href{mailto:yang.zhao18@imperial.ac.uk}{yang.zhao18}, \href{mailto:c.li21@imperial.ac.uk}{c.li21}, \href{mailto:b.clerckx@imperial.ac.uk}{b.clerckx}\}@imperial.ac.uk).

		Massimo Franceschetti is with the Department of Electrical and Computer Engineering, University of California at San Diego, La Jolla CA 92093, USA (e-mail: \href{mailto:massimo@ece.ucsd.edu}{massimo@ece.ucsd.edu}).
	}
}
\maketitle

\begin{abstract}
	This paper investigates to what extent a passive \gls{ris} can redistribute the singular values of a \gls{mimo} point-to-point channel.
	% the limit to which
	We depart from the conventional diagonal phase shift model and adopt a \gls{bd}-\gls{ris} architecture featuring in-group connections between elements, which enables signal amplitude and phase control.
	% This powerful model allows cooperative wave scattering with both amplitude and phase control, and we uniquely attribute the shaping advantage to channel rearrangement and space alignment.
	% This powerful model enables cooperative wave scattering with both amplitude and phase control, and we provide unique shaping insights in terms of channel rearrangement and space alignment.
	% uniquely explain the extra design freedom from off-diagonal entries as channel rearrangement and space alignment.
	% while the shaping advantage from off-diagonal entries is uniquely attributed to channel rearrangement and space alignment.
	% An efficient and universal \gls{bd}-\gls{ris} design framework is proposed over group-wise {geodesic} \gls{rcg} on the Stiefel manifold, which performs multiplicative rotational (instead of add-then-retract) updates for faster convergence.
	% The Pareto frontiers of channel singular values are characterized via a novel geodesic manifold optimization, and the resulting region comprehensively encapsulates relevant metrics (e.g., spectral norm and condition number).
	Specifically, we first provide shaping insights by characterizing the Pareto frontiers of channel singular values via a novel geodesic manifold optimization.
	The resulting region comprehensively encapsulates most relevant metrics (e.g., spectral norm and condition number).
	To explore the shaping limits of passive \gls{bd}-\gls{ris}, we also derive
	% 0ol. individual and collective
	singular value bounds for 1) rank-deficient forward/backward channel and 2) blocked direct channel.
	% respectively in rank-deficient channels and for fully-connected \gls{bd}-\gls{ris} via matrix analysis.
	% For the power gain problem, we provide a closed-form iterative solution by group-wise \gls{svd} that features even faster convergence.
	% We uniquely attribute the shaping advantage from off-diagonal entries to channel rearrangement and space alignment.
	% Channel rearrangement is a unique feature of off-diagonal entries that allows each group to rearrange and recombine the forward and backward channels.
	% Space alignment generalizes phase matching in \gls{siso} and introduces a trade-off between multiplicative backward-forward and additive direct-indirect channel combinations.
	% Those channel shaping designs have two major implications.
	% First, they demystify the performance gain from off-diagonal entries in terms of {channel rearrangement} and {space alignment}.
	% help to demystify the gain from off-diagonal entries and reveal the shaping advantage of \gls{bd}-\gls{ris} in channel rearrangement and space alignment.
	% Second, they inspire a two-stage suboptimal solution that decouples joint active and passive beamforming design.
	% \gls{ris}-transceiver optimization and suggest a low-complexity suboptimal solution based on channel power maximization.
	As a side product, we tackle \gls{bd}-\gls{ris}-aided \gls{mimo} achievable rate maximization by a local-optimal \gls{ao} approach and a suboptimal shaping-inspired design over channel gain maximization.
	% The former alternates between active and passive beamformers until convergence, while the latter maximizes
	% solves the problem in closed form by a channel power maximization and \gls{mimo} transmission subproblem.
	% shaping-inspired approach.
	Simulation results show that \gls{bd}-\gls{ris} improves the dynamic range of and trade-off between channel singular values significantly, compared to conventional diagonal \gls{ris}.
	Results also highlight that the power and rate gain of \gls{bd}-\gls{ris} over diagonal \gls{ris} increase with \gls{mimo} dimensions.

	% wider dynamic range (with better tradeoff) of singular values and significant power and rate gains, especially in large-scale \gls{mimo} systems.

	% indicate that the rate deficit from the latter diminishes as the \gls{ris} evolves from diagonal towards unitary, while the relative gain of \gls{bd}-\gls{ris} increase with \gls{mimo} dimensions and decrease with spatial correlation.

	% , and .

	% (i) , and (ii) the gap between the two approaches vanishes as \gls{bd}-\gls{ris} evolves from diagonal to unitary.
	% not only demystify the advantage of \gls{bd}-\gls{ris} in channel rearrangement and space alignment, but also decouple the joint \gls{ris}-transceiver optimization.
	% Those channel shaping designs not only demystify the advantage of \gls{bd}-\gls{ris} in channel rearrangement and space alignment, but also decouple the joint \gls{ris}-transceiver optimization.

	% geodesic \gls{rcg} algorithm is tailored for smooth optimization problems of asymmetric \gls{bd}-\gls{ris} with arbitrary group size, then invoked for the Pareto frontier of channel singular values.
	% To understand the gain from off-diagonal entries, we also derive analytical singular value bounds in rank-deficient and fully-connected scenarios.
	% As a side product, we tackle \gls{mimo} rate maximization problem by alternating between active beamformer (eigenmode transmission) and passive beamformer (\gls{rcg} algorithm) until convergence.
	% A low-complexity suboptimal solution based on channel shaping is also proposed, where the decoupled problem is formulated as channel power maximization and solved in closed form iteratively.
	% % We then show how channel shaping decouples the design and amounts to a low-complexity suboptimal solution.
	% % A low-complexity suboptimal solution decoupling both blocks is also proposed, where the channel shaping subproblem is formulated as channel power maximization and solved in closed form iteratively.
	% Theoretical analysis and numerical evaluation reveal that the shaping advantage of \gls{bd}-\gls{ris} increases with group size and \gls{mimo} dimensions, stemming from stronger channel rearrangement and space alignment capabilities.
\end{abstract}

\begin{IEEEkeywords}
	Beyond diagonal reconfigurable intelligent surface, multi-input multi-output, manifold optimization, channel shaping, rate maximization.
\end{IEEEkeywords}

\glsresetall

\begin{section}{Introduction}
	Today we are witnessing a paradigm shift from connectivity to intelligence, where the wireless environment is no longer a chaotic medium but a conscious agent that can serve on demand.
	This is empowered by the recent advances in \gls{ris}, a programmable passive planar surface that recycles and redistributes ambient electromagnetic waves for improved wireless performance.
	A typical \gls{ris} consists of numerous low-power sub-wavelength non-resonant scattering elements, whose response can be engineered in real-time to manipulate the amplitude, phase, frequency, and polarization of the scattered waves \cite{Basar2019}.
	% It not only experiences negligible noise and supports full-duplex transmissions, but also features better flexibility than reflectarrays, lighter footprint than various relays, and greater scalability than conventional multi-antenna techniques.
	It enables low-noise, full-duplex operation, and also features better flexibility than reflectarrays, lighter footprint than relays, and greater scalability than \gls{mimo} systems.
	The most popular \gls{ris} research direction is \emph{joint passive and active beamforming} design with transceivers for a specific performance measure, which has attracted significant attention in wireless communication \cite{Wu2019,Guo2020,Liu2022}, sensing \cite{He2022,Luo2022,Hua2023}, and power transfer literature \cite{Wu2020a,Feng2022,Zhao2022}.
	While passive beamforming at \gls{ris} suffers signal attenuation from double fading, it offers better asymptotic behaviors than active beamforming at transceivers (e.g., second-order array gain and fourth-order harvested power \cite{Zhao2022}).
	Another \gls{ris} application is \emph{backscatter modulation} by periodically switching its reflection pattern within the channel coherence time.
	This creates a free-ride message stream (similar to index modulation \cite{Basar2017}) with dual benefits: integrating with the legacy transmitter for enhanced channel capacity \cite{Karasik2020,Basar2020,Ye2022} or serving as an information source for low-power uplink communication \cite{Liang2020,Zhao2024,Yang2024}.
	Different from above, \emph{channel shaping} exploits the \gls{ris} as a stand-alone device to modify the inherent properties of the wireless environment.
	To name a few, it can compensate for the Doppler effect \cite{Basar2021}, transform frequency-selective channels into frequency-flat \cite{Arslan2022}, improve the spatial diversity for \gls{mimo} systems \cite{Ozdogan2020a}, and create artificial time diversity for orthogonal \cite{Yang2019} and non-orthogonal \cite{Chen2023} multiple accesses.
	Channel shaping also provides a ubiquitous solution for different wireless applications, which decouples joint \gls{ris}-transceiver designs by first optimizing the channel and then the communication system.
	% and helps to decouple the \gls{ris}-transceiver design in a distributed manner.
	At a specific resource block, relevant metrics can be classified into two categories:
	% shaping metrics can be classified into two categories:
	\begin{itemize}
		\item \emph{Singular value:} The impact of \gls{ris} has been studied in terms of minimum singular value \cite{ElMossallamy2021}, effective rank \cite{ElMossallamy2021,Meng2023}, condition number \cite{Zheng2022,Huang2023}, and degree of freedom \cite{Bafghi2022,Zheng2023,Chae2023}. Those metrics are closely related to performance measures (e.g., achievable rate and harvested power \cite{Shen2021}) but sensitive to small perturbations of the channel matrix.
		\item \emph{Power:} The impact of \gls{ris} has been studied in terms of channel power gain \cite{Wu2019,Shen2020a,Nerini2023,Nerini2024,Santamaria2023} in point-to-point channels and leakage interference \cite{Santamaria2023a} in interference channels. Those second-order metrics are less informative in \gls{mimo} but easier to analyze and optimize.
	\end{itemize}

	Although above works offer initial glimpses into the channel shaping potential of \gls{ris}, one critical question has not been fully addressed: \emph{What is the ultimate channel singular value shaping capability of a passive \gls{ris}?}
	% \begin{enumerate}
	% 	\item What is the entire singular value region of a \gls{mimo} channel with \gls{ris}?
	% \end{enumerate}
	% they neither discuss the limitation
	% depict the entire singular value region nor provide a universal optimization framework.
	% It motivates the ultimate question: \emph{To what extent can a passive \gls{ris} reshape \gls{mimo} channels in terms of singular values?}
	% Despite the great potentials and fruitful outcomes, one critical unanswered question is the {channel shaping} capability: \emph{To what extent can a passive \gls{ris} reshape \gls{mimo} channels?}
	The answer depends heavily on \gls{ris} hardware architecture and scattering model.
	Most relevant works \cite{ElMossallamy2021,Meng2023,Zheng2022,Huang2023,Bafghi2022,Zheng2023,Chae2023,Wu2019,Santamaria2023a} considered a diagonal \gls{ris} model where each element is connected to a dedicated impedance and disconnected from others, such that wave impinging on one element is entirely reflected by the same element.
	% is tuned by a dedicated impedance and acts as an \emph{individual} scatterer \cite{Wu2020}.
	This simple architecture ideally maps to a diagonal scattering matrix with unit-magnitude entries on the main diagonal and zeros elsewhere, which only applies a phase shift to the incoming signal.
	The concept was then generalized to \gls{bd}-\gls{ris} with a group-connected architecture \cite{Shen2020a} that connects adjacent elements via passive reconfigurable components\footnote{Those components can be either symmetric (e.g., capacitors and inductors) or asymmetric (e.g., ring hybrids and branch-line hybrids) \cite{Ahn2006}, resulting in symmetric and asymmetric scattering matrices, respectively.\label{fn:symmetric}}.
	This allows wave impinging on one element to propagate losslessly within the circuit and depart partially from any element in the same group.
	It can thus manipulate both amplitude and phase of the scattered wave, generalizing the scattering matrix from diagonal to block-diagonal with unitary blocks.
	Such a powerful model can be realized at reduced hardware cost using tree- and forest-connected architectures according to graph theory \cite{Nerini2024}.
	\gls{bd}-\gls{ris} can also function in hybrid transmitting-and-reflecting mode \cite{Li2023b} and multi-sector mode \cite{Li2023c} to provide full-space coverage and multi-user support.
	Many practical \gls{bd}-\gls{ris} design challenges, including channel estimation \cite{Li2024}, mutual coupling \cite{Li2023f}, and wideband modelling \cite{Li2024a}, have also been investigated in the literature.
	The passive beamforming superiority of \gls{bd}-\gls{ris} over diagonal \gls{ris} has been studied mainly in \gls{siso} and \gls{miso} communication systems, where the problems have been cast as single-user \gls{snr} maximization \cite{Shen2020a,Nerini2023,Nerini2024,Santamaria2023} and multi-user \gls{wsr} maximization \cite{Fang2023,Zhou2023,Li2023c,Soleymani2024}.
	However, the interplay between \gls{bd}-\gls{ris} and \gls{mimo} systems is still in the infancy stage.
	The authors of \cite{Bartoli2023} investigated the rate-optimal joint beamforming design for a \gls{bd}-\gls{ris}-aided \gls{mimo} system with blocked direct link and fully-connected \gls{bd}-\gls{ris}.
	Those assumptions simplify the problem but limit the generality of the results.
	A transmitter-side \gls{bd}-\gls{ris} was introduced to massive \gls{mimo} systems for improved spectral efficiency \cite{Mishra2024}, but the problem was again limited to blocked direct link and fully-connected \gls{bd}-\gls{ris}.
	Received power maximization with continuous-valued \cite{Nerini2023} and discrete-valued \cite{Nerini2023b} \gls{bd}-\gls{ris} have also been tackled in the literature, but the resulting single-stream transceiver is rate-suboptimal and the corresponding \gls{bd}-\gls{ris} design is equivalent to \gls{siso} shaping.
	% A practical frequency-dependent \gls{bd}-\gls{ris} model has been recently proposed for multi-band multi-cell \gls{mimo} networks to facilitate practical deployments \cite{Sena2024}.
	% Although the results are promising, the channel shaping capability from off-diagonal entries deserves further investigation, and there lacks a universal yet efficient \gls{bd}-\gls{ris} design framework.
	We notice that there lacks a comprehensive study of \gls{bd}-\gls{ris} in point-to-point \gls{mimo} systems --- the shaping benefits of \gls{bd}-\gls{ris} are not fully understood and the general rate maximization problem remains open.
	% and the channel shaping potential of \gls{bd}-\gls{ris} remains unexplored.
	% The channel shaping capability of \gls{bd}-\gls{ris} deserves further investigation.
	% Although the results are promising, the channel shaping capability of \gls{bd}-\gls{ris} deserves further investigation.
	Moreover, no previous work has characterized the \gls{mimo} channel singular value region manipulated by any type of \gls{ris}.
	% , and the \gls{bd}-\gls{ris}-aided \gls{mimo} rate maximization problem remains unsolved.
	This paper aims to narrow those gaps and provide a comprehensive answer to the channel shaping capability question through theoretical analysis and numerical optimization.
	The contributions are summarized below.


	% 1. need a general study on BD-RIS x MIMO and explain the potential from off-diagonal entries
	% 2. need a general optimization framework for BD-RIS
	% 3. need a comprehensive answer to the channel shaping question
	% 4. need a low-complexity solution from shaping

	First, we interpret the channel shaping potential of \gls{bd}-\gls{ris} in \gls{mimo} as channel rearrangement and space alignment.
	Channel rearrangement refers to rearranging and recombining the forward and backward channel branches (i.e., entries of the channel matrix) according to their strength.
	Space alignment generalizes phase matching in \gls{siso} and \gls{miso} to the high-dimensional singular vector space in \gls{mimo}.
	The off-diagonal entries of \gls{bd}-\gls{ris} scattering matrix provides a higher design freedom and exploits channel spatial diversity more effectively than diagonal \gls{ris}.
	This is the first paper to study \gls{bd}-\gls{ris} in general \gls{mimo} systems.
	%  and discuss its shaping potential.

	Second, we propose an efficient \gls{bd}-\gls{ris} design framework that solves general optimization problems (e.g., singular value redistribution and rate maximization) by geodesic\footnote{A geodesic refers to the shortest path between two points in a Riemannian manifold.} \gls{rcg}.
	% to numerically analyze the channel shaping capability of \gls{bd}-\gls{ris}, we exploit the Riemannian geometry of the Stiefel manifold and
	This method modified from \cite{Abrudan2008,Abrudan2009} exploits the Riemannian geometry of the Stiefel manifold and performs group-wise multiplicative rotational updates along the geodesics, which avoids retraction and facilitates step size selection.
	It thus converges faster than existing non-geodesic approaches \cite{Absil2009,Pan2022d}.
	This is the first work to tailor an efficient optimization framework for \gls{bd}-\gls{ris}.

	% pioneer
	Third, we adopt the proposed geodesic \gls{rcg} and provide a numerical answer to the singular value shaping question.
	% to answer the channel singular value shaping question via numerical optimization.
	% to redistribute the singular values of a point-to-point \gls{mimo} channel.
	The {Pareto frontiers} of channel singular values are characterized by solving a series of weighted sum maximization problems, where the weight associated with each singular value can be positive, zero, or negative.
	% optimizing their weighted sum, where the weights can be positive, zero, or negative.
	% This problem is solved by the proposed geodesic \gls{rcg} algorithm.
	The enclosed region generalizes most relevant metrics and provides an intuitive channel shaping benchmark.
	Results show that increasing \gls{bd}-\gls{ris} group size enlarges the singular value region, improving both dynamic range of and trade-off between singular values.
	% , where the dynamic range and trade-off between are both improved.
	% significantly enlarges the singular value region, improveing the dynamic range and trade-off in-between.
	% We also and derive some analytical singular value bounds for rank-deficient \gls{mimo} and fully-connected \gls{bd}-\gls{ris}.

	Fourth, we leverage matrix analysis tools and provide an analytical answer to the singular value shaping question.
	% revisit the channel singular value shaping problem from an analytical perspective via matrix analysis.
	% To explore the ultimate shaping limits, we derive individual and collective singular value bounds for rank-deficient forward/backward channel and blocked direct channel.
	% Asymptotic bounds shared by diagonal and \gls{bd}-\gls{ris} are derived in the former case, while exact bounds for unitary \gls{bd}-\gls{ris} are derived in the latter case.
	Asymptotic channel singular value bounds applying to diagonal and \gls{bd}-\gls{ris} are derived for rank-deficient forward/backward channel.
	On the other hand, tight bounds for fully-connected \gls{bd}-\gls{ris} with finite number of elements are derived for blocked direct channel.
	Results validate those bounds and emphasizes the shaping advantage of \gls{bd}-\gls{ris}.
	This is the first work to quantify the singular value redistribution capability of \gls{bd}-\gls{ris} from either numerical or analytical perspective.
	% Results validate those bounds and show that
	% fully-connected \gls{bd}-\gls{ris} without direct link.

	% In the rank-deficient scenario, we show that the asymptotic performace


	% % respectively in rank-deficient channels and for fully-connected \gls{bd}-\gls{ris}
	% collective singular value bounds	for rank-deficient channels and fully-connected \gls{bd}-\gls{ris}, respectively.
	% 	Results validate those bounds and show
	% for rank-deficient channels and fully-connected \gls{bd}-\gls{ris}, respectively.
	% Results validate those bounds and show that increasing \gls{bd}-\gls{ris} group size significantly enlarges the singular value region, providing wider dynamic range and better trade-off.
	% dynamic range and trade-off of singular values are significantly improved by \gls{bd}-\gls{ris}, especially in large-scale \gls{mimo} systems.
	% This is the first work to comprehensively answer the channel shaping capability question from both numerical and analytical perspectives in the most general \gls{bd}-\gls{ris} setup.
	% from a Pareto perspective.

	Fifth, we tackle \gls{bd}-\gls{ris}-aided \gls{mimo} rate maximization problem by two beamforming solutions: a local-optimal \gls{ao} approach and a low-complexity approach inspired by channel shaping insights.
	The former updates active beamforming by eigenmode transmission and passive beamforming by proposed geodesic \gls{rcg} until convergence.
	The latter suboptimally decouples the problem as channel power gain maximization at \gls{bd}-\gls{ris} and conventional \gls{mimo} transmission at transceiver, then solves both in closed form.
	% The problem is solved by a closed-form two-stage method.
	Results show that \gls{bd}-\gls{ris} provides higher power gain and achievable rate than diagonal \gls{ris}, and the rate gap of two approaches diminishes as the \gls{bd}-\gls{ris} evolves from single-connected to fully-connected.
	It suggests channel shaping offers a promising path to decouple joint \gls{ris}-transceiver designs.
	% Interestingly, the rate difference between the optimal and low-complexity designs diminishes as the \gls{ris} evolves from diagonal to unitary.
	% Those results emphasize the importance of using \gls{bd}-\gls{ris} in large-scale \gls{mimo} systems and suggest channel shaping offers a promising path to decouple joint \gls{ris}-transceiver designs.
	% a promising channel shaping path towards practical \gls{ris} and transceiver design.
	% that channel shaping offers a promising path towards simplified and practical \gls{bd}-
	% It suggests that channel shaping offers a promising path towards simplified and practical \gls{bd}-\gls{ris} (and transceiver) designs.
	% via \gls{bd}-\gls{ris} offers a promising path towards simplified and practical design.
	% offers a promising path towards simplified and practical desi
	% It suggests channel shaping helps to decouple the joint \gls{ris}-transceiver design and offers a promising low-complexity solution.
	% This is the first work to discuss the implications of channel shaping on joint active-passive beamforming optimization.

	% Fifth, extensive simulations reveal that the performance gain from \gls{bd}-\gls{ris} increases with group size and \gls{mimo} dimensions.
	% In terms of channel power, fully-connected \gls{bd}-\gls{ris} boosts up to 62\% and 270\% over diagonal \gls{ris} in $1 \times 1$ and $4 \times 4$ \gls{mimo} under independent Rayleigh fading, respectively.
	% The superiority stems from stronger \emph{channel rearrangement} and \emph{space alignment} capabilities empowered by in-group cooperation.
	% It emphasizes the importance of using \gls{bd}-\gls{ris} in large-scale \gls{mimo} systems.


	% First, we quantify the capability of a \gls{bd}-\gls{ris} to reshape the \gls{mimo} point-to-point channel in terms of singular values.
	% The \emph{Pareto frontiers} are characterized by optimizing the {weighted sum of singular values}, where the weights can be positive, zero, or negative.
	% % This generalizes most singular value metrics and provides a powerful design framework.
	% The resulting singular value region generalizes most relevant metrics and provides an intuitive channel shaping benchmark.
	% We then discuss some analytical singular value bounds in rank-deficient and fully-connected scenarios, which help to demystify the gain from off-diagonal entries.
	% This is the first paper to answer the channel shaping question and highlight the \gls{bd}-\gls{ris} gain from a Pareto perspective.

	% Second, we propose a \gls{rcg} algorithm adapted from \cite{Abrudan2008,Abrudan2009} for smooth optimization problems of asymmetric \gls{bd}-\gls{ris} with arbitrary group size.
	% Specifically, group-wise update is performed along the geodesics\footnote{A geodesic refers to the shortest path between two points in a Riemannian manifold.} of the Stiefel manifold, which are expressed compactly by the exponential map \cite{Edelman1998}.
	% It features lower complexity and faster convergence than general manifold optimization \cite{Absil2009,Pan2022d}, and solves the Pareto singular value problem.
	% This is the first paper to tailor an efficient optimization framework for asymmetric \gls{bd}-\gls{ris}.

	% Third, we tackle \gls{bd}-\gls{ris} \gls{mimo} rate maximization with two solutions: a local-optimal approach through \gls{ao} and a low-complexity approach over channel shaping.
	% The former updates active and passive beamformers by eigenmode transmission and \gls{rcg} algorithm, respectively.
	% The latter suboptimally decouples both blocks, recasts the shaping problem as channel power maximization, and solves it iteratively in closed form.
	% Interestingly, the gap in between vanishes as \gls{bd}-\gls{ris} evolves from diagonal (single-connected) to unitary (fully-connected).
	% It suggests channel shaping offers a promising low-complexity solution for joint \gls{ris}-transceiver designs.

	% Third, we propose a closed-form iterative algorithm for power centric channel shaping problems.
	% The idea is to successively approximate the quadratic objective by a sequence of affines and solve the local problems by \gls{svd}.
	% Case studies are conducted for channel power maximization in \gls{pc} and leakage interference minimization in \gls{ic}.


	\emph{Notation:}
	Italic, bold lower-case, and bold upper-case letters indicate scalars, vectors and matrices, respectively.
	$\jmath$ denotes the imaginary unit.
	$\mathbb{C}$ represents the set of complex numbers.
	$\mathbb{H}^{n \times n}$ and $\mathbb{U}^{n \times n}$ denotes the set of $n \times n$ Hermitian and unitary matrices, respectively.
	$\mathbf{0}$ and $\mathbf{I}$ are the all-zero and identity matrices with appropriate size, respectively.
	$\Re\{\cdot\}$ takes the real part of a complex number.
	$\mathrm{arg}(\cdot)$ gives the argument of a complex number.
	$\mathrm{tr}(\cdot)$ and $\det(\cdot)$ evaluates the trace and determinant of a square matrix, respectively.
	$\mathrm{diag}(\cdot)$ constructs a square matrix with arguments on the main (block) diagonal and zeros elsewhere.
	$\mathrm{sv}(\cdot)$ returns the singular value vector.
	$\sigma_n(\cdot)$ and $\lambda_n(\cdot)$ is the $n$-th largest singular value and eigenvalue, respectively.
	% $\boldsymbol{\sigma}(\cdot)$ and $\boldsymbol{\lambda}(\cdot)$ are the corresponding vectors.
	$(\cdot)^*$, $(\cdot)^\mathsf{T}$, $(\cdot)^\mathsf{H}$, $(\cdot)^\dagger$ $(\cdot)^{(r)}$, $(\cdot)^{\star}$ denote the conjugate, transpose, conjugate transpose (Hermitian), Moore-Penrose inverse, $r$-th iterated point, and stationary point, respectively.
	$(\cdot)_{[x:y]}$ is a shortcut for $(\cdot)_x,(\cdot)_{x+1},\ldots,(\cdot)_y$.
	$\lvert \cdot \rvert$, $\lVert \cdot \rVert$, and $\lVert \cdot \rVert _\mathrm{F}$ denote the absolute value, Euclidean norm, and Frobenius norm, respectively.
	$\odot$ represents the element-wise (Hadamard) product.
	$\mathcal{CN}(\mathbf{0}, \mathbf{\Sigma})$ is the multivariate \gls{cscg} distribution with mean $\mathbf{0}$ and covariance $\mathbf{\Sigma}$.
	$\sim$ means ``distributed as''.
\end{section}

\begin{section}{\glsfmtshort{bd}-\glsfmtshort{ris} Model}
	Consider a \gls{bd}-\gls{ris} aided point-to-point \gls{mimo} system with $N_\mathrm{T}$ and $N_\mathrm{R}$ transmit and receive antennas, respectively, and $N_\mathrm{S}$ scattering elements at the \gls{bd}-\gls{ris}.
	This configuration is denoted as $N_\mathrm{T} \times N_\mathrm{S} \times N_\mathrm{R}$ in the following context.
	The \gls{bd}-\gls{ris} can be modeled as an $N_\mathrm{S}$-port network \cite{Ivrlac2010} that further divides into $G$ individual groups, each containing $L \triangleq N_\mathrm{S} / G$ elements interconnected by real-time reconfigurable components \cite{Shen2020a}.
	To simplify the analysis and explore the performance limits, we assume a lossless asymmetric network without mutual coupling between scattering elements, as previously considered in \cite{Li2023b,Li2023c,Bartoli2023}.
	The overall scattering matrix of the \gls{bd}-\gls{ris} is block-unitary\footnote{Following footnote \ref{fn:symmetric}, we do not assume the scattering matrix to be symmetric. If required, one can enforce symmetry over the block-unitary result by $\mathbf{\Theta} \gets (\mathbf{\Theta} + \mathbf{\Theta}^\mathsf{T})/2$.}
	\begin{equation}
		\mathbf{\Theta} = \mathrm{diag}(\mathbf{\Theta}_1,\ldots,\mathbf{\Theta}_G),
		\label{eq:bd_ris}
	\end{equation}
	where $\mathbf{\Theta}_g \in \mathbb{U}^{L \times L}$ is the $g$-th unitary block (i.e., $\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g = \mathbf{I}$) that describes the response of group $g \in \mathcal{G} \triangleq \{1, \ldots, G\}$.
	Note that diagonal \gls{ris} can be regarded as its extreme case with group size $L=1$.
	Some potential physical architectures of \gls{bd}-\gls{ris} are illustrated in \cite[Fig. 3]{Shen2020a}, \cite[Fig. 5]{Li2023c}, and \cite[Fig. 2]{Nerini2024}, where the
	% radiation pattern and
	circuit topology is modelled in the scattering matrix.

	Let $\mathbf{H}_\mathrm{D} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$, $\mathbf{H}_\mathrm{B} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{S}}$, $\mathbf{H}_\mathrm{F} \in \mathbb{C}^{N_\mathrm{S} \times N_\mathrm{T}}$ denote the direct (i.e., transmitter-receiver), backward (i.e., \gls{ris}-receiver), and forward (i.e., transmitter-\gls{ris}) channels, respectively.
	The equivalent channel is a function of the scattering matrix
	\begin{equation}
		\mathbf{H} = \mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} = \mathbf{H}_\mathrm{D} + \sum_g \underbrace{\mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}}_{\triangleq \mathbf{H}_g},
		\label{eq:channel_equivalent}
	\end{equation}
	where $\mathbf{H}_{\mathrm{B},g} \in \mathbb{C}^{N_\mathrm{R} \times L}$ and $\mathbf{H}_{\mathrm{F},g} \in \mathbb{C}^{L \times N_\mathrm{T}}$ are the backward and forward channels for \gls{ris} group $g$, corresponding to the $(g{-}1)L{+}1$ to $gL$ columns of $\mathbf{H}_\mathrm{B}$ and rows of $\mathbf{H}_\mathrm{F}$, respectively.
	Let $\mathbf{H}_g \triangleq \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}$ be the indirect channel via \gls{bd}-\gls{ris} group $g$.
	Since unitary matrices constitute an algebraic group with respect to multiplication, the scattering matrix of group $g$ can be decomposed as
	\begin{equation}
		\mathbf{\Theta}_g = \mathbf{L}_g \mathbf{R}_g^\mathsf{H},
	\end{equation}
	where $\mathbf{L}_g, \mathbf{R}_g \in \mathbb{U}^{L \times L}$ are two unitary factor matrices.
	Let $\mathbf{H}_{\mathrm{B},g} = \mathbf{U}_{\mathrm{B},g} \mathbf{\Sigma}_{\mathrm{B},g} \mathbf{V}_{\mathrm{B},g}^\mathsf{H}$ and $\mathbf{H}_{\mathrm{F},g} = \mathbf{U}_{\mathrm{F},g} \mathbf{\Sigma}_{\mathrm{F},g} \mathbf{V}_{\mathrm{F},g}^\mathsf{H}$ be the compact \gls{svd} of the backward and forward channels, respectively.
	The equivalent channel can thus be rewritten as
	\begin{equation}
		\mathbf{H} = \overbrace{\mathbf{H}_\mathrm{D} + \sum_g \mathbf{U}_{\mathrm{B},g} \mathbf{\Sigma}_{\mathrm{B},g} \underbrace{\mathbf{V}_{\mathrm{B},g}^\mathsf{H} \mathbf{L}_g \mathbf{R}_g^\mathsf{H} \mathbf{U}_{\mathrm{F},g}}_\text{backward-forward} \mathbf{\Sigma}_{\mathrm{F},g} \mathbf{V}_{\mathrm{F},g}^\mathsf{H}}^\text{direct-indirect}.
		\label{eq:channel_equivalent_svd}
	\end{equation}

	% \begin{remark}
	By analyzing \eqref{eq:channel_equivalent_svd}, we conclude that the off-diagonal entries of the \gls{bd}-\gls{ris} scattering matrix provide two key potentials for \gls{mimo} channel shaping:
	% Channel rearrangement refers to rearrange and recombine the forward and backward channel branches by their strength.
	% Space alignment generalizes phase matching in \gls{siso} and \gls{miso} to the high-dimensional singular vector space in \gls{mimo}.
	\begin{itemize}
		\item \emph{Channel rearrangement:} It refers to rearranging and recombining the backward and forward channel branches (i.e., entries of the channel matrix) associated with each group by their strength.
		% This unique feature of \gls{bd}-\gls{ris} exploits spatial diversity effectively thanks to in-group connections.
		% This unique feature of \gls{bd}-\gls{ris} exploits the spatial diversity by rearranging and combining the backward and forward channel branches within each group.
		In \gls{siso}, diagonal \gls{ris} with perfect phase matching provides a maximum indirect channel amplitude of $\sum_{n=1}^{N_\mathrm{S}} \lvert h_{\mathrm{B},n} \rvert \lvert h_{\mathrm{F},n} \rvert$ while \gls{bd}-\gls{ris} can generalize it to $\sum_{g=1}^{G} \sum_{l=1}^{L} \lvert h_{\mathrm{B},\pi_{\mathrm{B},g}(l)} \rvert \lvert h_{\mathrm{F},\pi_{\mathrm{F},g}(l)} \rvert$, where $\pi_{\mathrm{B},g}$ and $\pi_{\mathrm{F},g}$ are permutations of $\mathcal{L} \triangleq \{1, \ldots, L\}$.
		Note the first summation is over groups and the second summation is over permuted channels.
		We thus conclude that \gls{bd}-\gls{ris} exploits spatial diversity effectively thanks to in-group connections.
		By rearrangement inequality, the maximum channel gain is attained by pairing the $l$-th strongest backward and forward branches.
		% , providing up to \qty{62.5}{\percent} asymptotic power gain over diagonal \gls{ris} in \gls{siso} Rayleigh fading \cite{Shen2020a}.
		Since the number of channels associated with each group is proportional to $N_\mathrm{T} N_\mathrm{R}$, we conclude the advantage of \gls{bd}-\gls{ris} in channel rearrangement scales with \gls{mimo} dimensions.
		\item \emph{Space alignment:} It refers to aligning the singular vectors of the direct, forward, and backward channels.
		The \gls{bd}-\gls{ris} needs to strike a balance between the alignment of backward-forward (intra-group, multiplicative) channels and direct-indirect (inter-group, additive) channels. In \gls{siso}, singular vectors become scalars and space alignment boils down to phase matching, such that the optimal scattering matrix of group $g$ that maximizes the channel gain is
		\begin{equation}
			\mathbf{\Theta}_g^\star = \exp \bigl(\jmath \mathrm{arg}(h_\mathrm{D})\bigr) \mathbf{V}_{\mathrm{B},g} \mathbf{U}_{\mathrm{F},g}^\mathsf{H},
			\label{eq:scattering_siso}
		\end{equation}
		where $\mathbf{V}_{\mathrm{B},g} = \bigl[\mathbf{h}_{\mathrm{B},g}/\lVert \mathbf{h}_{\mathrm{B},g} \rVert, \mathbf{N}_{\mathrm{B},g}\bigr] \in \mathbb{U}^{L \times L}$, $\mathbf{U}_{\mathrm{F},g} = \bigl[\mathbf{h}_{\mathrm{F},g}/\lVert \mathbf{h}_{\mathrm{F},g} \rVert, \mathbf{N}_{\mathrm{F},g}\bigr] \in \mathbb{U}^{L \times L}$, and $\mathbf{N}_{\mathrm{B},g}, \mathbf{N}_{\mathrm{F},g} \in \mathbb{C}^{L \times (L-1)}$ are the orthonormal bases of the null spaces of $\mathbf{h}_{\mathrm{B},g}$ and $\mathbf{h}_{\mathrm{F},g}$, respectively.
		Diagonal \gls{ris} with empty null space thus suffices for perfect phase matching in \gls{siso}.
		When it comes to \gls{mimo}, element $g$ of diagonal \gls{ris} can only apply a common phase shift to the ``pinhole''\footnote{The pinhole effect refers to channel rank reduction due to diffraction in the propagation environment \cite{Almers2006}. For element $g$ of diagonal \gls{ris}, the indirect channel $\mathbf{H}_g$ is rank-1 and the pinhole is $\Theta_g$.} indirect channel passing through itself by $\mathbf{H}_g = \mathbf{h}_{\mathrm{B},g} \Theta_g \mathbf{h}_{\mathrm{F},g}^\mathsf{H} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$.
		That is, the disadvantage of diagonal \gls{ris} in space alignment scales with \gls{mimo} dimensions.
		% As will be shown later, even if the \gls{bd}-\gls{ris} is unitary, there still exists a tradeoff between the alignment of direct-indirect and backward-forward spaces.
	\end{itemize}
	% \end{remark}

	% TODO: add illustrations for both

	% In \gls{siso}, the equivalent channel can be further simplified as
	% \begin{equation}
	% 	h = h_\mathrm{D} + \sum_g \mathbf{h}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{h}_{\mathrm{F},g},
	% \end{equation}
	% space alignment boils down to phase matching




	% For the \gls{siso} case in Fig. \subref*{fg:power_bond_txrx1_nd}, the maximum channel power is approximately \num{4e-6} by diagonal \gls{ris} and \num{6.5e-6} by fully-connected \gls{bd}-\gls{ris}, corresponding to a \qty{62.5}{\percent} gain.
	% This aligns with the asymptotic \gls{bd}-\gls{ris} scaling law derived for \gls{siso} in \cite{Shen2020a}.
	% Interestingly, the gain surges to \qty{270}{\percent} in $N_\mathrm{T}=N_\mathrm{S}=4$ \gls{mimo} as shown in Fig. \subref*{fg:power_bond_txrx4_nd}.
	% This is because space alignment boils down to phase matching in \gls{siso} such that both triangular and Cauchy-Schwarz inequalities in \cite[(50)]{Shen2020a} can be simultaneously tight regardless of the group size.
	% That is, diagonal \gls{ris} is sufficient for space alignment in \gls{siso} while the \qty{62.5}{\percent} gain from \gls{bd}-\gls{ris} comes purely from channel rearrangement (i.e., pairing the forward and backward channels from strongest to weakest).
	% Now consider a diagonal \gls{ris} in \gls{mimo}.
	% Each element can only apply a common phase shift to the associated rank-1 $N_\mathrm{R} \times N_\mathrm{T}$ indirect channel.
	% Therefore, perfect space alignment of indirect channels through different elements is generally impossible.
	% It means the disadvantage of diagonal \gls{ris} in space alignment and channel rearrangement scales with \gls{mimo} dimensions.
	% We thus conclude that the power gain of \gls{bd}-\gls{ris} scales with group size and \gls{mimo} dimensions.


	% \begin{equation}
	% 	\mathbf{H} = \underbrace{\mathbf{H}_\mathrm{D} + \underbrace{\sum_g \mathbf{U}_{\mathrm{B},g} \mathbf{\Sigma}_{\mathrm{B},g} \underbrace{\mathbf{V}_{\mathrm{B},g}^\mathsf{H} \mathbf{L}_g \mathbf{R}_g^\mathsf{H} \mathbf{U}_{\mathrm{F},g}}_\text{backward-forward} \mathbf{\Sigma}_{\mathrm{F},g} \mathbf{V}_{\mathrm{F},g}^\mathsf{H}}_\text{group-wise}}_\text{direct-indirect},
	% \end{equation}
	% which involves three space alignment problems:
	% which involves three space alignment problems
	% \begin{equation}
	% 	\mathbf{H} = \mathbf{H}_\mathrm{D} + \sum_g \mathbf{U}_{\mathrm{B},g} \mathbf{\Sigma}_{\mathrm{B},g} \underbrace{\mathbf{V}_{\mathrm{B},g}^\mathsf{H} \mathbf{L}_g \mathbf{R}_g^\mathsf{H} \mathbf{U}_{\mathrm{F},g}}_{\substack{\text{backward-forward}\\\text{additive alignment}}} \mathbf{\Sigma}_{\mathrm{F},g} \mathbf{V}_{\mathrm{F},g}^\mathsf{H}.
	% \end{equation}
	% \begin{equation}
	% 	\mathbf{H} = \mathbf{H}_\mathrm{D} + \sum_g \mathbf{U}_{\mathrm{B},g} \mathbf{\Sigma}_{\mathrm{B},g} \underbrace{\mathbf{V}_{\mathrm{B},g}^\mathsf{H} \mathbf{L}_g}_{\substack{\text{backward}\\\text{align}}} \underbrace{\mathbf{R}_g^\mathsf{H} \mathbf{U}_{\mathrm{F},g}}_{\substack{\text{forward}\\\text{align}}} \mathbf{\Sigma}_{\mathrm{F},g} \mathbf{V}_{\mathrm{F},g}^\mathsf{H}.
	% \end{equation}
	% Then the equivalent channel can be rewritten as
	% Since the field of (block) unitary matrices formulate a field that is closed under multiplication
	% Since block unitary matrices satisfy the axioms of a field under matrix multiplication
	% \begin{remark}
	% 	% To understand the \gls{b} gain from in-group connections
	% \end{remark}




	% \begin{remark}
	% 	From \eqref{eq:scattering_fc} and \eqref{eq:channel_equivalent_fc} in the proof of Proposition \ref{pp:fully_connected}, we notice that \eqref{iq:sv_bound_fc}--\eqref{iq:sv_bound_fc_power} are simultaneously tight when
	% 	% Interestingly, \eqref{iq:sv_bound_fc}--\eqref{iq:sv_bound_fc_power} are simultaneously tight when
	% 	\begin{equation}
	% 		\mathbf{\Theta} = \mathbf{V}_\mathrm{B} \mathbf{U}_\mathrm{F}^\mathsf{H}.
	% 		\label{eq:scattering_fc_tight}
	% 	\end{equation}
	% 	An interpretation is that the off-diagonal entries can enhance the capabilities of
	% 	\begin{itemize}
	% 		\item space alignment: $\mathbf{V}_\mathrm{B}$ and $\mathbf{U}_\mathrm{F}^\mathsf{H}$ in \eqref{eq:scattering_fc} fully align the spaces of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ by rotation;
	% 		\item channel rearrangement: $\mathbf{X} = \mathbf{I}$ in \eqref{eq:channel_equivalent_fc} pairs the channels of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ from strongest to weakest, which attains the maximum in rearrangement inequality.
	% 	\end{itemize}
	% \end{remark}



	% \begin{remark}
	% 	\gls{bd}-\gls{ris} reduces to diagonal \gls{ris} and fully-connected \gls{bd}-\gls{ris} with group size $L$ 1 and $N_\mathrm{S}$, respectively.
	% \end{remark}
	% \begin{remark}
	% 	Individual forward and backward \gls{csi} are required for \gls{bd}-\gls{ris} designs.
	% 	This is different from diagonal \gls{ris} where estimating their product is usually sufficient.
	% 	% Later we will show the potential benefits from the \gls{csi} overhead.
	% \end{remark}
\end{section}

\begin{section}{\glsfmtshort{bd}-\glsfmtshort{ris} Design by Geodesic \glsfmtshort{rcg}}
	% In this section, we first provide an overview on signal processing techniques for group-connected \gls{bd}-\gls{ris} design problems, then propose a novel group-wise geodesic \gls{rcg} method that exploits the properties of unitary group and operates directly on the Stiefel manifold.
	% The proposed method is applicable to any smooth optimization problem on the Stiefel manifold and is particularly suitable for \gls{bd}-\gls{ris} design problems.
	% We will later show that the proposed method provides better objective value and faster convergence for smooth optimization problems of arbitrary group size.

	Most group-connected \gls{bd}-\gls{ris} design problems can be formulated in the following general form
	\begin{maxi!}
		{\scriptstyle{\mathbf{\Theta}}}{f(\mathbf{\Theta})}{\label{op:general}}{\label{ob:general}}
		\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I},}{\quad \forall g,}{\label{co:general_unitary}}
	\end{maxi!}
	where the objective function $f(\mathbf{\Theta})$ can be any function of the \gls{bd}-\gls{ris} scattering matrix $\mathbf{\Theta}$, for example, channel singular value (to be discussed in Section \ref{sc:singular_value}) and achievable rate (to be discussed in Section \ref{sc:power_rate}).
	The feasible domain of each group is a $L$-dimensional Stiefel manifold $\mathbf{\Theta}_g \in \mathbb{U}^{L \times L}$, which is non-convex and non-Euclidean.
	Therefore, relevant optimization problems are usually solved by relax-then-project methods \cite{Fang2023} or universal non-geodesic manifold \gls{rcg} \cite{Li2023b,Li2023c,Bartoli2023}.
	The former solves an unconstrained problem \eqref{ob:general} by quasi-Newton methods, then projects the solution back to the Stiefel manifold.
	It has no guarantee of optimality and may suffer from numerical instability.
	The latter generalizes the conjugate gradient methods to any Riemannian manifold, which updates the feasible point by progressing along the conjugate direction and projecting back to the manifold at each step.
	In the following context, we first discuss the existing non-geodesic \gls{rcg} method and its drawbacks, then propose a novel group-wise geodesic \gls{rcg} method that operates directly on the Stiefel manifold for faster convergence.

	\begin{subsection}{Non-Geodesic \glsfmtshort{rcg}}
		A geodesic is a curve representing the shortest path between two points in a Riemannian manifold, whose tangent vectors remain parallel when transporting along the curve.
		The universal \gls{rcg} method proposed in \cite{Absil2009,Pan2022d} is non-geodesic and applicable to optimization problems over arbitrary manifolds.
		The main idea is to perform {additive} updates along the conjugate direction guided by the Riemannian gradient, then {project} the solution back onto the manifold.
		% update the feasible point by progressing along conjugate directions then project back to the manifold.
		% The main idea is to update the feasible point by progressing along conjugate directions then project back to the manifold.
		For optimization problem \eqref{op:general}, the steps for \gls{bd}-\gls{ris} group $g$ at iteration $r$ are summarized below:
		\begin{enumerate}
			\item \emph{Compute the Euclidean gradient \cite{Hjorungnes2007}:} The gradient of $f$ with respect to $\mathbf{\Theta}_g^*$ in the Euclidean space is
			\begin{equation}
				\nabla_{\mathrm{E},g}^{(r)} = \frac{\partial f(\mathbf{\Theta}_g^{(r)})}{\partial \mathbf{\Theta}_g^*};
				\label{eq:gradient_euclidean}
			\end{equation}
			\item \emph{Translate to the Riemannian gradient \cite{Absil2009}:} At point $\mathbf{\Theta}^{(r)}$, the Riemannian gradient lies in the tangent space of the Stiefel manifold $\mathcal{T}_{\mathbf{\Theta}_g^{(r)}}\mathbb{U}^{L \times L} \triangleq \{\mathbf{M} \in \mathbb{C}^{L \times L} \mid \mathbf{M}^\mathsf{H} \mathbf{\Theta}_g^{(r)} + {\mathbf{\Theta}_g^{(r)\mathsf{H}}} \mathbf{M} = \mathbf{0}\}$. It gives the steepest ascent direction of the objective on the manifold can be obtained by projecting the Euclidean gradient onto the tangent space:
			\begin{equation}
				% \nabla_{\mathrm{R},g}^{(r)} = \nabla_{\mathrm{E},g}^{(r)} {\mathbf{\Theta}_g^{(r)\mathsf{H}}} - \mathbf{\Theta}_g^{(r)} {\nabla_{\mathrm{E},g}^{(r)\mathsf{H}}};
				\nabla_{\mathrm{R},g}^{(r)} = \nabla_{\mathrm{E},g}^{(r)} - \mathbf{\Theta}_g^{(r)} {\nabla_{\mathrm{E},g}^{(r)\mathsf{H}}} \mathbf{\Theta}_g^{(r)};
				\label{eq:gradient_riemannian}
			\end{equation}
			\item \emph{Determine the conjugate direction \cite{Nocedal2006}:} The conjugate direction is obtained over the Riemannian gradient and previous direction as
			\begin{equation}
				\mathbf{D}_g^{(r)} = \nabla_{\mathrm{R},g}^{(r)} + \gamma_g^{(r)} \mathbf{D}_g^{(r-1)}, % $\mathcal{O}(N_\mathrm{S}^2)$
				\label{eq:direction_cg}
			\end{equation}
			where $\gamma_g^{(r)}$ is the parameter that deviates the conjugate direction from the tangent space for accelerated convergence. A popular choice is the Polak-Ribi\`{e}re formula
			\begin{equation}
				\gamma_g^{(r)} = \frac{\mathrm{tr}\bigl((\nabla_{\mathrm{R},g}^{(r)} - \nabla_{\mathrm{R},g}^{(r-1)}) {\nabla_{\mathrm{R},g}^{(r)\mathsf{H}}}\bigr)}{\mathrm{tr}\bigl(\nabla_{\mathrm{R},g}^{(r-1)} {\nabla_{\mathrm{R},g}^{(r-1)\mathsf{H}}}\bigr)}; % $\mathcal{O}(2 N_\mathrm{S}^3 + N_\mathrm{S}^2 + 2 N_\mathrm{S})$
				\label{eq:parameter_cg}
			\end{equation}
			\item \emph{Perform additive update \cite{Pan2022d}:} The point is updated by moving along a straight path in the conjugate direction
			\begin{equation}
				\bar{\mathbf{\Theta}}_g^{(r+1)} = \mathbf{\Theta}_g^{(r)} + \mu \mathbf{D}_g^{(r)},
				\label{eq:update_additive}
			\end{equation}
			where $\mu$ is the step size refinable by the Armijo rule \cite{Armijo1966};
			\item \emph{Retract for feasibility \cite{Absil2009,Li2023b}:} The resulting point needs to be projected to the closest point (in terms of Euclidean distance) on the Stiefel manifold by
			\begin{equation}
				\mathbf{\Theta}_g^{(r+1)} = \bar{\mathbf{\Theta}}_g^{(r+1)} \bigl({\bar{\mathbf{\Theta}}_g^{(r+1)\mathsf{H}}} \bar{\mathbf{\Theta}}_g^{(r+1)}\bigr)^{-1/2}.
				\label{eq:retraction}
			\end{equation}
			One can also combine the addition \eqref{eq:update_additive} and retraction \eqref{eq:retraction} in one step
			\begin{equation}
				\mathbf{\Theta}_g^{(r+1)} = \bigl(\mathbf{\Theta}_g^{(r)} + \mu \mathbf{D}_g^{(r)}\bigr) \bigl( \mathbf{I} + \mu^2 {\mathbf{D}_g^{(r)\mathsf{H}}} \mathbf{D}_g^{(r)} \bigr)^{-1/2},
				\label{eq:add_then_retract}
			\end{equation}
			and determine the step size therein.
		\end{enumerate}

		The above method is called non-geodesic since the points are updated in the linear embedding spaces by addition \eqref{eq:update_additive} and retraction \eqref{eq:retraction}, instead of on the Stiefel manifold itself.
		It converges to stationary points of the original problem but usually requires a large number of iterations due to inefficient operations in the Euclidean space.

		% additive update \eqref{eq:update_additive} in the Euclidean space and retraction \eqref{eq:retraction}.
		% Those
	\end{subsection}

	% \begin{subsection}{Conventional Techniques}
	% 	Group-connected \gls{bd}-\gls{ris} design techniques formulated in terms of scattering matrix can be classified into two categories based on the optimization variable and hardware architecture:
	% 	\begin{itemize}
	% 		\item \emph{Scattering matrix $\mathbf{\Theta}$:} This approach is often exploited for asymmetric architectures where the feasible domain of each group is a $L$-dimensional Stiefel manifold $\mathbf{\Theta}_g \in \mathbb{U}^{L \times L}$. Due to its non-convexity, relevant problems are usually solved by general non-geodesic manifold optimization \cite{Li2023b,Li2023c,Bartoli2023} or relax-then-project methods \cite{Fang2023}. The former will be discussed in the next subsection.
	% 		\item \emph{Reactance matrix $\mathbf{X}$:\footnote{Similar design over susceptance matrix $\mathbf{B}$ can be found in \cite{Nerini2024}.}} This approach is often exploited for symmetric architectures where every pair of elements in the same group are connected by capacitors and inductors. According to network theory \cite{Pozar2011}, it maps to the scattering matrix by $\mathbf{\Theta}_g = (\jmath \mathbf{X}_g + Z_0 \mathbf{I})^{-1} (\jmath \mathbf{X}_g - Z_0 \mathbf{I})$, which formulates an unconstrained optimization problem on the upper triangular entries of $\{\mathbf{X}_g\}_{g \in \mathcal{G}}$ that is solvable by quasi-Newton methods \cite{Shen2020a}.
	% 	\end{itemize}
	% \end{subsection}

	\begin{subsection}{Geodesic \glsfmtshort{rcg}}
		Before introducing geodesic \gls{rcg}, we revisit some basic concepts in differential geometry and Lie algebra.
		% \cite{Abrudan2008,Abrudan2009}.
		A Lie group is simultaneously a continuous group and a differentiable manifold.
		Lie algebra refers to the tangent space of the Lie group at the identity element.
		The exponential map acts as a bridge between the Lie algebra and Lie group, which allows one to recapture the local group structure using linear algebra techniques.
		The set of unitary matrices $\mathbb{U}^{L \times L}$ forms a Lie group $U(L)$ under multiplication, and the corresponding Lie algebra $\mathfrak{u}(L) \triangleq \mathcal{T}_{\mathbf{I}}\mathbb{U}^{L \times L} = \{\mathbf{M} \in \mathbb{C}^{L \times L} \mid \mathbf{M}^\mathsf{H} + \mathbf{M} = \mathbf{0}\}$ consists of skew-Hermitian matrices.
		A geodesic emanating from the identity with velocity $\mathbf{D} \in \mathfrak{u}(L)$ can be described by \cite{Edelman1998}
		\begin{equation}
			\mathbf{G}_\mathbf{I}(\mu) = \exp(\mu \mathbf{D}),
			\label{eq:geodesic_identity}
		\end{equation}
		where $\exp(\mathbf{A}) = \sum_{k=0}^\infty (\mathbf{A}^k/k!)$ is the matrix exponential and $\mu$ is the step size (i.e., magnitude of the tangent vector).
		Note that the right translation is an isometry in $U(L)$.
		During the optimization of group $g$, the geodesic evaluated at the identity \eqref{eq:geodesic_identity} should be translated to $\mathbf{\Theta}_g^{(r)}$ for successive updates \cite{Abrudan2008}
		\begin{equation}
			\mathbf{G}_g^{(r)}(\mu) = \mathbf{G}_\mathbf{I}(\mu) \mathbf{\Theta}_g^{(r)} = \exp(\mu \mathbf{D}_g^{(r)}) \mathbf{\Theta}_g^{(r)},
			\label{eq:geodesic_translated}
		\end{equation}
		while the Riemannian gradient evaluated at $\mathbf{\Theta}_g^{(r)}$ \eqref{eq:gradient_riemannian} should be translated back to the identity for exploiting the Lie algebra \cite{Abrudan2008}
		\begin{equation}
			\tilde{\nabla}_{\mathrm{R},g}^{(r)} = \nabla_{\mathrm{R},g}^{(r)} \mathbf{\Theta}_g^{(r)\mathsf{H}} = \nabla_{\mathrm{E},g}^{(r)} \mathbf{\Theta}_g^{(r)\mathsf{H}} - \mathbf{\Theta}_g^{(r)} {\nabla_{\mathrm{E},g}^{(r)\mathsf{H}}}.
			% $\mathcal{O}(2 L^3)$
			\label{eq:gradient_translated}
		\end{equation}
		After gradient translation, the deviation parameter and conjugate direction can be determined similarly to \eqref{eq:parameter_cg} and \eqref{eq:direction_cg}
		\begin{equation}
			\tilde{\gamma}_g^{(r)} = \frac{\mathrm{tr}\bigl((\tilde{\nabla}_{\mathrm{R},g}^{(r)} - \tilde{\nabla}_{\mathrm{R},g}^{(r-1)}) {\tilde{\nabla}_{\mathrm{R},g}^{(r)\mathsf{H}}}\bigr)}{\mathrm{tr}\bigl(\tilde{\nabla}_{\mathrm{R},g}^{(r-1)} {\tilde{\nabla}_{\mathrm{R},g}^{(r-1)\mathsf{H}}}\bigr)}. % $\mathcal{O}(2 N_\mathrm{S}^3 + N_\mathrm{S}^2 + 2 N_\mathrm{S})$
			\label{eq:parameter_cg_geodesic}
		\end{equation}
		\begin{equation}
			{\mathbf{D}}_g^{(r)} = \tilde{\nabla}_{\mathrm{R},g}^{(r)} + \tilde{\gamma}_g^{(r)} {\mathbf{D}}_g^{(r-1)},
			\label{eq:direction_cg_geodesic}
		\end{equation}
		The solution can thus be updated along the geodesic in a multiplicative rotational manner
		\begin{equation}
			\mathbf{\Theta}_g^{(r+1)} = \mathbf{G}_g^{(r)}(\mu) = \exp(\mu \mathbf{D}_g^{(r)}) \mathbf{\Theta}_g^{(r)},
			\label{eq:update_geodesic}
		\end{equation}
		where an appropriate $\mu$ may be obtained by the Armijo rule.
		To double the step size, one can simply square the rotation matrix instead of recomputing the matrix exponential, since $\exp^2(\mu \mathbf{D}_g^{(r)}) = \exp(2 \mu \mathbf{D}_g^{(r)})$.

		\setalgorithmcaptionfont{\small}
		\begin{algorithm}[!t]
			\small
			\caption{Group-wise geodesic \gls{rcg} for \gls{bd}-\gls{ris} design}
			\label{ag:rcg}
			\begin{algorithmic}[1]
				\Require $f(\mathbf{\Theta})$, $G$
				\Ensure $\mathbf{\Theta}^\star$
				\Initialize {$r \gets 0$, $\mathbf{\Theta}^{(0)}$}
				\Repeat
					\For {$g \gets 1$ to $G$}
						\State $\nabla_{\mathrm{E},g}^{(r)} \gets$ \eqref{eq:gradient_euclidean} \label{ln:gradient_euclidean}
						\State $\tilde{\nabla}_{\mathrm{R},g}^{(r)} \gets$ \eqref{eq:gradient_translated}
						\State $\tilde{\gamma}_g^{(r)} \gets$ \eqref{eq:parameter_cg_geodesic}
						\State $\mathbf{D}_g^{(r)} \gets$ \eqref{eq:direction_cg_geodesic}
						\If {$\Re\bigl\{\mathrm{tr}({\mathbf{D}_g^{(r)\mathsf{H}}} \tilde{\nabla}_{\mathrm{R},g}^{(r)})\bigr\} < 0$} \Comment{not an ascent direction}
							\State $\mathbf{D}_g^{(r)} \gets \tilde{\nabla}_{\mathrm{R},g}^{(r)}$
						\EndIf
						\State $\mu \gets 1$
						\State $\mathbf{G}_g^{(r)}(\mu) \gets$ \eqref{eq:geodesic_translated}
						\While {$f\bigl(\mathbf{G}_g^{(r)}(2\mu)\bigr) - f(\mathbf{\Theta}_g^{(r)}) \ge \mu \cdot \mathrm{tr}(\mathbf{D}_g^{(r)} {\mathbf{D}_g^{(r)\mathsf{H}}}) / 2$} \label{ln:armijo_start}
							\State $\mu \gets 2 \mu$
						\EndWhile
						\While {$f\bigl(\mathbf{G}_g^{(r)}(\mu)\bigr) - f(\mathbf{\Theta}_g^{(r)}) < \mu / 2 \cdot \mathrm{tr}(\mathbf{D}_g^{(r)} {\mathbf{D}_g^{(r)\mathsf{H}}}) / 2$}
							\State $\mu \gets \mu / 2$
						\EndWhile \label{ln:armijo_end}
						\State $\mathbf{\Theta}_g^{(r+1)} \gets$ \eqref{eq:update_geodesic}
					\EndFor
					\State $r \gets r+1$
				\Until $\lvert f(\mathbf{\Theta}^{(r)}) - f(\mathbf{\Theta}^{(r-1)}) \rvert / f(\mathbf{\Theta}^{(r-1)}) \le \epsilon$
			\end{algorithmic}
		\end{algorithm}

		Algorithm~\ref{ag:rcg} summarizes the proposed \gls{bd}-\gls{ris} design framework based on group-wise geodesic \gls{rcg}.
		Compared to the non-geodesic approach, it leverages the Lie group properties to replace the add-then-retract update \eqref{eq:add_then_retract} with a multiplicative rotational update \eqref{eq:update_geodesic} along the geodesic.
		This leads to faster convergence and simplifies the step size tuning thanks to appropriate parameter space.
		% Despite the difference in
		Convergence to a local optimum is still guaranteed if not initialized at a stationary point.
		Note that the group-wise updates can be performed in parallel to facilitate large-scale \gls{bd}-\gls{ris} optimization problems.
		Since block-unitary matrices are also closed under multiplication, one can avoid group-wise updates by directly operating on $\mathbf{\Theta}$ and pinching (i.e., keeping the block diagonal and nulling the other entries) the Euclidean gradient \eqref{eq:gradient_euclidean}, with potentially higher computational complexity and slower convergence.
	\end{subsection}
\end{section}

\begin{section}{Channel Singular Values Redistribution}
	\label{sc:singular_value}
	In this section, we first provide a toy example to illustrate the channel shaping advantage of \gls{bd}-\gls{ris} architecture.
	Next, we numerically characterize the channel singular value region based on the proposed Algorithm \ref{ag:rcg}.
	Finally, we derive some analytical singular value bounds in specific scenarios.
	\begin{subsection}{Toy Example}\label{sc:toy_example}
		We first illustrate the channel shaping capabilities of different \gls{ris} models by a toy example.
		Consider a $2 \times 2 \times 2$ setup where the direct link is blocked.
		The diagonal \gls{ris} is modeled by $\mathbf{\Theta}_\mathrm{D} = \mathrm{diag}(e^{\jmath \theta_1}, e^{\jmath \theta_2})$ while the fully-connected \gls{bd}-\gls{ris} has 4 independent angular parameters
		\begin{equation}
			\mathbf{\Theta}_\mathrm{U} = e^{\jmath \phi} \begin{bmatrix}
				e^{\jmath \alpha} \cos \psi  & e^{\jmath \beta} \sin \psi   \\
				-e^{-\jmath \beta} \sin \psi & e^{-\jmath \alpha} \cos \psi
			\end{bmatrix}.
			\label{eq:unitary_ris}
		\end{equation}
		It is worth noting that $\phi$ has no impact on the singular value because $\mathrm{sv}(e^{\jmath \phi} \mathbf{A}) = \mathrm{sv}(\mathbf{A})$.
		To simplify the analysis, we also enforce symmetry $\mathbf{\Theta}_\mathrm{U} = \mathbf{\Theta}_\mathrm{U}^\mathsf{T}$ by $\beta = \pi / 2$ such that both architectures have the same number of variables in the scattering matrix.
		\begin{figure}
			\centering
			\includegraphics[width=\columnwidth]{assets/simulation/singular_trend.eps}
			\caption{$2 \times 2 \times 2$ (no direct) channel singular value shaping by diagonal \gls{ris} and symmetric fully-connected \gls{bd}-\gls{ris}.}
			\label{fg:singular_trend}
		\end{figure}
		Fig.~\ref{fg:singular_trend} compares the achievable singular values of one typical channel realization, where the direct channel is blocked and the forward and backward channels are normalized Rayleigh fading
		\begin{equation*}
			\begin{split}
				\mathbf{H}_\mathrm{B} & =
				\begin{bmatrix}
					-0.2059 + 0.5914 \jmath & -0.0909 + 0.5861 \jmath \\
					0.4131 + 0.2651 \jmath & -0.1960 + 0.4650 \jmath
				\end{bmatrix},
				\\
				\mathbf{H}_\mathrm{F} & =
				\begin{bmatrix}
					-0.6362 + 0.1332 \jmath & -0.1572 + 1.5538 \jmath \\
					0.0196 + 0.4011 \jmath & -0.3170 - 0.2303 \jmath
				\end{bmatrix}.
			\end{split}
		\end{equation*}
		The results are obtained by an exhaustive grid search over $(\theta_1, \theta_2)$ for diagonal \gls{ris} and $(\alpha, \psi)$ for symmetric fully-connected \gls{bd}-\gls{ris}.
		In this example, we observe that both singular values can be manipulated up to\footnote{The percentage for manipulating the $n$-th channel singular value is calculated by $\eta_n = \frac{\max \sigma_n(\mathbf{H}) - \min \sigma_n(\mathbf{H})}{2 \bar{\sigma}_n(\mathbf{H})} \times 100\%$. In this case, we notice $\eta_1=\eta_2$ for both \gls{ris} architectures.} $9\%$ by diagonal \gls{ris} (using 2 reconfigurable impedances) and $42\%$ by symmetric fully-connected \gls{bd}-\gls{ris} (using 3 reconfigurable impedances).
		% , where the former needs 2 reconfigurable impedances and the latter needs 3.
		The extra performance gain comes purely from connecting both scattering elements, and a larger gain is expected an asymmetric reconfigurable component is available.
		% and a larger gain is expected when an asymmetric connection is available.
		This example shows that \gls{bd}-\gls{ris} can provide a wider dynamic range of channel singular values and motivates further studies on channel shaping.
	\end{subsection}

	\begin{subsection}{Pareto Frontier Characterization}\label{sc:pareto_frontier}
		We then characterize the Pareto frontier of singular values of a general $N_\mathrm{T} \times N_\mathrm{S} \times N_\mathrm{R}$ channel \eqref{eq:channel_equivalent} by maximizing their weighted sum
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{\sum_n \rho_n \sigma_n(\mathbf{H})}{\label{op:pareto}}{\label{ob:pareto}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I},}{\quad \forall g,}{\label{co:pareto_unitary}}
		\end{maxi!}
		where $n \in \mathcal{N} \triangleq \{1,\ldots,N\}$, $N \triangleq \min(N_\mathrm{T}, N_\mathrm{R})$ is the maximum channel rank, and $\rho_n$ is the weight of the $n$-th singular value that can be positive, zero, or negative.
		Varying $\{\rho_n\}_{n \in \mathcal{N}}$ characterizes the Pareto frontier that encloses the entire singular value region.
		Thus, we claim problem \eqref{op:pareto} generalizes most singular value shaping problems.
		It can be solved optimally by Algorithm~\ref{ag:rcg} with the Euclidean gradient given by Lemma \ref{lm:pareto_gradient}.
		% It can be solved optimally by Algorithm~\ref{ag:rcg} where line \ref{ln:gradient_euclidean} uses the following Euclidean gradient expression \eqref{eq:pareto_gradient}.

		\begin{lemma}\label{lm:pareto_gradient}
			The Euclidean gradient of \eqref{ob:pareto} with respect to \gls{bd}-\gls{ris} group $g$ is
			\begin{equation}
				\frac{\partial \sum_n \rho_n \sigma_n(\mathbf{H})}{\partial \mathbf{\Theta}_g^*} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{U} \mathrm{diag}(\rho_1,\ldots,\rho_N) \mathbf{V}^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^\mathsf{H},
				\label{eq:pareto_gradient}
			\end{equation}
			where $\mathbf{U}$ and $\mathbf{V}$ are the left and right compact singular matrices of $\mathbf{H}$, respectively.
		\end{lemma}
		\begin{proof}
			Please refer to Appendix~\ref{ap:pareto_gradient}.
		\end{proof}

		We then analyze the computational complexity of solving Pareto singular value problem \eqref{op:pareto} by Algorithm~\ref{ag:rcg}.
		To update each \gls{bd}-\gls{ris} group, compact \gls{svd} of $\mathbf{H}$ requires $\mathcal{O}(N N_\mathrm{T} N_\mathrm{R})$, Euclidean gradient \eqref{eq:pareto_gradient} requires $\mathcal{O}\bigl(L N (N_\mathrm{T}+N_\mathrm{R}+L+1) \bigr)$, Riemannian gradient translation \eqref{eq:gradient_translated} requires $\mathcal{O}(L^3)$, deviation parameter \eqref{eq:parameter_cg_geodesic} and conjugate direction \eqref{eq:direction_cg_geodesic} together require $\mathcal{O}(L^2)$, and matrix exponential \eqref{eq:update_geodesic} requires $\mathcal{O}(L^3)$ operations \cite{Moler2003}.
		The overall complexity is thus $\mathcal{O}\bigl(I_\text{RCG} G \bigl(N N_\mathrm{T} N_\mathrm{R} + L N (N_\mathrm{T}+N_\mathrm{R}+L+1) + I_\text{BLS} L^3\bigr)\bigr)$, where $I_\text{RCG}$ and $I_\text{BLS}$ are the number of iterations for geodesic \gls{rcg} and backtracking line search (line \ref{ln:armijo_start}--\ref{ln:armijo_end} of Algorithm \ref{ag:rcg}), respectively.
	\end{subsection}

	\begin{subsection}{Some Analytical Bounds}\label{sc:bounds}
		We then discuss some analytical bounds related to channel singular values, which help us to explore and understand the channel shaping limits of passive \gls{ris}.

		\gls{dof} (a.k.a. multiplexing gain) refers to the maximum number of independent streams that can be transmitted in parallel over a \gls{mimo} channel, which is defined as
		\begin{equation}
			d = \lim_{\rho \to \infty} \frac{\log \det(\mathbf{I} + \rho \mathbf{H} \mathbf{H}^\mathsf{H})}{\log \rho},
		\end{equation}
		where $\rho$ is the \gls{snr}.
		\begin{proposition}[Degree of freedom]\label{pp:dof}
			In point-to-point \gls{mimo}, \gls{bd}-\gls{ris} cannot achieve a higher \gls{dof} than diagonal \gls{ris}.
		\end{proposition}
		\begin{proof}
			Please refer to Appendix~\ref{ap:dof}.
		\end{proof}

		\begin{proposition}[Rank-deficient channel]\label{pp:rank_deficient}
			% If the forward or backward channel is rank-$k$ ($k \le N$),
			If the minimum rank of forward and backward channels is $k$ ($k \le N$),
			then for diagonal \gls{ris} or \gls{bd}-\gls{ris} of arbitrary number of elements, the $n$-th singular value of the equivalent channel is bounded above and below respectively by
			\begin{subequations}
				\begin{align}
					\sigma_n(\mathbf{H}) & \le \sigma_{n-k}(\mathbf{T}), &  & \text{if } n > k, \label{iq:sv_bound_enlarge}          \\
					\sigma_n(\mathbf{H}) & \ge \sigma_n(\mathbf{T}),     &  & \text{if } n < N - k + 1, \label{iq:sv_bound_suppress}
				\end{align}
				\label{iq:sv_bound_rank_deficient}
			\end{subequations}
			where $\mathbf{T}$ is an auxiliary matrix satisfying
			\begin{equation}
				\mathbf{T} \mathbf{T}^\mathsf{H} =
				\begin{cases}
					\mathbf{H}_\mathrm{D} (\mathbf{I} - \mathbf{V}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}) \mathbf{H}_\mathrm{D}^\mathsf{H}, & \text{if } \mathrm{rank}(\mathbf{H}_\mathrm{F}) = k, \\
					\mathbf{H}_\mathrm{D}^\mathsf{H} (\mathbf{I} - \mathbf{U}_\mathrm{B} \mathbf{U}_\mathrm{B}^\mathsf{H}) \mathbf{H}_\mathrm{D}, & \text{if } \mathrm{rank}(\mathbf{H}_\mathrm{B}) = k,
				\end{cases}
				\label{eq:auxiliary_matrix}
			\end{equation}
			and $\mathbf{V}_\mathrm{F}$ and $\mathbf{U}_\mathrm{B}$ are the right and left compact singular matrices of $\mathbf{H}_\mathrm{F}$ and $\mathbf{H}_\mathrm{B}$, respectively.
		\end{proposition}
		\begin{proof}
			Please refer to Appendix~\ref{ap:rank_deficient}.
		\end{proof}

		Inequality \eqref{iq:sv_bound_enlarge} states that
		if the forward and backward channels are at least rank $k$, then
		% with a diagonal \gls{ris} or \gls{bd}-\gls{ris} of sufficiently large number of scattering elements,
		the $n$-th singular value of $\mathbf{H}$ can be enlarged to the $(n-k)$-th singular value of $\mathbf{T}$, or suppressed to the $n$-th singular value of $\mathbf{T}$.
		Moreover, the first $k$ channel singular values are unbounded above\footnote{The energy conservation law $\sum_n \sigma_n^2(\mathbf{H}) \le 1$ still has to be respected. This constraint is omitted in the following context for brevity.} while the last $k$ channel singular values can be suppressed to zero.
		An example is given in Corollary \ref{co:los} for \gls{los} channels (i.e., $k=1$)\footnote{We notice a similar eigenvalue result has been derived in \cite{Semmler2023} but is limited to diagonal \gls{ris}.}.
		% states that the $n$-th channel singular value can be enlarged to the $(n-k)$-th singular value of $\mathbf{T}$.


		% We would like to give some insights into Proposition \ref{pp:rank_deficient}.

		% \begin{corollary}[Extreme singular values\label{co:extreme}]
		% 	If the minimum rank of forward and backward channels is $k$ ($k \le N$), then with a diagonal \gls{ris} or \gls{bd}-\gls{ris} of sufficiently large number of scattering elements, the first $k$ channel singular values are unbounded above\footnote{The energy conservation law $\sum_n \sigma_n^2(\mathbf{H}) \le 1$ still has to be respected. This constraint is omitted in the following context for brevity.} while the last $k$ channel singular values can be suppressed to zero.
		% \end{corollary}

		% \begin{proof}
		% 	This is a direct result of \eqref{iq:sv_bound_rank_deficient}.
		% \end{proof}

		\begin{corollary}[\gls{los} channel\label{co:los}]
			% If the forward or backward channel is \gls{los}, then a \gls{ris} can at most enlarge (resp. suppress) the $n$-th ($n \ge 2$) channel singular value to the $(n-1)$-th (resp. $n$-th) singular value of $\mathbf{T}$, that is,
			If the forward or backward channel is \gls{los}, then a diagonal \gls{ris} or \gls{bd}-\gls{ris} can at most enlarge the $n$-th ($n \ge 2$) channel singular value to the $(n-1)$-th singular value of $\mathbf{T}$, or suppress the $n$-th channel singular value to the $n$-th singular value of $\mathbf{T}$.
			That is,
			\begin{equation}
				\sigma_1(\mathbf{H}) \ge \sigma_1(\mathbf{T}) \ge {\sigma_2(\mathbf{H})} \ge \ldots \ge \sigma_{N-1}(\mathbf{T}) \ge {\sigma_N(\mathbf{H})} \ge \sigma_N(\mathbf{T}).
				\label{iq:sv_bound_los}
			\end{equation}
		\end{corollary}

		\begin{proof}
			This is a direct result of \eqref{iq:sv_bound_rank_deficient} with $k = 1$.
		\end{proof}

		We would like to highlight that Proposition \ref{pp:rank_deficient} holds for both diagonal and \gls{bd}-\gls{ris} with arbitrary number of elements, regardless of the presence of direct channel.
		The bounds are asymptotically tight when the number of scattering elements approaches infinity.
		On the other hand, we will show in Section \ref{sc:simulation} that with a finite number of elements, \gls{bd}-\gls{ris} can approach those bounds better than diagonal \gls{ris}.
		Proposition \ref{pp:rank_deficient} evaluates the ultimate channel shaping limits of passive \gls{ris} and provides a selection guideline for scattering element number in a practical deployment scenario.


		\begin{proposition}[Blocked direct channel]\label{pp:fully_connected}
			% If the \gls{bd}-\gls{ris} is unitary and the direct link is blocked, then the singular value bounds on $\mathbf{H}$ are equivalent to the singular value bounds on $\mathbf{BF}$, where $\mathbf{B}$ and $\mathbf{F}$ are arbitrary matrices with the same singular values as $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$, respectively,

			If the direct link is blocked and the \gls{bd}-\gls{ris} is fully-connected, then the channel singular values can be manipulated up to
			% If the \gls{bd}-\gls{ris} is unitary and the direct link is blocked, then the bounds on the channel singular values are equivalent to the singular values of the equivalent channel, that is,
			% only bounds that apply here are those that apply to the singular values of
			\begin{equation}
				\mathrm{sv}(\mathbf{H}) = \mathrm{sv}(\mathbf{BF}),
			\end{equation}
			where $\mathbf{B}$ and $\mathbf{F}$ are arbitrary matrices with $\mathrm{sv}(\mathbf{B})=\mathrm{sv}(\mathbf{H}_\mathrm{B})$ and $\mathrm{sv}(\mathbf{F})=\mathrm{sv}(\mathbf{H}_\mathrm{F})$.
			% Our focus thus shifts to how the singular values of matrix product are bounded by the singular values of its individual factors.
		\end{proposition}

		\begin{proof}
			Please refer to Appendix~\ref{ap:fully_connected}.
		\end{proof}

		Proposition \ref{pp:fully_connected} states that if the direct channel is blocked and the \gls{bd}-\gls{ris} is fully-connected, the only singular value bounds on the equivalent channel are the singular value bounds on the product of unitary-transformed forward and backward channels.
		% , a group-connected \gls{bd}-\gls{ris} in its most powerful form can manipulate the channel singular values to any possible state with zero power loss.
		For example, consider a $2 \times 2 \times 2$ setup with
		% $\mathrm{sv}(\mathbf{H}_\mathrm{B}) = [3, 2]^\mathsf{T}$ and $\mathrm{sv}(\mathbf{H}_\mathrm{B}) = [4, 1]^\mathsf{T}$.
		\begin{equation*}
			\mathbf{H}_\mathrm{B} =
				\begin{bmatrix}
					3 & 0 \\
					0 & 2
				\end{bmatrix},
				\quad
				\mathbf{H}_\mathrm{F} =
				\begin{bmatrix}
					1 & 0 \\
					0 & 4
				\end{bmatrix}.
		\end{equation*}
		It is apparent that any diagonal \gls{ris} can only achieve singular values $\mathrm{sv}(\mathbf{H}) = [8, 3]^\mathsf{T}$, but a fully connected \gls{bd}-\gls{ris} with $\mathbf{\Theta} = \begin{bsmallmatrix} 0 & 1 \\ 1 & 0 \end{bsmallmatrix}$ can achieve $\mathrm{sv}(\mathbf{H}) = [12, 2]^\mathsf{T}$.
		That is, fully-connected \gls{bd}-\gls{ris} applies right unitary transformation on $\mathbf{H}_\mathrm{B}$ and left unitary transformation on $\mathbf{H}_\mathrm{F}$, widening the singular values to $8 \le \sigma_1(\mathbf{H}) \le 12$ and $2 \le \sigma_2(\mathbf{H}) \le 3$.

		Proposition \ref{pp:fully_connected} transforms the shaping capacity question to a mathematical one, namely how the singular values of matrix product are bounded by the singular values of its individual factors.
		Let $\bar{N} = \max(N_\mathrm{T},N_\mathrm{S},N_\mathrm{R})$ and $\sigma_n(\mathbf{H})=\sigma_n(\mathbf{H}_\mathrm{F})=\sigma_n(\mathbf{H}_\mathrm{B})=0$ for $N < n \le \bar{N}$.
		We have the following corollaries.

		\begin{corollary}[Generic singular value bounds\label{co:sv_bound_horn}]
			\begin{equation}
				\prod_{k \in {K}} \sigma_k(\mathbf{H}) \le \prod_{i \in {I}} \sigma_i(\mathbf{H}_\mathrm{B}) \prod_{j \in {J}} \sigma_j(\mathbf{H}_\mathrm{F}),
				\label{iq:sv_bound_fc}
			\end{equation}
			for all admissible triples $(I, J, K) \in T_r^{\bar{N}}$ with $r < \bar{N}$, where
			\begin{equation*}
				\begin{gathered}
					% T_r^{\bar{N}} \triangleq \Bigl\{(I, J, K) \in U_r^{\bar{N}} \mid \text{for all } p < r \text{ and all } (F, G, H) \text{ in } T_p^r,\\
					% \sum_{f \in F} i_f + \sum_{g \in G} j_g \le \sum_{h \in H} k_h + p(p+1)/2 \Bigr\},
					T_r^{\bar{N}} \triangleq \Bigl\{(I, J, K) \in U_r^{\bar{N}} \mid \forall p < r, (F, G, H) \in T_p^r,\\
					\sum_{f \in F} i_f + \sum_{g \in G} j_g \le \sum_{h \in H} k_h + p(p+1)/2 \Bigr\},
				\end{gathered}
			\end{equation*}
			\begin{equation*}
				U_r^{\bar{N}} \triangleq \Bigl\{(I, J, K) \mid \sum_{i \in I} i + \sum_{j \in J} j = \sum_{k \in K} k + r(r+1)/2\Bigr\}.
			\end{equation*}
		\end{corollary}

		\begin{proof}
			Please refer to \cite[Theorem~8]{Fulton2000}.
		\end{proof}

		Corollary \eqref{co:sv_bound_horn} is by far the most comprehensive singular value bound over Proposition~\ref{pp:fully_connected}, which is also recognized as a variation of Horn's inequality \cite{Bhatia2001}.
		It is worth mentioning that the number of admissible triples (and bounds) grows exponentially with $\bar{N}$.
		For example, the number of inequalities described by \eqref{iq:sv_bound_fc} grows from 12 to 2062 when $\bar{N}$ increases from 3 to 7.
		This renders the analytic approach computationally expensive for large-scale \gls{mimo} systems.
		Next, we showcase some useful inequalities enclosed by \eqref{iq:sv_bound_fc}.
		Readers are referred to \cite[Chapter 16, 24]{Hogben2013} for more examples.

		\begin{corollary}[Upper bound on the largest singular value\label{co:sv_largest}]
			\begin{equation}
				\sigma_1(\mathbf{H}) \le \sigma_1(\mathbf{H}_\mathrm{B}) \sigma_1(\mathbf{H}_\mathrm{F}).
			\end{equation}
		\end{corollary}

		\begin{proof}
			This is a direct result of \eqref{iq:sv_bound_fc} with $r = 1$.
		\end{proof}

		\begin{corollary}[Lower bound on the smallest singular value\label{co:sv_smallest}]
			\begin{equation}
				\sigma_{\bar{N}}(\mathbf{H}) \ge \sigma_{\bar{N}}(\mathbf{H}_\mathrm{B}) \sigma_{\bar{N}}(\mathbf{H}_\mathrm{F}).
			\end{equation}
		\end{corollary}

		\begin{proof}
			This can be deducted from \eqref{iq:sv_bound_fc} with $r_1 = \bar{N}{-}1$ and $r_2 = \bar{N}$.
		\end{proof}

		\begin{corollary}[Upper bound on the product of first $k$ singular values]
			\begin{equation}
				\prod_{n=1}^k \sigma_n(\mathbf{H}) \le \prod_{n=1}^k \sigma_n(\mathbf{H}_\mathrm{B}) \prod_{n=1}^k \sigma_n(\mathbf{H}_\mathrm{F}).
			\end{equation}
		\end{corollary}

		\begin{proof}
			This is a direct result of \eqref{iq:sv_bound_fc} with $r = k$.
		\end{proof}

		\begin{corollary}[Lower bound on the product of last $k$ singular values\label{co:sv_product_smallest}]
			\begin{equation}
				\prod_{n=\bar{N}}^{\bar{N}-k+1} \sigma_n(\mathbf{H}) \ge \prod_{n=\bar{N}}^{\bar{N}-k+1} \sigma_n(\mathbf{H}_\mathrm{B}) \prod_{n=\bar{N}}^{\bar{N}-k+1} \sigma_n(\mathbf{H}_\mathrm{F}).
			\end{equation}
		\end{corollary}

		\begin{proof}
			This can be deducted from \eqref{iq:sv_bound_fc} with $r_1 = \bar{N}-k$ and $r_2 = \bar{N}$.
		\end{proof}

		Corollaries \ref{co:sv_smallest} and \ref{co:sv_product_smallest} are less informative when $\bar{N} \ne N$ (i.e., unequal number of transmit and receive antennas and scattering elements) as the lower bounds would coincide at zero.

		% \begin{corollary}[Upper bound on the sum of first $k$ singular values to the positive $p$-th power\label{co:sum_power} {\cite[Inequality~24.4.7]{Hogben2013}}]
		% 	\begin{equation}
		% 		\sum_{n=1}^k \sigma_n^p(\mathbf{H}) \le \sum_{n=1}^k \sigma_n^p(\mathbf{H}_\mathrm{B}) \sigma_n^p(\mathbf{H}_\mathrm{F}), \quad p > 0.
		% 		\label{iq:sv_bound_fc_power}
		% 	\end{equation}
		% 	When $k = N$ and $p = 2$, \eqref{iq:sv_bound_fc_power} suggests the channel power is upper bounded by the sum of (sorted) element-wise power product of backward and forward channels
		% 	\begin{equation}
		% 		\lVert \mathbf{H} \rVert _\mathrm{F}^2 \le \sum_{n=1}^N \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F}),
		% 	\end{equation}
		% \end{corollary}

		\begin{corollary}[Upper bound on the channel power gain\label{co:sum_power}]
			% The channel power gain is upper bounded by the sum of sorted element-wise power product of backward and forward channels
			The channel power gain is upper bounded by the sum of sorted element-wise product of squared singular values of backward and forward channels
			\begin{equation}
				\lVert \mathbf{H} \rVert _\mathrm{F}^2 = \sum_{n=1}^N \sigma_n^2(\mathbf{H}) \le \sum_{n=1}^N \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F}).
				\label{iq:power_gain}
			\end{equation}
		\end{corollary}

		\begin{proof}
			Please refer to \cite[Inequality~24.4.7]{Hogben2013}.
		\end{proof}

		To achieve the equalities in Corollaries \eqref{co:sv_largest} -- \eqref{co:sum_power}, the \gls{ris} needs to completely align the spaces of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$.
		The resulting scattering matrix is generally required to be unitary
		\begin{equation}
			\mathbf{\Theta}^\star = \mathbf{V}_\mathrm{B} \mathbf{U}_\mathrm{F}^\mathsf{H},
			\label{eq:scattering_fc_optimal}
		\end{equation}
		which can be concluded from \eqref{eq:scattering_fc} and \eqref{eq:channel_equivalent_fc} in Appendix~\ref{ap:fully_connected}.
		Interestingly, diagonal \gls{ris} can attain those equalities if and only if $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ are both rank-1.
		In such case, the equivalent channel reduces to $\mathbf{H} = \sigma_\mathrm{B} \sigma_\mathrm{F} \mathbf{u}_\mathrm{B} \mathbf{v}_\mathrm{B}^\mathsf{H} \mathbf{\Theta} \mathbf{u}_\mathrm{F} \mathbf{v}_\mathrm{F}^\mathsf{H}$ and the \gls{ris} only needs to align $\mathbf{v}_\mathrm{B}^\mathsf{H}$ and $\mathbf{u}_\mathrm{F}$ by
		\begin{equation}
			\mathbf{\Theta}^\star = \mathbf{v}_\mathrm{B} \mathbf{u}_\mathrm{F}^\mathsf{H} \odot \mathbf{I},
		\end{equation}
		which becomes a special case of \eqref{eq:scattering_siso}.
		On the other hand, when $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ are both in Rayleigh fading, the expected maximum channel power gain $\mathbb{E}\bigl\{ \lVert \mathbf{H} \rVert _ \mathrm{F} \bigr\}_{\max}$ can be evaluated as
		\begin{equation}
			\sum_{n=1}^N \int_0^\infty f_{\lambda_n^{\min(N_\mathrm{R},N_\mathrm{S})}}(x_n) d x_n \int_0^\infty f_{\lambda_n^{\min(N_\mathrm{S},N_\mathrm{T})}}(x_n) d x_n,
			\label{eq:power_gain_rayleigh}
		\end{equation}
		where $\lambda_n^{K}$ is the $n$-th eigenvalue of the complex $K \times K$ Wishart matrix with probability density function $f_{\lambda_n^{K}}(x_n)$ given by \cite[Equation 51]{Zanella2009}.
		We notice \eqref{eq:power_gain_rayleigh} is a generalization of \cite[Equation 58]{Shen2020a} to \gls{mimo}.

		Proposition \ref{pp:fully_connected} and Corollaries \ref{co:sv_largest} -- \ref{co:sum_power} provide a comprehensive answer to singular value bounds and channel power gain limits for fully-connected \gls{bd}-\gls{ris} with blocked direct channel.
		% understanding of the channel power gain limits of passive \gls{ris}.
		% and suggest the impact of channel rearrangement and space alignment on redistributing channel singular values.
		Tight bounds are inapplicable in more general cases since the direct-indirect channels and backward-forward channels cannot be completely aligned at the same time.
		In such case, we can exploit optimization approaches from a singular value perspective (Section~\ref{sc:pareto_frontier}) or a power gain perspective (Section~\ref{sc:power}).
	\end{subsection}
\end{section}

\begin{section}{Power Gain and Achievable Rate Maximization}
	\label{sc:power_rate}
	\begin{subsection}{Channel Power Gain}\label{sc:power}
		The \gls{mimo} channel power gain maximization problem is formulated with respect to the \gls{bd}-\gls{ris} scattering matrix
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2}{\label{op:power_passive}}{\label{ob:power_passive}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
		\end{maxi!}
		which generalizes the case of \gls{siso} \cite{Shen2020a}, \gls{miso} \cite{Santamaria2023,Fang2023}, single-stream \gls{mimo} \cite{Nerini2023,Nerini2023b}, and direct link-blocked \gls{mimo} with fully-connected \gls{bd}-\gls{ris} \eqref{eq:scattering_fc_optimal}.
		The key of solving \eqref{op:power_passive} is to balance the additive and multiplicative space alignments.

		\begin{remark}
			Interestingly, in terms of maximizing the inner product $\langle \mathbf{H}_\mathrm{D}, \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rangle$, \eqref{op:power_passive} is reminiscent of the weighted orthogonal Procrustes problem \cite{Gower2004}
			\begin{mini!}
				{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{D} - \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2}{\label{op:weighted_orthogonal_procrustes}}{}
				\addConstraint{\mathbf{\Theta}^\mathsf{H} \mathbf{\Theta}=\mathbf{I},}{\label{cs:power_block_unitary}}{}
			\end{mini!}
			which relaxes the block-unitary constraint \eqref{cs:power_block_unitary} to unitary but still has no trivial solution.
			One lossy transformation exploits the Moore-Penrose inverse and moves $\mathbf{\Theta}$ to one side of the product \cite{Bell2003}, formulating two standard orthogonal Procrustes problems
			\begin{mini!}
				{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{B}^\dagger \mathbf{H}_\mathrm{D} - \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2 \text{ or } \lVert \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\dagger - \mathbf{H}_\mathrm{B} \mathbf{\Theta} \rVert _\mathrm{F}^2}{\label{op:standard_orthogonal_procrustes}}{}
				\addConstraint{\mathbf{\Theta}^\mathsf{H} \mathbf{\Theta}=\mathbf{I},}{}{}
			\end{mini!}
			which have global optimal solutions
			\begin{equation}
				\mathbf{\Theta} = \mathbf{U} \mathbf{V}^\mathsf{H},
				\label{eq:orthogonal_procrustes_solution}
			\end{equation}
			where $\mathbf{U}$ and $\mathbf{V}$ are respectively the left and right compact singular matrices of $\mathbf{H}_\mathrm{B}^\dagger \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}$ or $\mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\dagger$ \cite{Golub2013}.
			We emphasize that \eqref{eq:scattering_fc_optimal} and \eqref{eq:orthogonal_procrustes_solution} are valid fully-connected \gls{bd}-\gls{ris} solutions to \eqref{op:power_passive} when the direct link is blocked and present, but the latter is neither optimal nor a generalization of the former due to the lossy transformation.
		\end{remark}

		Inspired by \cite{Nie2017}, we propose an optimal solution to problem \eqref{op:power_passive} with arbitrary group size.
		The idea is to successively approximate the quadratic objective \eqref{ob:power_passive} by local Taylor expansions and solve each step in closed form by group-wise \gls{svd}.

		\begin{proposition}\label{pp:power}
			Starting from any feasible $\mathbf{\Theta}^{(0)}$, the sequence
			\begin{equation}
				\mathbf{\Theta}_g^{(r+1)} = \mathbf{U}_g^{(r)} \mathbf{V}_g^{(r)}, \quad \forall g.
				\label{eq:scattering_power}
			\end{equation}
			converges to a stationary point of \eqref{op:power_passive}, where $\mathbf{U}_g^{(r)}$ and $\mathbf{V}_g^{(r)}$ are the left and right compact singular matrices of
			\begin{equation}
				\mathbf{M}_g^{(r)} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \Bigl(\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathrm{diag}\bigl(\mathbf{\Theta}_{[1:g-1]}^{(r+1)},\mathbf{\Theta}_{[g:G]}^{(r)}\bigr) \mathbf{H}_\mathrm{F}\Bigr) \mathbf{H}_{\mathrm{F},g}^\mathsf{H}
				\label{eq:auxiliary_matrix_power}
			\end{equation}
		\end{proposition}

		\begin{proof}
			Please refer to Appendix~\ref{ap:power}.
		\end{proof}

		We then analyze the computational complexity of solving channel gain maximization problem \eqref{op:power_passive} by Proposition \ref{pp:power}.
		To update each \gls{bd}-\gls{ris} group, matrix multiplication \eqref{eq:auxiliary_matrix_power} requires $\mathcal{O}\bigl(N_\mathrm{T} N_\mathrm{R} + (G+1)(NL^2+N_\mathrm{T} N_\mathrm{R} L)\bigr)$ operations and its compact \gls{svd} requires $\mathcal{O}(L^3)$ operations.
		The overall complexity is thus $\mathcal{O}\bigl(I_\text{SAA} G \bigl(N_\mathrm{T} N_\mathrm{R} + (G+1)(NL^2+N_\mathrm{T} N_\mathrm{R} L) + L^3\bigr)\bigr)$, where $I_\text{SAA}$ is the number iterations for successive affine approximation.
	\end{subsection}

	\begin{subsection}{Achievable Rate Maximization}\label{sc:rate}
		We aim to maximize the achievable rate of the \gls{bd}-\gls{ris}-aided \gls{mimo} system by jointly optimizing the active and passive beamforming
		\begin{maxi!}
			{\scriptstyle{\mathbf{W},\mathbf{\Theta}}}{R = \log \det \biggl(\mathbf{I} + \frac{\mathbf{W}^\mathsf{H}\mathbf{H}^\mathsf{H}\mathbf{H}\mathbf{W}}{\eta}\biggr)}{\label{op:rate}}{\label{ob:rate}}
			\addConstraint{\lVert \mathbf{W} \rVert _\mathrm{F}^2}{\le P}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g}{=\mathbf{I}, \quad \forall g,\label{cs:rate_block_unitary}}
		\end{maxi!}
		where $\mathbf{W}$ is the transmit precoder, $R$ is the achievable rate, $\eta$ is the average noise power, and $P$ is the transmit power constraint.
		Problem \eqref{op:rate} is non-convex due to the block-unitary constraint \eqref{cs:rate_block_unitary} and the coupling between variables.
		We propose a local-optimal approach via \gls{ao} and a low-complexity approach based on channel shaping.

		\begin{subsubsection}{Alternating Optimization}
			This approach updates $\mathbf{\Theta}$ and $\mathbf{W}$ iteratively until convergence.
			For a given $\mathbf{W}$, the passive beamforming subproblem is
			\begin{maxi!}
				{\scriptstyle{\mathbf{\Theta}}}{\log \det \biggl(\mathbf{I} + \frac{\mathbf{H} \mathbf{Q} \mathbf{H}^\mathsf{H}}{\eta}\biggr)}{\label{op:rate_passive}}{\label{ob:rate_passive}}
				\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
			\end{maxi!}
			where $\mathbf{Q} \triangleq \mathbf{W} \mathbf{W}^\mathsf{H}$ is the transmit covariance matrix.
			Problem \eqref{op:rate_passive} can be solved optimally by Algorithm \ref{ag:rcg} with the Euclidean gradient given by Lemma \ref{lm:rate_gradient}.
			\begin{lemma}\label{lm:rate_gradient}
				The Euclidean gradient of \eqref{ob:rate_passive} with respect to \gls{bd}-\gls{ris} block $g$ is
				\begin{equation}
					\frac{\partial R}{\partial \mathbf{\Theta}_g^*} = \frac{1}{\eta} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \biggl(\mathbf{I} + \frac{\mathbf{H}\mathbf{Q}\mathbf{H}^\mathsf{H}}{\eta}\biggr)^{-1} \mathbf{H} \mathbf{Q} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}.
					\label{eq:rate_gradient}
				\end{equation}
			\end{lemma}

			\begin{proof}
				Please refer to Appendix~\ref{ap:rate_gradient}.
			\end{proof}
			For a given $\mathbf{\Theta}$, the global optimal transmit precoder is given by eigenmode transmission \cite{Clerckx2013}
			\begin{equation}
				\mathbf{W}^\star = \mathbf{V} {\mathrm{diag}(\mathbf{s}^\star)}^{1/2},
				\label{eq:precoder_eigenmode}
			\end{equation}
			where $\mathbf{V}$ is the right singular matrix of the equivalent channel and $\mathbf{s}^\star$ is the optimal water-filling power allocation obtainable by the iterative method \cite{Tse2005}.

			The \gls{ao} algorithm is guaranteed to converge to local-optimal points of problem \eqref{op:rate} since each subproblem is solved optimally and the objective is bounded above.
			Similar to the analysis in Section \ref{sc:pareto_frontier}, the computational complexity of solving subproblem \eqref{op:rate_passive} by geodesic \gls{rcg} is $\mathcal{O}\bigl(I_\text{RCG} G (NL^2 + L N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} L^3)\bigr)$.
			On the other hand, the complexity of solving active beamforming subproblem by \eqref{eq:precoder_eigenmode} is $\mathcal{O}\bigl(N N_\mathrm{T} N_\mathrm{R}\bigr)$.
			The overall complexity is thus $\mathcal{O}\bigl(I_\text{AO}\bigl(I_\text{RCG} G (NL^2 + L N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} L^3) + N N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$, where $I_\text{AO}$ is the number of iterations for \gls{ao}.
		\end{subsubsection}

		\begin{subsubsection}{Low-Complexity Solution}\label{sc:low_complexity}
			We then propose a suboptimal two-stage solution to problem \eqref{op:rate} that decouples the joint \gls{ris}-transceiver design.
			The idea is to first consider channel shaping and replace the rate maximization subproblem \eqref{op:rate_passive} by channel power gain maximization problem \eqref{op:power_passive}, then proceed to conventional eigenmode transmission \eqref{eq:precoder_eigenmode}.
			Both steps are solved in closed form and the computational complexity is $\mathcal{O}\bigl(I_\text{SAA} G \bigl(N_\mathrm{T} N_\mathrm{R} + (G+1)(NL^2+N_\mathrm{T} N_\mathrm{R} L) + L^3\bigr) + N N_\mathrm{T} N_\mathrm{R}\bigr)$.
			While suboptimal, this shaping-inspired solution avoids outer iterations and implements inner iterations more efficiently.
		\end{subsubsection}
	\end{subsection}
\end{section}

\begin{section}{Simulation Results}\label{sc:simulation}
	In this section, we provide numerical results to evaluate the proposed \gls{bd}-\gls{ris} designs.
	Consider a distance-dependent path loss model $\Lambda(d) = \Lambda_0 d^{-\gamma}$ where $\Lambda_0$ is the reference path loss at distance \qty{1}{m}, $d$ is the propagation distance, and $\gamma$ is the path loss exponent.
	The small-scale fading model is $\mathbf{H} = \sqrt{\kappa/(1+\kappa)} \mathbf{H}_\text{LoS} + \sqrt{1/(1+\kappa)} \mathbf{H}_\text{NLoS}$, where $\kappa$ is the Rician $K$-factor, $\mathbf{H}_\text{LoS}$ is the deterministic \gls{los} component, and $\mathbf{H}_\text{NLoS} \sim \mathcal{CN}(\mathbf{0}, \mathbf{I})$ is the Rayleigh component.
	We set $\Lambda_0=\qty{-30}{dB}$, $d_\mathrm{D}=\qty{14.7}{m}$, $d_\mathrm{F}=\qty{10}{m}$, $d_\mathrm{B}=\qty{6.3}{m}$, $\gamma_\mathrm{D}=3$, $\gamma_\mathrm{F}=2.4$ and $\gamma_\mathrm{B}=2$ for reference, which corresponds to a typical indoor environment with $\Lambda_\mathrm{D}=\qty{-65}{dB}$, $\Lambda_\mathrm{F}=\qty{-54}{dB}$, $\Lambda_\mathrm{B}=\qty{-46}{dB}$.
	The indirect path via \gls{ris} is thus \qty{35}{\dB} weaker than the direct path.
	Rayleigh fading (i.e., $\kappa = 0$) is assumed for all channels unless otherwise specified.

	\begin{subsection}{Algorithm Evaluation}
		\begin{table*}[!t]
			\caption{Average Performance of Geodesic and Non-Geodesic \gls{rcg} Algorithms on Problem \eqref{op:pareto}}
			\label{tb:complexity_test}
			\centering
			\begin{tabular}{ccccccc}
				\toprule
				\multirow{2}{*}{\gls{rcg} path} & \multicolumn{3}{c}{$N_\mathrm{S}=16$} & \multicolumn{3}{c}{$N_\mathrm{S}=256$}                                                               \\ \cmidrule(lr){2-4} \cmidrule(lr){5-7}
												& Objective                             & Iterations                             & Time [s]         & Objective        & Iterations & Time [s] \\ \midrule
				Geodesic                        & $\num{4.359e-3}$                      & 11.59                                  & $\num{1.839e-2}$ & $\num{1.163e-2}$ & 25.58      & 3.461    \\
				Non-geodesic                    & $\num{4.329e-3}$                      & 30.92                                  & $\num{5.743e-2}$ & $\num{1.116e-2}$ & 61.40      & 13.50    \\ \bottomrule
			\end{tabular}
		\end{table*}
		We first compare in Table \ref{tb:complexity_test} the geodesic and non-geodesic \gls{rcg} algorithm on problem \eqref{op:pareto} in an $N_\mathrm{T}=N_\mathrm{S}=4$ system with \gls{bd}-\gls{ris} group size $L=4$.
		The statistics are averaged over \num{100} independent runs.
		It is observed that the geodesic \gls{rcg} method achieves a slightly higher objective value with significantly (up to 3$\times$) lower number of iterations and shorter (up to 4$\times$) computational time than the non-geodesic method.
		The results demonstrate the efficiency of the proposed geodesic \gls{rcg} algorithm especially in large-scale \gls{bd}-\gls{ris} design problems.
	\end{subsection}

	\begin{subsection}{Channel Singular Values Redistribution}
		\begin{subsubsection}{Pareto Frontier}
			\begin{figure}[!t]
				\centering
				\subfloat[$2 \times 32 \times 2$ (no direct)\label{fg:singular_pareto_sx32_nd}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/singular_pareto_sx32_nd.tex}
					}
				}
				\subfloat[$2 \times 32 \times 2$\label{fg:singular_pareto_sx32}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/singular_pareto_sx32.tex}
					}
				}
				\\
				\subfloat[$2 \times 64 \times 2$\label{fg:singular_pareto_sx64}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/singular_pareto_sx64.tex}
					}
				}
				\subfloat[$2 \times 128 \times 2$\label{fg:singular_pareto_sx128}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/singular_pareto_sx128.tex}
					}
				}
				\caption{Pareto frontiers of singular values of an $N_\mathrm{T}=N_\mathrm{R}=2$ channel reshaped by a \gls{ris}.}
				\label{fg:singular_pareto}
			\end{figure}
			% Fig. \ref{fg:singular_pareto} shows the Pareto frontiers of channel singular values reshaped by \gls{bd}-\gls{ris}.
			Fig. \ref{fg:singular_pareto} shows the Pareto singular values of an $N_\mathrm{T}=N_\mathrm{R}=2$ \gls{mimo} reshaped by a \gls{ris}.
			When the direct link is blocked, the achievable regions in Fig. \subref*{fg:singular_pareto_sx32_nd} are shaped like pizza slices.
			This is because $\sigma_1(\mathbf{H}) \ge \sigma_2(\mathbf{H}) \ge 0$ and there exists a trade-off between the alignment of two spaces.
			%  since $\sigma_1(\mathbf{H}) \ge \sigma_2(\mathbf{H}) \ge 0$.
			We observe that the smallest singular value can be enhanced up to \num{2e-4} by single-connected \gls{ris} and \num{3e-4} by fully-connected \gls{bd}-\gls{ris}, corresponding to a \qty{50}{\percent} gain.
			When the direct link is present, the shape of the singular value region depends heavily on the relative strength of the indirect link.
			In Fig. \subref*{fg:singular_pareto_sx32}, a 32-element \gls{ris} is insufficient to compensate the \qty{35}{dB} path loss imbalance and results in a limited singular value region that is symmetric around the direct point.
			As the group size $L$ increases, the shape of the region evolves from elliptical to square.
			This transformation not only improves the dynamic range of $\sigma_1(\mathbf{H})$ and $\sigma_2(\mathbf{H})$ by \qty{22}{\percent} and \qty{38}{\percent}, but also provides a better trade-off in manipulating both singular values.
			It suggests the design freedom from larger group size allows better alignment of multiple spaces simultaneously.
			% not only provides a better trade-off in channel manipulation but also improves the dynamic range of $\sigma_1(\mathbf{H})$ and $\sigma_2(\mathbf{H})$ by \qty{22}{\percent} and \qty{38}{\percent}, respectively.
			The singular value region also enlarges as the number of scattering elements $N_\mathrm{S}$ increases.
			In particular, Fig. \subref*{fg:singular_pareto_sx128} shows that the equivalent channel can be completely nulled (corresponding to the origin) by a 128-element \gls{bd}-\gls{ris} thanks to its superior channel shaping capability, but not by a diagonal one.
			Those results demonstrate the superior channel shaping capability of \gls{bd}-\gls{ris} and emphasizes the importance of reconfigurable inter-connection between elements.
		\end{subsubsection}

		\begin{subsubsection}{Analytical Bounds and Numerical Results}
			\begin{figure}[!t]
				\centering
				\subfloat[$4 \times 32 \times 4$ (rank-1)\label{fg:singular_bound_rank1_sx32}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/singular_bound_rank1_sx32.tex}
					}
				}
				\subfloat[$4 \times 64 \times 4$ (rank-1)\label{fg:singular_bound_rank1_sx64}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/singular_bound_rank1_sx64.tex}
					}
				}
				\\
				\subfloat[$4 \times 128 \times 4$ (rank-2)\label{fg:singular_bound_rank2_sx128}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/singular_bound_rank2_sx128.tex}
					}
				}
				\subfloat[$4 \times 256 \times 4$ (rank-4)\label{fg:singular_bound_rank4_sx256}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/singular_bound_rank4_sx256.tex}
					}
				}
				\caption{
					Achievable channel singular values: analytical bounds (green lines) and numerical optimization results (blue and red bars).
					The intersections of the blue and red bars denote the singular values of the direct channel.
					The blue (resp. red) bars are obtained by solving problem \eqref{op:pareto} with $\rho_n = -1$ (resp. $+1$) and $\rho_{n'} = 0$, $\forall n' \ne n$.
					`D' means diagonal \gls{ris} and `BD' refers to fully-connected \gls{bd}-\gls{ris}.
					`rank-$k$' refers to the rank of the forward channel.
				}
				\label{fg:singular_bound}
			\end{figure}
			Fig. \ref{fg:singular_bound} illustrates the analytical singular value bounds in Proposition \ref{pp:rank_deficient} and the numerical results obtained by solving problem \eqref{op:pareto} with $\rho_n = \pm 1$ and $\rho_{n'} = 0$, $\forall n' \ne n$.
			Here we assume a rank-$k$ forward channel without loss of generality.
			When the \gls{ris} is in the vicinity of the transmitter, Figs. \subref*{fg:singular_bound_rank1_sx32} and \subref*{fg:singular_bound_rank1_sx64} show that the achievable channel singular values indeed satisfy Corollary \ref{co:los}, namely $\sigma_1(\mathbf{H}) \ge \sigma_1(\mathbf{T})$, $\sigma_2(\mathbf{T}) \le \sigma_2(\mathbf{H}) \le \sigma_1(\mathbf{T})$, etc.
			It is obvious that \gls{bd}-\gls{ris} can approach those bounds better than diagonal \gls{ris} especially for a small $N_\mathrm{S}$.
			% Another example is given in Fig. \subref*{fg:singular_bound_rank2_sx128} where the forward channel is rank-2.
			Another example is given in Fig. \subref*{fg:singular_bound_rank2_sx128} with rank-2 forward channel.
			% The observations align with Proposition \ref{pp:rank_deficient} that t
			The first two channel singular values are unbounded above and bounded below by the first two singular values of $\mathbf{T}$, while the last two singular values can be suppressed to zero and bounded above by the first two singular values of $\mathbf{T}$.
			Those observations align with Proposition \ref{pp:rank_deficient}.
			Finally, Fig. \subref*{fg:singular_bound_rank4_sx256} confirms there are no extra singular value bounds when both forward and backward channels are full-rank.
			This can be predicted from \eqref{eq:auxiliary_matrix} where the compact singular matrix $\mathbf{V}_\mathrm{F}$ becomes unitary and $\mathbf{T}=\mathbf{0}$.
			The numerical results are consistent with the analytical bounds, and we conclude that the channel shaping advantage of \gls{bd}-\gls{ris} over diagonal \gls{ris} scales with forward and backward channel ranks.


			\begin{figure}[!t]
				\centering
				\subfloat[$1 \times 256 \times 1$ (no direct)\label{fg:power_bond_txrx1_nd}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/power_bond_txrx1_nd.tex}
					}
				}
				\subfloat[$4 \times 256 \times 4$ (no direct)\label{fg:power_bond_txrx4_nd}]{
					\resizebox{!}{3.25cm}{
						\input{assets/simulation/power_bond_txrx4_nd.tex}
					}
				}
				\caption{
					Average maximum channel power versus \gls{bd}-\gls{ris} group size and \gls{mimo} dimensions.
					The direct channel is blocked.
					`Cascaded' refers to the available power of the cascaded channel, i.e., the sum of (sorted) element-wise power product of backward and forward channels.
				}
				\label{fg:power_bond}
			\end{figure}

			Fig. \ref{fg:power_bond} compares the analytical channel power bound in Corollary \ref{co:sum_power} and the numerical results obtained by solving problem \eqref{op:power_passive} when the direct link is blocked.
			Here, a fully-connected \gls{bd}-\gls{ris} can attain the upper bound either in closed form \eqref{eq:scattering_fc_optimal} or via optimization approach \eqref{eq:scattering_power}.
			% Recall that a fully-connected \gls{bd}-\gls{ris} in closed form \eqref{eq:scattering_fc_tight} can attain the bound.
			% We observe that the bound is also tight for fully-connected \gls{bd}-\gls{ris}.
			% Increasing the group size of \gls{bd}-\gls{ris} significantly improves the channel power especially for a large \gls{mimo}.
			% Apparently, \gls{bd}-\gls{ris} with a larger group size can approach the bound better, and a fully-connected one can achieve the bound.
			% The bound here indicates how much power can potentially be extracted from the forward and backward channels.
			% We observe that using a larger group size can approach the bound better, and full
			% We observe that the bound is tight for fully-connected \gls{bd}-\gls{ris} in \gls{siso} and \gls{mimo}.
			For the \gls{siso} case in Fig. \subref*{fg:power_bond_txrx1_nd}, the maximum channel power is approximately \num{4e-6} by diagonal \gls{ris} and \num{6.5e-6} by fully-connected \gls{bd}-\gls{ris}, corresponding to a \qty{62.5}{\percent} gain.
			This aligns with the asymptotic \gls{bd}-\gls{ris} scaling law derived for \gls{siso} in \cite{Shen2020a}.
			Interestingly, the gain surges to \qty{270}{\percent} in $N_\mathrm{T}=N_\mathrm{S}=4$ \gls{mimo} as shown in Fig. \subref*{fg:power_bond_txrx4_nd}.
			This is because space alignment boils down to phase matching in \gls{siso} such that both triangular and Cauchy-Schwarz inequalities in \cite[(50)]{Shen2020a} can be simultaneously tight regardless of the group size.
			That is, diagonal \gls{ris} is sufficient for space alignment in \gls{siso} while the \qty{62.5}{\percent} gain from \gls{bd}-\gls{ris} comes purely from channel rearrangement.
			Now consider a diagonal \gls{ris} in \gls{mimo}.
			Each element can only apply a common phase shift to the associated rank-1 $N_\mathrm{R} \times N_\mathrm{T}$ indirect channel.
			Therefore, perfect space alignment of indirect channels through different elements is generally impossible.
			It means the disadvantage of diagonal \gls{ris} in space alignment and channel rearrangement scales with \gls{mimo} dimensions.
			We thus conclude that the power gain of \gls{bd}-\gls{ris} scales with group size and \gls{mimo} dimensions.
		\end{subsubsection}

		% The Pareto singular value frontiers of a $2 \times 2$ \gls{mimo} with a 32-element \gls{bd}-\gls{ris} is shown in Fig.~\ref{fg:singular_pareto}.
		% The Pareto frontier of channel singular values reshaped by \gls{bd}-\gls{ris} is shown in Fig. \ref{fg:singular_pareto}.
		% The Pareto frontier of channel singular values reshaped by \gls{bd}-\gls{ris} is shown in Fig. \ref{fg:singular_pareto}.
		% Clearly, a larger group size provides
		% and evolving trend of channel singular values are shown in Fig.~\ref{fg:singular_pareto} and \ref{fg:pc_singular_bound}.
		% Clearly, \gls{bd}-\gls{ris} with a larger group size can redistribute the channel singular values to a wider range.
	\end{subsection}

	\begin{subsection}{Power Gain and Achievable Rate Maximization}
		\begin{figure}[!t]
			\centering
			\subfloat[$16 \times N_\mathrm{S} \times 16$ (no direct)\label{fg:power_sx_txrx16_nd}]{
				\resizebox{!}{3.0625cm}{
					\input{assets/simulation/power_sx_txrx16_nd.tex}
				}
			}
			\subfloat[$16 \times N_\mathrm{S} \times 16$\label{fg:power_sx_txrx16}]{
				\resizebox{!}{3.0625cm}{
					\input{assets/simulation/power_sx_txrx16.tex}
				}
			}
			\caption{
				Average maximum channel power versus \gls{ris} configuration.
				`OP-left' and `OP-right' refer to the suboptimal solutions to problem \eqref{op:power_passive} by lossy transformation \eqref{op:standard_orthogonal_procrustes} where $\mathbf{\Theta}$ is to the left and right of the product, respectively.
			}
			\label{fg:power_sx}
		\end{figure}

		We first focus on channel power gain maximization problem \eqref{op:power_passive}.
		Fig. \ref{fg:power_sx} shows the achievable channel power under different \gls{ris} configurations.
		An interesting observation is that the relative power gain of \gls{bd}-\gls{ris} over diagonal \gls{ris} is even larger with direct link.
		For example, a 64-element fully \gls{bd}-\gls{ris} can almost provide the same channel power as a 256-element diagonal \gls{ris} in Fig. \subref*{fg:power_sx_txrx16}, but not in Fig. \subref*{fg:power_sx_txrx16_nd}.
		% This again credits to the superior space alignment capability of \gls{bd}-\gls{ris}.
		This is because the \gls{ris} needs to balance the multiplicative forward-backward combining and the additive direct-indirect combining, such that the space alignment advantage of \gls{bd}-\gls{ris} becomes more pronounced.
		We also notice that the suboptimal solutions \eqref{eq:orthogonal_procrustes_solution} for fully-connected \gls{bd}-\gls{ris} by lossy transformation \eqref{op:standard_orthogonal_procrustes} are very close to optimal especially for a large $N_\mathrm{S}$.

		\begin{figure}[!t]
			\centering
			\subfloat[$4 \times 128 \times 4$\label{fg:rate_beamforming}]{
				\resizebox{!}{3.25cm}{
					\input{assets/simulation/rate_beamforming.tex}
				}
			}
			\subfloat[$N_\mathrm{T} \times 128 \times N_\mathrm{R}$\label{fg:rate_txrx}]{
				\resizebox{!}{3.25cm}{
					\input{assets/simulation/rate_txrx.tex}
				}
			}
			\\
			\subfloat[$4 \times N_\mathrm{S} \times 4$\label{fg:rate_sx}]{
				\resizebox{!}{3.25cm}{
					\input{assets/simulation/rate_sx.tex}
				}
			}
			\subfloat[$4 \times 128 \times 4$\label{fg:rate_kfactor}]{
				\resizebox{!}{3.25cm}{
					\input{assets/simulation/rate_kfactor.tex}
				}
			}
			\caption{
				Average achievable rate versus \gls{mimo} and \gls{ris} configurations.
				The noise power is $\eta = \qty{-75}{dB}$, corresponding to a direct \gls{snr} of \num{-10} to \qty{30}{dB}.
				`Alternate' refers to the alternating optimization and `Decouple' refers to the low-complexity design.
				`D' means diagonal \gls{ris} and `BD' refers to fully-connected \gls{bd}-\gls{ris}.
			}
			\label{fg:rate}
		\end{figure}

		Fig. \ref{fg:rate} presents the achievable rate under different \gls{mimo} and \gls{ris} configurations.
		At a transmit power of \qty{10}{dB}, Fig. \subref*{fg:rate_beamforming} shows that introducing a 128-element diagonal \gls{ris} to $N_\mathrm{T}=N_\mathrm{S}=4$ \gls{mimo} can improve the achievable rate from \qty{22.2}{bps/Hz} to \qty{29.2}{bps/Hz} ($+\qty{31.5}{\percent}$).
		In contrast, a \gls{bd}-\gls{ris} of group size 4 and 128 can further improve the rate to \qty{32.1}{bps/Hz} ($+\qty{44.6}{\percent}$) and \qty{34}{bps/Hz}  ($+\qty{53.2}{\percent}$), respectively.
		Interestingly, the gap between the optimal \gls{ao} approach \eqref{op:rate_passive}--\eqref{eq:precoder_eigenmode} and the low-complexity solution \eqref{eq:scattering_power} and \eqref{eq:precoder_eigenmode} narrows as the group size increases, and completely vanishes for a fully-connected \gls{bd}-\gls{ris}.
		This implies that the \gls{ris}-transceiver design can often be decoupled via channel shaping with marginal performance loss.
		Figs. \subref*{fg:rate_txrx} and \subref*{fg:rate_sx} also confirm the advantage of \gls{bd}-\gls{ris} grows with the number of transmit and receive antennas and scattering elements.
		In the low power regime (\num{-20} to \qty{-10}{dB}), the slope of the achievable rate is significantly larger with \gls{bd}-\gls{ris}, suggesting that multiple streams can be activated at a much lower \gls{snr}.
		This is because \gls{bd}-\gls{ris} not only spreads the channel singular values to a wider range, but also provides a better trade-off between channels (c.f. Fig. \ref{fg:singular_pareto}).
		Finally, Fig. \subref*{fg:rate_kfactor} shows that the gap between diagonal and \gls{bd}-\gls{ris} narrows as the Rician $K$-factor increases and becomes indistinguishable in \gls{los} environment.
		The observation is expected from previous studies \cite{Shen2020a,Li2023b,Nerini2023} and aligns with Corollary \ref{co:los}, which suggests that the \gls{bd}-\gls{ris} should be deployed in rich-scattering environments to exploit its channel shaping potential.
	\end{subsection}
\end{section}

\begin{section}{Conclusion}
	This paper analyzes the channel shaping capability of \gls{ris} in terms of singular values redistribution.
	We consider a general \gls{bd} architecture that allows elements within the same group to interact, enabling more sophisticated manipulation than diagonal \gls{ris}.
	This translates to a wider dynamic range of and better tradeoff between singular values and significant power and rate gains, especially in large-scale \gls{mimo} systems.
	We characterize the Pareto frontiers of channel singular values via optimization approach and provide analytical bounds for rank-deficient forward/backward channel and blocked direct channel.
	Specifically, the former is done by proposing an efficient \gls{rcg} algorithm for \gls{bd}-\gls{ris} optimization problems, which offers better objective value and faster convergence than existing methods.
	We also present two beamforming designs for rate maximization problem, one based on alternating optimization for optimal performance and the other decouples the \gls{ris}-transceiver design for lower complexity.
	Extensive simulations show that the advantage of \gls{bd}-\gls{ris} stems from its superior space alignment and channel rearrangement capability, which scales with the number of elements, group size, \gls{mimo} dimensions, and channel diversity.

	% One future direction is introducing \gls{bd}-\gls{ris} to \gls{mimo} interference channel for interference alignment or cancellation.
	% Another open issue is to exploit different groups of \gls{bd}-\gls{ris} to enhance the channel response (and possibly ride extra information) at different frequencies.
	% Incorporating a \gls{ris} at both transmitter and receiver sides provides even stronger manipulation that potentially align both direct-indirect and forward-backward spaces simultaneously.
	% Finally, integrating the \gls{ris} into the \gls{mimo} precoding and combining design is also an interesting topic for future research.
	% into the \gls{mimo} precoding and combining design is also an interesting topic for future research.
	% even better channel shaping can be achieved by incorporating the \gls{ris} into the \gls{mimo} precoding and combining design.
\end{section}

% achieving comparable channel power with significantly fewer elements, showcasing its potential for energy-efficient and cost-effective wireless communication systems, particularly in scenarios with direct link availability.


\begin{appendix}
	\begin{subsection}{Proof of Lemma \ref{lm:pareto_gradient}}\label{ap:pareto_gradient}
		Let $\mathbf{H} = \sum_n \mathbf{u}_n \sigma_n \mathbf{v}_n^\mathsf{H}$ be the compact \gls{svd} of the equivalent channel.
		Since the singular vectors are orthonormal, the $n$-th singular value can be expressed as
		\begin{equation}
			\sigma_n = \mathbf{u}_n^\mathsf{H} \mathbf{H} \mathbf{v}_n = \mathbf{u}_n^\mathsf{T} \mathbf{H}^* \mathbf{v}_n^*,
		\end{equation}
		whose differential with respect to $\mathbf{\Theta}_g^*$ is
		\begin{align*}
			\partial \sigma_n
			 & = \partial \mathbf{u}_n^\mathsf{T} \underbrace{\mathbf{H}^* \mathbf{v}_n^*}_{\sum_m \mathbf{u}_m^* \sigma_m \mathbf{v}_m^\mathsf{T} \mathbf{v}_n} + \mathbf{u}_n^\mathsf{T} \cdot \partial \mathbf{H}^* \cdot \mathbf{v}_n^* + \underbrace{\mathbf{u}_n^\mathsf{T} \mathbf{H}^*}_{\mathbf{u}_n^\mathsf{T} \sum_m \mathbf{u}_m^* \sigma_m \mathbf{v}_m^\mathsf{T}} \partial \mathbf{v}_n^* \\
			 & = \underbrace{\partial \mathbf{u}_n^\mathsf{T} \mathbf{u}_n^*}_{\partial 1 = 0} \cdot \sigma_n + \mathbf{u}_n^\mathsf{T} \cdot \partial \mathbf{H}^* \cdot \mathbf{v}_n^* + \sigma_n \cdot \underbrace{\mathbf{v}_n^\mathsf{T} \partial \mathbf{v}_n^*}_{\partial 1 = 0}                                                                                                                  \\
			 & = \mathbf{u}_n^\mathsf{T} \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \cdot \mathbf{H}_{\mathrm{F},g}^* \mathbf{v}_n^*                                                                                                                                                                                                                                                 \\
			 & = \mathrm{tr}(\mathbf{H}_{\mathrm{F},g}^* \mathbf{v}_n^*\mathbf{u}_n^\mathsf{T} \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^*).
		\end{align*}
		According to \cite{Hjorungnes2007}, the corresponding complex derivative is
		\begin{equation}
			\frac{\partial \sigma_n}{\partial \mathbf{\Theta}_g^*} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{u}_n \mathbf{v}_n^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}.
			\label{eq:derivative_sv}
		\end{equation}
		A linear combination of \eqref{eq:derivative_sv} yields \eqref{eq:pareto_gradient}.
	\end{subsection}

	\begin{subsection}{Proof of Proposition \ref{pp:dof}}\label{ap:dof}
		The scattering matrix of \gls{bd}-\gls{ris} can be decomposed as
		\begin{equation}
			\mathbf{\Theta} = \mathbf{L} \mathbf{\Theta}_\mathrm{D} \mathbf{R}^\mathsf{H},
		\end{equation}
		where $\mathbf{\Theta}_\mathrm{D} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$ corresponds to diagonal \gls{ris} and $\mathbf{L}, \mathbf{R} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$ are block-diagonal matrices of $L \times L$ unitary blocks.
		Manipulating $\mathbf{L}$ and $\mathbf{R}$ rotates the linear spans of $\bar{\mathbf{H}}_\mathrm{B} \triangleq \mathbf{H}_\mathrm{B} \mathbf{L}$ and $\bar{\mathbf{H}}_\mathrm{F} \triangleq \mathbf{R}^\mathsf{H} \mathbf{H}_\mathrm{F}$ and maintains their rank.
		On the other hand, there exists a $\mathbf{\Theta}_\mathrm{D}$ such that
		\begin{equation*}
			\begin{split}
				\mathrm{rank}(\mathbf{H}_\mathrm{B} \mathbf{\Theta}_\mathrm{D} \mathbf{H}_\mathrm{F})
				 & = \min \bigl( \mathrm{rank}(\mathbf{H}_\mathrm{B}), \mathrm{rank}(\mathbf{\Theta}_\mathrm{D}), \mathrm{rank}(\mathbf{H}_\mathrm{F}) \bigr) \\
				 & = \min \bigl( \mathrm{rank}(\bar{\mathbf{H}}_\mathrm{B}), N_\mathrm{S}, \mathrm{rank}(\bar{\mathbf{H}}_\mathrm{F}) \bigr)                  \\
				 & = \max_\mathbf{\Theta} \ \mathrm{rank}(\mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F})
			\end{split}
		\end{equation*}
		The same result holds if the direct link is present.
	\end{subsection}

	\begin{subsection}{Proof of Proposition \ref{pp:rank_deficient}}\label{ap:rank_deficient}
		We consider rank-$k$ forward channel and the proof follows similarly for rank-$k$ backward channel.
		Let $\mathbf{H}_\mathrm{F} = \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}$ be the compact \gls{svd} of the forward channel.
		The channel Gram matrix $\mathbf{G} \triangleq \mathbf{H} \mathbf{H}^\mathsf{H} $ can be written as
		\begin{equation*}
			\begin{split}
				\mathbf{G}
				 & = \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{D}^\mathsf{H} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F}^\mathsf{H} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H}                                                         \\
				 & \quad + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H} \mathbf{H}_\mathrm{D}^\mathsf{H} + \mathbf{H}_\mathrm{D} \mathbf{V}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H}       \\
				 & = \mathbf{H}_\mathrm{D} (\mathbf{I} - \mathbf{V}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}) \mathbf{H}_\mathrm{D}^\mathsf{H}                                                                                                                                                                                                               \\
				 & \quad + (\mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} + \mathbf{H}_\mathrm{D} \mathbf{V}_\mathrm{F}) (\mathbf{\Sigma}_\mathrm{F} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} + \mathbf{V}_\mathrm{F}^\mathsf{H} \mathbf{H}_\mathrm{D}^\mathsf{H}) \\
				 & = \mathbf{Y} + \mathbf{Z} \mathbf{Z}^\mathsf{H},
			\end{split}
		\end{equation*}
		where we define $\mathbf{Y} \triangleq \mathbf{H}_\mathrm{D} (\mathbf{I} - \mathbf{V}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}) \mathbf{H}_\mathrm{D}^\mathsf{H} \in \mathbb{H}^{N_\mathrm{R} \times N_\mathrm{R}}$ and $\mathbf{Z} \triangleq \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} + \mathbf{H}_\mathrm{D} \mathbf{V}_\mathrm{F} \in \mathbb{C}^{N_\mathrm{R} \times k}$.
		That is to say, $\mathbf{G}$ can be expressed as a Hermitian matrix plus $k$ rank-1 perturbations.
		According to the Cauchy interlacing formula \cite{Golub2013}, the $n$-th eigenvalue of $\mathbf{G}$ is bounded by
		\begin{align}
			\lambda_n(\mathbf{G}) & \le \lambda_{n-k}(\mathbf{Y}), &  & \text{if } n > k, \label{iq:ev:bound_enlarge}          \\
			\lambda_n(\mathbf{G}) & \ge \lambda_n(\mathbf{Y}),     &  & \text{if } n < N - k + 1 \label{iq:ev_bound_suppress}.
		\end{align}
		Since $\mathbf{Y} = \mathbf{T} \mathbf{T}^\mathsf{H}$ is positive semi-definite, taking the square roots of \eqref{iq:ev:bound_enlarge} and \eqref{iq:ev_bound_suppress} gives \eqref{iq:sv_bound_enlarge} and \eqref{iq:sv_bound_suppress}.
	\end{subsection}

	\begin{subsection}{Proof of Proposition \ref{pp:fully_connected}}\label{ap:fully_connected}
		Let $\mathbf{H}_\mathrm{B} = \mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{V}_\mathrm{B}^\mathsf{H}$ and $\mathbf{H}_\mathrm{F} = \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}$ be the \gls{svd} of the backward and forward channels, respectively.
		The scattering matrix of fully-connected \gls{bd}-\gls{ris} can be decomposed as
		\begin{equation}
			\mathbf{\Theta} = \mathbf{V}_\mathrm{B} \mathbf{X} \mathbf{U}_\mathrm{F}^\mathsf{H},
			\label{eq:scattering_fc}
		\end{equation}
		where $\mathbf{X} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$ is a unitary matrix to be designed.
		The equivalent channel is thus a function of $\mathbf{X}$
		\begin{equation}
			\mathbf{H} = \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} = \mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}.
			\label{eq:channel_equivalent_fc}
		\end{equation}
		Since $\mathrm{sv}(\mathbf{U} \mathbf{A} \mathbf{V}^\mathsf{H}) = \mathrm{sv}(\mathbf{A})$ for unitary $\mathbf{U}$ and $\mathbf{V}$, we have
		\begin{align*}
			\mathrm{sv}(\mathbf{H}) & = \mathrm{sv}(\mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H})                                                                     \\
			                        & = \mathrm{sv}(\mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F})                                                                                                                            \\
			                        & = \mathrm{sv}(\bar{\mathbf{U}}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{\bar{V}}_\mathrm{B}^\mathsf{H} \bar{\mathbf{U}}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{\bar{V}}_\mathrm{F}^\mathsf{H}) \\
			                        & = \mathrm{sv}(\mathbf{BF}),
		\end{align*}
		where $\bar{\mathbf{U}}_{\mathrm{B}/\mathrm{F}}$ and $\bar{\mathbf{V}}_{\mathrm{B}/\mathrm{F}}$ are arbitrary unitary matrices.
	\end{subsection}

	\begin{subsection}{Proof of Lemma \ref{lm:rate_gradient}}\label{ap:rate_gradient}
		The differential of $R$ with respect to $\mathbf{\Theta}_g^*$ is \cite{Hjorungnes2007}
		\begin{align*}
			\partial R
			 & = \frac{1}{\eta} \mathrm{tr} \biggl\{ \partial \mathbf{H}^* \cdot \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T} \Bigl(\mathbf{I} + \frac{\mathbf{H}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T}}{\eta}\Bigr)^{-1} \biggr\}                                                                      \\
			 & = \frac{1}{\eta} \mathrm{tr} \biggl\{ \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \cdot \mathbf{H}_{\mathrm{F},g}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T} \Bigl(\mathbf{I} + \frac{\mathbf{H}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T}}{\eta}\Bigr)^{-1} \biggr\} \\
			 & = \frac{1}{\eta} \mathrm{tr} \biggl\{ \mathbf{H}_{\mathrm{F},g}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T} \Bigl(\mathbf{I} + \frac{\mathbf{H}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T}}{\eta}\Bigr)^{-1} \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \biggr\},
		\end{align*}
		and the corresponding complex derivative is \eqref{eq:rate_gradient}.
	\end{subsection}

	\begin{subsection}{Proof of Proposition \ref{pp:power}}\label{ap:power}
		The differential of \eqref{ob:power_passive} with respect to $\mathbf{\Theta}_g^*$ is
		\begin{align*}
			\partial \lVert \mathbf{H} \rVert _\mathrm{F}^2
			 & = \mathrm{tr}\bigl(\mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \cdot \mathbf{H}_{\mathrm{F},g}^* (\mathbf{H}_\mathrm{D}^\mathsf{T} + \mathbf{H}_\mathrm{F}^\mathsf{T} \mathbf{\Theta}^\mathsf{T} \mathbf{H}_\mathrm{B}^\mathsf{T})\bigr) \\
			 & = \mathrm{tr}\bigl(\mathbf{H}_{\mathrm{F},g}^* (\mathbf{H}_\mathrm{D}^\mathsf{T} + \mathbf{H}_\mathrm{F}^\mathsf{T} \mathbf{\Theta}^\mathsf{T} \mathbf{H}_\mathrm{B}^\mathsf{T}) \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^*\bigr)
		\end{align*}
		and the corresponding complex derivative is
		\begin{equation}
			\frac{\partial \lVert \mathbf{H} \rVert _\mathrm{F}^2}{\partial \mathbf{\Theta}_g^*} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H} = \mathbf{M}_g.
		\end{equation}
		% For a given $\mathbf{\Theta}$, we approximate the quadratic objective \eqref{ob:power_passive} by local Taylor expansion and recast problem \eqref{op:power_passive} as

		First, we approximate the quadratic objective \eqref{ob:power_passive} by its local Taylor expansion
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{\sum_g 2 \Re\bigl\{ \mathrm{tr}(\mathbf{\Theta}_g^\mathsf{H} \mathbf{M}_g) \bigr\}}{\label{op:power_passive_approx}}{\label{ob:power_passive_approx}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g.}{}{}
		\end{maxi!}
		Let $\mathbf{M}_g = \mathbf{U}_g \mathbf{\Sigma}_g \mathbf{V}_g^\mathsf{H}$ be the compact \gls{svd} of $\mathbf{M}_g$.
		We have
		\begin{equation}
			\Re \bigl\{\mathrm{tr}(\mathbf{\Theta}_g^\mathsf{H} \mathbf{M}_g)\bigr\} = \Re \bigl\{ \mathrm{tr}(\mathbf{\Sigma}_g \mathbf{V}_g^\mathsf{H} \mathbf{\Theta}_g^\mathsf{H} \mathbf{U}_g) \bigr\} \le \mathrm{tr}(\mathbf{\Sigma}_g).
		\end{equation}
		The upper bound is tight when $\mathbf{V}_g^\mathsf{H} \mathbf{\Theta}_g^\mathsf{H} \mathbf{U}_g = \mathbf{I}$, which implies the optimal solution of \eqref{op:power_passive_approx} is $\tilde{\mathbf{\Theta}}_g = \mathbf{U}_g \mathbf{V}_g^\mathsf{H}$, $\forall g$.

		Next, we prove that solving \eqref{op:power_passive_approx} successively does not decrease \eqref{ob:power_passive}.
		Since $\tilde{\mathbf{\Theta}}$ optimal for problem \eqref{op:power_passive_approx}, we have $\sum_g 2 \Re\bigl\{ \mathrm{tr}(\tilde{\mathbf{\Theta}}_g^\mathsf{H} \mathbf{M}_g) \bigr\} \ge \sum_g 2 \Re\bigl\{ \mathrm{tr}(\mathbf{\Theta}_g^\mathsf{H} \mathbf{M}_g) \bigr\}$ which is explicitly expressed by \eqref{iq:power_passive_approx}.
		% Expanding both side gives \eqref{iq:power_passive_approx}.
		On the other hand, expanding $\lVert \sum_g \mathbf{H}_{\mathrm{B},g} \tilde{\mathbf{\Theta}}_g \mathbf{H}_{\mathrm{F},g} - \sum_g \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g} \rVert _\mathrm{F}^2 \ge 0$ gives \eqref{iq:nonnegative_norm_square}.
		Adding \eqref{iq:power_passive_approx} and \eqref{iq:nonnegative_norm_square}, we have
		\begin{multline}
			2 \Re \Bigl\{\mathrm{tr}(\tilde{\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}) \Bigr\} + \mathrm{tr}(\mathbf{H}_\mathrm{F}^\mathsf{H} \tilde{\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{B} \tilde{\mathbf{\Theta}} \mathbf{H}_\mathrm{F}) \\
			\ge 2 \Re \Bigl\{\mathrm{tr}({\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}) \Bigr\} + \mathrm{tr}(\mathbf{H}_\mathrm{F}^\mathsf{H} {\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{B} {\mathbf{\Theta}} \mathbf{H}_\mathrm{F}),
		\end{multline}
		which suggests that updating $\tilde{\mathbf{\Theta}}$ does not decrease \eqref{ob:power_passive}.
		\begin{figure*}
			\begin{equation}
				\label{iq:power_passive_approx}
				\resizebox{0.95\textwidth}{!}{
					$2 \Re \Bigl\{\sum\limits_g \mathrm{tr}(\tilde{\mathbf{\Theta}}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}) + \sum\limits_{g_1,g_2} \mathrm{tr}(\tilde{\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \mathbf{\Theta}_{g_2} \mathbf{H}_{\mathrm{F},g_2} \mathbf{H}_{\mathrm{F},g_1}^\mathsf{H})\Bigr\} \ge 2 \Re \Bigl\{\sum\limits_g \mathrm{tr}({\mathbf{\Theta}}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}) + \sum\limits_{g_1,g_2} \mathrm{tr}({\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \mathbf{\Theta}_{g_2} \mathbf{H}_{\mathrm{F},g_2} \mathbf{H}_{\mathrm{F},g_1}^\mathsf{H})\Bigr\}$
				}
			\end{equation}
			\begin{equation}
				\label{iq:nonnegative_norm_square}
				\resizebox{0.95\textwidth}{!}{
					$\sum\limits_{g_1,g_2} \mathrm{tr}(\mathbf{H}_{\mathrm{F},g_1}^\mathsf{H} \tilde{\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \tilde{\mathbf{\Theta}}_{g_2} \mathbf{H}_{\mathrm{F},g_2}) - 2 \Re \Bigl\{\sum\limits_{g_1,g_2} \mathrm{tr}(\mathbf{H}_{\mathrm{F},g_1}^\mathsf{H} \tilde{\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \mathbf{\Theta}_{g_2} \mathbf{H}_{\mathrm{F},g_2})\Bigr\} + \sum\limits_{g_1,g_2} \mathrm{tr}(\mathbf{H}_{\mathrm{F},g_1}^\mathsf{H} {\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} {\mathbf{\Theta}}_{g_2} \mathbf{H}_{\mathrm{F},g_2}) \ge 0$
				}
			\end{equation}
			\hrulefill
		\end{figure*}

		Finally, we prove that the converging point of \eqref{op:power_passive_approx}, denoted by $\tilde{\mathbf{\Theta}}^?$, is a stationary point of \eqref{op:power_passive}.
		The \gls{kkt} conditions of \eqref{op:power_passive} and \eqref{op:power_passive_approx} are equivalent in terms of primal/dual feasibility and complementary slackness, while the stationary conditions are respectively, $\forall g$,
		\begin{gather}
			\mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta}^\star \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H} - \mathbf{\Theta}_g^\star \mathbf{\Lambda}_g^\mathsf{H} = 0,\label{eq:power_passive_stationary}\\
			\mathbf{M}_g - \mathbf{\Theta}_g^\star \mathbf{\Lambda}_g^\mathsf{H} = 0.\label{eq:power_passive_approx_stationary}
		\end{gather}
		On convergence, \eqref{eq:power_passive_approx_stationary} becomes $\mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta}^? \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H} - \mathbf{\Theta}_g^? \mathbf{\Lambda}_g^\mathsf{H} = 0$ and reduces to \eqref{eq:power_passive_stationary}.
		The proof is thus completed.
	\end{subsection}
\end{appendix}


% \begin{section}{\glsentryshort{mimo}-\glsentryshort{ic}}
% 	\begin{subsection}{Leakage Interference Minimization}
% 		\begin{mini!}
% 			{\scriptstyle{\mathbf{\Theta}, \{\mathbf{G}_k\}, \{\mathbf{W}_k\}}}{\mathop{\sum\sum}_{j \neq k} \left\lVert \mathbf{G}_k (\mathbf{H}_{kj}^\mathrm{D} + \mathbf{H}_k^\mathrm{B} \mathbf{\Theta} \mathbf{H}_j^\mathrm{F}) \mathbf{W}_j \right\rVert _{\mathrm{F}}^2}{}{}
% 			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g}{}{}
% 			\addConstraint{\mathbf{G}_k \mathbf{G}_k^\mathsf{H}=\mathbf{I}, \quad \mathbf{W}_k^\mathsf{H} \mathbf{W}_k=\mathbf{I}, \quad \forall k.}{}{}
% 		\end{mini!}
% 		The non-convex problem can be solved by \gls{bcd} method.
% 		For a given $\mathbf{\Theta}$, it reduces to conventional linear beamforming problem, for which an iterative algorithm alternating between the original and reciprocal networks is proposed in \cite{Gomadam2011,Clerckx2013}.
% 		At iteration $r$, the combiner at receiver $k$ is updated as
% 		\begin{equation}
% 			\mathbf{G}_k^{(r)} = {\mathbf{U}_{k,N}^{(r-1)\mathsf{H}}},
% 		\end{equation}
% 		where $\mathbf{U}_{k,N}^{(r-1)}$ is the eigenvectors corresponding to $N$ smallest eigenvalues of interference covariance matrix $\mathbf{Q}_k^{(r-1)} = \sum_{j \ne k} \mathbf{H}_{kj} \mathbf{W}_j^{(r-1)} {\mathbf{W}_j^{(r-1)\mathsf{H}}} \mathbf{H}_{kj}^\mathsf{H}$.
% 		The precoder at transmitter $j$ is updated as
% 		\begin{equation}
% 			\mathbf{W}_j^{(r)} = \bar{\mathbf{U}}_{j,N}^{(r)},
% 		\end{equation}
% 		where $\bar{\mathbf{U}}_{j,N}^{(r)}$ corresponds to interference covariance matrix $\bar{\mathbf{Q}}_j^{(r)} = \sum_{k \ne j} \mathbf{H}_{kj}^\mathsf{H} {\mathbf{G}_k^{(r)\mathsf{H}}} \mathbf{G}_k^{(r)} \mathbf{H}_{kj}$ in the reciprocal network.
% 		Once $\{\mathbf{G}_k\}$ and $\{\mathbf{W}_k\}$ are determined, we define $\bar{\mathbf{H}}_{kj}^\mathrm{D} \triangleq \mathbf{G}_k \mathbf{H}_{kj}^\mathrm{D} \mathbf{W}_j$, $\bar{\mathbf{H}}_k^\mathrm{B} \triangleq \mathbf{G}_k \mathbf{H}_k^\mathrm{B}$, and $\bar{\mathbf{H}}_j^\mathrm{F} \triangleq \mathbf{H}_j^\mathrm{F} \mathbf{W}_j$.
% 		The \gls{bd}-\gls{ris} subproblem reduces to
% 		\begin{mini!}
% 			{\scriptstyle{\mathbf{\Theta}}}{\mathop{\sum\sum}_{j \neq k} \left\lVert (\bar{\mathbf{H}}_{kj}^\mathrm{D} + \bar{\mathbf{H}}_k^\mathrm{B} \mathbf{\Theta} \bar{\mathbf{H}}_j^\mathrm{F}) \right\rVert _{\mathrm{F}}^2}{\label{op:ic_interference_ris}}{}
% 			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g.}{}{}
% 		\end{mini!}

% 		\begin{proposition}
% 			Start from any $\mathbf{\Theta}^{(0)}$, the sequence
% 			\begin{equation}
% 				\mathbf{\Theta}_g^{(r+1)} = \mathbf{U}_g^{(r)} \mathbf{V}_g^{(r)}, \quad \forall g
% 			\end{equation}
% 			converges to a stationary point of \eqref{op:ic_interference_ris}, where $\mathbf{U}_g^{(r)}$ and $\mathbf{V}_g^{(r)}$ are left and right singular matrix of
% 			\begin{equation}
% 				\mathbf{M}_g^{(r)} = \mathop{\sum\sum}_{j \neq k} \bigl(\mathbf{B}_{k,g} \mathbf{\Theta}_g^{(r)} \mathbf{H}_{j,g}^\mathrm{F} - {\mathbf{H}_{k,g}^\mathrm{B}}^\mathsf{H} \mathbf{D}_{kj,g}^{(r)}\bigr) {\mathbf{H}_{j,g}^\mathrm{F}}^\mathsf{H},
% 			\end{equation}
% 			where $\mathbf{B}_{k,g} = \lambda_1\bigl(\mathbf{H}_{k,g}^\mathrm{B} {\mathbf{H}_{k,g}^\mathrm{B}}^\mathsf{H}\bigr) \mathbf{I} - {\mathbf{H}_{k,g}^\mathrm{B}}^\mathsf{H} \mathbf{H}_{k,g}^\mathrm{B}$ and
% 			\begin{equation}
% 				\mathbf{D}_{kj,g}^{(r)} = \mathbf{H}_{jk}^\mathrm{D} + \sum_{g'<g} {\mathbf{H}_{k,g'}^\mathrm{B}}^\mathsf{H} \mathbf{\Theta}_{g'}^{(r+1)} \mathbf{H}_{k,g'}^\mathrm{F} + \sum_{g'>g} {\mathbf{H}_{k,g'}^\mathrm{B}}^\mathsf{H} \mathbf{\Theta}_{g'}^{(r)} \mathbf{H}_{k,g'}^\mathrm{F}.
% 			\end{equation}
% 		\end{proposition}
% 		\begin{proof}
% 			To be added.
% 		\end{proof}

% 		\begin{figure}[!t]
% 			\centering
% 			\resizebox{0.65\columnwidth}{!}{
% 				\input{assets/simulation/ic_interference_sx.tex}
% 			}
% 			\caption{Average leakage interference versus \gls{ris} elements $N^\mathrm{S}$ and group size $L$. Transmitters and receivers are randomly generated in a disk of radius 50 m centered at the \gls{ris}. $(N^\mathrm{T}, N^\mathrm{R}, N^\mathrm{E}, K) = (8, 4, 3, 5)$, $(\gamma^\mathrm{D}, \gamma^\mathrm{F}, \gamma^\mathrm{B}) = (3, 2.4, 2.4)$, and reference pathloss at \qty{1}{\meter} is \qty{-30}{\dB}.}
% 			\label{fg:ic_interference_sx}
% 		\end{figure}
% 		Fig.~\ref{fg:ic_interference_sx} illustrates how \gls{bd}-\gls{ris} helps to reduce the leakage interference.
% 		In this case, a unitary $2^n$-element \gls{bd}-\gls{ris} is almost as good as a diagonal $2^{n+2}$-element \gls{ris} in terms of leakage interference.
% 		Interestingly, the result suggests that \gls{bd}-\gls{ris} can achieve a higher \gls{dof} than diagonal \gls{ris} in \gls{mimo}-\gls{ic}, which is not the case in \gls{mimo}-\gls{pc} (as discussed in \ref{sc:pc_rank_deficient}).
% 	\end{subsection}

% 	\begin{subsection}{Weighted Sum-Rate Maximization}
% 		\begin{maxi!}
% 			{\scriptstyle{\mathbf{\Theta}, \{\mathbf{W}_k\}}}{J_2 = \sum_k \rho_k \log \det \biggl(\mathbf{I} + \mathbf{W}_k \mathbf{H}_{kj}^\mathsf{H} \mathbf{Q}_k^{-1} \mathbf{H}_{kj} \mathbf{W}_k\biggr)}{\label{op:ic_rate}}{\label{ob:ic_rate}}
% 			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g}{}{}
% 			\addConstraint{\lVert \mathbf{W}_k \rVert _\mathrm{F}^2 \le P_k. \quad \forall k}{}{}
% 		\end{maxi!}
% 		where $\rho_k$ is the weight of user $k$ and $\mathbf{Q}_k$ is the interference-plus-noise covariance matrix
% 		\begin{equation}
% 			\mathbf{Q}_k = \sum_{j \ne k} \mathbf{H}_{kj} \mathbf{W}_j {\mathbf{W}_j}^\mathsf{H} \mathbf{H}_{kj}^\mathsf{H} + \eta \mathbf{I}.
% 		\end{equation}
% 		For a given $\mathbf{\Theta}$, \eqref{op:ic_rate} reduces to conventional linear beamforming problem, for which a closed-form iterative solution based on \gls{wsr}-\gls{wmmse} relationship is proposed in \cite{Negro2010}.
% 		At iteration $r$, the \gls{mmse} combiner at receiver $k$ is
% 		\begin{equation}
% 			\mathbf{G}_k^{(r)} = {\mathbf{W}_k^{(r-1)\mathsf{H}}} \mathbf{H}_{kk}^\mathsf{H} \bigl(\mathbf{Q}_k^{(r-1)} + \mathbf{H}_{kk} \mathbf{W}_k^{(r-1)} {\mathbf{W}_k^{(r-1)\mathsf{H}}} \mathbf{H}_{kk}^\mathsf{H}\bigr)^{-1},
% 		\end{equation}
% 		the corresponding error matrix is
% 		\begin{equation}
% 			\mathbf{E}_k^{(r)} = \bigl(\mathbf{I} + {\mathbf{W}_k^{(r-1)\mathsf{H}}} \mathbf{H}_{kk}^\mathsf{H} \mathbf{Q}_k^{(r-1)} \mathbf{H}_{kk} \mathbf{W}_k^{(r-1)}\bigr)^{-1},
% 		\end{equation}
% 		the \gls{mse} weight is
% 		\begin{equation}
% 			\mathbf{\Omega}_k^{(r)} = \rho_k {\mathbf{E}_k^{(r)}}^{-1},
% 		\end{equation}
% 		the Lagrange multiplier is
% 		% \begin{equation}
% 		% 	\begin{split}
% 		% 		\lambda_k^{(r)}
% 		% 		& = \frac{\sum_{j \ne k} \mathrm{tr}(\mathbf{\Omega}_k^{(r)}\mathbf{F}_{kj}^{(r)} {\mathbf{F}_{kj}^{(r)\mathsf{H}}}) - \sum_{j \ne k} \mathrm{tr}(\mathbf{\Omega}_j^{(r)}\mathbf{F}_{jk}^{(r)} {\mathbf{F}_{jk}^{(r)\mathsf{H}}})}{P_k} \\
% 		% 		& \quad + \frac{\mathrm{tr}(\eta \mathbf{\Omega}_k^{(r)} \mathbf{G}_k^{(r)}{\mathbf{G}_k^{(r)\mathsf{H}}})}{P_k}
% 		% 	\end{split}
% 		% \end{equation}
% 		\begin{equation}
% 			\lambda_k^{(r)} = \frac{\mathrm{tr}\bigl(\eta \mathbf{\Omega}_k^{(r)} \mathbf{G}_k^{(r)}{\mathbf{G}_k^{(r)\mathsf{H}}} + \sum_j \mathbf{\Omega}_k^{(r)}\mathbf{T}_{kj}^{(r)} {\mathbf{T}_{kj}^{(r)\mathsf{H}}} - \mathbf{\Omega}_j^{(r)}\mathbf{T}_{jk}^{(r)} {\mathbf{T}_{jk}^{(r)\mathsf{H}}} \bigr)}{P_k},
% 		\end{equation}
% 		where $\mathbf{T}_{kj}^{(r)} = \mathbf{G}_k^{(r)} \mathbf{H}_{kj} \mathbf{W}_j^{(r)}$.
% 		The precoder at transmitter $k$ is
% 		\begin{equation}
% 			\mathbf{W}_k^{(r)} = \Bigl(\sum_j \mathbf{H}_{jk}^\mathsf{H} {\mathbf{G}_j^{(r)\mathsf{H}}} \mathbf{\Omega}_k^{(r)} \mathbf{G}_j^{(r)} \mathbf{H}_{jk} + \lambda_k^{(r)} \mathbf{I} \Bigr)^{-1} \mathbf{H}_{kk}^\mathsf{H} {\mathbf{G}_j^{(r)\mathsf{H}}} \mathbf{\Omega}_k^{(r)}.
% 		\end{equation}
% 		Once $\{\mathbf{W}_k\}$ is determined, the complex derivative of \eqref{ob:ic_rate} with respect to \gls{ris} block $g$ is
% 		\begin{equation}
% 			\begin{split}
% 				\frac{\partial J_2}{\partial \mathbf{\Theta}_g^*}
% 				& = \sum_k \rho_k {\mathbf{H}_{k,g}^\mathrm{B}}^\mathsf{H} \mathbf{Q}_k^{-1} \mathbf{H}_{kk} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \\
% 				& \quad \times \bigl({\mathbf{H}_{k,g}^\mathrm{F}}^\mathsf{H} - \mathbf{H}_{kk}^\mathsf{H} \mathbf{Q}_k^{-1} \sum_{j \ne k} \mathbf{H}_{kj} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} {\mathbf{H}_{j,g}^\mathrm{F}}^\mathsf{H}\bigr).
% 			\end{split}
% 			\label{eq:ic_rate_gradient_ris}
% 		\end{equation}
% 		The \gls{ris} subproblem can be solved by \gls{rcg} Algorithm~\ref{ag:pc_rate_ris} with \eqref{eq:pc_rate_gradient_ris} replaced by \eqref{eq:ic_rate_gradient_ris}.

% 		\begin{figure}[!t]
% 			\centering
% 			\resizebox{0.65\columnwidth}{!}{
% 				\input{assets/simulation/ic_rate_sx.tex}
% 			}
% 			\caption{Average weighted sum-rate versus \gls{snr}, \gls{ris} elements $N^\mathrm{S}$ and group size $L$. $(N^\mathrm{T}, N^\mathrm{R}, N^\mathrm{E}, K) = (8, 4, 3, 5)$, $(\Lambda^\mathrm{D}, \Lambda^\mathrm{F}, \Lambda^\mathrm{B}) = (65, 54, 46) \unit{dB}$, $\rho_k = 1, \ \forall k$.}
% 			\label{fg:ic_rate_sx}
% 		\end{figure}

% 		\begin{figure}[!t]
% 			\centering
% 			\resizebox{0.65\columnwidth}{!}{
% 				\input{assets/simulation/ic_rate_user.tex}
% 			}
% 			\caption{Average weighted sum-rate versus user pairs $K$, \gls{ris} elements $N^\mathrm{S}$ and group size $L$ at $\mathrm{SNR} = \qty{15}{dB}$. $(N^\mathrm{T}, N^\mathrm{R}, N^\mathrm{E}) = (4, 4, 3)$, $\rho_k = 1, \ \forall k$.}
% 			\label{fg:ic_rate_user}
% 		\end{figure}

% 		A new observation from Fig.~\ref{fg:ic_rate_sx} that the interference alignment capability of \gls{bd}-\gls{ris} scales much faster with group size than number of elements.\footnote{The results are not very stable and depend heavily on initialization.}
% 	\end{subsection}
% \end{section}


\bibliographystyle{IEEEtran}
\bibliography{library.bib}
\end{document}
