\documentclass[journal]{IEEEtran}

\input{preamble}

\externaldocument[~]{appendix}

\title{MIMO Channel Shaping and Rate Maximization\\Using Beyond Diagonal RIS}
\author{
	\IEEEauthorblockN{
		Yang Zhao, \IEEEmembership{Member, IEEE,}
		Hongyu Li, \IEEEmembership{Graduate Student Member, IEEE,}\\
		Massimo Franceschetti, \IEEEmembership{Fellow, IEEE,}
		and Bruno Clerckx, \IEEEmembership{Fellow, IEEE}
	}
	\thanks{
		Yang Zhao is with the School of Electronic and Electrical Engineering, University of Leeds, LS2 9JT, U.K. (e-mail: \href{mailto:yang.zhao@ieee.org}{yang.zhao@ieee.org}.)

		Hongyu Li and Bruno Clerckx are with the Department of Electrical and Electronic Engineering, Imperial College London, SW7 2AZ, U.K.

		Massimo Franceschetti is with the Department of Electrical and Computer Engineering, University of California, San Diego, La Jolla CA 92093, USA.

		This work has been partially supported by UKRI grant EP/Y004086/1, EP/X040569/1, EP/Y037197/1, EP/X04047X/1, EP/Y037243/1.
	}
}

\begin{document}

\maketitle

\begin{abstract}
	This paper investigates the limits to which a passive \gls{ris} can reshape a point-to-point \gls{mimo} in terms of singular values for improved wireless (e.g., rate and power) performance.
	We depart from the \gls{d} scattering matrix and adopt a \gls{bd} model that exploits element-wise connections for signal amplitude and phase manipulation.
	% , which translate to superior \gls{mimo} shaping capabilities.
	Specifically, analytical bounds are derived under popular \gls{ris} deployment scenarios to showcase the shaping potentials of \gls{bd}-\gls{ris} on the channel \gls{dof}, singular value spread, power gain, and capacity.
	A numerical optimization method is then proposed for a broader range of shaping problems and invoked to characterize the achievable singular value region.
	As a side product, we tackle \gls{bd}-\gls{ris}-aided \gls{mimo} rate maximization problem by a local-optimal \gls{ao} and a low-complexity shaping-inspired approach.
	Results show that \gls{bd}-\gls{ris} significantly improves the dynamic range of all channel singular values and the trade-off in manipulating them, resulting in enhanced power gain and achievable rate.
	Those benefits become more pronounced when the number of \gls{ris} elements or \gls{mimo} dimensions increase.
	Of particular interest, \gls{bd}-\gls{ris} is shown to activate multi-stream transmission (hence achieving the asymptotic \gls{dof}) at much lower transmit power than \gls{d}-\gls{ris} thanks to its singular value shaping proficiency.
\end{abstract}

\begin{IEEEkeywords}
	MIMO, RIS, channel shaping, rate maximization, singular value analysis, manifold optimization.
\end{IEEEkeywords}

\glsresetall

\begin{section}{Introduction}
	% \begin{subsection}{Background}
		Today we are witnessing a paradigm shift from connectivity to intelligence, where the wireless environment is no longer a chaotic medium but a conscious agent that can serve on demand.
		This is empowered by recent advances in \gls{ris}, a programmable passive planar surface that recycles and redistributes ambient electromagnetic waves for improved wireless performance.
		A typical \gls{ris} consists of numerous low-power sub-wavelength non-resonant scattering elements, whose response can be engineered in real-time to manipulate the amplitude, phase, frequency, and polarization of the scattered waves \cite{Basar2019}.
		It enables low-noise full-duplex operation, featuring better flexibility than reflectarrays, lighter footprint than relays, and greater scalability than \gls{mimo} systems.
		One popular \gls{ris} research direction is \emph{joint passive and active beamforming} design with transceivers to enhance a specific performance measure, which has attracted significant interests in wireless communication \cite{Wu2019,Guo2020,Liu2022}, sensing \cite{He2022,Luo2022,Hua2023}, and power transfer literature \cite{Wu2020a,Feng2022,Zhao2022}.
		While passive beamforming at \gls{ris} suffers attenuation from double fading, it offers better asymptotic behaviors than active beamforming at transceivers (e.g., second-order array gain and fourth-order harvested power \cite{Zhao2022}).
		Another \gls{ris} application is \emph{information modulation} by periodically switching its reflection pattern within the channel coherence time.
		This creates a free-ride message stream with dual benefits: integrating with legacy transmitter for enhanced channel capacity \cite{Karasik2020,Basar2020,Ye2022}, or serving as individual source for low-power uplink communication \cite{Liang2020,Zhao2024,Yang2024}.
		Different from above, \emph{channel shaping} exploits \gls{ris} as a stand-alone device to modify the inherent properties of the wireless environment, for example, compensate for the Doppler effect \cite{Basar2021}, flatten frequency-selective channels \cite{Arslan2022}, improve \gls{mimo} channel rank \cite{Ozdogan2020a}, and artificially diversify channel over time for orthogonal \cite{Yang2019} and non-orthogonal \cite{Chen2023} multiple access schemes.
		This helps to decouple joint beamforming problems into a channel shaping stage and a conventional transceiver design stage, providing a versatile solution for various wireless applications.
	% \end{subsection}

	% \begin{subsection}{Related Works}
		At a specific resource block, channel shaping metrics can be classified into two categories.
		\begin{itemize}
			\item \emph{Singular value:} The impact of \gls{ris} has been studied in terms of minimum singular value \cite{ElMossallamy2021}, effective rank \cite{ElMossallamy2021,Meng2023}, condition number \cite{Zheng2022,Huang2023}, and \gls{dof} \cite{Bafghi2022,Zheng2023,Chae2023}. Those are closely related to performance measures (e.g., achievable rate and harvested power \cite{Shen2021}) but sensitive to minor perturbations of the channel matrix;
			\item \emph{Power:} The impact of \gls{ris} has been studied in terms of channel power gain \cite{Wu2019,Shen2020a,Nerini2023,Nerini2024,Santamaria2023} in point-to-point channels and leakage interference \cite{Santamaria2023a} in interference channels. Those second-order metrics are less informative in \gls{mimo} but easier to analyze and optimize.
		\end{itemize}

		Although above works offered inspiring glimpses into the channel shaping potential of passive \gls{ris}, none attempted to disclose the entire singular value region.
		Most relevant literature \cite{ElMossallamy2021,Meng2023,Zheng2022,Huang2023,Bafghi2022,Zheng2023,Chae2023,Wu2019,Santamaria2023a} have also been limited to a \gls{d}-\gls{ris} model where each element is connected to a dedicated impedance and disconnected from others.
		As such, wave impinging on one element is entirely scattered by the same element.
		This simple architecture is modeled by a diagonal scattering matrix with unit-magnitude diagonal entries, which only applies a phase shift to the incoming signal.
		The idea was later generalized to \gls{bd}-\gls{ris} with group-connected architecture \cite{Shen2020a}, where adjacent elements within the same group are connected via passive reconfigurable components, which can be either symmetric (e.g., capacitors and inductors) or asymmetric (e.g., ring hybrids and branch-line hybrids) \cite{Ahn2006}.
		This allows wave impinging on one element to propagate within the circuit and depart partially from any element in the same group.
		It can thus manipulate both amplitude and phase of the scattered wave while remaining passive.
		Such a powerful model can be realized at reduced hardware cost using tree- and forest-connected architectures by graph theory \cite{Nerini2024}.
		\gls{bd}-\gls{ris} can also function in
		% hybrid transmitting-and-reflecting mode \cite{Li2023b} and
		multi-sector mode \cite{Li2023c} for full-space coverage and multi-user support.
		Practical challenges such as channel estimation \cite{Li2024}, mutual coupling \cite{Li2023f}, and wideband modelling \cite{Li2024a} have also been studied in recent literature.
		Its beamforming effectiveness over \gls{d}-\gls{ris} and energy efficiency over active \gls{ris} and relay systems have been proved in \gls{siso} and \gls{miso} systems \cite{Shen2020a,Nerini2023,Nerini2024,Santamaria2023,Fang2023,Zhou2023,Li2023c,Soleymani2024}.
		However, the interplay between \gls{bd}-\gls{ris} and \gls{mimo} is still in the infancy stage.
		The authors of \cite{Bartoli2023} investigated the rate-optimal joint beamforming design for a fully-connected \gls{bd}-\gls{ris}-aided \gls{mimo} system where the direct channel is negligible.
		A transmitter-side \gls{bd}-\gls{ris} was introduced to
		massive \gls{mimo} systems that exploits statistical \gls{csi} for improved spectral efficiency \cite{Mishra2024}, which again assumed negligible direct channel and fully-connected \gls{bd}-\gls{ris}.
		Received power maximization with continuous-valued and discrete-valued \gls{bd}-\gls{ris} have been tackled respectively in closed form \cite{Nerini2023} and by machine learning approach \cite{Nerini2023b}, but the corresponding single-stream transceiver is rate-suboptimal.
	% \end{subsection}

	% \begin{subsection}{Contributions}
		\label{sc:contributions}
		This paper is motivated by a fundamental question:
		\emph{What is the channel shaping capability (in terms of singular values and their functions) of a passive \gls{ris} in \gls{mimo} channels?}
		Unlike existing works that focus on specific metrics or scenarios, we seek a general understanding of \gls{ris} in manipulating the wireless environment to provide insights for various wireless applications.
		% We aim for a comprehensive answer via analysis and optimization.
		The contributions are summarized below.

		First, we pioneer \gls{bd}-\gls{ris} study in general \gls{mimo} channels and interpret its shaping potential as branch matching and mode alignment.
		Branch matching refers to pairing and combining the branches (i.e., entries) of backward and forward channels associated with each \gls{bd}-\gls{ris} group.
		Mode alignment refers to aligning and ordering the modes (i.e., singular vectors) of indirect channels with those of direct channel.
		The former origins uniquely from the off-diagonal entries of the scattering matrix of \gls{bd}-\gls{ris}.

		Second, we provide an analytical answer to the shaping question under specific channel conditions.
		It is shown that \gls{bd}-\gls{ris} may achieve a larger or smaller communication \gls{dof} than \gls{d}-\gls{ris}.
		When the backward or forward channel is rank-deficient, we derive asymptotic bounds of individual singular values applying to \gls{d}- and \gls{bd}-\gls{ris}.
		When the direct channel is negligible, we recast the shaping question for fully-connected \gls{bd}-\gls{ris} as a well-studied linear algebra question and provide tight bounds (with closed-form \gls{ris} expressions) on channel singular values, power gain, and capacity.
		% The corresponding \gls{ris} scattering matrices are also derived in closed form.
		% The results are insightful for understanding the shaping advantages of \gls{bd}-\gls{ris} in \gls{mimo} channels.
		These results help to understand the fundamental limits of channel shaping and serve as a foundation for advanced \gls{ris} designs.

		% guide the design and optimization of future wireless networks

		Third, we provide a numerical answer to the shaping question by exploiting a geodesic \gls{rcg} method to optimize the \gls{bd}-\gls{ris} for a broad class of singular value functions.
		It compares favorably to legacy \gls{ris} designs in that the updates are performed multiplicatively along the shortest paths on the manifold for accelerated convergence.
		The method is then invoked in a Pareto problem to reveal the entire singular value region, which generalizes most relevant metrics and provides an intuitive shaping benchmark.

		Fourth, we tackle \gls{bd}-\gls{ris}-aided \gls{mimo} rate maximization problem by a local-optimal \gls{ao} and a low-complexity shaping-inspired approach.
		The former iteratively updates the passive beamforming by geodesic \gls{rcg} and the active beamforming by eigenmode transmission, until convergence.
		The latter shapes the channel with \gls{ris} for maximum power gain and then performs conventional precoding.
		% Closed-form solutions are derived for the power gain maximization subproblem in different scenarios.
		% Interestingly, the rate deficit from the low-complexity design diminishes as the \gls{bd}-\gls{ris} evolves towards fully-connected.
		% We also extend both approaches to \gls{wsr} maximization in \gls{mimo} interference channels where the low-complexity design aims for minimum leakage interference instead.

		Fifth, we conduct extensive simulations to validate the analytical bounds and numerical methods.
		It is concluded that:
		\begin{itemize}
			\item \gls{bd}-\gls{ris} significantly improves the dynamic range of all channel singular values and the trade-off in manipulating them, resulting in enhanced power gain and achievable rate;
			\item A fully-connected \gls{bd}-\gls{ris} may be designed in closed-form for multi-functional optimality;
			\item The shaping advantages of \gls{bd}-\gls{ris} increase with the number of scattering elements and \gls{mimo} dimensions;
			\item \gls{bd}-\gls{ris} can activate multi-stream transmission (hence achieving the asymptotic \gls{dof}) at low transmit power thanks to its singular value shaping proficiency;
			\item The rate gap between the optimal and low-complexity beamforming designs diminishes as the \gls{ris} evolves from \gls{d} to fully-connected \gls{bd};
			\item The additional optimization cost of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} is affordable and the geodesic \gls{rcg} method is efficient on large-scale problems;
			\item The proposed \gls{ris} designs are robust to channel estimation errors and can be modified for symmetry with reasonable performance cost.
		\end{itemize}
	% \end{subsection}

	\emph{Notation:}
	Italic, bold lower-case, and bold upper-case letters indicate scalars, vectors and matrices, respectively.
	$\jmath$ denotes the imaginary unit.
	% $\mathbb{C}$ represents the set of complex numbers.
	$\mathbb{H}^{n \times n}$, $\mathbb{H}_+^{n \times n}$, and $\mathbb{U}^{n \times n}$ denote the set of $n \times n$ Hermitian, positive semi-definite, and unitary matrices, respectively.
	% $\mathbf{0}$ and $\mathbf{I}$ are the all-zero and identity matrices with appropriate size, respectively.
	$\Re\{\cdot\}$ takes the real part of a complex number.
	% $\tr(\cdot)$ and $\det(\cdot)$ evaluate the trace and determinant of a square matrix, respectively.
	$\diag(\cdot)$ constructs a square matrix with arguments on the main (block) diagonal and zeros elsewhere.
	$\sv(\cdot)$, $\ran(\cdot)$, and $\ker(\cdot)$ evaluate the singular values (in descending order), range, and kernel of a matrix, respectively.
	% $\sv(\cdot)$ extracts the singular values of a matrix as a non-ascending vector.
	% $\card(\cdot)$ returns the cardinality of a set.
	$\conv(\cdot)$ returns the convex hull of arguments.
	$\mathrm{vec}(\cdot)$ stacks the columns of a matrix as a vector.
	$\lvert \cdot \rvert$, $\lVert \cdot \rVert$, and $\lVert \cdot \rVert _\mathrm{F}$ denote the absolute value, Euclidean norm, and Frobenius norm, respectively.
	$\sigma_n(\cdot)$ and $\lambda_n(\cdot)$ are the $n$-th largest singular value and eigenvalue, respectively.
	% $\boldsymbol{\sigma}(\cdot)$ and $\boldsymbol{\lambda}(\cdot)$ are the corresponding vectors.
	$(\cdot)^*$, $(\cdot)^\mathsf{T}$, $(\cdot)^\mathsf{H}$, $(\cdot)^\dagger$, $(\cdot)^{\star}$ denote the conjugate, transpose, conjugate transpose (Hermitian), Moore-Penrose inverse, and stationary point, respectively.
	$[N]$ is a shortcut for $\{1,2,\ldots,N\}$.
	$(\cdot)_{[x:y]}$ is a shortcut for $(\cdot)_x,(\cdot)_{x+1},\ldots,(\cdot)_y$.
	$\odot$ denotes the Hadamard product.
	$\mathcal{N}_{\mathbb{C}}(\mathbf{0}, \mathbf{\Sigma})$ is the multivariate \gls{cscg} distribution with mean $\mathbf{0}$ and covariance $\mathbf{\Sigma}$.
	$\sim$ means ``distributed as''.
\end{section}

\begin{section}{System Model}
	% \begin{subsection}{BD-RIS}
		The \gls{bd}-\gls{ris} can be modeled as an $N_\mathrm{S}$-port network \cite{Ivrlac2010} that divides into $G$ individual groups, where group $g \in [G]$ contains $N_g$ scattering elements interconnected by real-time reconfigurable components \cite{Shen2020a} such that $N_\mathrm{S} = \sum_{g=1}^G N_g$.
		We assume equal group size $N_g = L \triangleq N_\mathrm{S} / G, \ \forall g$, no mutual coupling between elements, and asymmetric circuit components for reference.
		% Some symmetric solutions (i.e., $\mathbf{\Theta} = \mathbf{\Theta}^\mathsf{T}$) will be discussed and their performance will be evaluated in Section~\ref{sc:simulation}.
		The overall scattering matrix is block-diagonal with unitary blocks
		\begin{equation}
			\label{eq:ris}
			\mathbf{\Theta} = \diag(\mathbf{\Theta}_1,\ldots,\mathbf{\Theta}_G),
		\end{equation}
		where $\mathbf{\Theta}_g \in \mathbb{U}^{L \times L}$ is the $g$-th diagonal block modeling the response of group $g$.
		Apparently, \gls{d}-\gls{ris} is an extreme case of \eqref{eq:ris} with group size $L=1$.
		Some viable architectures of \gls{bd}-\gls{ris} are illustrated in \cite[Fig. 3]{Shen2020a}, \cite[Fig. 5]{Li2023c}, \cite[Fig. 2]{Nerini2024} where the circuit topology have been modeled in $\mathbf{\Theta}$.
	% \end{subsection}

	% \begin{subsection}{MIMO Point-to-Point Channel}
		Consider a \gls{bd}-\gls{ris}-aided \gls{mimo} point-to-point channel with $N_\mathrm{T}$ and $N_\mathrm{R}$ transmit and receive antennas, respectively, and $N_\mathrm{S}$ scattering elements at the \gls{bd}-\gls{ris}.
		This configuration is denoted as $N_\mathrm{T} \times N_\mathrm{S} \times N_\mathrm{R}$.
		Let $\mathbf{H}_\mathrm{D} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$, $\mathbf{H}_\mathrm{B} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{S}}$, $\mathbf{H}_\mathrm{F} \in \mathbb{C}^{N_\mathrm{S} \times N_\mathrm{T}}$ denote the direct (i.e., transmitter-receiver), backward (i.e., \gls{ris}-receiver), and forward (i.e., transmitter-\gls{ris}) channels, respectively.
		The equivalent channel depends on the \gls{bd}-\gls{ris} scattering matrix
		\begin{equation}
			\label{eq:channel}
			\mathbf{H} = \mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} = \mathbf{H}_\mathrm{D} + \sum_g \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g},
			%  \triangleq \mathbf{H}_\mathrm{D} + \sum_g \mathbf{H}_g,
		\end{equation}
		where $\mathbf{H}_{\mathrm{B},g} \in \mathbb{C}^{N_\mathrm{R} \times L}$ and $\mathbf{H}_{\mathrm{F},g} \in \mathbb{C}^{L \times N_\mathrm{T}}$ are the backward and forward channels associated with group $g$, corresponding to the $(g{-}1)L{+}1$ to $gL$ columns of $\mathbf{H}_\mathrm{B}$ and rows of $\mathbf{H}_\mathrm{F}$, respectively.
		% , and $\mathbf{H}_g \triangleq \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}$ is the indirect channel via group $g$.
		Since unitary matrices constitute an algebraic group with respect to multiplication, the scattering matrix of group $g$ can be decomposed as
		\begin{equation}
			\label{eq:ris_decompose_group}
			\mathbf{\Theta}_g = \mathbf{L}_g \mathbf{X}_g \mathbf{R}_g^\mathsf{H},
		\end{equation}
		where $\mathbf{L}_g, \mathbf{R}_g \in \mathbb{U}^{L \times L}$ are two unitary matrices and $\mathbf{X}_g$ is a permutation matrix.
		Let $\mathbf{H}_g \triangleq \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}$ be the indirect channel induced by group $g$ and $\mathbf{H}_{\mathrm{B/F},g} = \mathbf{U}_{\mathrm{B/F},g} \mathbf{\Sigma}_{\mathrm{B/F},g} \mathbf{V}_{\mathrm{B/F},g}^\mathsf{H}$ be the \gls{svd} of the backward and forward channels, respectively.
		The equivalent channel is
		\begin{equation}
			\label{eq:channel_svd}
			\mathbf{H} = \overbrace{\mathbf{H}_\mathrm{D} + \sum_g \mathbf{U}_{\mathrm{B},g} \mathbf{\Sigma}_{\mathrm{B},g} \underbrace{\mathbf{V}_{\mathrm{B},g}^\mathsf{H} \mathbf{L}_g \mathbf{X}_g \mathbf{R}_g^\mathsf{H} \mathbf{U}_{\mathrm{F},g}}_\text{backward-forward} \mathbf{\Sigma}_{\mathrm{F},g} \mathbf{V}_{\mathrm{F},g}^\mathsf{H}}^\text{direct-indirect}.
		\end{equation}

		\begin{remark}
			In \eqref{eq:channel_svd}, the \gls{bd}-\gls{ris} performs a blockwise unitary transformation to combine the backward-forward (intra-group, multiplicative) channels and direct-indirect (inter-group, additive) channels.
			These two attributes are refined respectively as:
			\begin{itemize}
				\item \emph{Branch matching:} To pair and combine the branches (i.e., entries) of $\mathbf{H}_{\mathrm{B},g}$ and $\mathbf{H}_{\mathrm{F},g}$ through $\mathbf{\Theta}_g$;
				\item \emph{Mode alignment:} To align and order the modes (i.e., singular vectors) of $\{\mathbf{H}_g\}_{g \in [G]}$ with those of $\mathbf{H}_\mathrm{D}$ through $\mathbf{\Theta}$.
			\end{itemize}
		\end{remark}

		\begin{example}[\gls{siso} channel gain maximization]
			\label{eg:siso}
			Denote the direct, backward, forward channels as $h_\mathrm{D}$, $\mathbf{h}_\mathrm{B} \in \mathbb{C}^{N_\mathrm{S} \times 1}$, and $\mathbf{h}_\mathrm{F}^\mathsf{H} \in \mathbb{C}^{1 \times N_\mathrm{S}}$, respectively.
			In this case, mode alignment boils down to phase matching and the optimal \gls{bd}-\gls{ris} structure is
			% any $L \in [N_\mathrm{S}]$, including \gls{d}-\gls{ris}, suffices for perfect mode alignment using
			\begin{equation}
				\mathbf{\Theta}_{\textnormal{P-max},g}^\textnormal{SISO} = \frac{h_\mathrm{D}}{\lvert h_\mathrm{D} \rvert} \mathbf{V}_{\mathrm{B},g} \mathbf{U}_{\mathrm{F},g}^\mathsf{H}, \quad \forall g,
			\end{equation}
			where $\mathbf{V}_{\mathrm{B},g} = \bigl[\mathbf{h}_{\mathrm{B},g}/\lVert \mathbf{h}_{\mathrm{B},g} \rVert, \mathbf{N}_{\mathrm{B},g}\bigr] \in \mathbb{U}^{L \times L}$, $\mathbf{U}_{\mathrm{F},g} = \bigl[\mathbf{h}_{\mathrm{F},g}/\lVert \mathbf{h}_{\mathrm{F},g} \rVert, \mathbf{N}_{\mathrm{F},g}\bigr] \in \mathbb{U}^{L \times L}$, and $\mathbf{N}_{\mathrm{B/F},g} \in \mathbb{C}^{L \times (L-1)}$ are the orthonormal bases of kernels of $\mathbf{h}_{\mathrm{B/F},g}$.
			It is evident that any group size $L$ (including \gls{d}-\gls{ris}) suffices for perfect phase matching.
			On the other hand, the resulting maximum channel gain depends on $L$
			\begin{equation}
				\ \lvert h \rvert = \lvert h_\mathrm{D} \rvert + \sum_g \sum_l \lvert h_{\mathrm{B},g,\pi_{\mathrm{B},g}(l)} \rvert \lvert h_{\mathrm{F},g,\pi_{\mathrm{F},g}(l)} \rvert,
			\end{equation}
			where $h_{\mathrm{B/F},g,l}$ are the $l$-th entries of $\mathbf{h}_{\mathrm{B/F},g}$, and $\pi_{\mathrm{B/F},g}$ are permutations of $[L]$ sorting their magnitude in similar orders.
			That is, the maximum \gls{siso} channel gain is attained when each \gls{bd}-\gls{ris} group, apart from phase shifting, matches the $l$-th strongest backward and forward channel branches.
			A larger $L$ provides more flexible branch matching and thus higher channel gain.
		\end{example}

		Example~\ref{eg:siso} clarifies the difference between branch matching and mode alignment and show their impacts on channel shaping.
		When it comes to \gls{mimo}, the advantage of \gls{bd}-\gls{ris} in branch matching improves since the number of available branches is proportional to $N_\mathrm{T} N_\mathrm{R}$. On the other hand, the limitation of \gls{d}-\gls{ris} in mode alignment intensifies since each element can only apply a scalar phase shift to the indirect channel of $N \triangleq \min(N_\mathrm{T}, N_\mathrm{R})$ modes.
	% \end{subsection}

	% \begin{subsection}{MIMO Interference Channel}
		% \label{sc:mimo_ic}
		% We also consider a \gls{bd}-\gls{ris}-aided \gls{mimo} interference channel of $K$ transceiver pairs where each transmitter and receiver has $N_\mathrm{T}$ and $N_\mathrm{R}$ antennas, respectively, and the \gls{bd}-\gls{ris} has $N_\mathrm{S}$ scattering elements.
		% This configuration is denoted as $(N_\mathrm{T} \times N_\mathrm{S} \times N_\mathrm{R})^K$.
		% Let $\mathbf{H}_\mathrm{D}^{(kj)} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$, $\mathbf{H}_\mathrm{B}^{(k)} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{S}}$, $\mathbf{H}_\mathrm{F}^{(j)} \in \mathbb{C}^{N_\mathrm{S} \times N_\mathrm{T}}$ denote the direct channel from transmitter $j$ to receiver $k$, the backward channel of receiver $k$, and the forward channel of transmitter $j$, respectively, where $(j,k) \in [K]^2$.
		% Assume all transmitter-\gls{ris}-receiver paths share the same \gls{bd}-\gls{ris} scattering matrix $\mathbf{\Theta}$.
		% The equivalent channel from transmitter $j$ to receiver $k$ is
		% \begin{equation}
		% 	\label{eq:channel_interference}
		% 	\mathbf{H}^{(kj)} = \mathbf{H}_\mathrm{D}^{(kj)} {+} \mathbf{H}_\mathrm{B}^{(k)} \mathbf{\Theta} \mathbf{H}_\mathrm{F}^{(j)} = \mathbf{H}_\mathrm{D}^{(kj)} {+} \sum_g \mathbf{H}_{\mathrm{B},g}^{(k)} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}^{(j)},
		% \end{equation}
		% where $\mathbf{H}_{\mathrm{B},g}^{(k)} \in \mathbb{C}^{N_\mathrm{R} \times L}$ and $\mathbf{H}_{\mathrm{F},g}^{(j)} \in \mathbb{C}^{L \times N_\mathrm{T}}$ are associated with \gls{ris} group $g$, corresponding to the $(g{-}1)L{+}1$ to $gL$ columns of $\mathbf{H}_{\mathrm{B}}^{(k)}$ and rows of $\mathbf{H}_{\mathrm{F}}^{(j)}$, respectively.
	% \end{subsection}
\end{section}

\begin{section}{Channel Shaping}
	In this section, we first provide an example demonstrating the \gls{mimo} channel shaping advantages of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris}, then derive some analytical bounds related to channel singular values under specific channel conditions, and provide closed-form \gls{bd}-\gls{ris} solution for several cases of interest.
	Finally, we propose a numerical method to optimize the \gls{bd}-\gls{ris} for a special class of singular value functions under general channel conditions.

	\begin{example}[$2 \times 2 \times 2$ shaping]
		\label{eg:shaping_potential}
		Here \gls{d}-\gls{ris} and fully-connected \gls{bd}-\gls{ris} can be modeled by 2 and 4 independent angular parameters, respectively:
		\begin{equation*}
			\mathbf{\Theta}_\mathrm{D} = \diag(e^{\jmath \theta_1}, e^{\jmath \theta_2}), \quad
			\mathbf{\Theta}_\mathrm{BD} = e^{\jmath \phi} \begin{bmatrix}
				e^{\jmath \alpha} \cos \psi  & e^{\jmath \beta} \sin \psi   \\
				-e^{-\jmath \beta} \sin \psi & e^{-\jmath \alpha} \cos \psi
			\end{bmatrix},
		\end{equation*}
		We consider a special case where the \gls{bd}-\gls{ris} is symmetric (i.e., $\beta = \pi / 2$) and the direct channel is negligible such that $\phi$ has no impact on $\sv(\mathbf{H})$, since $\sv(e^{\jmath \phi} \mathbf{A}) = \sv(\mathbf{A})$.
		The singular value shaping capabilities of $\mathbf{\Theta}_\mathrm{D}$ and $\mathbf{\Theta}_\mathrm{BD}$ can thus be compared visually over 2 tunable parameters.
		\begin{figure}
			\centering
			\includegraphics[width=0.7\columnwidth]{../assets/simulation/pc_singular_trend.eps}
			\caption{$2 \times 2 \times 2$ singular value shaping by \gls{d}-\gls{ris} and symmetric fully-connected \gls{bd}-\gls{ris} when the direct channel is negligible.
			% $\sigma_1(\mathbf{H})$ and $\sigma_2(\mathbf{H})$ refer to the most and least dominant singular values, respectively.
			% Their maximum and minimum are marked explicitly on the plot.
			The maximum and minimum of both singular values are marked explicitly on the plot.}
			\label{fg:shaping_potential}
		\end{figure}
		With an exhaustive grid search over $(\theta_1, \theta_2)$ and $(\alpha, \psi)$, Fig.~\ref{fg:shaping_potential} shows the achievable singular values of a specific channel instance
		$
			\mathbf{H}_\mathrm{B} =
				\begin{bsmallmatrix}
					-0.2059 + 0.5914 \jmath & -0.0909 + 0.5861 \jmath \\
					0.4131 + 0.2651 \jmath  & -0.1960 + 0.4650 \jmath
				\end{bsmallmatrix}, \
				\mathbf{H}_\mathrm{F} =
				\begin{bsmallmatrix}
					-0.6362 + 0.1332 \jmath & -0.1572 + 1.5538 \jmath \\
					0.0196 + 0.4011 \jmath  & -0.3170 - 0.2303 \jmath
				\end{bsmallmatrix}.
		$
		% \begin{equation*}
		% 	\begin{split}
		% 		\mathbf{H}_\mathrm{B} & =
		% 		\begin{bsmallmatrix}
		% 			-0.2059 + 0.5914 \jmath & -0.0909 + 0.5861 \jmath \\
		% 			0.4131 + 0.2651 \jmath  & -0.1960 + 0.4650 \jmath
		% 		\end{bsmallmatrix},
		% 		\\
		% 		\mathbf{H}_\mathrm{F} & =
		% 		\begin{bsmallmatrix}
		% 			-0.6362 + 0.1332 \jmath & -0.1572 + 1.5538 \jmath \\
		% 			0.0196 + 0.4011 \jmath  & -0.3170 - 0.2303 \jmath
		% 		\end{bsmallmatrix}.
		% 	\end{split}
		% \end{equation*}
		In this example, both singular values can be manipulated up to\footnote{The percentage for manipulating $\sigma_n(\mathbf{H})$ is calculated by $\eta_n^+ = \frac{\max \sigma_n(\mathbf{H}) - \mathrm{avg} \sigma_n(\mathbf{H})}{\mathrm{avg} \sigma_n(\mathbf{H})} \times 100\%$ and  $\eta_n^- = \frac{\min \sigma_n(\mathbf{H}) - \mathrm{avg} \sigma_n(\mathbf{H})}{\mathrm{avg} \sigma_n(\mathbf{H})} \times 100\%$.} $\pm 9\%$ by \gls{d}-\gls{ris} and $\pm 42\%$ by symmetric fully-connected \gls{bd}-\gls{ris}.
		It is noteworthy that the former requires 2 circuit components and the latter requires 3.
	\end{example}

	Example~\ref{eg:shaping_potential} suggests that the physical interconnection of \gls{ris} elements, even if using symmetric circuit components, can create a ``cooperation effect'' that significantly enhances the dynamic range of channel singular values.
	This motivates the analytical and numerical channel shaping studies in Section~\ref{sc:shaping_analytical} and \ref{sc:shaping_numerical}, respectively.

	\begin{subsection}{Analytical Shaping Bounds}
		\label{sc:shaping_analytical}
		% \footnote{Here \gls{dof} refers to the maximum number of streams that can be transmitted in parallel over a \gls{mimo} channel, i.e., $\textnormal{DoF}(\mathbf{H}) = \lim_{\rho \to \infty} \frac{\log \det(\mathbf{I} + \rho \mathbf{H} \mathbf{H}^\mathsf{H})}{\log \rho}$ where $\rho$ is the \gls{snr}. It is closely related to radar \gls{dof} which refers to the number of independent measurements.}
		\begin{definition}[\gls{dof}]
			\gls{dof} refers to the maximum number of streams that can be transmitted in parallel over a \gls{mimo} channel in the asymptotic high-\gls{snr} regime
			\begin{equation}
				\textnormal{DoF}(\mathbf{H}) = \lim_{\rho \to \infty} \frac{\log \det(\mathbf{I} + \rho \mathbf{H} \mathbf{H}^\mathsf{H})}{\log \rho},
			\end{equation}
			where $\rho$ is the \gls{snr}.
			% It is closely related to radar \gls{dof} which refers to the number of independent measurements.
		\end{definition}

		\begin{definition}[Negligible direct channel]
			% A direct channel is considered negligible when the signal power received via the direct channel is negligible compared to the signal power received via the scattering of \gls{ris}
			A direct channel is considered negligible when its contribution to the received signal is substantially weaker than that of the \gls{ris}-induced channels. Mathematically, this can be defined as
			\begin{equation*}
				\frac{\lVert \mathbf{H}_\mathrm{D} \rVert _\mathrm{F}^2}{\lVert \sum_g \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g} \rVert _\mathrm{F}^2} < \epsilon,
			\end{equation*}
			where $\epsilon$ is a small positive threshold.
			This can result from a very large number of \gls{ris} elements (as in Proposition~\ref{pp:rd}) or physical obstacles in the propagation path (as in Proposition~\ref{pp:nd}).
			% A direct channel is considered negligible when the
			% signal going through it is negligible compared to that through the scattering of \gls{ris}
			% power of the signal arriving at the receiver through the direct path is negligible compared to that through the scattering of \gls{ris}.

			% Negligible direct channel refers to the case where the power of the signal arriving at the receiver through the direct path is negligible compared to that through the scattering of \gls{ris}, i.e., $\mathbf{H} \approx \sum_g \mathbf{H}_g$.
		\end{definition}

		The main results of this subsection are summarized in the following Propositions and Corollaries.
		\begin{proposition}[\gls{dof}]
			\label{pp:dof}
			\gls{bd}-\gls{ris} may achieve a larger or smaller \gls{mimo} \gls{dof} than \gls{d}-\gls{ris}.
		\end{proposition}
		\begin{proof}
			Please refer to Appendix~\ref{~ap:dof} in the supplement.
		\end{proof}

		While increasing the \gls{dof} improves the asymptotic rate performance for point-to-point transmission, the potential to reduce the \gls{dof} can be exploited to orthogonalize channels and align interference in multi-user scenarios.
		% reducing the \gls{dof} does not necessarily degrade the rate at finite \gls{snr}.
		% , it does not necessarily imply a higher rate at finite \gls{snr}.
		% It is worth mentioning that a larger \gls{dof} implies more parallel streams or less interference, which is beneficial for high-rate communication.

		\begin{example}[\gls{dof} of $4 \times 4 \times 4$ shaping]
			\label{eg:dof}
			Consider a $4 \times 4 \times 4$ shaping with $\mathbf{H}_\mathrm{D} = \mathbf{0}$ and
			\begin{equation*}
				\mathbf{H}_\mathrm{B} =
				\begin{bsmallmatrix}
					1 & 1 & 0 & 0 \\
					0 & 0 & 0 & 0 \\
					0 & 0 & 1 & 0 \\
					0 & 0 & 0 & 0
				\end{bsmallmatrix}, \quad
				\mathbf{H}_\mathrm{F} =
				\diag(1, 1, 0, 0).
			\end{equation*}
			Evidently, any \gls{d}-\gls{ris} $\mathbf{\Theta}_\mathrm{D} = \diag(e^{\jmath \theta_1}, e^{\jmath \theta_2}, e^{\jmath \theta_3}, e^{\jmath \theta_4})$ results in
			\begin{equation*}
				\mathbf{H} =
				\begin{bsmallmatrix}
					e^{\jmath \theta_1} & e^{\jmath \theta_2} & 0 & 0 \\
					0 & 0 & 0 & 0 \\
					0 & 0 & 0 & 0 \\
					0 & 0 & 0 & 0
				\end{bsmallmatrix}
			\end{equation*}
			with 1 \gls{dof}.
			In contrast, a fully-connected \gls{bd}-\gls{ris} can fully align or misalign the kernel of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ using \eqref{~eq:ris_dof_max} or \eqref{~eq:ris_dof_min} in Appendix~\ref{~ap:dof}
			\begin{equation*}
				\mathbf{\Theta}_{\textnormal{DoF-max}}^{\textnormal{MIMO}} =
				\begin{bsmallmatrix}
					0 & \frac{\sqrt{2}}{2} & 0 & -\frac{\sqrt{2}}{2} \\
					0 & \frac{\sqrt{2}}{2} & 0 & \frac{\sqrt{2}}{2} \\
					-1 & 0 & 0 & 0 \\
					0 & 0 & 1 & 0
				\end{bsmallmatrix}, \quad
				\mathbf{\Theta}_{\textnormal{DoF-min}}^{\textnormal{MIMO}} =
				\begin{bsmallmatrix}
					-\frac{\sqrt{2}}{2} & 0 & \frac{\sqrt{2}}{2} & 0\\
					\frac{\sqrt{2}}{2} & 0 & \frac{\sqrt{2}}{2} & 0 \\
					0 & 0 & 0 & 1 \\
					0 & -1 & 0 & 0
				\end{bsmallmatrix}.
			\end{equation*}
			Those correspond to
			\begin{equation*}
				\mathbf{H} =
				\begin{bsmallmatrix}
					0 & \sqrt{2} & 0 & 0 \\
					0 & 0 & 0 & 0 \\
					-1 & 0 & 0 & 0 \\
					0 & 0 & 0 & 0
				\end{bsmallmatrix}, \quad
				\mathbf{H} = \mathbf{0},
			\end{equation*}
			and a \gls{dof} of 2 and 0, respectively.
		\end{example}

		Proposition \ref{pp:dof} and Example \ref{eg:dof} suggest that we can expect more parallel streams or less interference when shaping the channel with \gls{bd}-\gls{ris}.
		We now take a step further to examine the limits of redistributing channel singular values under specific channel conditions.

		\begin{proposition}[Rank-deficient channel]
			\label{pp:rd}
			If the minimum rank of backward and forward channels is $k$ ($k \le N$),
			then for \gls{d}-\gls{ris} or \gls{bd}-\gls{ris} of arbitrary number of elements, the $n$-th singular value of the equivalent channel is bounded above and below respectively by
			\begin{subequations}
				\label{iq:sv_rd}
				\begin{align}
					\sigma_n(\mathbf{H}) & \le \sigma_{n-k}(\mathbf{T}), &  & \text{if } n > k, \label{iq:sv_rd_max}          \\
					\sigma_n(\mathbf{H}) & \ge \sigma_n(\mathbf{T}),     &  & \text{if } n < N - k + 1, \label{iq:sv_rd_min}
				\end{align}
			\end{subequations}
			where $\mathbf{T}$ is arbitrary auxiliary matrix satisfying
			\begin{equation}
				\label{eq:auxiliary_rd}
				\mathbf{T} \mathbf{T}^\mathsf{H} =
				\begin{cases}
					\mathbf{H}_\mathrm{D} (\mathbf{I} - \mathbf{V}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}) \mathbf{H}_\mathrm{D}^\mathsf{H}, & \text{if } \rank(\mathbf{H}_\mathrm{F}) = k, \\
					\mathbf{H}_\mathrm{D}^\mathsf{H} (\mathbf{I} - \mathbf{U}_\mathrm{B} \mathbf{U}_\mathrm{B}^\mathsf{H}) \mathbf{H}_\mathrm{D}, & \text{if } \rank(\mathbf{H}_\mathrm{B}) = k,
				\end{cases}
			\end{equation}
			and $\mathbf{V}_\mathrm{F}$ and $\mathbf{U}_\mathrm{B}$ are any right and left singular matrices of $\mathbf{H}_\mathrm{F}$ and $\mathbf{H}_\mathrm{B}$, respectively.
		\end{proposition}
		\begin{proof}
			Please refer to Appendix~\ref{~ap:rank_deficient} in the supplement.
		\end{proof}

		Inequality \eqref{iq:sv_rd_max} states that
		if $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ are at least rank $k$, then
		with a \gls{d}-\gls{ris} or \gls{bd}-\gls{ris} of \emph{sufficiently large} $N_\mathrm{S}$,
		the $n$-th singular value of $\mathbf{H}$ can be enlarged to the $(n-k)$-th singular value of $\mathbf{T}$, or suppressed to the $n$-th singular value of $\mathbf{T}$.
		Moreover, the first $k$ channel singular values are unbounded above\footnote{The energy conservation law $\sum_{n=1}^N \sigma_n^2(\mathbf{H}) \le 1$ still has to be respected in all cases.} while the last $k$ channel singular values can be suppressed to zero.
		Proposition \ref{pp:rd} complements Proposition \ref{pp:dof} by quantifying the dynamic range of extreme singular values.
		A special case of \gls{los} channel is presented below\footnote{A similar eigenvalue result has been derived for \gls{d}-\gls{ris} only \cite{Semmler2023}.}.


		\begin{corollary}[\gls{los} channel]
			\label{co:los}
			If at least one of backward and forward channels is \gls{los}, then a \gls{d}-\gls{ris} or \gls{bd}-\gls{ris} can at most enlarge the $n$-th ($n \ge 2$) channel singular value to the $(n-1)$-th singular value of $\mathbf{T}$, or suppress the $n$-th channel singular value to the $n$-th singular value of $\mathbf{T}$.
			That is,
			\begin{equation}
				\label{iq:sv_los}
				\sigma_1(\mathbf{H}) \ge \sigma_1(\mathbf{T}) \ge {\sigma_2(\mathbf{H})} \ge \ldots \ge \sigma_{N-1}(\mathbf{T}) \ge {\sigma_N(\mathbf{H})} \ge \sigma_N(\mathbf{T}).
			\end{equation}
		\end{corollary}

		\begin{proof}
			This is a direct result of \eqref{iq:sv_rd} with $k = 1$.
		\end{proof}

		We emphasize that Proposition \ref{pp:rd} and Corollary \ref{co:los} apply to both \gls{d}- and \gls{bd}-\gls{ris} configurations regardless of the status of the direct channel.
		Out of $2N$ bounds in \eqref{iq:sv_rd} or \eqref{iq:sv_los}, $N$ of them can be \emph{simultaneously} tight as $N_\mathrm{S} \to \infty$, namely, when the direct channel becomes negligible.
		For a finite $N_\mathrm{S}$, the \gls{ris} may prioritize a subset of those by aligning the corresponding modes, and we will later show in Section \ref{sc:simulation} that \gls{bd}-\gls{ris} outperforms \gls{d}-\gls{ris} on this purpose.
		Proposition \ref{pp:rd} provides a reference on the selection of $N_\mathrm{S}$ in low-multipath application scenarios, highlighting its diminishing returns.
		Next, we shift the focus to another popular \gls{ris} deployment scenario where the direct channel is blocked.


		\begin{proposition}[Negligible direct channel]
			\label{pp:nd}
			If the direct channel is negligible, then a fully-connected \gls{bd}-\gls{ris} can manipulate the channel singular values up to
			\begin{equation}
				\sv(\mathbf{H}) = \sv(\mathbf{BF}),
			\end{equation}
			where $\mathbf{B}$ and $\mathbf{F}$ are arbitrary matrices with $\sv(\mathbf{B})=\sv(\mathbf{H}_\mathrm{B})$ and $\sv(\mathbf{F})=\sv(\mathbf{H}_\mathrm{F})$.
		\end{proposition}

		\begin{proof}
			Please refer to Appendix~\ref{~ap:nd} in the supplement.
		\end{proof}

		Proposition \ref{pp:nd} says that if the direct channel is negligible and the \gls{bd}-\gls{ris} is fully-connected, the only singular value bounds on the equivalent channel are those on the product of unitary-transformed backward and forward channels.
		It is \emph{not necessarily} an asymptotic result and does \emph{not} depend on any relationship between $N_\mathrm{R}$, $N_\mathrm{S}$, and $N_\mathrm{T}$.
		Its importance lies in that our initial channel shaping question can be recast as a linear algebra question: \emph{How the singular values of matrix product are bounded by the singular values of its individual factors?}
		The question is partially answered in Corollaries \ref{co:nd_sv_prod_subset} -- \ref{co:nd_sv_indl} over the definition $\bar{N} = \max(N_\mathrm{T},N_\mathrm{S},N_\mathrm{R})$ and $\sigma_n(\mathbf{H})=\sigma_n(\mathbf{H}_\mathrm{F})=\sigma_n(\mathbf{H}_\mathrm{B})=0, \ \forall n \in [\bar{N}] \setminus [N]$.
		This is equivalent to padding zero blocks at the end of $\mathbf{H}, \mathbf{H}_\mathrm{B}, \mathbf{H}_\mathrm{F}$ to make square matrices of dimension $\bar{N}$.
		The results are by no means complete and interested readers are referred to \cite[Chapter 16, 24]{Hogben2013} and \cite[Chapter 3]{Horn1994} for more information.


		\begin{corollary}[Product of subset of singular values]
			\label{co:nd_sv_prod_subset}
			If the direct channel is negligible,
			then the product of subset of singular values of $\mathbf{H}$ is bounded from above by those of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$, that is,
			\begin{equation}
				\label{iq:horn}
				\prod_{k \in {K}} \sigma_k(\mathbf{H}) \le \prod_{i \in {I}} \sigma_i(\mathbf{H}_\mathrm{B}) \prod_{j \in {J}} \sigma_j(\mathbf{H}_\mathrm{F}),
			\end{equation}
			for all admissible triples $(I, J, K) \in T_r^{\bar{N}}$ with $r < \bar{N}$, where
			\begin{equation*}
				\begin{split}
					T_r^{\bar{N}} \triangleq \Bigl\{(I, J, K) \in U_r^{\bar{N}} \bigm\vert & \forall p < r, \ \forall (F, G, H) \in T_p^r,                                              \\
																							& \sum_{f \in F} i_f + \sum_{g \in G} j_g \le \sum_{h \in H} k_h + \frac{p(p+1)}{2} \Bigr\},
				\end{split}
			\end{equation*}
			\begin{equation*}
				U_r^{\bar{N}} \triangleq \Bigl\{(I, J, K) \subseteq [\bar{N}]^3 \bigm\vert \sum_{i \in I} i + \sum_{j \in J} j = \sum_{k \in K} k + \frac{r(r+1)}{2}\Bigr\}.
			\end{equation*}
		\end{corollary}

		\begin{proof}
			Please refer to \cite[Theorem~8]{Fulton2000}.
		\end{proof}

		Inequality \eqref{iq:horn}, also recognized as a variation of Horn's inequality \cite{Bhatia2001}, is one of the most comprehensive result over Proposition \ref{pp:nd}.
		However, the number of admissible triples increases exponentially\footnote{For example, the number of inequalities described by \eqref{iq:horn} grows from 12 to 2062 when $N_\mathrm{S}$ increases from 3 to 7.} with $N_\mathrm{S}$ despite some resulting bounds can be redundant.
		We will shortly see \eqref{iq:horn} can also induce lower bounds on channel singular values.
		Those facts render the shaping limit analysis non-trivial for large-scale \gls{ris}-aided \gls{mimo} systems.
		Below we showcase some useful bounds therein.

		\begin{corollary}[Product of some largest or smallest singular values]
			\label{co:nd_sv_prod_tail}
			If the direct channel is negligible,
			then the product of the first (resp. last\footnote{The lower bounds coincide at zero when $\bar{N} \ne N$ (i.e., $N_\mathrm{T} = N_\mathrm{S} = N_\mathrm{R}$ being false).}) $k$ singular values of $\mathbf{H}$ is bounded from above (resp. below) by those of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$, that is,
			\begin{subequations}
				\begin{align}
					\prod_{n=1}^k \sigma_n(\mathbf{H})                   & \le \prod_{n=1}^k \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}), \label{iq:sv_nd_prod_largest}                    \\
					\prod_{n=\bar{N}}^{\mathclap{\bar{N}-k+1}} \sigma_n(\mathbf{H}) & \ge \prod_{n=\bar{N}}^{\mathclap{\bar{N}-k+1}} \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}). \label{iq:sv_nd_prod_smallest}
				\end{align}
			\end{subequations}
		\end{corollary}

		\begin{proof}
			Please refer to Appendix~\ref{~ap:nd_sv_prod_tail} in the supplement.
		\end{proof}

		\begin{corollary}[Individual singular value]
			\label{co:nd_sv_indl}
			If the direct channel is negligible,
			then the $n$-th channel singular value can be manipulated up to
			\begin{equation}
				\label{iq:sv_nd_indl}
				\max_{\mathclap{i+j=n+N_\mathrm{S}}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) \le \sigma_n(\mathbf{H}) \le \min_{\mathclap{i+j=n+1}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}),
			\end{equation}
			where $(i, j) \in [N_\mathrm{S}]^2$.
			The upper and lower bounds are attained respectively at
			\begin{subequations}
				\label{eq:ris_nd_sv_indl}
				\begin{align}
					\mathbf{\Theta}_{\textnormal{sv-}n\textnormal{-max}}^\textnormal{MIMO-ND} & = \mathbf{V}_\mathrm{B} \mathbf{P} \mathbf{U}_\mathrm{F}^\mathsf{H}, \label{eq:ris_nd_sv_indl_max} \\
					\mathbf{\Theta}_{\textnormal{sv-}n\textnormal{-min}}^\textnormal{MIMO-ND} & = \mathbf{V}_\mathrm{B} \mathbf{Q} \mathbf{U}_\mathrm{F}^\mathsf{H}, \label{eq:ris_nd_sv_indl_min}
				\end{align}
			\end{subequations}
			where $\mathbf{V}_\mathrm{B}, \mathbf{U}_\mathrm{F} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$ are any right and left singular matrices of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$, respectively,
			and $\mathbf{P}$ and $\mathbf{Q}$ are arbitrary permutation matrices of dimension $N_\mathrm{S}$ satisfying:
			\begin{itemize}
				\item The $(i, j)$-th entry is $1$, where
					\begin{subnumcases}{(i, j) =}
						\ \underset{\mathclap{i+j=n+1}}{\arg\min} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) & for $\mathbf{P}$, \label{eq:idx_nd_sv_indl_max} \\
						\ \underset{\mathclap{i+j=n+N_\mathrm{S}}}{\arg\max} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) & for $\mathbf{Q}$, \label{eq:idx_nd_sv_indl_min}
					\end{subnumcases}
					and ties may be broken arbitrarily;
				\item After deleting the $i$-th row and $j$-th column, the resulting submatrix $\mathbf{Y}$ is arbitrary permutation matrix of dimension $N_\mathrm{S}-1$ satisfying
					\begin{subequations}
						\begin{alignat}{2}
							\sigma_{n{-}1}(\hat{\mathbf{\Sigma}}_{\mathrm{B}} \mathbf{Y} \hat{\mathbf{\Sigma}}_{\mathrm{F}}) & {\ge} \ \ \min_{\mathclap{i+j=n+1}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F})            &  & \text{ for } \mathbf{P}, \label{eq:perm_nd_sv_indl_max} \\
							\sigma_{n{+}1}(\hat{\mathbf{\Sigma}}_{\mathrm{B}} \mathbf{Y} \hat{\mathbf{\Sigma}}_{\mathrm{F}}) & {\le} \ \ \max_{\mathclap{i+j=n+N_\mathrm{S}}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) &  & \text{ for } \mathbf{Q}, \label{eq:perm_nd_sv_indl_min}
						\end{alignat}
					\end{subequations}
					where $\hat{\mathbf{\Sigma}}_{\mathrm{B}}$ and $\hat{\mathbf{\Sigma}}_{\mathrm{F}}$ are diagonal singular value matrices of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ with both $i$-th row and $j$-th column deleted, respectively.
			\end{itemize}
		\end{corollary}

		\begin{proof}
			Please refer to Appendix~\ref{~ap:nd_sv_indl} in the supplement.
		\end{proof}

		\begin{remark}
			\label{rm:svd}
			We emphasize that the singular matrices in the \gls{svd} are not uniquely defined.
			When a singular value has multiplicity $k$, the corresponding singular vectors can be any orthonormal basis of the $k$-dimensional subspace. Even if all singular values are distinct, the singular vectors of each can be scaled by a phase factor of choice.
			Consequently, all \gls{svd}-based \gls{ris} solutions in this paper are inherently non-unique.
		\end{remark}

		Corollary \ref{co:nd_sv_indl} and Proposition \ref{pp:rd} both reveal the shaping limits of the $n$-th largest channel singular value, which may be used to simplify the \gls{mimo} precoder design with limited number $n$ of \gls{rf} chains.
		They are derived under different assumptions are not special cases of each other.
		Importantly, Corollary \ref{co:nd_sv_indl} establishes upper and lower bounds for \emph{each} channel singular value (c.f. first and last few in Proposition \ref{pp:rd}), applies to fully-connected \gls{bd}-\gls{ris} of arbitrary size, and provides a general solution structure.
		We emphasize that in \eqref{eq:ris_nd_sv_indl} the mode alignment is realized by $\mathbf{V}_\mathrm{B}$ and $\mathbf{U}_\mathrm{F}$ while the ordering is enabled by permutation matrices $\mathbf{P}$ and $\mathbf{Q}$, which are special cases of $\mathbf{X}$ defined in \eqref{eq:ris_decompose_group}.
		Specially, the extreme channel singular values can be manipulated up to
		\begin{subequations}
			\label{iq:sv_nd_extreme}
			\begin{gather}
				\max_{\mathclap{i+j=N_\mathrm{S}+1}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) {\le} \sigma_1(\mathbf{H}) {\le} \sigma_1(\mathbf{H}_\mathrm{B}) \sigma_1(\mathbf{H}_\mathrm{F}), \label{iq:sv_nd_largest} \\
				\min_{\mathclap{i+j=\bar{N}+1}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) {\ge} \sigma_{\bar{N}}(\mathbf{H}) {\ge} \sigma_{\bar{N}}(\mathbf{H}_\mathrm{B}) \sigma_{\bar{N}}(\mathbf{H}_\mathrm{F}). \label{iq:sv_nd_smallest}
			\end{gather}
		\end{subequations}
		We notice that the right halves in \eqref{iq:sv_nd_largest} and \eqref{iq:sv_nd_smallest} are also special cases of \eqref{iq:sv_nd_prod_largest} and \eqref{iq:sv_nd_prod_smallest} with $k=1$.

		\begin{example}[Bounds on $3 \times 3 \times 3$ shaping]
			\label{eg:shaping_bounds}
			Consider a $3 \times 3 \times 3$ setup with $\mathbf{H}_\mathrm{D} = \mathbf{0}$, $\mathbf{H}_\mathrm{B} = \diag(3, 2, 1)$, and $\mathbf{H}_\mathrm{F} = \diag(4, 0, 5)$.
			\begin{itemize}
				\item \gls{d}-\gls{ris}: It is evident that any \gls{d}-\gls{ris} can only achieve $\sv(\mathbf{H}) = [12, 5, 0]^\mathsf{T}$ due to limited branch matching and mode alignment capability;
				\item \gls{bd}-\gls{ris}: According to \eqref{iq:sv_nd_indl}, a fully-connected \gls{bd}-\gls{ris} can manipulate the singular values up to
					\begin{equation*}
						8 \le \sigma_1(\mathbf{H}) \le 15, \quad 4 \le \sigma_2(\mathbf{H}) \le 10, \quad 0 \le \sigma_3(\mathbf{H}) \le 0.
					\end{equation*}
					To attain the upper and lower bounds, $(i,j)$ in \eqref{eq:ris_nd_sv_indl_max} and \eqref{eq:ris_nd_sv_indl_min} takes $(1, 1)$ and $(2, 2)$ when $n=1$, and $(2, 1)$ and $(3, 2)$ when $n=2$, respectively.
			\end{itemize}
		\end{example}

		We conclude from Example \ref{eg:shaping_bounds} that a fully-connected \gls{bd}-\gls{ris} can widen the dynamic range of channel singular values by properly aligning and ordering the modes of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$.
		However, the individual bounds \eqref{iq:sv_nd_indl} may not be simultaneously tight when the problem of interest is a function of multiple singular values.
		Some case studies are presented below.

		\begin{corollary}[Channel power gain]
			\label{co:nd_power}
			If the direct channel is negligible, then the channel power gain is bounded from above (resp. below) by the inner product of squared singular values of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ when they are sorted similarly (resp. oppositely), that is,
			% \footnote{As a side note, we notice \cite{Fang1994} discussed a similar bound using extreme singular values $\max\bigl(\sigma_{N}(\mathbf{H}_\mathrm{B}) \lVert \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2, \sigma_{N}(\mathbf{H}_\mathrm{F}) \lVert \mathbf{H}_\mathrm{B} \rVert _\mathrm{F}^2\bigr) \le \lVert \mathbf{H} \rVert _\mathrm{F}^2 \le \min\bigl(\sigma_1(\mathbf{H}_\mathrm{B}) \lVert \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2, \sigma_1(\mathbf{H}_\mathrm{F}) \lVert \mathbf{H}_\mathrm{B} \rVert _\mathrm{F}^2\bigr)$. This is a looser version of \eqref{iq:power_nd} and cannot take equalities unless the extreme singular values are of multiplicity $N$.}
			\begin{equation}
				\label{iq:power_nd}
				\sum_{n=1}^N \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_{N_\mathrm{S}-n+1}^2(\mathbf{H}_\mathrm{F}) \le \lVert \mathbf{H} \rVert _\mathrm{F}^2 \le \sum_{n=1}^N \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F}),
			\end{equation}
			whose upper and lower bounds are attained respectively at
			\begin{subequations}
				\label{eq:ris_nd_power}
				\begin{align}
					\mathbf{\Theta}_\textnormal{P-max}^\textnormal{MIMO-ND} & = \mathbf{V}_\mathrm{B} \mathbf{U}_\mathrm{F}^\mathsf{H}, \label{eq:ris_nd_power_max}            \\
					\mathbf{\Theta}_\textnormal{P-min}^\textnormal{MIMO-ND} & = \mathbf{V}_\mathrm{B} \mathbf{J} \mathbf{U}_\mathrm{F}^\mathsf{H} \label{eq:ris_nd_power_min},
				\end{align}
			\end{subequations}
			where $\mathbf{J}$ is the exchange (a.k.a. backward identity) matrix of dimension $N_\mathrm{S}$.
		\end{corollary}
		\begin{proof}
			Please refer to Appendix~\ref{~ap:nd_power} in the supplement.
		\end{proof}

		We notice that \eqref{eq:ris_nd_power_max} and \eqref{eq:ris_nd_power_min} are special cases of \eqref{eq:ris_nd_sv_indl_max} and \eqref{eq:ris_nd_sv_indl_min} with $\mathbf{P} = \mathbf{I}$ and $\mathbf{Q} = \mathbf{J}$, which also attain the right and left halves of \eqref{iq:sv_nd_extreme}, respectively.
		The upper bound \eqref{eq:ris_nd_power_max} is also reminiscent of the optimal amplify-and-forward relay beamforming design \cite[(16), (17)]{Rong2009a} where the diagonal power allocation matrices boil down to $\mathbf{I}$ due to the passive nature of \gls{ris}.
		As a side note, when both $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ follow Rayleigh fading, the expectation of maximum channel power gain can be numerically evaluated as
		\begin{equation}
			\label{eq:power_nd_rayleigh}
			\begin{split}
				\mathbb{E}\bigl\{ \lVert \mathbf{H} \rVert _ \mathrm{F}^2 \bigr\} = \sum_{n=1}^N
				& \int_0^\infty x f_{\lambda_n^{\min(N_\mathrm{R},N_\mathrm{S})}}(x) d x         \\
				& \times \int_0^\infty y f_{\lambda_n^{\min(N_\mathrm{S},N_\mathrm{T})}}(y) d y,
			\end{split}
		\end{equation}
		where $\lambda_n^{K}$ is the $n$-th eigenvalue of the complex $K \times K$ Wishart matrix with probability density function $f_{\lambda_n^{K}}(\cdot)$ given by \cite[(51)]{Zanella2009}.
		\eqref{eq:power_nd_rayleigh} generalizes the \gls{siso} channel power gain aided by \gls{bd}-\gls{ris} \cite[(58)]{Shen2020a} to \gls{mimo} but a closed-form expression is non-trivial.
		The next corollary has been derived in \cite{Bartoli2023} independently of Proposition \ref{pp:nd} and we include it here for completeness of results.
		\begin{corollary}[Channel capacity at general \gls{snr}]
			\label{co:nd_capacity_snr_general}
			If the direct channel is negligible, then the \gls{bd}-\gls{ris}-aided \gls{mimo} channel capacity is
			\begin{equation}
				\label{eq:capacity_nd}
				C^\textnormal{MIMO-ND} = \sum_{n=1}^N \log \left(1 + \frac{s_n \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F})}{\eta}\right),
			\end{equation}
			where $\eta$ is the average noise power, $s_n = \mu - \frac{\eta}{\sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F})}$ is the power allocated to the $n$-th mode obtainable by the water-filling algorithm \cite{Clerckx2013}.
			The capacity-achieving \gls{bd}-\gls{ris} scattering matrix is
			\begin{equation}
				\label{eq:ris_nd_rate_max}
				\mathbf{\Theta}_\textnormal{R-max}^\textnormal{MIMO-ND} = \mathbf{V}_\mathrm{B} \mathbf{U}_\mathrm{F}^\mathsf{H}.
			\end{equation}
		\end{corollary}

		\begin{proof}
			Please refer to \cite[Appendix~A]{Bartoli2023}.
		\end{proof}

		Corollary \ref{co:nd_capacity_snr_general} also suggests that the power- and rate-optimal scattering matrices \eqref{eq:ris_nd_power_max} and \eqref{eq:ris_nd_rate_max} coincide with each other when the direct channel is negligible and the \gls{bd}-\gls{ris} is fully-connected.
		When either condition is not satisfied, active and passive beamforming are coupled and the rate-optimal solution involves alternating optimization.
		However, the power gain-optimal \gls{ris} still provides for a low-complexity decoupled solution.
		The details will be discussed in Section~\ref{sc:rate}.

		\begin{corollary}[Channel capacity at extreme \gls{snr}]
			\label{co:nd_capacity_snr_extreme}
			If the direct channel is negligible, then the channel capacity at extremely low and high \gls{snr} $\rho$ are approximately bounded from above by
			\begin{subequations}
				\label{iq:capacity_nd_snr_extreme}
				\begin{align}
					C_{\rho_\downarrow} & \lessapprox \rho \sigma_1^2(\mathbf{H}_\mathrm{B}) \sigma_1^2(\mathbf{H}_\mathrm{F}), \label{iq:capacity_nd_snr_low}                                           \\
					C_{\rho_\uparrow}   & \lessapprox N \log \frac{\rho}{N} + 2 \log \prod_{n=1}^N \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}). \label{iq:capacity_nd_snr_high}
				\end{align}
			\end{subequations}
		\end{corollary}

		\begin{proof}
			Please refer to Appendix~\ref{~ap:nd_capacity} in the supplement.
		\end{proof}

		The ergodic counterparts of \eqref{eq:capacity_nd} and \eqref{iq:capacity_nd_snr_extreme} when both $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ follow Rayleigh fading can be evaluated similarly to \eqref{eq:power_nd_rayleigh}.
		Proposition \ref{pp:dof} -- \ref{pp:nd} and the resulting Corollaries provide a partial answer to the channel shaping question in terms of singular values and their functions.
		Extending the analysis to more general setups and objectives is non-trivial due to limited branch matching and mode alignment capabilities therein.
		A numerical solution will be discussed in Section~\ref{sc:shaping_numerical}.
	\end{subsection}

	\begin{subsection}{Numerical Shaping Solution}
		\label{sc:shaping_numerical}
		Consider a special class of channel shaping problem
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{f\bigl(\sv(\mathbf{H})\bigr)}{\label{op:shaping}}{\label{ob:shaping}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I},}{\quad \forall g,}{\label{cn:shaping_unitary}}
		\end{maxi!}
		where $f: \mathbb{R}^{N} \to \mathbb{R}$ is a symmetric gauge function (i.e., a norm invariant under sign change and argument permutation) \cite{Watson1992}.
		Examples of such $f$ include the Ky Fan $k$ norm, Schatten $p$ norm, $n$-th singular value, and channel power gain.
		Problem \eqref{op:shaping} is non-convex due to the unitary constraints \eqref{cn:shaping_unitary} and non-smooth due to the possibility of repeated singular values or singular values crossing each other.
		\begin{proposition}
			\label{pp:shaping}
			The sub-differential of \eqref{ob:shaping} with respect to \gls{bd}-\gls{ris} block $g$ is
			\begin{equation}
				\label{eq:shaping_subdiff}
				\partial_{\mathbf{\Theta}_g^*} f\bigl(\sv(\mathbf{H})\bigr) = \conv \bigl\{ \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{U} \mathbf{D} \mathbf{V}^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^\mathsf{H} \bigr\},
			\end{equation}
			where $\mathbf{D} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$ is a rectangular diagonal matrix with $[\mathbf{D}]_{n,n} \in \partial_{\sigma_n(\mathbf{H})} f\bigl(\sv(\mathbf{H})\bigr)$, $\forall n \in [N]$, and $\mathbf{U}$, $\mathbf{V}$ are any left and right singular matrices of $\mathbf{H}$.
		\end{proposition}

		\begin{proof}
			Please refer to Appendix~\ref{~ap:shaping} in the supplement.
		\end{proof}

		With Proposition \ref{pp:shaping}, one can apply the \emph{relax-then-project} method \cite{Shen2020a,Fang2023} or \emph{non-geodesic\footnote{A geodesic is a curve representing the shortest path between two points in a Riemannian manifold, whose tangent vectors remain parallel when transporting along the curve.} \gls{rcg}} \cite{Li2023b,Li2023c,Zhou2023} to solve problem \eqref{op:shaping}.
		The former solves unconstrained problem \eqref{ob:shaping} by quasi-Newton methods and projects the solution back to domain \eqref{cn:shaping_unitary} without guarantee of optimality.
		The latter generalizes the conjugate gradient methods to Riemannian manifolds and updates the solution by addition and retraction, which constitutes a zigzag path departing from and returning to the manifold.
		Next, we introduce a group-wise \emph{geodesic \gls{rcg}} method modified from \cite{Abrudan2008,Abrudan2009} that performs multiplicative updates along the geodesics on the Stiefel manifold for faster convergence.
		\begin{remark}
			The group-wise geodesic \gls{rcg} method is applicable to a wide range of \gls{bd}-\gls{ris} designs where the objective $f$ is smooth or convex non-smooth and \eqref{cn:shaping_unitary} is the only constraint.
		\end{remark}
		The steps for updating $\mathbf{\Theta}_g$ at iteration $r$ are summarized below, where gradients can be replaced by sub-gradients for non-smooth $f$.
		\begin{enumerate}[label=(\roman*)]
			\item \emph{Compute the Euclidean gradient at $\mathbf{\Theta}_g^{(r)}$:} The gradient of $f$ with respect to $\mathbf{\Theta}_g$ in the Euclidean space is
			% \cite[(A.3.6)]{Fischer2005}
				\begin{equation}
					\label{eq:gradient_eucl}
					\nabla_{\mathrm{E},g}^{(r)} = 2 \frac{\partial f(\mathbf{\Theta}_g^{(r)})}{\partial \mathbf{\Theta}_g^*};
				\end{equation}
			\item \emph{Translate to the Riemannian gradient at $\mathbf{\Theta}_g^{(r)}$:} At point $\mathbf{\Theta}_g^{(r)}$, the Riemannian gradient gives the steepest ascent direction on the manifold. It lies in the tangent space of the manifold $\mathcal{T}_{\mathbf{\Theta}_g^{(r)}}\mathbb{U}^{L \times L} \triangleq \{\mathbf{M} \in \mathbb{C}^{L \times L} \mid \mathbf{M}^\mathsf{H} \mathbf{\Theta}_g^{(r)} + {\mathbf{\Theta}_g^{(r)\mathsf{H}}} \mathbf{M} = \mathbf{0}\}$ and is obtainable by projection:
				\begin{equation}
					\label{eq:gradient_riem}
					\nabla_{\mathrm{R},g}^{(r)} = \nabla_{\mathrm{E},g}^{(r)} - \mathbf{\Theta}_g^{(r)} {\nabla_{\mathrm{E},g}^{(r)\mathsf{H}}} \mathbf{\Theta}_g^{(r)};
				\end{equation}
			\item \emph{Translate to the Riemannian gradient at the identity:} The Riemannian gradient should be translated back to the identity for exploiting the Lie algebra\footnote{Lie algebra refers to the tangent space of the Lie group at the identity element. A Lie group is simultaneously a continuous group and a differentiable manifold. In this example, $\mathbb{U}^{L \times L}$ formulates a Lie group and the corresponding Lie algebra consists of skew-Hermitian matrices $\mathfrak{u}(L) \triangleq \mathcal{T}_{\mathbf{I}}\mathbb{U}^{L \times L} = \{\mathbf{M} \in \mathbb{C}^{L \times L} \mid \mathbf{M}^\mathsf{H} + \mathbf{M} = \mathbf{0}\}$.}:
				\begin{equation}
					\label{eq:gradient_riem_tran}
					\tilde{\nabla}_{\mathrm{R},g}^{(r)} = \nabla_{\mathrm{R},g}^{(r)} \mathbf{\Theta}_g^{(r)\mathsf{H}} = \nabla_{\mathrm{E},g}^{(r)} \mathbf{\Theta}_g^{(r)\mathsf{H}} - \mathbf{\Theta}_g^{(r)} {\nabla_{\mathrm{E},g}^{(r)\mathsf{H}}}.
					% $\mathcal{O}(2 L^3)$
				\end{equation}
			\item \emph{Determine the conjugate direction:} The conjugate direction is obtained over the Riemannian gradient and previous direction as
				\begin{equation}
					\label{eq:conjugate_dirn_geod}
					{\mathbf{D}}_g^{(r)} = \tilde{\nabla}_{\mathrm{R},g}^{(r)} + {\gamma}_g^{(r)} {\mathbf{D}}_g^{(r-1)},
				\end{equation}
				where $\gamma_g^{(r)}$ is the parameter that deviates the conjugate direction from the tangent space for accelerated convergence. A popular choice is the Polak-Ribi\`{e}re formula \cite{Hager2006}
				\begin{equation}
					\label{eq:conjugate_parm_geod}
					{\gamma}_g^{(r)} = \frac{\tr\bigl((\tilde{\nabla}_{\mathrm{R},g}^{(r)} - \tilde{\nabla}_{\mathrm{R},g}^{(r-1)}) {\tilde{\nabla}_{\mathrm{R},g}^{(r)\mathsf{H}}}\bigr)}{\tr\bigl(\tilde{\nabla}_{\mathrm{R},g}^{(r-1)} {\tilde{\nabla}_{\mathrm{R},g}^{(r-1)\mathsf{H}}}\bigr)}. % $\mathcal{O}(2 N_\mathrm{S}^3 + N_\mathrm{S}^2 + 2 N_\mathrm{S})$
				\end{equation}
			\item \emph{Evaluate the geodesic at the identity:} The geodesic emanating from the identity with velocity $\mathbf{D} \in \mathfrak{u}(L)$ is described by
				\begin{equation}
					\label{eq:geodesic_iden}
					\mathbf{G}_\mathbf{I}(\mu) = \exp(\mu \mathbf{D}),
				\end{equation}
				where $\exp(\mathbf{A}) = \sum_{k=0}^\infty (\mathbf{A}^k/k!)$ is the matrix exponential and $\mu$ is the step size (i.e., magnitude of the tangent vector).
			\item \emph{Translate to the geodesic at $\mathbf{\Theta}_g^{(r)}$:} The geodesic emanating from $\mathbf{\Theta}_g^{(r)}$ terminates at $\mathbf{\Theta}_g^{(r+1)}$ by multiplicative updates
				\begin{equation}
					\label{eq:geodesic_tran}
					\mathbf{\Theta}_g^{(r+1)} {=} \mathbf{G}_{\mathbf{\Theta}_g^{(r)}}(\mu) {=} \mathbf{G}_\mathbf{I}(\mu) \mathbf{\Theta}_g^{(r)} {=} \exp(\mu \mathbf{D}_g^{(r)}) \mathbf{\Theta}_g^{(r)},
				\end{equation}
				where $\mu$ is the step size refinable\footnote{To double the step size, one can simply square the rotation matrix instead of recomputing the matrix exponential, that is, $\exp^2(\mu \mathbf{D}_g^{(r)}) = \exp(2 \mu \mathbf{D}_g^{(r)})$.} by the Armijo rule \cite{Armijo1966}.
		\end{enumerate}

		\begin{algorithm}[!t]
			\footnotesize
			\caption{Group-wise geodesic \gls{rcg}}
			\label{ag:rcg}
			\begin{algorithmic}[1]
				\Require $f(\mathbf{\Theta})$, $G$
				\Ensure $\mathbf{\Theta}^\star$
				\Initialize {$r \gets 0$, $\mathbf{\Theta}^{(0)}$}
				\Repeat
				\For {$g \gets 1$ to $G$}
				\State $\nabla_{\mathrm{E},g}^{(r)} \gets$ \eqref{eq:gradient_eucl}, $\tilde{\nabla}_{\mathrm{R},g}^{(r)} \gets$ \eqref{eq:gradient_riem_tran}
				\State $\tilde{\gamma}_g^{(r)} \gets$ \eqref{eq:conjugate_parm_geod}, $\mathbf{D}_g^{(r)} \gets$ \eqref{eq:conjugate_dirn_geod}
				\If {$\Re\bigl\{\tr({\mathbf{D}_g^{(r)\mathsf{H}}} \tilde{\nabla}_{\mathrm{R},g}^{(r)})\bigr\} < 0$} \Comment{Not ascent}
				\State $\mathbf{D}_g^{(r)} \gets \tilde{\nabla}_{\mathrm{R},g}^{(r)}$
				\EndIf
				\State $\mu \gets 0.1$
				\State $\mathbf{G}_{\mathbf{\Theta}_g^{(r)}}(\mu) \gets$ \eqref{eq:geodesic_tran}
				\While {$ f\bigl(\mathbf{G}_{\mathbf{\Theta}_g^{(r)}}(2\mu)\bigr) - f(\mathbf{\Theta}_g^{(r)}) \ge \mu \cdot \frac{\tr(\mathbf{D}_g^{(r)} {\mathbf{D}_g^{(r)\mathsf{H}}})}{2}$}\label{ln:armijo_start}
				\State $\mu \gets 2 \mu$
				\EndWhile
				\While {$f\bigl(\mathbf{G}_{\mathbf{\Theta}_g^{(r)}}(\mu)\bigr) - f(\mathbf{\Theta}_g^{(r)}) < \frac{\mu}{2} \cdot \frac{\tr(\mathbf{D}_g^{(r)} {\mathbf{D}_g^{(r)\mathsf{H}}})}{2}$}
				\State $\mu \gets \mu / 2$
				\EndWhile \label{ln:armijo_end}
				\State $\mathbf{\Theta}_g^{(r+1)} \gets$ \eqref{eq:geodesic_tran}
				\EndFor
				\State $r \gets r+1$
				\Until $\lvert f(\mathbf{\Theta}^{(r)}) - f(\mathbf{\Theta}^{(r-1)}) \rvert / f(\mathbf{\Theta}^{(r-1)}) \le \epsilon$
			\end{algorithmic}
		\end{algorithm}

		Algorithm~\ref{ag:rcg} summarizes the introduced group-wise geodesic \gls{rcg} method.
		Compared to the non-geodesic approach, it leverages Lie algebra to replace the add-then-retract update with a multiplicative update \eqref{eq:geodesic_tran} along the geodesics of the Stiefel manifold.
		This appropriate parameter space leads to faster convergence and easier step size tuning.
		Convergence to a local optimum is still guaranteed if not initialized at a stationary point.
		The group-wise updates can be performed in parallel to facilitate large-scale \gls{bd}-\gls{ris} design problems.
		One can also directly operate on $\mathbf{\Theta}$ and pinching (i.e., keeping the main block diagonal and nulling others) relevant expressions to unify step size selection and accelerate the algorithm for a large $G$.

		We now analyze the computational complexity of solving singular value shaping problem \eqref{op:shaping} by Algorithm~\ref{ag:rcg}.
		To update each \gls{bd}-\gls{ris} group, \gls{svd} of $\mathbf{H}$ requires $\mathcal{O}(N N_\mathrm{T} N_\mathrm{R})$, Euclidean sub-gradient \eqref{eq:shaping_subdiff} requires $\mathcal{O}\bigl(L N (N_\mathrm{T}+N_\mathrm{R}+L) \bigr)$, Riemannian sub-gradient translation \eqref{eq:gradient_riem_tran} requires $\mathcal{O}(L^3)$, deviation parameter \eqref{eq:conjugate_parm_geod} and conjugate direction \eqref{eq:conjugate_dirn_geod} together require $\mathcal{O}(L^2)$, and matrix exponential \eqref{eq:geodesic_tran} requires $\mathcal{O}(L^3)$ operations \cite{Moler2003}.
		The overall complexity is thus $\mathcal{O}\bigl(I_\text{RCG} G \bigl(N N_\mathrm{T} N_\mathrm{R} + L N (N_\mathrm{T}+N_\mathrm{R}+L) + I_\text{BLS} L^3\bigr)\bigr)$, where $I_\text{RCG}$ and $I_\text{BLS}$ are the number of iterations for geodesic \gls{rcg} and backtracking line search (i.e., lines \ref{ln:armijo_start} -- \ref{ln:armijo_end} of Algorithm \ref{ag:rcg}), respectively.
		That is, $\mathcal{O}_\mathrm{D}\bigl(N_\mathrm{S}\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(N_\mathrm{S}^3\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
		% That is, $\mathcal{O}_\mathrm{D}\bigl(I_\text{RCG} N_\mathrm{S} \bigl(N N_\mathrm{T} N_\mathrm{R} + N (N_\mathrm{T}+N_\mathrm{R}) + I_\text{BLS}\bigr)\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(I_\text{RCG} \bigl(N N_\mathrm{T} N_\mathrm{R} + N_\mathrm{S} N (N_\mathrm{T}+N_\mathrm{R}+N_\mathrm{S}) + I_\text{BLS} N_\mathrm{S}^3\bigr)\bigr)$ for fully-connected \gls{bd}-\gls{ris}.

		To validate Algorithm~\ref{ag:rcg} and quantify the shaping capability of \gls{bd}-\gls{ris}, we characterize the achievable singular value region of \gls{bd}-\gls{ris}-aided \gls{mimo} channel by considering the Pareto optimization problem
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{\sum_{n=1}^N \rho_n \sigma_n(\mathbf{H})}{\label{op:pareto}}{\label{ob:pareto}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I},}{\quad \forall g,}{\label{cn:pareto_unitary}}
		\end{maxi!}
		where $\rho_n \ge 0$ is the weight associated with the $n$-th channel singular value.
		Varying those weights help to characterize the Pareto frontier that encloses the achievable singular value region.
		While the objective \eqref{ob:pareto} itself seems obscure, a larger quantity translates to a stronger singular value redistribution capability and thus better wireless performance (e.g., channel capacity for communication \cite{Clerckx2013}, detection probability for sensing \cite{Liu2022c}, and harvested power for power transfer \cite{Shen2021}).
		Problem \eqref{op:pareto} also generalizes the \gls{dof} problem in Proposition \ref{pp:dof} and the individual singular value shaping problem in Corollary \ref{co:nd_sv_indl} and Proposition \ref{pp:rd}.
		It can be solved optimally by Algorithm~\ref{ag:rcg} with $[\mathbf{D}]_{n,n} = \rho_n$ in \eqref{eq:shaping_subdiff}.
	\end{subsection}
\end{section}

\begin{section}{Rate Maximization}
	\label{sc:rate}
	In this section, we first solve the \gls{bd}-\gls{ris}-aided \gls{mimo} rate maximization problem optimally by joint beamforming design, and then exploit channel shaping for a low-complexity two-stage solution.
	The problem is formulated as
	% The achievable rate maximization problem for \gls{bd}-\gls{ris}-aided \gls{mimo} point-to-point channel is formulated as
	\begin{maxi!}
		{\scriptstyle{\mathbf{W},\mathbf{\Theta}}}{R = \log \det \biggl(\mathbf{I} + \frac{\mathbf{W}^\mathsf{H}\mathbf{H}^\mathsf{H}\mathbf{H}\mathbf{W}}{\eta}\biggr)}{\label{op:rate}}{\label{ob:rate}}
		\addConstraint{\lVert \mathbf{W} \rVert _\mathrm{F}^2}{\le P}
		\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g}{=\mathbf{I}, \quad \forall g,\label{cn:rate_unitary}}
	\end{maxi!}
	where $\mathbf{W}$ is the transmit precoder, $R$ is the achievable rate, $\eta$ is the average noise power, and $P$ is maximum average transmit power.
	Problem \eqref{op:rate} is non-convex due to the block-unitary constraint \eqref{cn:rate_unitary} and the coupling between variables.
	% Two approaches are proposed to solve it optimally or efficiently.

	\begin{subsection}{Alternating Optimization}
		\label{sc:rate_ao}
		This approach updates $\mathbf{\Theta}$ and $\mathbf{W}$ iteratively until convergence.
		For a given $\mathbf{W}$, the passive beamforming subproblem is
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{\log \det \biggl(\mathbf{I} + \frac{\mathbf{H} \mathbf{Q} \mathbf{H}^\mathsf{H}}{\eta}\biggr)}{\label{op:rate_ris}}{\label{ob:rate_ris}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
		\end{maxi!}
		where $\mathbf{Q} \triangleq \mathbf{W} \mathbf{W}^\mathsf{H}$ is the transmit covariance matrix.
		Problem \eqref{op:rate_ris} can be solved optimally by Algorithm \ref{ag:rcg} with the partial derivative given in Lemma \ref{lm:rate}.
		\begin{lemma}
			\label{lm:rate}
			The partial derivative of \eqref{ob:rate_ris} with respect to \gls{bd}-\gls{ris} block $g$ is
			\begin{equation}
				\label{eq:gradient_eucl_rate}
				\frac{\partial R}{\partial \mathbf{\Theta}_g^*} = \frac{1}{\eta} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \biggl(\mathbf{I} + \frac{\mathbf{H}\mathbf{Q}\mathbf{H}^\mathsf{H}}{\eta}\biggr)^{-1} \mathbf{H} \mathbf{Q} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}.
			\end{equation}
		\end{lemma}

		\begin{proof}
			Please refer to Appendix~\ref{~ap:rate} in the supplement.
		\end{proof}
		For a given $\mathbf{\Theta}$, the optimal transmit precoder is given by eigenmode transmission \cite{Clerckx2013}
		\begin{equation}
			\label{eq:precoder_rate}
			\mathbf{W}^\star = \mathbf{V} {\diag(\mathbf{s}^\star)}^{1/2},
		\end{equation}
		where $\mathbf{V}$ is the right singular matrix of $\mathbf{H}$ and $\mathbf{s}^\star$ is the optimal water-filling power allocation \cite{Clerckx2013}.
		The \gls{ao} algorithm is guaranteed to converge to local-optimal points of problem \eqref{op:rate} since each subproblem is solved optimally and the objective is bounded above.
		The computational complexity of solving subproblem \eqref{op:rate_ris} by geodesic \gls{rcg} is $\mathcal{O}\bigl(I_\text{RCG} G (NL^2 + L N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} L^3)\bigr)$.
		On the other hand, the complexity of active beamforming \eqref{eq:precoder_rate} is $\mathcal{O}\bigl(N N_\mathrm{T} N_\mathrm{R}\bigr)$.
		The overall complexity is thus $\mathcal{O}\bigl(I_\text{AO}\bigl(I_\text{RCG} G (NL^2 + L N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} L^3) + N N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$, where $I_\text{AO}$ is the number of iterations for \gls{ao}.
		That is, $\mathcal{O}_\mathrm{D}\bigl(N_\mathrm{S}\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(N_\mathrm{S}^3\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
		% That is, $\mathcal{O}_\mathrm{D}\bigl(I_\text{AO}\bigl(I_\text{RCG} N_\mathrm{S} (N + N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS}) + N N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(I_\text{AO}\bigl(I_\text{RCG} (NN_\mathrm{S}^2 + N_\mathrm{S} N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} N_\mathrm{S}^3) + N N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
	\end{subsection}

	\begin{subsection}{Low-Complexity Solution}
		\label{sc:rate_lc}
		To reduce the computational complexity, we suboptimally decouple the beamforming design by first shape the channel for maximum power gain and then optimize the active beamforming.
		The shaping subproblem is formulated as
		% \footnote{%
		% 	\label{fn:power_gain}%
		% 	Problem \eqref{op:power} has been studied in \gls{siso} \cite{Shen2020a} and \gls{miso} equivalents \cite{Santamaria2023,Fang2023,Nerini2023,Nerini2023b} where only one mode is available. Generalizing those to \gls{mimo} is non-trivial due to trade-off between modes.
		% }
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2}{\label{op:power}}{\label{ob:power}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g.}{\label{cn:power_unitary}}{}
		\end{maxi!}
		Similar problems have been studied in \gls{siso} \cite{Shen2020a} and \gls{miso} equivalents \cite{Santamaria2023,Fang2023,Nerini2023,Nerini2023b} where only one mode is available. Generalizing those to \gls{mimo} is non-trivial due to trade-off between modes.
		Inspired by \cite{Nie2017}, we propose a closed-form iterative solution based on orthogonal projection.
		The idea is to approximate the quadratic objective \eqref{ob:power} successively by Taylor expansion and solve each subproblem by group-wise \gls{svd}.

		\begin{proposition}
			\label{pp:power}
			Starting from any feasible $\mathbf{\Theta}^{(0)}$, the orthogonal projection of
			\begin{equation}
				\label{eq:auxiliary_power}
				\mathbf{M}_g^{(r)} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \Bigl(\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \diag\bigl(\mathbf{\Theta}_{[1:g-1]}^{(r+1)},\mathbf{\Theta}_{[g:G]}^{(r)}\bigr) \mathbf{H}_\mathrm{F}\Bigr) \mathbf{H}_{\mathrm{F},g}^\mathsf{H}
			\end{equation}
			onto the Stiefel manifold, given in the closed-form \cite{Manton2002}
			% $\pi(\mathbf{M}_g) = {\arg\min}_{\mathbf{X}_g \in \mathbb{U}^{L \times L}} \lVert \mathbf{M}_g - \mathbf{X}_g \rVert _\mathrm{F} = \mathbf{U}_g \mathbf{V}_g^\mathsf{H}$ .
			% sequence
			% \footnote{However, \eqref{eq:ris_power} might not converge to a single solution point when $\mathbf{M}_g$ is rank-deficient due to the non-uniqueness of the orthonormal bases of kernels.}
			\begin{equation}
				\label{eq:ris_power}
				\mathbf{\Theta}_g^{(r+1)} = \underset{\mathbf{X}_g \in \mathbb{U}^{L \times L}}{\arg\min} \lVert \mathbf{M}_g - \mathbf{X}_g \rVert _\mathrm{F} = \mathbf{U}_g^{(r)} \mathbf{V}_g^{(r)\mathsf{H}},
			\end{equation}
			monotonically increases the objective function \eqref{ob:power},
			% leads to a convergence of the objective function \eqref{ob:power} towards a stationary point,\footnote{However, \eqref{eq:ris_power} might not converge to a single solution point due to the non-uniqueness of \gls{svd}, especially when $\mathbf{M}_g$ is rank-deficient.}
			where $\mathbf{U}_g^{(r)}$ and $\mathbf{V}_g^{(r)}$ are any left and right singular matrices of $\mathbf{M}_g^{(r)}$.
			% However, \eqref{eq:ris_power} might not converge to a single solution due to the non-uniqueness of \gls{svd}, c.f. Remark \ref{rm:svd}.
			When \eqref{eq:auxiliary_power} converges, \eqref{eq:ris_power} leads to a convergence of the objective function \eqref{ob:power} towards a stationary point.
		\end{proposition}

		\begin{proof}
			Please refer to Appendix~\ref{~ap:power} in the supplement.
		\end{proof}

		\begin{remark}
			\label{rm:power}
			While a rigorous proof remains intricate due to the non-uniqueness of \gls{svd},
			there is strong empirical evidence from simulation result that
			% empirical evidence from extensive simulation indicates that
			\eqref{eq:auxiliary_power} converges and \eqref{eq:ris_power} provides an optimal solution for vastly tested scenarios.
		\end{remark}

		To update each \gls{bd}-\gls{ris} group, matrix multiplication \eqref{eq:auxiliary_power} requires $\mathcal{O}\bigl(N_\mathrm{T} N_\mathrm{R} + NL^2+N_\mathrm{T} N_\mathrm{R} L\bigr)$ operations and its \gls{svd} requires $\mathcal{O}(L^3)$ operations.
		The overall complexity is thus $\mathcal{O}\bigl(I_\text{SAA} G \bigl(N_\mathrm{T} N_\mathrm{R} + NL^2+N_\mathrm{T} N_\mathrm{R} L + L^3\bigr)\bigr)$, where $I_\text{SAA}$ is the number iterations for successive affine approximation.
		That is, $\mathcal{O}_\mathrm{D}\bigl(N_\mathrm{S}\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(N_\mathrm{S}^3\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
		% That is, $\mathcal{O}_\mathrm{D}\bigl(I_\text{SAA} N_\mathrm{S} \bigl(N_\mathrm{T} N_\mathrm{R} + N+N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(I_\text{SAA} \bigl(N_\mathrm{T} N_\mathrm{R} + NN_\mathrm{S}^2+N_\mathrm{T} N_\mathrm{R} N_\mathrm{S} + N_\mathrm{S}^3\bigr)\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
		For the latter, the computational complexity can be further reduced:
		\begin{itemize}
			\item \emph{Negligible direct channel:} The optimal solution to \eqref{op:power} has been solved in closed form by \eqref{eq:ris_nd_power_max};
			\item \emph{Non-negligible direct channel:} In terms of maximizing the inner product $\langle \mathbf{H}_\mathrm{D}, \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rangle$, \eqref{op:power} is reminiscent of the weighted orthogonal Procrustes problem \cite{Gower2004}
			\begin{mini!}
				{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{D} - \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2}{\label{op:procrustes_wt}}{}
				\addConstraint{\mathbf{\Theta}^\mathsf{H} \mathbf{\Theta}=\mathbf{I},}{\label{cn:procrustes_wt}}{}
			\end{mini!}
			which still has no trivial solution.
			One \emph{lossy} transformation \cite{Bell2003} shifts $\mathbf{\Theta}$ to sides of the product by Moore-Penrose inverse, formulating standard orthogonal Procrustes problems
			\begin{mini!}
				{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{B}^\dagger \mathbf{H}_\mathrm{D} - \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2 \text{ or } \lVert \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\dagger - \mathbf{H}_\mathrm{B} \mathbf{\Theta} \rVert _\mathrm{F}^2}{\label{op:procrustes}}{}
				\addConstraint{\mathbf{\Theta}^\mathsf{H} \mathbf{\Theta}=\mathbf{I},}{}{}
			\end{mini!}
			with optimal solutions \cite[(6.4.1)]{Golub2013}
			\begin{equation}
				\label{eq:ris_procrustes}
				\mathbf{\Theta}_\textnormal{P-max-approx}^\textnormal{MIMO} = \mathbf{U} \mathbf{V}^\mathsf{H},
			\end{equation}
			where $\mathbf{U}$ and $\mathbf{V}$ are respectively any left and right singular matrices of $\mathbf{H}_\mathrm{B}^\dagger \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}$ or $\mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\dagger$.
		\end{itemize}

		Although \eqref{eq:ris_nd_power_max} and \eqref{eq:ris_procrustes} are of similar form, the latter is neither optimal nor a generalization of the former due to the lossy transformation.
		We will show in Section \ref{sc:simulation} that \eqref{eq:ris_procrustes} achieves near-optimal performance when $N_\mathrm{S}$ is large.
		Once the channel is shaped by \eqref{eq:ris_power} or \eqref{eq:ris_nd_power_max} or \eqref{eq:ris_procrustes}, the active beamforming is retrieved by \eqref{eq:precoder_rate}.
		This two-stage solution avoids outer iterations and efficiently handles (or avoids) inner iterations.
	\end{subsection}

	% \begin{subsection}{MIMO Interference Channel}
	% 	\label{sc:wsr}
	% 	On top of \eqref{eq:channel_interference}, the achievable rate of transmission $k$ is
	% 	\begin{equation}
	% 		R_k = \log \det \biggl(\mathbf{I} + \mathbf{W}_k {\mathbf{H}^{(kj)\mathsf{H}}} \mathbf{Q}_k^{-1} {\mathbf{H}^{(kk)}} \mathbf{W}_k\biggr),
	% 	\end{equation}
	% 	where $\mathbf{W}_k$ is the precoder at transmitter $k$ and $\mathbf{Q}_k = \sum_{j \ne k} {\mathbf{H}^{(kj)}} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} {\mathbf{H}^{(kj)\mathsf{H}}} + \eta \mathbf{I}$ is the interference-plus-noise covariance matrix at receiver $k$.
	% 	The \gls{wsr} maximization problem for \gls{bd}-\gls{ris}-aided \gls{mimo} interference channel is formulated as
	% 	\begin{maxi!}
	% 		{\scriptstyle{\mathbf{\Theta}, \{\mathbf{W}_k\}_{k \in [K]}}}{\sum_{k=1}^K \rho_k R_k}{\label{op:wsr}}{\label{ob:wsr}}
	% 		\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g}{}{}
	% 		\addConstraint{\lVert \mathbf{W}_k \rVert _\mathrm{F}^2 \le P_k. \quad \forall k}{}{}
	% 	\end{maxi!}
	% 	where $\rho_k \ge 0$ is the weight associated with transmission $k$.
	% 	This non-convex problem can be solved by extending both solutions covered in Section \ref{sc:rate} as detailed below.

	% 	\begin{subsubsection}{Alternating Optimization}
	% 		\label{sc:wsr_ao}
	% 		This approach updates $\mathbf{\Theta}$ and $\{\mathbf{W}_k\}_{k \in [K]}$ iteratively until convergence.
	% 		For a given precoder set, the passive beamforming subproblem is
	% 		\begin{maxi!}
	% 			{\scriptstyle{\mathbf{\Theta}}}{\sum_{k=1}^K \rho_k R_k}{\label{op:wsr_ris}}{\label{ob:wsr_ris}}
	% 			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
	% 		\end{maxi!}
	% 		which can be solved optimally by Algorithm \ref{ag:rcg} with the partial derivative given in Lemma \ref{lm:wsr}.

	% 		\begin{lemma}
	% 			\label{lm:wsr}
	% 			The partial derivative of \eqref{ob:wsr_ris} with respect to \gls{bd}-\gls{ris} block $g$ is
	% 			\begin{equation}
	% 				\label{eq:gradient_eucl_wsr}
	% 				\begin{split}
	% 					\frac{\partial \rho_k R_k}{\partial \mathbf{\Theta}_g^*} = \sum_{k=1}^K & \rho_k {\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} \mathbf{Q}_k^{-1} {\mathbf{H}^{(kk)}} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \\
	% 					& \times \bigl({\mathbf{H}_{\mathrm{F},g}^{(k)\mathsf{H}}} - {\mathbf{H}^{(kk)\mathsf{H}}} \mathbf{Q}_k^{-1} \sum_{j \ne k} {\mathbf{H}^{(kj)}} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} {\mathbf{H}^{(j)\mathsf{H}}_{\mathrm{F},g}}\bigr),
	% 				\end{split}
	% 			\end{equation}
	% 			where $\mathbf{E}_k = \bigl(\mathbf{I} + {\mathbf{W}_k^\mathsf{H}} {\mathbf{H}^{(kk)\mathsf{H}}} \mathbf{Q}_k {\mathbf{H}^{(kk)}} \mathbf{W}_k\bigr)^{-1}$ is the error matrix of receiver $k$.
	% 		\end{lemma}

	% 		\begin{proof}
	% 			Please refer to Appendix~\ref{~ap:wsr} in the supplement.
	% 		\end{proof}

	% 		For a given $\mathbf{\Theta}$, problem \eqref{op:wsr} reduces to conventional precoding design for interference channel.
	% 		A closed-form iterative solution based on mutual information-\gls{mmse} relationship has been proposed in \cite{Shin2012,Negro2010} and we summarize the steps as follows.
	% 		At iteration $r$, the \gls{mmse} combiner at receiver $k$ is
	% 		\begin{equation}
	% 			\begin{split}
	% 				\mathbf{G}_k^{(r)} &= {\mathbf{W}_k^{(r-1)\mathsf{H}}} {\mathbf{H}^{(kk)\mathsf{H}}} \\
	% 				& \quad \times \bigl(\mathbf{Q}_k^{(r-1)} + {\mathbf{H}^{(kk)}} \mathbf{W}_k^{(r-1)} {\mathbf{W}_k^{(r-1)\mathsf{H}}} {\mathbf{H}^{(kk)\mathsf{H}}}\bigr)^{-1},
	% 			\end{split}
	% 		\end{equation}
	% 		the corresponding error matrix is
	% 		\begin{equation}
	% 			\mathbf{E}_k^{(r)} = \bigl(\mathbf{I} + {\mathbf{W}_k^{(r-1)\mathsf{H}}} {\mathbf{H}^{(kk)\mathsf{H}}} \mathbf{Q}_k^{(r-1)} {\mathbf{H}^{(kk)}} \mathbf{W}_k^{(r-1)}\bigr)^{-1},
	% 		\end{equation}
	% 		and the optimal precoder at transmitter $k$ is given by
	% 		\begin{equation}
	% 			\label{eq:precoder_wsr}
	% 			\begin{split}
	% 				\mathbf{W}_k^{(r)} & = \Bigl(\sum_{j=1}^K {\mathbf{H}^{(jk)\mathsf{H}}} {\mathbf{G}_j^{(r)\mathsf{H}}} \mathbf{\Omega}_k^{(r)} \mathbf{G}_j^{(r)} \mathbf{H}^{(jk)} + \lambda_k^{(r)} \mathbf{I} \Bigr)^{-1} \\
	% 				& \quad \times {\mathbf{H}^{(kk)\mathsf{H}}} {\mathbf{G}_j^{(r)\mathsf{H}}} \mathbf{\Omega}_k^{(r)},
	% 			\end{split}
	% 		\end{equation}
	% 		where $\mathbf{\Omega}_k^{(r)} = \rho_k {\mathbf{E}_k^{(r)-1}}$ is the mean-square error weight and $\lambda_k^{(r)}$ is the Lagrange multiplier retrievable by bisection \cite{Shin2012} or in closed form \cite{Negro2010}
	% 		\begin{equation}
	% 			\lambda_k^{(r)} = \frac{\mathrm{tr}\bigl(\eta \mathbf{\Omega}_k^{(r)} \mathbf{G}_k^{(r)}{\mathbf{G}_k^{(r)\mathsf{H}}} + \sum_{j=1}^K (\mathbf{Z}_{kj}^{(r)} - \mathbf{Z}_{jk}^{(r)}) \bigr)}{P_k},
	% 			% \lambda_k^{(r)} = \frac{\mathrm{tr}\bigl(\eta \mathbf{\Omega}_k^{(r)} \mathbf{G}_k^{(r)}{\mathbf{G}_k^{(r)\mathsf{H}}} + \sum_j \mathbf{\Omega}_k^{(r)}\mathbf{T}_{kj}^{(r)} {\mathbf{T}_{kj}^{(r)\mathsf{H}}} - \mathbf{\Omega}_j^{(r)}\mathbf{T}_{jk}^{(r)} {\mathbf{T}_{jk}^{(r)\mathsf{H}}} \bigr)}{P_k},
	% 		\end{equation}
	% 		where $\mathbf{Z}_{kj}^{(r)} = \mathbf{\Omega}_k^{(r)}\mathbf{T}_{kj}^{(r)} {\mathbf{T}_{kj}^{(r)\mathsf{H}}}$ and $\mathbf{T}_{kj}^{(r)} = \mathbf{G}_k^{(r)} {\mathbf{H}^{(kj)}} \mathbf{W}_j^{(r)}$.

	% 		The computational complexity of solving subproblem \eqref{op:wsr_ris} by geodesic \gls{rcg} is $\mathcal{O}\bigl(I_\text{RCG} G (N_\mathrm{T} d^2 + N_\mathrm{T}^2 d + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + K (N_\mathrm{T} N_\mathrm{R} d + N_\mathrm{T} N_\mathrm{R} L) + I_\text{BLS}L^3)\bigr)$.
	% 		That is, $\mathcal{O}_\mathrm{D}\bigl(N_\mathrm{S}\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(N_\mathrm{S}^3\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
	% 	\end{subsubsection}

	% 	\begin{subsubsection}{Low-Complexity Solution}
	% 		\label{sc:wsr_lc}
	% 		Similar to Section \ref{sc:rate_lc}, we suboptimally decouple the beamforming design by first shape the channel by \gls{ris} for minimum leakage interference and then optimize the active beamforming.
	% 		The leakage interference minimization problem is formulated as
	% 		\begin{mini!}
	% 			{\scriptstyle{\mathbf{\Theta}}}{I = \sum_{k=1}^K \sum_{j \ne k} \left\lVert {\mathbf{H}}^{(kj)}_\mathrm{D} + {\mathbf{H}}^{(k)}_\mathrm{B} \mathbf{\Theta} {\mathbf{H}}^{(j)}_\mathrm{F} \right\rVert _{\mathrm{F}}^2}{\label{op:interference}}{\label{ob:interference}}
	% 			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
	% 		\end{mini!}
	% 		which can be solved iteratively in closed form.

	% 		\begin{proposition}
	% 			\label{pp:interference}
	% 			Starting from any feasible $\mathbf{\Theta}^{(0)}$, the sequence
	% 			\begin{equation}
	% 				\label{eq:ris_interference}
	% 				\mathbf{\Theta}_g^{(r+1)} = \mathbf{U}_g^{(r)} \mathbf{V}_g^{(r)}, \quad \forall g
	% 			\end{equation}
	% 			monotonically decreases the objective function \eqref{ob:interference},
	% 			% converges to a stationary point of \eqref{op:interference},
	% 			where $\mathbf{U}_g^{(r)}$ and $\mathbf{V}_g^{(r)}$ are any left and right singular matrices of
	% 			\begin{equation}
	% 				\label{eq:auxiliary_interference}
	% 				\mathbf{M}_g^{(r)} = \sum_{k=1}^K \sum_{j \ne k} \bigl(\mathbf{B}_g^{(k)} \mathbf{\Theta}_g^{(r)} \mathbf{H}^{(j)}_{\mathrm{F},g} - {\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} {\mathbf{D}^{(kj)(r)}_{g}}\bigr) {\mathbf{H}^{(j)\mathsf{H}}_{\mathrm{F},g}},
	% 			\end{equation}
	% 			where $\mathbf{B}_g^{(k)} = \lambda_1\bigl({\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} \mathbf{H}^{(k)}_{\mathrm{B},g}\bigr) \mathbf{I} - {\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} \mathbf{H}^{(k)}_{\mathrm{B},g}$ and ${\mathbf{D}^{(kj)(r)}_{g}} = \mathbf{H}^{(kj)}_\mathrm{D} + \sum_{g'<g} {\mathbf{H}_{\mathrm{B},g'}^{(k)\mathsf{H}}} \mathbf{\Theta}_{g'}^{(r+1)} \mathbf{H}_{\mathrm{F},g'}^{(k)} + \sum_{g'>g} {\mathbf{H}_{\mathrm{B},g'}^{(k)\mathsf{H}}} \mathbf{\Theta}_{g'}^{(r)} \mathbf{H}_{\mathrm{F},g'}^{(k)}.$
	% 			Besides, when \eqref{eq:auxiliary_interference} converges, \eqref{eq:ris_interference} leads to a convergence of the objective function \eqref{ob:interference} towards a stationary point.
	% 		\end{proposition}
	% 		\begin{proof}
	% 			Please refer to Appendix~\ref{~ap:interference} in the supplement.
	% 		\end{proof}
	% 		Once the channel is shaped by \eqref{eq:ris_interference}, the active beamforming is retrieved iteratively by \eqref{eq:precoder_wsr}.
	% 		This two-stage solution avoids outer iterations and efficiently handles inner iterations.
	% 	\end{subsubsection}
	% \end{subsection}
\end{section}

\begin{section}{Simulation Results}
	\label{sc:simulation}
	In this section, we provide numerical results to evaluate the proposed \gls{bd}-\gls{ris} designs.\footnote{Source code is available at \url{https://github.com/snowztail/channel-shaping}.}
	Consider a distance-dependent path loss model $\Lambda(d) = \Lambda_0 d^{-\gamma}$ where $\Lambda_0$ is the reference path loss at distance \qty{1}{m}, $d$ is the propagation distance, and $\gamma$ is the path loss exponent.
	We set $\Lambda_0=\qty{-30}{dB}$, $\gamma_\mathrm{D}=3$, $\gamma_\mathrm{F}=2.4$, $\gamma_\mathrm{B}=2$, $d_\mathrm{D}=\qty{14.7}{m}$, $d_\mathrm{F}=\qty{10}{m}$, $d_\mathrm{B}=\qty{6.3}{m}$, which corresponds to a typical indoor environment with $\Lambda_\mathrm{D}=\qty{-65}{dB}$, $\Lambda_\mathrm{F}=\qty{-54}{dB}$, $\Lambda_\mathrm{B}=\qty{-46}{dB}$.
	The small-scale fading model is $\mathbf{H} = \sqrt{\kappa/(1+\kappa)} \mathbf{H}_\text{LoS} + \sqrt{1/(1+\kappa)} \mathbf{H}_\text{NLoS}$, where $\kappa$ is the Rician K-factor, $\mathbf{H}_\text{LoS}$ is the deterministic \gls{los} component, and $\mathbf{H}_\text{NLoS} \sim \mathcal{N}_{\mathbb{C}}(\mathbf{0}, \mathbf{I})$ is the Rayleigh component.
	Unless otherwise specified, we assume the direct channel is present, $\kappa = 0$ (i.e., Rayleigh fading) for all channels, and $\eta = \qty{-75}{dB}$.
	% For point-to-point channel, we set $d_\mathrm{D}=\qty{14.7}{m}$, $d_\mathrm{F}=\qty{10}{m}$, $d_\mathrm{B}=\qty{6.3}{m}$, which corresponds to a typical indoor environment with $\Lambda_\mathrm{D}=\qty{-65}{dB}$, $\Lambda_\mathrm{F}=\qty{-54}{dB}$, $\Lambda_\mathrm{B}=\qty{-46}{dB}$.
	% For interference channel, we assume $K$ transmitters and receivers are independently and uniformly distributed in a disk of radius \qty{20}{m}, and all transmissions use the same number of streams $N_\mathrm{E}$ and equal weight $\rho_k=1$, $\forall k$.

	\begin{subsection}{Algorithm Evaluation}
		\begin{table}[!t]
			\caption{Performance of Geodesic and Non-Geodesic \gls{rcg} on \eqref{op:pareto}}
			\label{tb:complexity_algorithm}
			\centering
			\resizebox{\columnwidth}{!}{
				\begin{tabular}{ccccccc}
					\toprule
					\multirow{2}{*}{\gls{rcg} path} & \multicolumn{3}{c}{$N_\mathrm{S}=16$} & \multicolumn{3}{c}{$N_\mathrm{S}=256$}                                                               \\ \cmidrule(lr){2-4} \cmidrule(lr){5-7}
													& Objective                             & Iterations                             & Time [s]         & Objective        & Iterations & Time [s] \\ \midrule
					Geodesic                        & $\num{4.359e-3}$                      & 11.59                                  & $\num{1.839e-2}$ & $\num{1.163e-2}$ & 25.58      & 3.461    \\
					Non-geodesic                    & $\num{4.329e-3}$                      & 30.92                                  & $\num{5.743e-2}$ & $\num{1.116e-2}$ & 61.40      & 13.50    \\ \bottomrule
				\end{tabular}
			}
		\end{table}
		Table \ref{tb:complexity_algorithm} compares the geodesic \gls{rcg} method in Algorithm \ref{ag:rcg} and the non-geodesic \gls{rcg} method used in \cite{Li2023b,Li2023c,Zhou2023} on Pareto singular value problem \eqref{op:pareto} where $N_\mathrm{T}=N_\mathrm{R}=4$ and $L=4$.
		The statistics are averaged over \num{100} independent runs.
		We observe that the geodesic \gls{rcg} method achieves slightly higher objective values with significantly (down to 1/3) lower number of iterations and shorter (down to 1/4) elapsed time than the non-geodesic method.
		The results demonstrate the efficiency of the geodesic \gls{rcg} algorithm \ref{ag:rcg} on large-scale \gls{bd}-\gls{ris} design problems.

		\begin{table}[!t]
			\caption{Performance of \gls{d}-\gls{ris} and Fully-Connected \gls{bd}-\gls{ris} on \eqref{op:rate}}
			\label{tb:complexity_bond}
			\centering
			\resizebox{\columnwidth}{!}{
				\begin{tabular}{ccccccc}
					\toprule
					\multirow{3}{*}{\gls{ris} type} & \multicolumn{3}{c}{$N_\mathrm{S}=16$} & \multicolumn{3}{c}{$N_\mathrm{S}=256$}                                                               \\ \cmidrule(lr){2-4} \cmidrule(lr){5-7}
													& Objective                             & \begin{tabular}{@{}c@{}}Iterations\\(outer)\end{tabular}                             & Time [s]         & Objective        & \begin{tabular}{@{}c@{}}Iterations\\(outer)\end{tabular} & Time [s] \\ \midrule
					Diagonal                        & $\num{25.33}$                      & 2.06                                  & $\num{2.620e-2}$ & $\num{32.22}$ & 2.92      & 1.277    \\
					Fully-connected BD              & $\num{26.10}$                      & 3.84                                  & $\num{2.719e-2}$ & $\num{36.58}$ & 3.03      & 0.806    \\ \bottomrule
				\end{tabular}
			}
		\end{table}
		Table \ref{tb:complexity_bond} compares the performance of \gls{d}-\gls{ris} and fully-connected \gls{bd}-\gls{ris} on rate maximization problem \eqref{op:rate} using the \gls{ao} design in Section \ref{sc:rate_ao}, where $N_\mathrm{T}=N_\mathrm{R}=4$ and $P=\qty{20}{dB}$.
		The statistics are averaged over \num{100} independent runs.
		The fact that fully-connected \gls{bd}-\gls{ris} provides a higher achievable rate using slightly more outer iterations $I_\text{AO}$ than \gls{d}-\gls{ris} is consistent with our analysis.
		Interestingly, \emph{the former still ends up with shorter elapsed time,} which seems to contradict the complexity analysis that $\mathcal{O}_\mathrm{BD}\bigl(N_\mathrm{S}^3\bigr)$ for fully-connected \gls{bd}-\gls{ris} and $\mathcal{O}_\mathrm{D}\bigl(N_\mathrm{S}\bigr)$ for \gls{d}-\gls{ris}.
		One possible reason is that \gls{bd}-\gls{ris} only involves 1 backtracking line search per iteration while \gls{d}-\gls{ris} requires $N_\mathrm{S}$ times.
		Another reason is that the group-wise update of \gls{d}-\gls{ris} leads to slower convergence of inner iterations.
		These results suggest that optimizing \gls{bd}-\gls{ris} may be less computational intensive than expected.
	\end{subsection}

	\begin{subsection}{Channel Singular Value Redistribution}
		\begin{subsubsection}{Achievable Singular Value Region}
			\begin{figure}[!t]
				\centering
				\subfloat[$2 \times 32 \times 2$ (no direct)]{
					\label{fg:singular_pareto_sx32_nd}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_singular_pareto_sx32_nd.tex}

					}
				}
				\subfloat[$2 \times 32 \times 2$]{
					\label{fg:singular_pareto_sx32}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_singular_pareto_sx32.tex}
					}
				}
				\\
				\subfloat[$2 \times 64 \times 2$]{
					\label{fg:singular_pareto_sx64}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_singular_pareto_sx64.tex}
					}
				}
				\subfloat[$2 \times 128 \times 2$]{
					\label{fg:singular_pareto_sx128}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_singular_pareto_sx128.tex}
					}
				}
				\caption{Achievable singular value regions of an $N_\mathrm{T}=N_\mathrm{R}=2$ channel shaped by \gls{bd}-\gls{ris}. The singular value pair of the direct channel are marked as baseline.
				On the Pareto frontiers, `P-max', `E-max', and `R-max' refer to the channel power gain-optimal point, wireless power transfer-optimal point, and rate-optimal arc, respectively.}
				\label{fg:singular_pareto}
			\end{figure}
			Fig. \ref{fg:singular_pareto} illustrates the achievable regions of singular values of an $N_\mathrm{T}=N_\mathrm{R}=2$ point-to-point \gls{mimo} shaped by \gls{ris}, where the channel power gain-optimal point, wireless power transfer-optimal point,\footnote{For \gls{mimo} wireless power transfer with \gls{rf} combining, the maximum harvested power depends solely on the dominant channel singular value \cite{Shen2021}.} and rate-optimal arc are highlighted on the Pareto frontiers.
			The results are obtained by solving the channel shaping problem \eqref{op:pareto} merely without any application-specific optimization.
			% , and we conjecture that the Pareto frontier includes the optimal singular value points of other wireless applications (e.g., sensing).
			As the \gls{snr} increases, the rate-optimal point proceeds on the arc from the east (favoring $\sigma_1(\mathbf{H})$) to the north (favoring $\sigma_2(\mathbf{H})$).
			% The results are obtained by solving the channel shaping problem \eqref{op:pareto} merely without any application-specific optimization, and we conjecture that the Pareto frontier includes the optimal singular value points of other wireless applications (e.g., sensing).
			When the direct channel is negligible, the achievable regions in Fig. \subref*{fg:singular_pareto_sx32_nd} are shaped like pizza slices.
			This is because $\sigma_1(\mathbf{H}) \ge \sigma_2(\mathbf{H})$ and there exists a trade-off between the alignment of two modes.
			The smallest singular value can be enhanced up to \num{2e-4} by \gls{d}-\gls{ris} and \num{3e-4} by fully-connected \gls{bd}-\gls{ris}, corresponding to a \qty{50}{\percent} gain.
			We also see that for fully-connected \gls{bd}-\gls{ris}, the power gain-optimal and rate-optimal points coincide with each other, as have been proved in  \eqref{eq:ris_nd_power_max} and \eqref{eq:ris_nd_rate_max}.
			This observation still holds in Figs. \subref*{fg:singular_pareto_sx32} -- \subref*{fg:singular_pareto_sx128} where the direct channel is significant, yet a formal proof is unavailable due to the non-trivial solution structures.
			The shape of the singular value region depends heavily on the relative strength of the indirect channels, which is $\Lambda_\mathrm{F}\Lambda_\mathrm{B}/\Lambda_\mathrm{D}=\qty{-35}{dB}$ here.
			Fig. \subref*{fg:singular_pareto_sx32} shows that a 32-element \gls{ris} is insufficient to compensate this imbalance and results in a limited singular value region that is symmetric around the direct point.
			As the group size $L$ increases, the shape of the region evolves from elliptical to square.
			This transformation not only improves the dynamic range of $\sigma_1(\mathbf{H})$ and $\sigma_2(\mathbf{H})$ by \qty{22}{\percent} and \qty{38}{\percent}, but also provides a better trade-off in manipulating both singular values.
			It verifies that the design flexibility of \gls{bd}-\gls{ris} allows better alignment of multiple modes simultaneously.
			As a consequence, {the optimally shaped channels for power gain, communication, and power transfer coincide,} which implies that \emph{a fully-connected \gls{bd}-\gls{ris} may be designed in closed-form for multi-functional optimality.}
			The singular value region also enlarges as the number of scattering elements $N_\mathrm{S}$ increases.
			In particular, Fig. \subref*{fg:singular_pareto_sx128} shows that the equivalent channel can be completely nulled (corresponding to the origin) by a 128-element \gls{bd}-\gls{ris} but not by a diagonal one, which may be leveraged for interference mitigation and secure communication.
			Those results demonstrate the superior channel shaping capability of \gls{bd}-\gls{ris} and emphasizes the importance of adding reconfigurable inter-connections between elements.
		\end{subsubsection}

		\begin{subsubsection}{Analytical Bounds and Numerical Results}
			\begin{figure}[!t]
				\centering
				\subfloat[$4 \times 32 \times 4$ (rank-1)]{
					\label{fg:singular_bound_rank1_sx32}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_singular_bound_rank1_sx32.tex}
					}
				}
				\subfloat[$4 \times 64 \times 4$ (rank-1)]{
					\label{fg:singular_bound_rank1_sx64}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_singular_bound_rank1_sx64.tex}
					}
				}
				\\
				\subfloat[$4 \times 128 \times 4$ (rank-2)]{
					\label{fg:singular_bound_rank2_sx128}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_singular_bound_rank2_sx128.tex}
					}
				}
				\subfloat[$4 \times 256 \times 4$ (rank-4)]{
					\label{fg:singular_bound_rank4_sx256}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_singular_bound_rank4_sx256.tex}
					}
				}
				\caption{
					Achievable channel singular values: analytical bounds (lines) and numerical results (bars).
					Baselines of bars denote the singular values of the direct channel.
					Blue (resp. red) bars denote the lower (resp. upper) dynamic range of singular values obtained by solving \eqref{op:pareto} with $\rho_n/\rho_{n'} \to 0$ (resp. $\to \infty$), $\forall n, \ n' \ne n$.
					`D' means \gls{d}-\gls{ris} and `BD' refers to fully-connected \gls{bd}-\gls{ris}.
					`rank-$k$' refers to the rank of the forward channel.
				}
				\label{fg:singular_bound}
			\end{figure}
			We focus on achieving the asymptotic bounds in Proposition \ref{pp:rd} as most results from Proposition \ref{pp:nd} are supplied with closed-form \gls{ris} solutions.
			For a rank-$k$ forward channel, Fig. \ref{fg:singular_bound} compares the individual singular value bounds in Proposition \ref{pp:rd} and the numerical results obtained by solving problem \eqref{op:pareto} with proper weights.
			When the \gls{ris} is in \gls{los} of the transmitter, Figs. \subref*{fg:singular_bound_rank1_sx32} and \subref*{fg:singular_bound_rank1_sx64} show that the achievable channel singular values indeed satisfy Corollary \ref{co:los}, namely $\sigma_1(\mathbf{H}) \ge \sigma_1(\mathbf{T})$, $\sigma_2(\mathbf{T}) \le \sigma_2(\mathbf{H}) \le \sigma_1(\mathbf{T})$, etc.
			It is obvious that \gls{bd}-\gls{ris} can approach those bounds better than \gls{d}-\gls{ris} using a small $N_\mathrm{S}$.
			Another example is given in Fig. \subref*{fg:singular_bound_rank2_sx128} with rank-2 forward channel.
			The first two channel singular values are unbounded above and bounded below by the first two singular values of $\mathbf{T}$, while the last two singular values can be suppressed to zero and bounded above by the first two singular values of $\mathbf{T}$.
			Those observations align with Proposition \ref{pp:rd}.
			Finally, Fig. \subref*{fg:singular_bound_rank4_sx256} confirms there are no extra singular value bounds when both backward and forward channels are full-rank.
			This can be predicted from \eqref{eq:auxiliary_rd} where the singular matrix $\mathbf{V}_\mathrm{F}$ becomes unitary and $\mathbf{T}=\mathbf{0}$.
			The numerical results are consistent with the analytical bounds, and we conclude that the channel shaping advantage of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} scales with the rank of backward and forward channels.

			\begin{figure}[!t]
				\centering
				\subfloat[$1 \times 256 \times 1$ (no direct)]{
					\label{fg:power_bond_txrx1_nd}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_power_bond_txrx1_nd.tex}
					}
				}
				\subfloat[$4 \times 256 \times 4$ (no direct)]{
					\label{fg:power_bond_txrx4_nd}
					\resizebox{!}{3.25cm}{
						\input{../assets/simulation/pc_power_bond_txrx4_nd.tex}
					}
				}
				\caption{
					Average maximum channel power gain versus \gls{bd}-\gls{ris} group size and \gls{mimo} dimensions.
					`Cascaded' refers to the upper bound in \eqref{iq:power_nd}.
				}
				\label{fg:power_bond}
			\end{figure}

			Fig. \ref{fg:power_bond} compares the analytical bound on channel power gain in Corollary \ref{co:nd_power} and the numerical results obtained by solving problem \eqref{op:power} when the direct channel is negligible.
			Here, a fully-connected \gls{bd}-\gls{ris} can attain the upper bound either in closed form \eqref{eq:ris_nd_power_max} or via optimization approach \eqref{eq:ris_power}.
			For the \gls{siso} case in Fig. \subref*{fg:power_bond_txrx1_nd}, the maximum channel power gain is approximately \num{4e-6} by \gls{d}-\gls{ris} and \num{6.5e-6} by fully-connected \gls{bd}-\gls{ris}, corresponding to a \qty{62.5}{\percent} gain.
			It comes purely from branch matching as discussed in Example \ref{eg:siso} and agrees with the asymptotic power scaling law derived in \cite[(30)]{Shen2020a}
			Interestingly, Fig. \subref*{fg:power_bond_txrx4_nd} shows that this gain surges to \qty{270}{\percent} in $N_\mathrm{T}=N_\mathrm{R}=4$ \gls{mimo} and aligns with the expectation analysis \eqref{eq:power_nd_rayleigh}.
			We thus conclude that the power gain of \gls{bd}-\gls{ris} scales with group size and \gls{mimo} dimensions.
		\end{subsubsection}
	\end{subsection}

	\begin{subsection}{Achievable Rate Maximization}
		\begin{figure}[!t]
			\centering
			\subfloat[$16 \times N_\mathrm{S} \times 16$ (no direct)]{
				\label{fg:power_sx_txrx16_nd}
				\resizebox{!}{3.15cm}{
					\input{../assets/simulation/pc_power_sx_txrx16_nd.tex}
				}
			}
			\subfloat[$16 \times N_\mathrm{S} \times 16$]{
				\label{fg:power_sx_txrx16}
				\resizebox{!}{3.15cm}{
					\input{../assets/simulation/pc_power_sx_txrx16.tex}
				}
			}
			\caption{
				Average maximum channel power gain versus \gls{ris} configuration.
				`Explicit' refers to the optimal solution \eqref{eq:ris_nd_power_max} when the direct channel is negligible.
				`OP-left' and `OP-right' refer to the suboptimal solutions, when the direct channel is significant, by lossy transformation \eqref{op:procrustes} where $\mathbf{\Theta}$ is to the left and right of the product, respectively.
			}
			\label{fg:power_sx}
		\end{figure}

		We first focus on the channel power gain problem \eqref{op:power}.
		Fig. \ref{fg:power_sx} shows the maximum channel power gain under different \gls{ris} configurations.
		An interesting observation is that the relative power gain of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} is even larger when the direct channel is significant.
		As shown in Figs. \subref*{fg:power_sx_txrx16_nd} and \subref*{fg:power_sx_txrx16}, a 64-element fully \gls{bd}-\gls{ris} can almost provide the same channel power gain as a 256-element \gls{d}-\gls{ris} when the direct channel is significant, but less so when it is negligible.
		This is because the mode alignment advantage of \gls{bd}-\gls{ris} becomes more pronounced when the modes of direct channel is taken into account.
		We also notice that the suboptimal solutions \eqref{eq:ris_procrustes} for fully-connected \gls{bd}-\gls{ris} by lossy transformation \eqref{op:procrustes} are very close to optimal especially for a large $N_\mathrm{S}$.

		\begin{figure}[!t]
			\centering
			\subfloat[$4 \times 128 \times 4$]{
				\label{fg:rate_beamforming}
				\resizebox{!}{3.25cm}{
					\input{../assets/simulation/pc_rate_beamforming.tex}
				}
			}
			\subfloat[$N_\mathrm{T} \times 128 \times N_\mathrm{R}$]{
				\label{fg:rate_txrx}
				\resizebox{!}{3.25cm}{
					\input{../assets/simulation/pc_rate_txrx.tex}
				}
			}
			\\
			\subfloat[$4 \times N_\mathrm{S} \times 4$]{
				\label{fg:rate_sx}
				\resizebox{!}{3.25cm}{
					\input{../assets/simulation/pc_rate_sx.tex}
				}
			}
			\subfloat[$4 \times 128 \times 4$]{
				\label{fg:rate_kfactor}
				\resizebox{!}{3.25cm}{
					\input{../assets/simulation/pc_rate_kfactor.tex}
				}
			}
			\caption{
				Average achievable rate versus \gls{mimo} and \gls{ris} configurations.
				The transmit power corresponds to a direct \gls{snr} of \num{-10} to \qty{30}{dB}.
				`Alternate' refers to the alternating optimization and `Decouple' refers to the low-complexity design.
				`D' means \gls{d}-\gls{ris} and `BD' refers to fully-connected \gls{bd}-\gls{ris}.
			}
			\label{fg:rate}
		\end{figure}

		Fig. \ref{fg:rate} presents the achievable rate under different \gls{mimo} and \gls{ris} configurations.
		At a transmit power $P = \qty{10}{dB}$, Fig. \subref*{fg:rate_beamforming} shows that introducing a 128-element \gls{d}-\gls{ris} to $N_\mathrm{T}=N_\mathrm{R}=4$ \gls{mimo} can improve the achievable rate from \qty{22.2}{bps/Hz} to \qty{29.2}{bps/Hz} ($+\qty{31.5}{\percent}$).
		A \gls{bd}-\gls{ris} of group size 4 and 128 can further elevate those to \qty{32.1}{bps/Hz} ($+\qty{44.6}{\percent}$) and \qty{34}{bps/Hz}  ($+\qty{53.2}{\percent}$), respectively.
		An interesting observation is that the rate gap between the optimal \gls{ao} approach in Section \ref{sc:rate_ao} and the low-complexity shaping-inspired solution in Section \ref{sc:rate_lc} narrows as $L$ increases and completely vanishes for a fully-connected \gls{bd}-\gls{ris}.
		This implies that joint \gls{ris}-transceiver designs can be decoupled by first shaping the wireless channel and then optimizing the active beamformer, which simplifies the design substantially.
		Figs. \subref*{fg:rate_txrx} and \subref*{fg:rate_sx} also show that both \emph{absolute and relative} rate gains of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris}
		increases with the number of transmit and receive antennas and scattering elements, especially at high \gls{snr}.
		For $N_\mathrm{S}=128$ and $P = \qty{20}{dB}$,
		the achievable rate ratio of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} is \num{1.04}, \num{1.11}, and \num{1.13} for $N_\mathrm{T}=N_\mathrm{R}=1$, \num{4}, and \num{16}, respectively.
		For $N_\mathrm{T}=N_\mathrm{R}=4$ and $P = \qty{20}{dB}$, this ratio amounts to \num{1.03}, \num{1.08}, and \num{1.13} for $N_\mathrm{S}=16$, \num{64}, and \num{256}, respectively.
		Those observations align with the power gain results in Fig. \ref{fg:power_sx} and highlight the rate benefits of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} in large-scale \gls{mimo} systems.
		In the low power regime (\num{-20} to \qty{-10}{dB}), we also notice that the slope of the achievable rate of \gls{bd}-\gls{ris} is steeper than that of \gls{d}-\gls{ris}.
		That is, \gls{bd}-\gls{ris} can help to activate more streams and achieve the asymptotic \gls{dof} at a low transmit \gls{snr}.
		This is particularly visible in Fig. \subref*{fg:rate_sx} where the topmost curve is almost a linear function of the transmit power.
		It can be predicted from Fig. \ref{fg:singular_pareto} that \gls{bd}-\gls{ris} can significantly enlarge all channel singular values for higher receive \gls{snr}.
		Finally, Fig. \subref*{fg:rate_kfactor} shows that the gap between \gls{d}- and \gls{bd}-\gls{ris} narrows as the Rician K-factor increases and becomes indistinguishable in \gls{los} environment.
		The observation is expected from previous studies \cite{Shen2020a,Li2023b,Nerini2023} and aligns with Corollary \ref{co:los}, which suggests that the \gls{bd}-\gls{ris} should be deployed in rich-scattering environments to exploit its channel shaping potential.

		% \begin{subsubsection}{MIMO Interference Channel}
		% 	\label{sc:simulation_wsr}
		% 	\begin{figure}[!t]
		% 		\centering
		% 		\subfloat[Interference: $(4 \times N_\mathrm{S} \times 4)^5$]{
		% 			\label{fg:ic_interference_sx}
		% 			\resizebox{!}{3.15cm}{
		% 				\input{../assets/simulation/ic_interference_sx.tex}
		% 			}
		% 		}
		% 		\subfloat[WSR: $(2 \times 128 \times 2)^2, N_\mathrm{E} = 2$]{
		% 			\label{fg:ic_wsr_beamforming}
		% 			\resizebox{!}{3.15cm}{
		% 				\input{../assets/simulation/ic_wsr_beamforming.tex}
		% 			}
		% 		}
		% 		\\
		% 		\subfloat[WSR: $(4 \times N_\mathrm{S} \times 4)^5, N_\mathrm{E} = 4$]{
		% 			\label{fg:ic_wsr_sx}
		% 			\resizebox{!}{3.15cm}{
		% 				\input{../assets/simulation/ic_wsr_sx.tex}
		% 			}
		% 		}
		% 		\subfloat[WSR: $(N_\mathrm{T} \times 128 \times N_\mathrm{R})^{10}, N_\mathrm{E} = 2$]{
		% 			\label{fg:ic_wsr_txrx}
		% 			\resizebox{!}{3.15cm}{
		% 				\input{../assets/simulation/ic_wsr_txrx.tex}
		% 			}
		% 		}
		% 		\caption{
		% 			Average leakage interference and weighted sum-rate versus \gls{ris} and \gls{mimo} interference channel configurations.
		% 			`Alternate' refers to the alternating optimization and `Decouple' refers to the low-complexity design.
		% 			`D' means \gls{d}-\gls{ris} and `BD' refers to fully-connected \gls{bd}-\gls{ris}.
		% 		}
		% 	\end{figure}

		% 	Fig.~\ref{fg:ic_interference_sx} illustrates how \gls{bd}-\gls{ris} helps to reduce the leakage interference by solving problem \eqref{op:interference}.
		% 	In this case, a fully-connected $2^n$-element \gls{bd}-\gls{ris} is almost as good as a $2^{n+2}$-element \gls{d}-\gls{ris} in terms of leakage interference.
		% 	The result also implies that \gls{bd}-\gls{ris} can achieve a higher \gls{dof} than diagonal \gls{ris} in \gls{mimo} interference channel, which generalizes Proposition \ref{pp:dof} and emphasizes the potential of \gls{bd}-\gls{ris} in interference alignment.

		% 	Fig.~\ref{fg:ic_wsr_beamforming} compares the average \gls{wsr} achieved by the optimal and low-complexity beamforming designs in Section \ref{sc:wsr_ao} and \ref{sc:wsr_lc}, respectively.
		% 	Unlike the point-to-point case, the latter is not as effective as the former.
		% 	The reason is that, for $K$ transmissions of different path loss, interference alignment using only a shared passive beamformer is very challenging especially, when the direct channels are dominant.
		% 	On the other hand, using $K$ precoders in the joint beamforming design can reasonably orthogonalize the channels and the \gls{ris} can simply enhance the signal power.
		% 	A narrower performance gap is expected when $N_\mathrm{S}$ increases or \gls{ris} coverage area shrinks.

		% 	Figs.~\ref{fg:ic_wsr_sx} and \ref{fg:ic_wsr_txrx} show the average \gls{wsr} versus the number of scattering elements and transceiving antennas.
		% 	Again, we observe that the rate gain of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} increases with $N_\mathrm{S}$, $N_\mathrm{T}$, and $N_\mathrm{R}$.
		% 	The reasons have been discussed in the point-to-point case.
		% \end{subsubsection}
	\end{subsection}

	\begin{subsection}{Practical Constraints}
		\begin{subsubsection}{RIS Symmetry}
			\label{sc:ris_symmetry}
			\begin{figure}[!t]
				\centering
				\subfloat[Power: $2 \times N_\mathrm{S} \times 2$]{
					\label{fg:pc_power_symmetry}
					\resizebox{!}{3.15cm}{
						\input{../assets/simulation/pc_power_symmetry.tex}
					}
				}
				\subfloat[Rate: $4 \times N_\mathrm{S} \times 4$]{
					\label{fg:pc_rate_symmetry}
					\resizebox{!}{3.15cm}{
						\input{../assets/simulation/pc_rate_symmetry.tex}
					}
				}
				\caption{
					Impact of \gls{ris} symmetry on the \gls{mimo} power gain and achievable rate.
				}
			\end{figure}
			Symmetric \gls{ris} satisfying $\mathbf{\Theta} = \mathbf{\Theta}^\mathsf{T}$ are often considered in the literature due to hardware constraints.
			This study aim to investigate the impact of \gls{ris} symmetry on the system performance.
			\begin{remark}
				All proposed asymmetric \gls{bd}-\gls{ris} designs can be modified for symmetry. In particular,
				\begin{enumerate}[label=(\roman*)]
					\item \emph{\gls{svd}-based (e.g., \eqref{eq:ris_nd_sv_indl}, \eqref{eq:ris_nd_power}, \eqref{eq:ris_nd_rate_max}, \eqref{eq:ris_power}, \eqref{eq:ris_procrustes}):} Those closed-form asymmetric solutions are constructed from the product of singular matrices. If symmetry is required, one can replace the $\mathbf{U}, \mathbf{V}$ from the \gls{svd} of $\mathbf{A} = \mathbf{U} \mathbf{\Sigma} \mathbf{V}^\mathsf{H}$ by the factor $\mathbf{Q}$ from the Autonne-Takagi factorization of $\frac{\mathbf{A} + \mathbf{A}^\mathsf{T}}{2} = \mathbf{Q} \mathbf{\Sigma} \mathbf{Q}^\mathsf{T}$ \cite{Ikramov2012} to construct the corresponding $\mathbf{\Theta}$; \label{it:takagi}
					\item \emph{\gls{rcg}-based (e.g., \eqref{eq:shaping_subdiff}, \eqref{eq:gradient_eucl_rate}):} The symmetry constraint is added to the corresponding optimization problems, and one can project the solution to the nearest symmetric point $\mathbf{\Theta} \gets \frac{\mathbf{\Theta} + \mathbf{\Theta}^\mathsf{T}}{2}$ after each iteration. \label{it:projection}
				\end{enumerate}
			\end{remark}

			Figs. \subref*{fg:pc_power_symmetry} and \subref*{fg:pc_rate_symmetry} compare the power gain and achievable rate of \gls{mimo} point-to-point channel under asymmetric and various symmetric \gls{ris} configurations.
			Here, `Asymmetric' refers to the benchmark solution by \eqref{eq:ris_power} or \eqref{eq:gradient_eucl_rate}, `Enforced' refers to enforcing symmetry on `Asymmetric', `Legacy' refers to a straightforward extension of the \gls{siso} \gls{snr}-optimal solution \cite[(6)]{Santamaria2023}, `Takagi' refers to the modification \ref{it:takagi}, and `Projection' refers to the modification \ref{it:projection}.
			We observe that the performance gaps between the asymmetric and symmetric \gls{ris} configurations are insignificant and tends to widen with the number of scattering elements.
			The two proposed modifications also outperform other candidates in both problems.
		\end{subsubsection}

		\begin{subsubsection}{Channel Estimation Error}
			\label{sc:estimation_error}
			\begin{figure}[!t]
				\centering
				\subfloat[Pareto: $2 \times 64 \times 2$]{
					\label{fg:pc_singular_csi}
					\resizebox{!}{3.15cm}{
						\input{../assets/simulation/pc_singular_csi.tex}
					}
				}
				\subfloat[Rate: $4 \times 128 \times 4$]{
					\label{fg:pc_rate_csi}
					\resizebox{!}{3.15cm}{
						\input{../assets/simulation/pc_rate_csi.tex}
					}
				}
				\caption{
					Impact of \gls{ris} channel estimation error on the \gls{mimo} singular value region and achievable rate.
					A higher transparency of the Pareto frontier indicates a larger channel estimation error.
					`D' means \gls{d}-\gls{ris} and `BD' refers to fully-connected \gls{bd}-\gls{ris}.
				}
			\end{figure}

			Figs. \subref*{fg:pc_singular_csi} and \subref*{fg:pc_rate_csi} investigates how \gls{ris} channel estimation errors affect the system performance in terms of singular value region and achievable rate.
			We assume the direct channel can be perfectly acquired and the estimated backward and forward channels are modeled by
			\begin{equation*}
				\hat{\mathbf{H}}_{\mathrm{B/F}} = \mathbf{H}_{\mathrm{B/F}} + \tilde{\mathbf{H}}_{\mathrm{B/F}},
			\end{equation*}
			where the error follows $\mathrm{vec}(\tilde{\mathbf{H}}_{\mathrm{B/F}}) \sim \mathcal{N}_\mathbb{C}(\mathbf{0}, \epsilon \Lambda_\mathrm{B} \Lambda_\mathrm{F}\mathbf{I})$.
			The results are evaluated over the ground truth channels.
			It is observed that the proposed channel shaping and joint beamforming solutions are reasonably robust to channel estimation errors.
			An interesting observation is that a \gls{bd}-\gls{ris} designed over extremely poorly estimated channels ($\epsilon = 0.5$) may still outpeform a \gls{d}-\gls{ris} designed over almost perfectly estimated channels ($\epsilon = 0.01$).
			We hope those results can motivate further research on the robust shaping design and provide insights for practical \gls{bd}-\gls{ris} deployment.

			% \begin{figure}[!t]
			% 	\centering
			% 	\resizebox{!}{3.15cm}{
			% 		\input{../assets/simulation/ic_wsr_pair.tex}
			% 	}
			% 	\caption{
			% 		Impact of channel estimation error and transceiver pairs on the weighted sum-rate of $(2 \times 64 \times 2)^K$ \gls{mimo} interference channel with $P = \qty{20}{dB}$ and $N_\mathrm{E} = 2$.
			% 	}
			% 	\label{fg:ic_wsr_pair}
			% \end{figure}

			% Fig.~\ref{fg:ic_wsr_pair} shows the average \gls{wsr} versus the backward/forward channel estimation error and the number of transceiver pairs.
			% Specifically, the active and passive beamformers are designed by Section \ref{sc:rate_ao} over the estimated backward and forward channels
			% \begin{equation*}
			% 	\hat{\mathbf{H}}_{\mathrm{B/F}}^{(k)} = \mathbf{H}_{\mathrm{B/F}}^{(k)} + \tilde{\mathbf{H}}_{\mathrm{B/F}}^{(k)}, \quad \forall k,
			% \end{equation*}
			% where the error follows $\mathrm{vec}(\tilde{\mathbf{H}}_{\mathrm{B/F}}^{(k)}) \sim \mathcal{N}_\mathbb{C}(\mathbf{0}, \epsilon \Lambda_\mathrm{B} \Lambda_\mathrm{F}\mathbf{I})$.
			% The \gls{wsr} is evaluated using the true channels.
			% We observe that the proposed joint beamforming design in Section \ref{sc:wsr_ao} is reasonably robust to channel estimation error and thus viable for practical implementation.
			% On the other hand, introducing a \gls{ris} to interference channel systems is helpful to mitigate the rate saturation effect as $K$ increases.
			% In the saturated regime ($K \ge 4$), \gls{bd}-\gls{ris} provides a much larger \gls{wsr} than \gls{d}-\gls{ris} thanks to its superior shaping capability in aligning the interference subspaces.
			% These results provide valuable insights for practical \gls{ris} design in dense connection scenarios, where proper \gls{bd} configurations can significantly enhance the network capacity.
		\end{subsubsection}
	\end{subsection}
\end{section}

\begin{section}{Conclusion}
	This paper analyzes the channel shaping capability of a passive \gls{ris} in terms of singular value redistribution.
	We focus on a \gls{bd} architecture that allows elements within the same group to interact, enabling more sophisticated manipulation than \gls{d}-\gls{ris}.
	This translates to a wider dynamic range of and better trade-off between singular values, resulting in significant power and rate gains.
	Analytical singular value bounds are derived under typical \gls{ris} deployment scenarios and the Pareto frontiers are characterized via an efficient \gls{rcg} method.
	We also present two beamforming designs for rate maximization problem in \gls{mimo} point-to-point channel and interference channel, one for optimal performance and the other exploits channel shaping for lower complexity.
	Extensive simulations show that the shaping advantage of \gls{bd}-\gls{ris} stems from its superior branch matching and mode alignment potentials, which scales with the number of elements, group size, and \gls{mimo} dimensions.

	% It would be interesting to investigate the impact of channel shaping through \gls{ris} on other wireless applications such as sensing and far-field power transfer.
	% One future direction is introducing \gls{bd}-\gls{ris} to \gls{mimo} interference channel for interference alignment or cancellation.
	% Another open issue is to exploit different groups of \gls{bd}-\gls{ris} to enhance the channel response (and possibly ride extra information) at different frequencies.
	% Incorporating a \gls{ris} at both transmitter and receiver sides provides even stronger manipulation that potentially align both direct-indirect and forward-backward spaces simultaneously.
	% Finally, integrating the \gls{ris} into the \gls{mimo} precoding and combining design is also an interesting topic for future research.
	% into the \gls{mimo} precoding and combining design is also an interesting topic for future research.
	% even better channel shaping can be achieved by incorporating the \gls{ris} into the \gls{mimo} precoding and combining design.
\end{section}


% \begin{appendix}
% 	\begin{subsection}{Proof of Proposition \ref{pp:dof}}
% 		\label{ap:dof}
% 		It suffices to consider the rank of the indirect channel.
% 		Denote the \gls{svd} of the backward and forward channels as
% 		\begin{equation*}
% 			\mathbf{H}_\mathrm{B/F} = \begin{bmatrix}
% 				\mathbf{U}_{\mathrm{B/F},1} & \mathbf{U}_{\mathrm{B/F},2}
% 			\end{bmatrix}
% 			\begin{bmatrix}
% 				\mathbf{\Sigma}_{\mathrm{B/F},1} & \mathbf{0} \\
% 				\mathbf{0}                     & \mathbf{0}
% 			\end{bmatrix}
% 			\begin{bmatrix}
% 				\mathbf{V}_{\mathrm{B/F},1}^\mathsf{H} \\
% 				\mathbf{V}_{\mathrm{B/F},2}^\mathsf{H}
% 			\end{bmatrix},
% 		\end{equation*}
% 		where $\mathbf{U}_{\mathrm{B/F},1}$ and $\mathbf{V}_{\mathrm{B/F},1}$ are any left and right singular matrices of $\mathbf{H}_\mathrm{B/F}$ corresponding to non-zero singular values $\mathbf{\Sigma}_{\mathrm{B/F},1}$, and $\mathbf{U}_{\mathrm{B/F},2}$ and $\mathbf{V}_{\mathrm{B/F},2}$ are those corresponding to zero singular values.
% 		The rank of the indirect channel is \cite[(16.5.10.b)]{Hogben2013}
% 		\begin{equation*}
% 			\begin{split}
% 				\rank(\mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F})
% 				& = \rank(\mathbf{H}_\mathrm{B}) - \dim \bigl(\ker(\mathbf{H}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H}) \cap \ran(\mathbf{H}_\mathrm{B}^\mathsf{H})\bigr) \\
% 				& = \rank(\mathbf{H}_\mathrm{B}) - \dim \bigl(\ran(\mathbf{\Theta} \mathbf{U}_{\mathrm{F},2}) \cap \ran(\mathbf{V}_{\mathrm{B},1})\bigr) \\
% 				& \triangleq r_\mathrm{B} - r_\mathrm{L}(\mathbf{\Theta}),
% 			\end{split}
% 		\end{equation*}
% 		where we define $r_\mathrm{L}(\mathbf{\Theta}) \triangleq \dim \bigl(\ran(\mathbf{\Theta} \mathbf{U}_{\mathrm{F},2}) \cap \ran(\mathbf{V}_{\mathrm{B},1})\bigr)$ and $r_\mathrm{B/F} \triangleq \rank(\mathbf{H}_\mathrm{B/F})$.
% 		Since $\mathbf{U}_{\mathrm{F},2} \in \mathbb{U}^{N_\mathrm{S} \times (N_\mathrm{S} - r_\mathrm{F})}$ and $\mathbf{V}_{\mathrm{B},1} \in \mathbb{U}^{N_\mathrm{S} \times r_\mathrm{B}}$, we have $\max(r_\mathrm{B} - r_\mathrm{F}, 0) \le r_\mathrm{L}(\mathbf{\Theta}) \le \min(N_\mathrm{S} - r_\mathrm{F}, r_\mathrm{B})$
% 		and thus
% 		\begin{equation}
% 			\label{iq:rank_indirect}
% 			\max(r_\mathrm{B} + r_\mathrm{F} - N_\mathrm{S}, 0) \le \rank(\mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F}) \le \min(r_\mathrm{B}, r_\mathrm{F}).
% 		\end{equation}
% 		To attain the upper bound in \eqref{iq:rank_indirect}, the \gls{ris} needs to minimize $r_\mathrm{L}(\mathbf{\Theta})$ by aligning the ranges of $\mathbf{\Theta} \mathbf{U}_{\mathrm{F},2}$ and $\mathbf{V}_{\mathrm{B},2}$ as much as possible.
% 		This is achieved by
% 		\begin{equation}
% 			\label{eq:ris_dof_max}
% 			\mathbf{\Theta}_{\textnormal{DoF-max}}^{\textnormal{MIMO}} = \mathbf{Q}_{\mathrm{B},2} \mathbf{Q}_{\mathrm{F},2}^\mathsf{H},
% 		\end{equation}
% 		where $\mathbf{Q}_{\mathrm{B},2}$ and $\mathbf{Q}_{\mathrm{F},2}$ are the unitary matrices of the QR decomposition of $\mathbf{V}_{\mathrm{B},2}$ and $\mathbf{U}_{\mathrm{F},2}$, respectively.
% 		Similarly, the lower bound in \eqref{iq:rank_indirect} is attained at
% 		\begin{equation}
% 			\label{eq:ris_dof_min}
% 			\mathbf{\Theta}_{\textnormal{DoF-min}}^{\textnormal{MIMO}} = \mathbf{Q}_{\mathrm{B},1} \mathbf{Q}_{\mathrm{F},2}^\mathsf{H},
% 		\end{equation}
% 		where $\mathbf{Q}_{\mathrm{B},1}$ is the unitary matrix of the QR decomposition of $\mathbf{V}_{\mathrm{B},1}$.
% 		While the \gls{dof}-optimal structures \eqref{eq:ris_dof_max} and \eqref{eq:ris_dof_min} are always feasible for fully-connected \gls{bd}-\gls{ris}, they are generally infeasible for \gls{d}-\gls{ris} unless there exist some QR decomposition that diagonalize $\mathbf{Q}_{\mathrm{B},2} \mathbf{Q}_{\mathrm{F},2}^\mathsf{H}$ and $\mathbf{Q}_{\mathrm{B},1} \mathbf{Q}_{\mathrm{F},2}^\mathsf{H}$ simultaneously.
% 		That is, \gls{bd}-\gls{ris} may achieve a larger or smaller number of \gls{dof} of indirect channel, and thus equivalent channel, than \gls{d}-\gls{ris}.
% 	\end{subsection}

% 	\begin{subsection}{Proof of Proposition \ref{pp:rd}}
% 		\label{ap:rank_deficient}
% 		We consider rank-$k$ forward channel and the proof follows similarly for rank-$k$ backward channel.
% 		Let $\mathbf{H}_\mathrm{F} = \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}$ be the \gls{svd} of the forward channel.
% 		The channel Gram matrix $\mathbf{G} \triangleq \mathbf{H} \mathbf{H}^\mathsf{H} $ can be written as
% 		\begin{equation*}
% 			\begin{split}
% 				\mathbf{G}
% 				& = \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{D}^\mathsf{H} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F}^\mathsf{H} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H}                                                         \\
% 				& \quad + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H} \mathbf{H}_\mathrm{D}^\mathsf{H} + \mathbf{H}_\mathrm{D} \mathbf{V}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H}       \\
% 				& = \mathbf{H}_\mathrm{D} (\mathbf{I} - \mathbf{V}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}) \mathbf{H}_\mathrm{D}^\mathsf{H}                                                                                                                                                                                                               \\
% 				& \quad + (\mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} + \mathbf{H}_\mathrm{D} \mathbf{V}_\mathrm{F}) (\mathbf{\Sigma}_\mathrm{F} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} + \mathbf{V}_\mathrm{F}^\mathsf{H} \mathbf{H}_\mathrm{D}^\mathsf{H}) \\
% 				& = \mathbf{Y} + \mathbf{Z} \mathbf{Z}^\mathsf{H},
% 			\end{split}
% 		\end{equation*}
% 		where we define $\mathbf{Y} \triangleq \mathbf{H}_\mathrm{D} (\mathbf{I} - \mathbf{V}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}) \mathbf{H}_\mathrm{D}^\mathsf{H} \in \mathbb{H}^{N_\mathrm{R} \times N_\mathrm{R}}$ and $\mathbf{Z} \triangleq \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} + \mathbf{H}_\mathrm{D} \mathbf{V}_\mathrm{F} \in \mathbb{C}^{N_\mathrm{R} \times k}$.
% 		That is to say, $\mathbf{G}$ can be expressed as a Hermitian matrix plus $k$ rank-1 perturbations.
% 		According to the Cauchy interlacing formula \cite[Theorem 8.4.3]{Golub2013}, the $n$-th eigenvalue of $\mathbf{G}$ is bounded by
% 		\begin{align}
% 			\lambda_n(\mathbf{G}) & \le \lambda_{n-k}(\mathbf{Y}), &  & \text{if } n > k, \label{iq:ev_rd_max}          \\
% 			\lambda_n(\mathbf{G}) & \ge \lambda_n(\mathbf{Y}),     &  & \text{if } n < N - k + 1 \label{iq:ev_rd_min}.
% 		\end{align}
% 		Since $\mathbf{Y} = \mathbf{T} \mathbf{T}^\mathsf{H}$ is positive semi-definite, taking the square roots of \eqref{iq:ev_rd_max} and \eqref{iq:ev_rd_min} gives \eqref{iq:sv_rd_max} and \eqref{iq:sv_rd_min}.
% 	\end{subsection}

% 	\begin{subsection}{Proof of Proposition \ref{pp:nd}}
% 		\label{ap:nd}
% 		Let $\mathbf{H}_\mathrm{B} = \mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{V}_\mathrm{B}^\mathsf{H}$ and $\mathbf{H}_\mathrm{F} = \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}$ be the \gls{svd} of the backward and forward channels, respectively.
% 		The scattering matrix of fully-connected \gls{bd}-\gls{ris} can be decomposed as
% 		\begin{equation}
% 			\label{eq:ris_decompose}
% 			\mathbf{\Theta} = \mathbf{V}_\mathrm{B} \mathbf{X} \mathbf{U}_\mathrm{F}^\mathsf{H},
% 		\end{equation}
% 		where $\mathbf{X} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$ is a unitary matrix to be designed.
% 		The equivalent channel is thus a function of $\mathbf{X}$
% 		\begin{equation}
% 			\label{eq:channel_nd}
% 			\mathbf{H} = \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} = \mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}.
% 		\end{equation}
% 		Since $\sv(\mathbf{U} \mathbf{A} \mathbf{V}^\mathsf{H}) = \sv(\mathbf{A})$ for unitary $\mathbf{U}$ and $\mathbf{V}$, we have
% 		\begin{equation}
% 			\label{eq:sv_factor}
% 			\begin{split}
% 				\sv(\mathbf{H}) & = \sv(\mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H})                                                                     \\
% 								& = \sv(\mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F})                                                                                                                            \\
% 								& = \sv(\bar{\mathbf{U}}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{\bar{V}}_\mathrm{B}^\mathsf{H} \bar{\mathbf{U}}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{\bar{V}}_\mathrm{F}^\mathsf{H}) \\
% 								& = \sv(\mathbf{BF}),
% 			\end{split}
% 		\end{equation}
% 		where $\bar{\mathbf{U}}_{\mathrm{B}} \in \mathbb{U}^{N_\mathrm{R} \times N_\mathrm{R}}$, $\bar{\mathbf{V}}_\mathrm{B}, \bar{\mathbf{U}}_\mathrm{F} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$, and $\bar{\mathbf{V}}_\mathrm{F} \in \mathbb{U}^{N_\mathrm{T} \times N_\mathrm{T}}$ can be designed arbitrarily.
% 	\end{subsection}

% 	\begin{subsection}{Proof of Corollary \ref{co:nd_sv_prod_tail}}
% 		\label{ap:nd_sv_prod_tail}
% 		\eqref{iq:sv_nd_prod_largest} follows from \eqref{iq:horn} when $r = k$.
% 		On the other hand, if we can prove
% 		\begin{equation}
% 			\label{eq:sv_prod_all_ext}
% 			\prod_{n=1}^{\bar{N}} \sigma_n(\mathbf{H}) = \prod_{n=1}^{\bar{N}} \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}),
% 		\end{equation}
% 		then \eqref{iq:sv_nd_prod_smallest} follows from \eqref{iq:sv_nd_prod_largest} and the non-negativity of singular values.
% 		To see \eqref{eq:sv_prod_all_ext}, we start from a stricter result
% 		\begin{equation}
% 			\label{eq:sv_product_all}
% 			\prod_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{H}) = \prod_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}),
% 		\end{equation}
% 		which is provable by cases.
% 		When $N_\mathrm{S} > N$, both sides of \eqref{eq:sv_product_all} become zero since $\sigma_n(\mathbf{H}) = \sigma_n(\mathbf{H}_\mathrm{B}) = \sigma_n(\mathbf{H}_\mathrm{F}) = 0$ for $n > N$.
% 		When $N_\mathrm{S} \le N$, we have
% 		\begin{equation*}
% 			\begin{split}
% 				\prod\nolimits_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{H})
% 				& = \prod\nolimits_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F})             \\
% 				& = \prod\nolimits_{n=1}^{N_\mathrm{S}} \sigma_n(\hat{\mathbf{\Sigma}}_\mathrm{B} \mathbf{X} \hat{\mathbf{\Sigma}}_\mathrm{F}) \\
% 				& = \det\bigl(\hat{\mathbf{\Sigma}}_\mathrm{B} \mathbf{X} \hat{\mathbf{\Sigma}}_\mathrm{F}\bigr)                               \\
% 				& = \det\bigl(\hat{\mathbf{\Sigma}}_\mathrm{B}\bigr) \det(\mathbf{X}) \det\bigl(\hat{\mathbf{\Sigma}}_\mathrm{F}\bigr)         \\
% 				& = \prod\nolimits_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{\Sigma}_\mathrm{B}) \sigma_n(\mathbf{\Sigma}_\mathrm{F}),
% 			\end{split}
% 		\end{equation*}
% 		where the first equality follows from \eqref{eq:sv_factor} and $\hat{\mathbf{\Sigma}}_\mathrm{B}, \hat{\mathbf{\Sigma}}_\mathrm{F}$ truncate $\mathbf{\Sigma}_\mathrm{B}, \mathbf{\Sigma}_\mathrm{F}$ to square matrices of dimension $N_\mathrm{S}$, respectively.
% 		It is evident that \eqref{eq:sv_product_all} implies \eqref{eq:sv_prod_all_ext} and thus \eqref{iq:sv_nd_prod_smallest}.
% 	\end{subsection}

% 	\begin{subsection}{Proof of Corollary \ref{co:nd_sv_indl}}
% 		\label{ap:nd_sv_indl}
% 		In \eqref{iq:sv_nd_indl}, the set of upper bounds
% 		\begin{equation}
% 			\label{iq:sv_nd_indl_set_max}
% 			\bigl\{\sigma_n(\mathbf{H}) \le \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) \mid [i,j,k] \in [N_\mathrm{S}]^3, i+j=n+1\bigr\}
% 		\end{equation}
% 		is a special case of \eqref{iq:horn} with $(I, J, K) \in [N_\mathrm{S}]^3$.
% 		The minimum\footnote{One may think to take the maximum of those upper bounds as the problem of interest is the attainable dynamic range of $n$-th singular value. This is infeasible since the singular values will be reordered.} of \eqref{iq:sv_nd_indl_set_max} is selected as the tightest upper bound in \eqref{iq:sv_nd_indl}.
% 		On the other hand, the set of lower bounds
% 		\begin{equation}
% 			\label{iq:sv_nd_indl_set_min}
% 			\bigl\{\sigma_n(\mathbf{H}) \ge \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) \mid [i,j,k] \in [N_\mathrm{S}]^3, i+j=n+N_\mathrm{S}\bigr\}
% 		\end{equation}
% 		can be induced by \eqref{iq:sv_nd_indl_set_max}, \eqref{eq:sv_product_all}, and the non-negativity of singular values.
% 		The maximum of \eqref{iq:sv_nd_indl_set_min} is selected as the tightest lower bound in \eqref{iq:sv_nd_indl}.
% 		Interested readers are also referred to \cite[(2.0.3)]{Zhang2005}.

% 		To attain the upper bound, the \gls{bd}-\gls{ris} needs to maximize the minimum of the first $n$ channel singular values.
% 		It follows from \eqref{eq:ris_nd_sv_indl_max} that
% 		\begin{equation*}
% 			\begin{split}
% 				\sv(\mathbf{H})
% 				& = \sv(\mathbf{H}_\mathrm{B} \mathbf{V}_\mathrm{B} \mathbf{P} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{H}_\mathrm{F})                                                                                                                         \\
% 				& = \sv(\mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{V}_\mathrm{B}^\mathsf{H} \mathbf{V}_\mathrm{B} \mathbf{P} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{U}_\mathrm{F}^\mathsf{H}) \\
% 				& = \sv(\mathbf{\Sigma}_\mathrm{B} \mathbf{P} \mathbf{\Sigma}_\mathrm{F}).
% 			\end{split}
% 		\end{equation*}
% 		On the one hand, $\mathbf{P}_{ij}=1$ with $(i, j)$ satisfying \eqref{eq:idx_nd_sv_indl_max} ensures $\min_{i+j=n+1} \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F})$ is a singular value of $\mathbf{H}$.
% 		It is actually among the first $n$ since the number of pairs $(i',j')$ not majorized by $(i,j)$ is $n-1$.
% 		On the other hand, \eqref{eq:perm_nd_sv_indl_max} ensures the first $(n-1)$-th singular values are no smaller than $\min_{i+j=n+1} \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F})$.
% 		Combining both facts, we claim the upper bound $\sigma_n(\mathbf{H}) = \min_{i+j=n+1} \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F})$ is attainable by \eqref{eq:ris_nd_sv_indl_max}.
% 		The attainability of the lower bound can be proved similarly and the details are omitted.
% 	\end{subsection}

% 	\begin{subsection}{Proof of Corollary \ref{co:nd_power}}
% 		\label{ap:nd_power}
% 		From \eqref{eq:ris_decompose} and \eqref{eq:channel_nd} we have
% 		\begin{equation}
% 			\begin{split}
% 				\lVert \mathbf{H} \rVert _\mathrm{F}^2
% 				& = \tr \bigl(\mathbf{V}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F}^\mathsf{H} \mathbf{X}^\mathsf{H} \mathbf{\Sigma}_\mathrm{B}^\mathsf{H} \mathbf{U}_\mathrm{B}^\mathsf{H} \mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}\bigr) \\
% 				& = \tr \bigl(\mathbf{\Sigma}_\mathrm{B}^\mathsf{H} \mathbf{\Sigma}_\mathrm{B} \cdot \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F}^\mathsf{H} \mathbf{X}^\mathsf{H}\bigr)                                                                                                         \\
% 				& \triangleq \tr \bigl(\tilde{\mathbf{B}} \tilde{\mathbf{F}}\bigr),
% 			\end{split}
% 		\end{equation}
% 		where $\mathbf{X} \triangleq \mathbf{V}_\mathrm{B}^\mathsf{H} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$, $\tilde{\mathbf{B}} \triangleq \mathbf{\Sigma}_\mathrm{B}^\mathsf{H} \mathbf{\Sigma}_\mathrm{B} \in \mathbb{H}_+^{N_\mathrm{S} \times N_\mathrm{S}}$, and $\tilde{\mathbf{F}} \triangleq \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F}^\mathsf{H} \mathbf{X}^\mathsf{H} \in \mathbb{H}_+^{N_\mathrm{S} \times N_\mathrm{S}}$.
% 		By Ruhe's trace inequality for positive semi-definite matrices \cite[(H.1.g) and (H.1.h)]{Marshall2010},
% 		\begin{equation*}
% 			\sum_{n=1}^N \lambda_n(\tilde{\mathbf{B}}) \lambda_{N_\mathrm{S}-n+1}(\tilde{\mathbf{F}}) \le \tr \bigl(\tilde{\mathbf{B}} \tilde{\mathbf{F}}\bigr) \le \sum_{n=1}^N \lambda_n(\tilde{\mathbf{B}}) \lambda_n(\tilde{\mathbf{F}}),
% 		\end{equation*}
% 		which simplifies to \eqref{iq:power_nd}.
% 		The upper bound is attained when $\mathbf{X}$ is chosen to match the singular values of $\tilde{\mathbf{F}}$ to those of $\tilde{\mathbf{B}}$ in similar order.
% 		Apparently this occurs at $\mathbf{X} = \mathbf{I}$ and $\mathbf{\Theta} = \mathbf{V}_\mathrm{B} \mathbf{U}_\mathrm{F}^\mathsf{H}$.
% 		On the other hand, the lower bound is attained when the singular values of $\tilde{\mathbf{F}}$ and $\tilde{\mathbf{B}}$ are matched in reverse order, namely $\mathbf{X} = \mathbf{J}$ and $\mathbf{\Theta} = \mathbf{V}_\mathrm{B} \mathbf{J} \mathbf{U}_\mathrm{F}^\mathsf{H}$.
% 	\end{subsection}

% 	\begin{subsection}{Proof of Corollary \ref{co:nd_capacity_snr_extreme}}
% 		\label{ap:nd_capacity}
% 		When perfect \gls{csi} is available at the transmitter, in the low-\gls{snr} regime, the capacity is achieved by dominant eigenmode transmission \cite[(5.26)]{Clerckx2013}
% 		\begin{align*}
% 			C_{\rho_\downarrow}
% 			& = \log\bigl(1 + \rho \lambda_1(\mathbf{H}^\mathsf{H} \mathbf{H})\bigr)        \\
% 			& = \log\bigl(1 + \rho \sigma_1^2(\mathbf{H})\bigr)                             \\
% 			& \approx \rho \sigma_1^2(\mathbf{H})                                           \\
% 			& \le \rho \sigma_1^2(\mathbf{H}_\mathrm{B}) \sigma_1^2(\mathbf{H}_\mathrm{F}),
% 		\end{align*}
% 		where the approximation is $\log(1 + x) \approx x$ for small $x$ and the inequality follows from \eqref{iq:sv_nd_prod_largest} with $k=1$.
% 		In the high-\gls{snr} regime, the capacity is achieved by multiple eigenmode transmission with uniform power location \cite[(5.27)]{Clerckx2013}
% 		\begin{align*}
% 			C_{\rho_\uparrow}
% 			& = \sum\nolimits_{n=1}^N \log\Bigl(1 + \frac{\rho}{N} \lambda_n(\mathbf{H}^\mathsf{H} \mathbf{H})\Bigr)                     \\
% 			& \approx \sum\nolimits_{n=1}^N \log\Bigl(\frac{\rho}{N} \sigma_n^2(\mathbf{H})\Bigr)                                        \\
% 			& = N \log \frac{\rho}{N} + \sum\nolimits_{n=1}^N \log \sigma_n^2(\mathbf{H})                                                \\
% 			& = N \log \frac{\rho}{N} + \log \prod\nolimits_{n=1}^N \sigma_n^2(\mathbf{H})                                               \\
% 			& \le N \log \frac{\rho}{N} + 2 \log \prod\nolimits_{n=1}^N \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}),
% 		\end{align*}
% 		where the approximation is $\log(1 + x) \approx \log(x)$ for large $x$ and the inequality follows from \eqref{iq:sv_nd_prod_largest} with $k=N$.

% 		We now show \eqref{eq:ris_nd_rate_max} can achieve the upper bounds in \eqref{iq:capacity_nd_snr_low} and \eqref{iq:capacity_nd_snr_high} simultaneously.
% 		On the one hand, \eqref{eq:ris_nd_rate_max} is a special case of \eqref{eq:ris_nd_sv_indl_max} with $\mathbf{P} = \mathbf{I}$, which satisfies \eqref{eq:idx_nd_sv_indl_max} and \eqref{eq:perm_nd_sv_indl_max} for $n=1$ and thus attain $\sigma_1(\mathbf{H}) = \sigma_1(\mathbf{H}_\mathrm{B}) \sigma_1(\mathbf{H}_\mathrm{F})$.
% 		On the other hand, since $\log(\cdot)$ is a monotonic function, we can prove similar to Appendix \ref{ap:nd_power} that $\sum_{n=1}^N \log \sigma_n^2(\mathbf{H}) \le \sum_{n=1}^N \log \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F})$ and the bound is tight at \eqref{eq:ris_nd_rate_max}.
% 		The proof is complete.
% 	\end{subsection}

% 	\begin{subsection}{Proof of Proposition \ref{pp:shaping}}
% 		\label{ap:shaping}
% 		The sub-differential of a symmetric gauge function of singular values of a matrix with respect to the matrix itself is given by \cite[Theorem 2]{Watson1992}
% 		\begin{equation}
% 			\partial_{\mathbf{H}^*} f\bigl(\sv(\mathbf{H})\bigr) = \conv \bigl\{ \mathbf{U} \mathbf{D} \mathbf{V}^\mathsf{H} \bigr\},
% 		\end{equation}
% 		where $\mathbf{D} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$ is a rectangular diagonal matrix with $[\mathbf{D}]_{n,n} \in \partial_{\sigma_n(\mathbf{H})} f\bigl(\sv(\mathbf{H})\bigr)$, $\forall n \in [N]$, and $\mathbf{U}$, $\mathbf{V}$ are any left and right singular matrices of $\mathbf{H}$.
% 		It implies
% 		\begin{align*}
% 			\partial f\bigl(\sv(\mathbf{H})\bigr)
% 			& \ni \tr \bigl(\mathbf{V}^* \mathbf{D}^\mathsf{T} \mathbf{U}^\mathsf{T} \partial \mathbf{H}^*\bigr) \\
% 			& = \tr \bigl(\mathbf{V}^* \mathbf{D}^\mathsf{T} \mathbf{U}^\mathsf{T} \mathbf{H}_{\mathrm{B},g}^* \partial {\mathbf{\Theta}_g^*} \mathbf{H}_{\mathrm{F},g}^*\bigr) \\
% 			& = \tr \bigl(\mathbf{H}_{\mathrm{F},g}^* \mathbf{V}^* \mathbf{D}^\mathsf{T} \mathbf{U}^\mathsf{T} \mathbf{H}_{\mathrm{B},g}^* \partial {\mathbf{\Theta}_g^*} \bigr),
% 		\end{align*}
% 		and therefore $\mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{U} \mathbf{D} \mathbf{V}^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}$ constitutes a sub-gradient of $f\bigl(\sv(\mathbf{H})\bigr)$ with respect to $\mathbf{\Theta}_g$.
% 		The convex hull of those sub-gradients is the sub-differential \eqref{eq:shaping_subdiff}.
% 	\end{subsection}

% 	\begin{subsection}{Proof of Lemma \ref{lm:rate}}
% 		\label{ap:rate}
% 		The differential of $R$ with respect to $\mathbf{\Theta}_g^*$ is \cite{Hjorungnes2007}
% 		\begin{align*}
% 			\partial R
% 			& = \frac{1}{\eta} \tr \biggl\{ \partial \mathbf{H}^* \cdot \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T} \Bigl(\mathbf{I} + \frac{\mathbf{H}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T}}{\eta}\Bigr)^{-1} \biggr\}                                                                      \\
% 			& = \frac{1}{\eta} \tr \biggl\{ \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \cdot \mathbf{H}_{\mathrm{F},g}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T} \Bigl(\mathbf{I} + \frac{\mathbf{H}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T}}{\eta}\Bigr)^{-1} \biggr\} \\
% 			& = \frac{1}{\eta} \tr \biggl\{ \mathbf{H}_{\mathrm{F},g}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T} \Bigl(\mathbf{I} + \frac{\mathbf{H}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T}}{\eta}\Bigr)^{-1} \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \biggr\},
% 		\end{align*}
% 		and the corresponding complex derivative is \eqref{eq:gradient_eucl_rate}.
% 	\end{subsection}

% 	\begin{subsection}{Proof of Proposition \ref{pp:power}}
% 		\label{ap:power}
% 		The differential of \eqref{ob:power} with respect to $\mathbf{\Theta}_g^*$ is
% 		\begin{align*}
% 			\partial \lVert \mathbf{H} \rVert _\mathrm{F}^2
% 			& = \tr\bigl(\mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \cdot \mathbf{H}_{\mathrm{F},g}^* (\mathbf{H}_\mathrm{D}^\mathsf{T} + \mathbf{H}_\mathrm{F}^\mathsf{T} \mathbf{\Theta}^\mathsf{T} \mathbf{H}_\mathrm{B}^\mathsf{T})\bigr) \\
% 			& = \tr\bigl(\mathbf{H}_{\mathrm{F},g}^* (\mathbf{H}_\mathrm{D}^\mathsf{T} + \mathbf{H}_\mathrm{F}^\mathsf{T} \mathbf{\Theta}^\mathsf{T} \mathbf{H}_\mathrm{B}^\mathsf{T}) \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^*\bigr)
% 		\end{align*}
% 		and the corresponding complex derivative is
% 		\begin{equation}
% 			\frac{\partial \lVert \mathbf{H} \rVert _\mathrm{F}^2}{\partial \mathbf{\Theta}_g^*} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H} \triangleq \mathbf{M}_g,
% 		\end{equation}
% 		whose \gls{svd} is denoted as $\mathbf{M}_g = \mathbf{U}_g \mathbf{\Sigma}_g \mathbf{V}_g^\mathsf{H}$.
% 		The quadratic objective \eqref{ob:power} can be successively approximated by its first-order Taylor expansion, resulting in the subproblem
% 		\begin{maxi!}
% 			{\scriptstyle{\mathbf{\Theta}}}{\sum_g 2 \Re\bigl\{ \tr(\mathbf{\Theta}_g^\mathsf{H} \mathbf{M}_g) \bigr\}}{\label{op:power_ris_taylor}}{\label{ob:power_ris_taylor}}
% 			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
% 		\end{maxi!}
% 		whose optimal solution is
% 		\begin{equation}
% 			\label{eq:ris_power_taylor}
% 			\tilde{\mathbf{\Theta}}_g = \mathbf{U}_g \mathbf{V}_g^\mathsf{H}, \quad \forall g.
% 		\end{equation}
% 		This is because $\Re \bigl\{\tr(\mathbf{\Theta}_g^\mathsf{H} \mathbf{M}_g)\bigr\} = \Re \bigl\{ \tr(\mathbf{\Sigma}_g \mathbf{V}_g^\mathsf{H} \mathbf{\Theta}_g^\mathsf{H} \mathbf{U}_g) \bigr\} \le \tr(\mathbf{\Sigma}_g)$ and the bound is tight when $\mathbf{V}_g^\mathsf{H} \mathbf{\Theta}_g^\mathsf{H} \mathbf{U}_g = \mathbf{I}$.

% 		Next, we prove that solving the affine approximation \eqref{op:power_ris_taylor} by \eqref{eq:ris_power_taylor} does not decrease \eqref{ob:power}.
% 		Since $\tilde{\mathbf{\Theta}} = \diag(\tilde{\mathbf{\Theta}}_1, \ldots, \tilde{\mathbf{\Theta}}_G)$ is optimal for \eqref{op:power_ris_taylor}, we have
% 		\begin{equation}
% 			\label{iq:power_ris_taylor}
% 			\begin{split}
% 				2 \Re \bigl\{ & \sum\limits_g \tr(\tilde{\mathbf{\Theta}}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}) \\
% 				& + \sum\limits_{g_1,g_2} \tr(\tilde{\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \mathbf{\Theta}_{g_2} \mathbf{H}_{\mathrm{F},g_2} \mathbf{H}_{\mathrm{F},g_1}^\mathsf{H})\bigr\} \\
% 				\ge 2 \Re \bigl\{ &\sum\limits_g \tr({\mathbf{\Theta}}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}) \\
% 				& + \sum\limits_{g_1,g_2} \tr({\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \mathbf{\Theta}_{g_2} \mathbf{H}_{\mathrm{F},g_2} \mathbf{H}_{\mathrm{F},g_1}^\mathsf{H})\bigr\}.
% 			\end{split}
% 		\end{equation}
% 		Besides, $\lVert \sum_g \mathbf{H}_{\mathrm{B},g} \tilde{\mathbf{\Theta}}_g \mathbf{H}_{\mathrm{F},g} - \sum_g \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g} \rVert _\mathrm{F}^2 \ge 0$ implies
% 		\begin{equation}
% 			\label{iq:auxiliary_nonnegative}
% 			\begin{split}
% 				& \sum\limits_{g_1,g_2} \tr(\mathbf{H}_{\mathrm{F},g_1}^\mathsf{H} \tilde{\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \tilde{\mathbf{\Theta}}_{g_2} \mathbf{H}_{\mathrm{F},g_2}) \\
% 				& \quad + \sum\limits_{g_1,g_2} \tr(\mathbf{H}_{\mathrm{F},g_1}^\mathsf{H} {\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} {\mathbf{\Theta}}_{g_2} \mathbf{H}_{\mathrm{F},g_2}) \\
% 				\ge & 2 \Re \bigl\{\sum\limits_{g_1,g_2} \tr(\mathbf{H}_{\mathrm{F},g_1}^\mathsf{H} \tilde{\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \mathbf{\Theta}_{g_2} \mathbf{H}_{\mathrm{F},g_2})\bigr\}.
% 			\end{split}
% 		\end{equation}
% 		Adding \eqref{iq:power_ris_taylor} and \eqref{iq:auxiliary_nonnegative}, we have
% 		\begin{equation}
% 			\begin{split}
% 				& 2 \Re \bigl\{\tr(\tilde{\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}) \bigr\} + \tr(\mathbf{H}_\mathrm{F}^\mathsf{H} \tilde{\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{B} \tilde{\mathbf{\Theta}} \mathbf{H}_\mathrm{F}) \\
% 				\ge & 2 \Re \bigl\{\tr({\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}) \bigr\} + \tr(\mathbf{H}_\mathrm{F}^\mathsf{H} {\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{B} {\mathbf{\Theta}} \mathbf{H}_\mathrm{F}),
% 			\end{split}
% 		\end{equation}
% 		which suggests that \eqref{ob:power} is non-decreasing as the solution iterates over \eqref{eq:ris_power_taylor}.
% 		Since \eqref{ob:power} is also bounded from above, the sequence of objective value converges.

% 		Finally, we prove that any solution when \eqref{eq:auxiliary_power} converges, denoted by $\mathbf{\Theta}'$, is a stationary point of \eqref{op:power}.
% 		The \gls{kkt} conditions of \eqref{op:power} and \eqref{op:power_ris_taylor} are equivalent in terms of primal/dual feasibility and complementary slackness, while the stationary conditions are respectively, $\forall g$,
% 		\begin{gather}
% 			\mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta}^\star \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H} - \mathbf{\Theta}_g^\star \mathbf{\Lambda}_g^\mathsf{H} = 0,\label{eq:power_ris_optimal}\\
% 			\mathbf{M}_g - \mathbf{\Theta}_g^\star \mathbf{\Lambda}_g^\mathsf{H} = 0.\label{eq:power_ris_taylor_optimal}
% 		\end{gather}
% 		When \eqref{eq:auxiliary_power} converges, $\mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta}' \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta}^\star \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H}$ and \eqref{eq:power_ris_taylor_optimal} reduces to \eqref{eq:power_ris_optimal}.
% 		The proof is thus completed.
% 	\end{subsection}

% 	% \begin{subsection}{Proof of Lemma \ref{lm:wsr}}
% 	% 	\label{ap:wsr}
% 	% 	The differential of $f = \sum_{k=1}^K \rho_k R_k$ with respect to $\mathbf{\Theta}_g^*$ is
% 	% 	\begin{align*}
% 	% 		\partial f
% 	% 		& = \sum_{k=1}^K \rho_k \tr \Bigl\{ \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \Bigl( \mathbf{H}_{\mathrm{F},g}^{(k)\mathsf{H}} \partial \mathbf{\Theta}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \\
% 	% 		& \quad + \mathbf{H}^{(kk)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}_{\mathrm{B},g}^{(k)} \partial \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}^{(k)} - \mathbf{H}^{(kk)\mathsf{H}} \mathbf{Q}_k^{(-1)} \\
% 	% 		& \quad \times \sum_{j \ne k} \Bigl(\mathbf{H}_{\mathrm{B},g}^{(k)} \partial \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} \mathbf{H}^{(kj)\mathsf{H}} \\
% 	% 		& \quad + \mathbf{H}^{(kj)} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \partial \mathbf{\Theta}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \Bigr) \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \Bigr) \mathbf{W}_k \Bigr\} \\
% 	% 		& = \sum_{k=1}^K \rho_k \Bigl( \tr \Bigl\{ \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^{(k)\mathsf{H}} \partial \mathbf{\Theta}_g^\mathsf{H}\Bigr\} \\
% 	% 		& \quad + \tr \Bigl\{ \mathbf{H}_{\mathrm{F},g}^{(k)\mathsf{H}} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \mathbf{H}^{(kk)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \partial \mathbf{\Theta}_g \Bigr\} \\
% 	% 		& \quad - \tr \Bigl\{ \sum_{j \ne k} \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \mathbf{H}^{(kk)\mathsf{H}} \\
% 	% 		& \quad \quad \times \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kj)} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \partial \mathbf{\Theta}_g^\mathsf{H} \Bigr\} \\
% 	% 		& \quad - \tr \Bigl\{ \sum_{j \ne k} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} \mathbf{H}^{(kj)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \mathbf{W}_k \\
% 	% 		& \quad \quad \times \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \mathbf{H}^{(kk)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}_{\mathrm{B},g}^{(k)} \partial \mathbf{\Theta}_g \Bigr\} \Bigr),
% 	% 	\end{align*}
% 	% 	and the corresponding complex derivative is \eqref{eq:gradient_eucl_wsr}.
% 	% \end{subsection}

% 	% \begin{subsection}{Proof of Proposition \ref{pp:interference}}
% 	% 	\label{ap:interference}
% 	% 	Minimizing \eqref{ob:interference} is equivalent to maximizing
% 	% 	\begin{align*}
% 	% 		f(\mathbf{\Theta}) & = - I + \sum_g \beta_g^{(k)} \tr \Bigl\{ \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{H}_{\mathrm{F},g}^{(j)} \Bigr\} \\
% 	% 		& = \sum_{k=1}^K \sum_{j \ne k} - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{H}_{\mathrm{D}}^{(kj)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)} \mathbf{\Theta}_g\Bigr\} \\
% 	% 		& \quad - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{D}}^{(kj)} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{\Theta}_g^\mathsf{H} \Bigr\} \\
% 	% 		& \quad - \tr \Bigl\{ \sum_{g_1=1}^G \sum_{g_2 \ne g_1} \mathbf{H}_{\mathrm{B},g_2}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g_1}^{(k)} \mathbf{\Theta}_{g_1} \mathbf{H}_{\mathrm{F},g_1}^{(j)} \mathbf{H}_{\mathrm{F},g_2}^{(j)\mathsf{H}} \mathbf{\Theta}_{g_2}^\mathsf{H}\Bigr\} \\
% 	% 		& \quad - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)} \mathbf{\Theta}_{g} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{\Theta}_{g}^\mathsf{H} \Bigr\} \\
% 	% 		& \quad + \tr \Bigl\{ \sum_g \beta_g^{(k)} \mathbf{\Theta}_{g} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{\Theta}_{g}^\mathsf{H} \Bigr\} \\
% 	% 		& = \sum_{k=1}^K \sum_{j \ne k} - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{H}_{\mathrm{D}}^{(kj)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)} \mathbf{\Theta}_g\Bigr\} \\
% 	% 		& \quad - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{D}}^{(kj)} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{\Theta}_g^\mathsf{H} \Bigr\} \\
% 	% 		& \quad - \tr \Bigl\{ \sum_{g_1=1}^G \sum_{g_2 \ne g_1} \mathbf{H}_{\mathrm{B},g_2}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g_1}^{(k)} \mathbf{\Theta}_{g_1} \mathbf{H}_{\mathrm{F},g_1}^{(j)} \mathbf{H}_{\mathrm{F},g_2}^{(j)\mathsf{H}} \mathbf{\Theta}_{g_2}^\mathsf{H}\Bigr\} \\
% 	% 		& \quad + \tr \Bigl\{ \sum_g \mathbf{B}_{g}^{(k)} \mathbf{\Theta}_{g} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{\Theta}_{g}^\mathsf{H} \Bigr\},
% 	% 	\end{align*}
% 	% 	where $\mathbf{B}_{g}^{(k)} = \beta_g^{(k)} \mathbf{I} - \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)}$ and the relaxation constant $\beta_g^{(k)}$ can be chosen arbitrarily.
% 	% 	One can choose $\beta_g^{(k)} = \lambda_1(\mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)})$ to ensure the positive semi-definiteness of $\mathbf{B}_{g}^{(k)}$ and formulate a quadratic function to be maximized.
% 	% 	The remaining proof is similar to Appendix \ref{ap:power} and omitted here.
% 	% \end{subsection}
% \end{appendix}

% \begin{section}{Acknowledgement}
% 	The authors would like to thank the anonymous reviewers for their insightful criticisms and suggestions that helped us correct several technical errors.
% \end{section}

\bibliographystyle{IEEEtran}
\bibliography{library.bib}
\end{document}
