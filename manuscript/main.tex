\documentclass[journal]{IEEEtran}

\input{preamble}

% TODO compact or standard SVD

% \title{Channel Shaping Using Beyond Diagonal RIS:\\Analysis, Optimization, and Enhanced Flexibility}
\title{MIMO Channel Shaping and Rate Maximization\\Using Beyond Diagonal RIS}
% \title{MIMO Channel Shaping Using Beyond Diagonal RIS: Singular Value Redistribution and Rate Maximization}
% \title{Beyond Diagonal RIS: MIMO Channel Shaping and Rate Maximization}
\author{
	\IEEEauthorblockN{
		Yang Zhao, \IEEEmembership{Member, IEEE,}
		Hongyu Li, \IEEEmembership{Graduate Student Member, IEEE,}\\
		Massimo Franceschetti, \IEEEmembership{Fellow, IEEE,}
		and Bruno Clerckx, \IEEEmembership{Fellow, IEEE}
	}
	\thanks{
		Yang Zhao, Hongyu Li, and Bruno Clerckx are with the Department of Electrical and Electronic Engineering, Imperial College London, London SW7 2AZ, U.K. (e-mail: \{\href{mailto:yang.zhao18@imperial.ac.uk}{yang.zhao18}, \href{mailto:c.li21@imperial.ac.uk}{c.li21}, \href{mailto:b.clerckx@imperial.ac.uk}{b.clerckx}\}@imperial.ac.uk).

		Massimo Franceschetti is with the Department of Electrical and Computer Engineering, University of California, San Diego, La Jolla CA 92093, USA (e-mail: \href{mailto:massimo@ece.ucsd.edu}{massimo@ece.ucsd.edu}).

		This work has been partially supported by UKRI grant EP/Y004086/1, EP/X040569/1, EP/Y037197/1, EP/X04047X/1, EP/Y037243/1.
	}
}

\begin{document}

\maketitle

\begin{abstract}
	% This paper investigates the extent to which a passive \gls{ris} can redistribute
	% singular values of a point-to-point \gls{mimo} channel for power and rate gains.
	% This paper investigates to what extent can a passive \gls{ris} redistribute
	% singular values to achieve power and rate gains in point-to-point \gls{mimo} channels.
	% the limit to which
	This paper investigates the capability of a passive \gls{ris} to redistribute the singular values of point-to-point \gls{mimo} channels for achieving power and rate gains.
	We depart from the conventional \gls{d}-\gls{ris} with diagonal phase shift matrix
	and adopt a \gls{bd} architecture that offers greater wave manipulation flexibility through element-wise connections.
	% ? not restricted to diagonal scattering matrix and featuring element-wise connections for extra wave manipulation flexibility.
	% featuring element-wise connections for signal amplitude and phase control.
	% featuring element-wise connections for amplitude and phase control.
	% in-group connections between elements, which enables signal amplitude and phase control.
	% This powerful model allows cooperative wave scattering with both amplitude and phase control, and we uniquely attribute the shaping advantage to channel rearrangement and space alignment.
	% This powerful model enables cooperative wave scattering with both amplitude and phase control, and we provide unique shaping insights in terms of channel rearrangement and space alignment.
	% uniquely explain the extra design freedom from off-diagonal entries as channel rearrangement and space alignment.
	% while the shaping advantage from off-diagonal entries is uniquely attributed to channel rearrangement and space alignment.
	% An efficient and universal \gls{bd}-\gls{ris} design framework is proposed over group-wise {geodesic} \gls{rcg} on the Stiefel manifold, which performs multiplicative rotational (instead of add-then-retract) updates for faster convergence.
	% The Pareto frontiers of channel singular values are characterized via a novel geodesic manifold optimization, and the resulting region comprehensively encapsulates relevant metrics (e.g., spectral norm and condition number).
	Specifically, we first
	provide shaping insights by characterizing
	% characterize
	the channel singular value regions attainable by \gls{d}-\gls{ris} and \gls{bd}-\gls{ris} via a novel geodesic optimization.
	Analytical singular value bounds are then derived to explore their shaping limits in typical deployment scenarios.
	% Pareto frontiers of channel singular values via a novel geodesic manifold optimization.
	% channel shaping insights by characterizing the Pareto singular value frontiers via a novel geodesic manifold optimization.
	% The resulting region comprehensively encapsulates most relevant metrics (e.g., spectral norm and condition number).
	% To explore the shaping limits, we also derive
	% 0ol. individual and collective
	% analytical singular value bounds for common \gls{ris} deployment scenarios.
	% in special channel conditions.
	% in two common scenarios: 1) forward/backward channel is rank-deficient and 2) direct channel is blocked.
	% respectively in rank-deficient channels and for fully-connected \gls{bd}-\gls{ris} via matrix analysis.
	% For the power gain problem, we provide a closed-form iterative solution by group-wise \gls{svd} that features even faster convergence.
	% We uniquely attribute the shaping advantage from off-diagonal entries to channel rearrangement and space alignment.
	% Channel rearrangement is a unique feature of off-diagonal entries that allows each group to rearrange and recombine the forward and backward channels.
	% Space alignment generalizes phase matching in \gls{siso} and introduces a trade-off between multiplicative backward-forward and additive direct-indirect channel combinations.
	% Those channel shaping designs have two major implications.
	% First, they demystify the performance gain from off-diagonal entries in terms of {channel rearrangement} and {space alignment}.
	% help to demystify the gain from off-diagonal entries and reveal the shaping advantage of \gls{bd}-\gls{ris} in channel rearrangement and space alignment.
	% Second, they inspire a two-stage suboptimal solution that decouples joint active and passive beamforming design.
	% \gls{ris}-transceiver optimization and suggest a low-complexity suboptimal solution based on channel power maximization.
	As a side product, we tackle \gls{bd}-\gls{ris}-aided \gls{mimo} rate maximization problem by a local-optimal \gls{ao} and a shaping-inspired low-complexity approach.
	%  over channel power gain maximization.
	% (i.e., power gain maximization).
	% over channel gain maximization.
	% The former alternates between active and passive beamformers until convergence, while the latter maximizes
	% solves the problem in closed form by a channel power maximization and \gls{mimo} transmission subproblem.
	% shaping-inspired approach.
	Results show that compared to \gls{d}-\gls{ris}, \gls{bd}-\gls{ris} significantly improves the dynamic range of all channel singular values, the trade-off in manipulating them, and thus the channel power and achievable rate.
	Those observations become more pronounced when the number of \gls{ris} elements and \gls{mimo} dimensions increase.
	% Results show that compared to \gls{d}-\gls{ris}, \gls{bd}-\gls{ris} significantly improves the dynamic range of all channel singular values as well as the trade-off in manipulating them.
	% We also notice the power and rate gain of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} increase with the number of scattering elements and \gls{mimo} dimensions.
	Of particular interest, \gls{bd}-\gls{ris} is shown to activate multi-stream transmission at lower transmit power than \gls{d}-\gls{ris}, hence achieving the asymptotic \gls{dof} at low \gls{snr} thanks to its higher flexibility of shaping the distribution of channel singular values.
	% wider dynamic range (with better trade-off) of singular values and significant power and rate gains, especially in large-scale \gls{mimo} systems.

	% indicate that the rate deficit from the latter diminishes as the \gls{ris} evolves from diagonal towards unitary, while the relative gain of \gls{bd}-\gls{ris} increase with \gls{mimo} dimensions and decrease with spatial correlation.

	% , and .

	% (i) , and (ii) the gap between the two approaches vanishes as \gls{bd}-\gls{ris} evolves from diagonal to unitary.
	% not only demystify the advantage of \gls{bd}-\gls{ris} in channel rearrangement and space alignment, but also decouple the joint \gls{ris}-transceiver optimization.
	% Those channel shaping designs not only demystify the advantage of \gls{bd}-\gls{ris} in channel rearrangement and space alignment, but also decouple the joint \gls{ris}-transceiver optimization.

	% geodesic \gls{rcg} algorithm is tailored for smooth optimization problems of asymmetric \gls{bd}-\gls{ris} with arbitrary group size, then invoked for the Pareto frontier of channel singular values.
	% To understand the gain from off-diagonal entries, we also derive analytical singular value bounds in rank-deficient and fully-connected scenarios.
	% As a side product, we tackle \gls{mimo} rate maximization problem by alternating between active beamformer (eigenmode transmission) and passive beamformer (\gls{rcg} algorithm) until convergence.
	% A low-complexity suboptimal solution based on channel shaping is also proposed, where the decoupled problem is formulated as channel power maximization and solved in closed form iteratively.
	% % We now show how channel shaping decouples the design and amounts to a low-complexity suboptimal solution.
	% % A low-complexity suboptimal solution decoupling both blocks is also proposed, where the channel shaping subproblem is formulated as channel power maximization and solved in closed form iteratively.
	% Theoretical analysis and numerical evaluation reveal that the shaping advantage of \gls{bd}-\gls{ris} increases with group size and \gls{mimo} dimensions, stemming from stronger channel rearrangement and space alignment capabilities.
\end{abstract}

\begin{IEEEkeywords}
	Reconfigurable intelligent surface, channel singular value redistribution, rate maximization, manifold optimization.
\end{IEEEkeywords}

\glsresetall

\begin{section}{Introduction}
	\begin{subsection}{Background}
		Today we are witnessing a paradigm shift from connectivity to intelligence, where the wireless environment is no longer a chaotic medium but a conscious agent that can serve on demand.
		This is empowered by recent advances in \gls{ris}, a programmable passive planar surface that recycles and redistributes ambient electromagnetic waves for improved wireless performance.
		A typical \gls{ris} consists of numerous low-power sub-wavelength non-resonant scattering elements, whose response can be engineered in real-time to manipulate the amplitude, phase, frequency, and polarization of the scattered waves \cite{Basar2019}.
		% It not only experiences negligible noise and supports full-duplex transmissions, but also features better flexibility than reflectarrays, lighter footprint than various relays, and greater scalability than conventional multi-antenna techniques.
		It enables low-noise full-duplex operation, featuring better flexibility than reflectarrays, lighter footprint than relays, and greater scalability than \gls{mimo} systems.
		One popular \gls{ris} research direction is \emph{joint passive and active beamforming} design with transceivers to enhance a specific performance measure, which has attracted significant interests in wireless communication \cite{Wu2019,Guo2020,Liu2022}, sensing \cite{He2022,Luo2022,Hua2023}, and power transfer literature \cite{Wu2020a,Feng2022,Zhao2022}.
		While passive beamforming at \gls{ris} suffers attenuation from double fading, it offers better asymptotic behaviors than active beamforming at transceivers (e.g., second-order array gain and fourth-order harvested power \cite{Zhao2022}).
		Another \gls{ris} application is \emph{information modulation} by periodically switching its reflection pattern within the channel coherence time.
		This creates a free-ride message stream with dual benefits: integrating with legacy transmitter for enhanced channel capacity \cite{Karasik2020,Basar2020,Ye2022}, or serving as individual source for low-power uplink communication \cite{Liang2020,Zhao2024,Yang2024}.
		Different from above, \emph{channel shaping} exploits \gls{ris} as a stand-alone device to modify the inherent properties of the wireless environment, for example, compensate for the Doppler effect \cite{Basar2021}, flatten frequency-selective channels \cite{Arslan2022}, improve \gls{mimo} channel rank \cite{Ozdogan2020a}, and artificially diversify channel over time for orthogonal \cite{Yang2019} and non-orthogonal \cite{Chen2023} multiple access schemes.
		This helps to decouple joint beamforming problems into a channel shaping stage and a legacy transceiver design stage, providing a versatile solution for various wireless applications.
		% provides a ubiquitous solution for various wireless applications by decoupling the joint \gls{ris}-transceiver design into a channel design stage and a legacy system design stage.
		% decoupling joint beamforming design by first optimizing the channel and then the transceiver.
		% decouples joint \gls{ris}-transceiver design by first optimizing the channel and then the system, providing a ubiquitous solution for different wireless applications
		% different wireless applications
		% different wireless applications
		% into a channel design stage and a communication system design stage.
		% provides a ubiquitous solution for different wireless applications, decoupling the joint \gls{ris}-transceiver designs into a channel design stage and a communication system design stage.
		% which decouples joint \gls{ris}-transceiver designs by first optimizing the channel and then the communication system.
		% and helps to decouple the \gls{ris}-transceiver design in a distributed manner.
	\end{subsection}

	\begin{subsection}{Related Works}
		At a specific resource block, channel shaping metrics can be classified into two categories:
		% shaping metrics can be classified into two categories:
		\begin{itemize}
			\item \emph{Singular value:} The impact of \gls{ris} has been studied in terms of minimum singular value \cite{ElMossallamy2021}, effective rank \cite{ElMossallamy2021,Meng2023}, condition number \cite{Zheng2022,Huang2023}, and degree of freedom \cite{Bafghi2022,Zheng2023,Chae2023}. Those are closely related to performance measures (e.g., achievable rate and harvested power \cite{Shen2021}) but sensitive to minor perturbations of the channel matrix.
			\item \emph{Power:} The impact of \gls{ris} has been studied in terms of channel power gain \cite{Wu2019,Shen2020a,Nerini2023,Nerini2024,Santamaria2023} in point-to-point channels and leakage interference \cite{Santamaria2023a} in interference channels. Those second-order metrics are less informative in \gls{mimo} but easier to analyze and optimize.
		\end{itemize}

		Although above works offered inspiring glimpses into the channel shaping potential of passive \gls{ris}, none attempted to disclose the entire attainable channel singular value region.
		% to characterize the channel singular value region manipulated by passive \gls{ris}.
		% no previous work has characterized the \gls{mimo} channel singular value region manipulated by any type of \gls{ris}.
		Most relevant literature \cite{ElMossallamy2021,Meng2023,Zheng2022,Huang2023,Bafghi2022,Zheng2023,Chae2023,Wu2019,Santamaria2023a} have also been limited to a \gls{d}-\gls{ris} model where each element is connected to a dedicated impedance and disconnected from others.
		As such, wave impinging on one element is entirely scattered by the same element.
		% is tuned by a dedicated impedance and acts as an \emph{individual} scatterer \cite{Wu2020}.
		This simple architecture is modeled by a diagonal scattering matrix with unit-magnitude diagonal entries, which only applies a phase shift to the incoming signal.
		The idea was soon generalized to \gls{bd}-\gls{ris} with group-connected architecture \cite{Shen2020a}, where adjacent elements within the same group are connected via passive reconfigurable components\footnote{Those components can be either symmetric (e.g., capacitors and inductors) or asymmetric (e.g., ring hybrids and branch-line hybrids) \cite{Ahn2006}, resulting in symmetric and asymmetric scattering matrices, respectively.}.
		This allows wave impinging on one element to propagate within the circuit and depart partially from any element in the same group.
		It can thus manipulate both amplitude and phase of the scattered wave while remaining passive.
		Such a powerful model can be realized at reduced hardware cost using tree- and forest-connected architectures by graph theory \cite{Nerini2024}.
		\gls{bd}-\gls{ris}
		% also supports
		can also function in
		% hybrid transmitting-and-reflecting mode \cite{Li2023b} and
		multi-sector mode \cite{Li2023c} for full-space coverage and multi-user support.
		Practical challenges such as channel estimation \cite{Li2024}, mutual coupling \cite{Li2023f}, and wideband modelling \cite{Li2024a} have also been studied in recent literature.
		Its beamforming superiority over \gls{d}-\gls{ris} has been proved in \gls{siso} and \gls{miso} systems \cite{Shen2020a,Nerini2023,Nerini2024,Santamaria2023,Fang2023,Zhou2023,Li2023c,Soleymani2024}, however, the interplay between \gls{bd}-\gls{ris} and \gls{mimo} is still in the infancy stage.
		% On the other hand, the beamforming superiority of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} has been extensively studied in \gls{siso} and \gls{miso} communication systems \cite{Shen2020a,Nerini2023,Nerini2024,Santamaria2023,Fang2023,Zhou2023,Li2023c,Soleymani2024}.
		% % , where the problems have been cast as single-user \gls{snr} maximization \cite{Shen2020a,Nerini2023,Nerini2024,Santamaria2023} and multi-user \gls{wsr} maximization \cite{Fang2023,Zhou2023,Li2023c,Soleymani2024}.
		% However, the interplay between \gls{bd}-\gls{ris} and \gls{mimo} is still in the infancy stage.
		The authors of \cite{Bartoli2023} investigated the rate-optimal joint beamforming design for a fully-connected \gls{bd}-\gls{ris}-aided \gls{mimo} system where the direct channel is negligible.
		% 		The work
		% 		% For a massive \gls{mimo} without direct link,
		% 		Similar assumptions were also adopted in
		% [47], which introduces a transmitter-side BD-RIS to massive
		% MIMO that exploits statistical Channel State Information (CSI)
		% for improved spectral efficiency
		% 		% with negligible direct link and \gls{bd}-\gls{ris}.
		% 		% Those assumptions simplify the problem but limit the generality of the results.
		A transmitter-side \gls{bd}-\gls{ris} was introduced to
		% improve the spectral efficiency of massive \gls{mimo} systems where the direct channel is negligible \cite{Mishra2024}.
		massive \gls{mimo} systems that exploits statistical \gls{csi} for improved spectral efficiency \cite{Mishra2024}, which again assumed negligible direct channel and fully-connected \gls{bd}-\gls{ris}.
		Received power maximization with continuous-valued and discrete-valued \gls{bd}-\gls{ris} have been tackled respectively in closed form \cite{Nerini2023} and by machine learning approach \cite{Nerini2023b}, but the corresponding single-stream transceiver is rate-suboptimal.
		%  and the \gls{bd}-\gls{ris} design problem is equivalent to \gls{siso} shaping.

		% in single-stream \gls{mimo} transmission

		% in the literature, but the resulting single-stream transceiver is rate-suboptimal and the corresponding \gls{bd}-\gls{ris} design is equivalent to \gls{siso} shaping.
		% A practical frequency-dependent \gls{bd}-\gls{ris} model has been recently proposed for multi-band multi-cell \gls{mimo} networks to facilitate practical deployments \cite{Sena2024}.
		% Although the results are promising, the channel shaping capability from off-diagonal entries deserves further investigation, and there lacks a universal yet efficient \gls{bd}-\gls{ris} design framework.
	\end{subsection}

	\begin{subsection}{Contributions}
		% We notice that there lacks a comprehensive study of \gls{bd}-\gls{ris} in point-to-point \gls{mimo} systems

		% This paper investigates the shaping capability of passive \gls{ris} in point-to-point \gls{mimo} channels.
		% We aim to answer the ultimate question:
		% \emph{What is the channel singular value (and power gain) shaping capability of \gls{bd}-\gls{ris}?}


		This paper is motivated by a fundamental question:
		\emph{What is the singular value (and power gain) shaping capability of a passive \gls{ris} in point-to-point \gls{mimo} channels?}
		We aim for a comprehensive answer via analysis and optimization.
		The contributions are summarized below.

		% This paper aims to answer a critical question:
		% \emph{What is the singular value (and power gain) shaping capability of passive \gls{ris} in point-to-point \gls{mimo} channels?}
		% We provide a comprehensive answer through theoretical analysis and numerical optimization.

		% This paper investigates the shaping capability of passive \gls{ris} in point-to-point \gls{mimo} channels.
		% We aim to answer the ultimate question:
		% \emph{What is the channel singular value and power gain shaping capability of \gls{bd}-\gls{ris}?}
		% \emph{What is the ultimate channel singular value shaping capability of a passive \gls{ris}?}


		% We notice that there lacks a comprehensive study of \gls{bd}-\gls{ris} in point-to-point \gls{mimo} systems --- the shaping benefits of \gls{bd}-\gls{ris} are not fully understood and the general rate maximization problem remains open.
		% and the channel shaping potential of \gls{bd}-\gls{ris} remains unexplored.
		% The channel shaping capability of \gls{bd}-\gls{ris} deserves further investigation.
		% Although the results are promising, the channel shaping capability of \gls{bd}-\gls{ris} deserves further investigation.
		% Moreover, no previous work has characterized the \gls{mimo} channel singular value region manipulated by any type of \gls{ris}.
		% , and the \gls{bd}-\gls{ris}-aided \gls{mimo} rate maximization problem remains unsolved.
		% one critical question has not been fully addressed: \emph{What is the ultimate channel singular value shaping capability of a passive \gls{ris}?}
		% \begin{enumerate}
		% 	\item What is the entire singular value region of a \gls{mimo} channel with \gls{ris}?
		% \end{enumerate}
		% they neither discuss the limitation
		% depict the entire singular value region nor provide a universal optimization framework.
		% It motivates the ultimate question: \emph{To what extent can a passive \gls{ris} reshape \gls{mimo} channels in terms of singular values?}
		% Despite the great potentials and fruitful outcomes, one critical unanswered question is the {channel shaping} capability: \emph{To what extent can a passive \gls{ris} reshape \gls{mimo} channels?}
		% The answer depends heavily on \gls{ris} hardware architecture and scattering model.
		% This paper aims to narrow those gaps and provide a comprehensive answer to the channel shaping capability question through theoretical analysis and numerical optimization.
		% The contributions are summarized below.


		% 1. need a general study on BD-RIS x MIMO and explain the potential from off-diagonal entries
		% 2. need a general optimization framework for BD-RIS
		% 3. need a comprehensive answer to the channel shaping question
		% 4. need a low-complexity solution from shaping

		% Specifically, we propose a novel design method that allows reshaping of the available channels through singular values manipulation. Our method compares favorably with respect to existing solutions in that

		First, we pioneer \gls{bd}-\gls{ris} study in general \gls{mimo} channels and interpret its shaping potential as branch matching and mode alignment.
		Branch matching refers to pairing and combining the branches (i.e., entries) of backward and forward channels associated with each \gls{bd}-\gls{ris} group.
		Mode alignment refers to aligning and ordering the modes (i.e., singular vectors) of indirect channels with those of direct channel.
		% channel rearrangement and space alignment.
		% Channel rearrangement refers to rearranging and recombining the entries of backward (i.e., \gls{ris}-receiver) and forward (i.e., transmitter-\gls{ris}) channel matrices by their strength.
		% Space alignment generalizes the phase matching of direct and indirect channels in \gls{siso} and \gls{miso} to the singular vector space in \gls{mimo}.
		The former is uniquely attributed to the off-diagonal entries of the scattering matrix of \gls{bd}-\gls{ris}.


		% We highlight that the off-diagonal entries of \gls{bd}-\gls{ris} scattering matrix provides higher signal processing flexibility than \gls{d}-\gls{ris}.
		% exploits more effectively than \gls{d}-\gls{ris}.
		% This is the first paper to study \gls{bd}-\gls{ris} in general \gls{mimo} systems.
		%  and discuss its shaping potential.

		Second, we propose a novel \gls{bd}-\gls{ris} design method that allows reshaping of the available channels through singular values manipulation.
		Our \gls{rcg} method compares favorably with respect to existing ones in that the updates are along the geodesics (i.e., the shortest path between two points in a Riemannian manifold) of the feasible domain to accelerate convergence.
		It also works for general design problems of group-connected \gls{bd}-\gls{ris}.


		% Second, we propose an efficient \gls{bd}-\gls{ris} design framework that solves general optimization problems (e.g., singular value redistribution and rate maximization) by geodesic\footnote{A geodesic refers to the shortest path between two points in a Riemannian manifold.} \gls{rcg}.
		% % to numerically analyze the channel shaping capability of \gls{bd}-\gls{ris}, we exploit the Riemannian geometry of the Stiefel manifold and
		% This method modified from \cite{Abrudan2008,Abrudan2009} exploits the Riemannian geometry of the Stiefel manifold and performs group-wise multiplicative rotational updates along the geodesics, which avoids retraction and facilitates step size selection.
		% It thus converges faster than existing non-geodesic approaches \cite{Absil2009,Pan2022d}.
		% This is the first work to tailor an efficient optimization framework for \gls{bd}-\gls{ris}.

		% pioneer
		Third, we provide a numerical answer to the shaping question by characterizing the Pareto frontiers of channel singular values.
		The enclosed region generalizes most relevant metrics and provides an intuitive shaping benchmark.
		Results show that increasing \gls{bd}-\gls{ris} group size enlarges this region, improving the dynamic range of all singular values and the trade-off in manipulating them.
		% enlarges the singular value region, improving both dynamic range of and trade-off between singular values.


		% adopt the proposed geodesic \gls{rcg} and provide a numerical answer to the singular value shaping question.
		% % to answer the channel singular value shaping question via numerical optimization.
		% % to redistribute the singular values of a point-to-point \gls{mimo} channel.
		% The {Pareto frontiers} of channel singular values are characterized by solving a series of weighted sum maximization problems, where the weight associated with each singular value can be positive, zero, or negative.
		% optimizing their weighted sum, where the weights can be positive, zero, or negative.
		% This problem is solved by the proposed geodesic \gls{rcg} algorithm.
		% The enclosed region generalizes most relevant metrics and provides an intuitive channel shaping benchmark.
		% Results show that increasing \gls{bd}-\gls{ris} group size enlarges the singular value region, improving both dynamic range of and trade-off between singular values.
		% , where the dynamic range and trade-off between are both improved.
		% significantly enlarges the singular value region, improveing the dynamic range and trade-off in-between.
		% We also and derive some analytical singular value bounds for rank-deficient \gls{mimo} and fully-connected \gls{bd}-\gls{ris}.

		Fourth, we provide an analytical answer to the shaping question in typical deployment scenarios.
		% For rank-deficient forward/backward channel,
		When the forward/backward channel is rank-deficient, we derive singular value bounds applying to \gls{d}- and \gls{bd}-\gls{ris} with asymptotically large number of elements.
		% For negligible direct channel
		When the direct channel is negligible, we derive singular value bounds applying to fully-connected \gls{bd}-\gls{ris} with arbitrary number of elements.
		Those bounds are validated by comparing with the numerical results above.
		Results show that for a fixed number of elements, \gls{bd}-\gls{ris} can approach the asymptotic bounds better than \gls{d}-\gls{ris}.

		% Results validate those bounds and emphasizes the shaping advantage of \gls{bd}-\gls{ris}.
		% This is the first work to quantify the singular value redistribution capability of \gls{bd}-\gls{ris} from either numerical or analytical perspective.


		% 1) rank-deficient forward/backward channel and 2) direct channel being blocked.

		% % leverage matrix analysis tools and provide an analytical answer to the singular value shaping question.
		% % revisit the channel singular value shaping problem from an analytical perspective via matrix analysis.
		% % To explore the ultimate shaping limits, we derive individual and collective singular value bounds for rank-deficient forward/backward channel and blocked direct channel.
		% % Asymptotic bounds shared by diagonal and \gls{bd}-\gls{ris} are derived in the former case, while exact bounds for unitary \gls{bd}-\gls{ris} are derived in the latter case.
		% Asymptotic channel singular value bounds applying to diagonal and \gls{bd}-\gls{ris} are derived for rank-deficient forward/backward channel.
		% On the other hand, tight bounds for fully-connected \gls{bd}-\gls{ris} with finite number of elements are derived for blocked direct channel.
		% Results validate those bounds and emphasizes the shaping advantage of \gls{bd}-\gls{ris}.
		% This is the first work to quantify the singular value redistribution capability of \gls{bd}-\gls{ris} from either numerical or analytical perspective.
		% Results validate those bounds and show that
		% fully-connected \gls{bd}-\gls{ris} without direct link.

		% In the rank-deficient scenario, we show that the asymptotic performace


		% % respectively in rank-deficient channels and for fully-connected \gls{bd}-\gls{ris}
		% collective singular value bounds	for rank-deficient channels and fully-connected \gls{bd}-\gls{ris}, respectively.
		% 	Results validate those bounds and show
		% for rank-deficient channels and fully-connected \gls{bd}-\gls{ris}, respectively.
		% Results validate those bounds and show that increasing \gls{bd}-\gls{ris} group size significantly enlarges the singular value region, providing wider dynamic range and better trade-off.
		% dynamic range and trade-off of singular values are significantly improved by \gls{bd}-\gls{ris}, especially in large-scale \gls{mimo} systems.
		% This is the first work to comprehensively answer the channel shaping capability question from both numerical and analytical perspectives in the most general \gls{bd}-\gls{ris} setup.
		% from a Pareto perspective.



		% We also present two beamforming designs for rate maximization problem, one based on alternating optimization for optimal performance and the other decouples the \gls{ris}-transceiver design for lower complexity.
		% Extensive simulations show that the advantage of \gls{bd}-\gls{ris} stems from its superior space alignment and channel rearrangement capability, which scales with the number of elements, group size, \gls{mimo} dimensions, and channel diversity.



		Fifth, we tackle \gls{bd}-\gls{ris}-aided \gls{mimo} rate maximization problem by a local-optimal \gls{ao} and a shaping-inspired low-complexity approach.
		The former iteratively updates active beamforming by eigenmode transmission and passive beamforming by geodesic \gls{rcg}, until convergence.
		The latter exploits the \gls{bd}-\gls{ris} to shape the channel for maximum power gain then performs eigenmode transmission.
		% simply shapes the channel by \gls{bd}-\gls{ris} for maximum power gain and performs eigenmode transmission.
		Interestingly, the rate deficit from the shaping-inspired approach diminishes as the \gls{bd}-\gls{ris} evolves towards fully-connected.
		% gap in between diminishes as the \gls{ris} evolves from diagonal to fully-connected.
		We conclude that: 1) channel shaping decouples joint beamforming for reduced design complexity; 2) the power and rate gains of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} increase with the number of scattering elements and \gls{mimo} dimensions; 3) at low transmit power, \gls{bd}-\gls{ris} can activate more streams than \gls{d}-\gls{ris} and achieve the asymptotic \gls{dof}, thanks to its higher flexibility of shaping the distribution of channel singular values.
		% Interestingly, the rate gap in between diminishes as the \gls{ris} evolves from diagonal to fully-connected.
		% Channel shaping helps to decouple joint beamforming by first designing the channel and then the transmitter.

		% We highlight that the power and rate gains of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} increase with the number of scattering elements and \gls{mimo} dimensions.
		% Besides, \gls{bd}-\gls{ris} can help to activate more streams and achieves higher \gls{dof} than \gls{d}-\gls{ris} at low transmit \gls{snr}.
		% \gls{bd}-\gls{ris} is shown to activate multi-stream transmission at lower transmit power than \gls{d}-\gls{ris}, hence attaining the full \gls{dof} at lower \gls{snr} thanks to its higher flexibility of shaping the distribution of channel singular values.


		% Fifth, extensive simulations reveal that the performance gain from \gls{bd}-\gls{ris} increases with group size and \gls{mimo} dimensions.
		% In terms of channel power, fully-connected \gls{bd}-\gls{ris} boosts up to 62\% and 270\% over \gls{d}-\gls{ris} in $1 \times 1$ and $4 \times 4$ \gls{mimo} under independent Rayleigh fading, respectively.
		% The superiority stems from stronger \emph{channel rearrangement} and \emph{space alignment} capabilities empowered by in-group cooperation.
		% It emphasizes the importance of using \gls{bd}-\gls{ris} in large-scale \gls{mimo} systems.



		% is a local-optimal approach through \gls{ao} that iteratively updates active and passive beamformers by eigenmode transmission and geodesic \gls{rcg}, respectively.
		% The second is a low-complexity approach that shape the channel for maximum power gain then perform eigenmode transmission.
		% It suggests that channel shaping offers a promising path to decouple joint \gls{ris}-transceiver designs.
		% inspired by channel shaping that decouples the joint \gls{ris}-transceiver design.

		% : a local-optimal \gls{ao} approach and a low-complexity approach inspired by channel shaping insights.
		% The former updates active beamforming by eigenmode transmission and passive beamforming by proposed geodesic \gls{rcg} until convergence.
		% The latter suboptimally decouples the problem as channel power gain maximization at \gls{bd}-\gls{ris} and conventional \gls{mimo} transmission at transceiver, then solves both in closed form.
		% The problem is solved by a closed-form two-stage method.
		% Results show that \gls{bd}-\gls{ris} provides higher power gain and achievable rate than \gls{d}-\gls{ris}, and the rate gap of two approaches diminishes as the \gls{bd}-\gls{ris} evolves from diagonal to fully-connected.
		% It suggests channel shaping offers a promising path to decouple joint \gls{ris}-transceiver designs.
		% Interestingly, the rate difference between the optimal and low-complexity designs diminishes as the \gls{ris} evolves from diagonal to unitary.
		% Those results emphasize the importance of using \gls{bd}-\gls{ris} in large-scale \gls{mimo} systems and suggest channel shaping offers a promising path to decouple joint \gls{ris}-transceiver designs.
		% a promising channel shaping path towards practical \gls{ris} and transceiver design.
		% that channel shaping offers a promising path towards simplified and practical \gls{bd}-
		% It suggests that channel shaping offers a promising path towards simplified and practical \gls{bd}-\gls{ris} (and transceiver) designs.
		% via \gls{bd}-\gls{ris} offers a promising path towards simplified and practical design.
		% offers a promising path towards simplified and practical desi
		% It suggests channel shaping helps to decouple the joint \gls{ris}-transceiver design and offers a promising low-complexity solution.
		% This is the first work to discuss the implications of channel shaping on joint active-passive beamforming optimization.

		% Fifth, extensive simulations reveal that the performance gain from \gls{bd}-\gls{ris} increases with group size and \gls{mimo} dimensions.
		% In terms of channel power, fully-connected \gls{bd}-\gls{ris} boosts up to 62\% and 270\% over \gls{d}-\gls{ris} in $1 \times 1$ and $4 \times 4$ \gls{mimo} under independent Rayleigh fading, respectively.
		% The superiority stems from stronger \emph{channel rearrangement} and \emph{space alignment} capabilities empowered by in-group cooperation.
		% It emphasizes the importance of using \gls{bd}-\gls{ris} in large-scale \gls{mimo} systems.


		% First, we quantify the capability of a \gls{bd}-\gls{ris} to reshape the \gls{mimo} point-to-point channel in terms of singular values.
		% The \emph{Pareto frontiers} are characterized by optimizing the {weighted sum of singular values}, where the weights can be positive, zero, or negative.
		% % This generalizes most singular value metrics and provides a powerful design framework.
		% The resulting singular value region generalizes most relevant metrics and provides an intuitive channel shaping benchmark.
		% We now discuss some analytical singular value bounds in rank-deficient and fully-connected scenarios, which help to demystify the gain from off-diagonal entries.
		% This is the first paper to answer the channel shaping question and highlight the \gls{bd}-\gls{ris} gain from a Pareto perspective.

		% Second, we propose a \gls{rcg} algorithm adapted from \cite{Abrudan2008,Abrudan2009} for smooth optimization problems of asymmetric \gls{bd}-\gls{ris} with arbitrary group size.
		% Specifically, group-wise update is performed along the geodesics\footnote{A geodesic refers to the shortest path between two points in a Riemannian manifold.} of the Stiefel manifold, which are expressed compactly by the exponential map \cite{Edelman1998}.
		% It features lower complexity and faster convergence than general manifold optimization \cite{Absil2009,Pan2022d}, and solves the Pareto singular value problem.
		% This is the first paper to tailor an efficient optimization framework for asymmetric \gls{bd}-\gls{ris}.

		% Third, we tackle \gls{bd}-\gls{ris} \gls{mimo} rate maximization with two solutions: a local-optimal approach through \gls{ao} and a low-complexity approach over channel shaping.
		% The former updates active and passive beamformers by eigenmode transmission and \gls{rcg} algorithm, respectively.
		% The latter suboptimally decouples both blocks, recasts the shaping problem as channel power maximization, and solves it iteratively in closed form.
		% Interestingly, the gap in between vanishes as \gls{bd}-\gls{ris} evolves from diagonal (diagonal) to unitary (fully-connected).
		% It suggests channel shaping offers a promising low-complexity solution for joint \gls{ris}-transceiver designs.

		% Third, we propose a closed-form iterative algorithm for power centric channel shaping problems.
		% The idea is to successively approximate the quadratic objective by a sequence of affines and solve the local problems by \gls{svd}.
		% Case studies are conducted for channel power maximization in \gls{pc} and leakage interference minimization in \gls{ic}.
	\end{subsection}

	\emph{Notation:}
	Italic, bold lower-case, and bold upper-case letters indicate scalars, vectors and matrices, respectively.
	$\jmath$ denotes the imaginary unit.
	% $\mathbb{C}$ represents the set of complex numbers.
	$\mathbb{H}^{n \times n}$, $\mathbb{H}_+^{n \times n}$, and $\mathbb{U}^{n \times n}$ denote the set of $n \times n$ Hermitian, positive semi-definite, and unitary matrices, respectively.
	% $\mathbf{0}$ and $\mathbf{I}$ are the all-zero and identity matrices with appropriate size, respectively.
	$\Re\{\cdot\}$ takes the real part of a complex number.
	% $\tr(\cdot)$ and $\det(\cdot)$ evaluate the trace and determinant of a square matrix, respectively.
	$\diag(\cdot)$ constructs a square matrix with arguments on the main (block) diagonal and zeros elsewhere.
	$\sv(\cdot)$, $\ran(\cdot)$, and $\ker(\cdot)$ evaluate the singular values (in descending order), column space (range), and kernel of a matrix, respectively.
	% $\sv(\cdot)$ extracts the singular values of a matrix as a non-ascending vector.
	% $\card(\cdot)$ returns the cardinality of a set.
	$\conv(\cdot)$ returns the convex hull of arguments.
	$\lvert \cdot \rvert$, $\lVert \cdot \rVert$, and $\lVert \cdot \rVert _\mathrm{F}$ denote the absolute value, Euclidean norm, and Frobenius norm, respectively.
	$\sigma_n(\cdot)$ and $\lambda_n(\cdot)$ are the $n$-th largest singular value and eigenvalue, respectively.
	% $\boldsymbol{\sigma}(\cdot)$ and $\boldsymbol{\lambda}(\cdot)$ are the corresponding vectors.
	$(\cdot)^*$, $(\cdot)^\mathsf{T}$, $(\cdot)^\mathsf{H}$, $(\cdot)^\dagger$, $(\cdot)^{\star}$ denote the conjugate, transpose, conjugate transpose (Hermitian), Moore-Penrose inverse, and stationary point, respectively.
	$[N]$ is a shortcut for $\{1,2,\ldots,N\}$.
	$(\cdot)_{[x:y]}$ is a shortcut for $(\cdot)_x,(\cdot)_{x+1},\ldots,(\cdot)_y$.
	$\odot$ denotes the element-wise (Hadamard) product.
	$\mathcal{N}_{\mathbb{C}}(\mathbf{0}, \mathbf{\Sigma})$ is the multivariate \gls{cscg} distribution with mean $\mathbf{0}$ and covariance $\mathbf{\Sigma}$.
	$\sim$ means ``distributed as''.
\end{section}

\begin{section}{System Model}
	\begin{subsection}{BD-RIS}
		The \gls{bd}-\gls{ris} can be modeled as an $N_\mathrm{S}$-port network \cite{Ivrlac2010} that divides into $G$ individual groups, where group $g \in [G]$ contains $N_g$ scattering elements interconnected by real-time reconfigurable components \cite{Shen2020a}.
		Apparently $N_\mathrm{S} = \sum_{g=1}^G N_g$.
		Without loss of generality we assume equal size for all groups $N_g = L \triangleq N_\mathrm{S} / G, \ \forall g$ and no mutual coupling between elements.
		For asymmetric \gls{bd}-\gls{ris}, the overall scattering matrix is block-diagonal with unitary blocks\footnote{We assume asymmetric network by default to establish a benchmark for passive \gls{ris}. Some symmetric solutions (i.e., $\mathbf{\Theta} = \mathbf{\Theta}^\mathsf{T}$) will be discussed and their performance will be evaluated in Section~\ref{sc:simulation}.}
		\begin{equation}
			\label{eq:ris}
			\mathbf{\Theta} = \diag(\mathbf{\Theta}_1,\ldots,\mathbf{\Theta}_G),
		\end{equation}
		where $\mathbf{\Theta}_g \in \mathbb{U}^{L \times L}$ is the $g$-th diagonal block modeling the response of group $g$.
		It is noteworthy that \gls{d}-\gls{ris} is an extreme case of \eqref{eq:ris} with group size $L=1$, that is, each element is an individual.
		Some viable architectures of \gls{bd}-\gls{ris} are illustrated in \cite[Fig. 3]{Shen2020a}, \cite[Fig. 5]{Li2023c}, \cite[Fig. 2]{Nerini2024} where the array geometry and circuit topology are modeled in $\mathbf{\Theta}$.
	\end{subsection}

	\begin{subsection}{MIMO Point-to-Point Channel}
		Consider a \gls{bd}-\gls{ris} aided \gls{mimo} \gls{pc} with $N_\mathrm{T}$ and $N_\mathrm{R}$ transmit and receive antennas, respectively, and $N_\mathrm{S}$ scattering elements at the \gls{bd}-\gls{ris}.
		This configuration is denoted as $N_\mathrm{T} \times N_\mathrm{S} \times N_\mathrm{R}$.
		Let $\mathbf{H}_\mathrm{D} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$, $\mathbf{H}_\mathrm{B} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{S}}$, $\mathbf{H}_\mathrm{F} \in \mathbb{C}^{N_\mathrm{S} \times N_\mathrm{T}}$ denote the direct (i.e., transmitter-receiver), backward (i.e., \gls{ris}-receiver), and forward (i.e., transmitter-\gls{ris}) channels, respectively.
		The equivalent channel depends on the \gls{bd}-\gls{ris} scattering matrix
		\begin{equation}
			\label{eq:channel}
			\mathbf{H} = \mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} = \mathbf{H}_\mathrm{D} + \sum_g \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g} \triangleq \mathbf{H}_\mathrm{D} + \sum_g \mathbf{H}_g,
		\end{equation}
		where $\mathbf{H}_{\mathrm{B},g} \in \mathbb{C}^{N_\mathrm{R} \times L}$ and $\mathbf{H}_{\mathrm{F},g} \in \mathbb{C}^{L \times N_\mathrm{T}}$ are the backward and forward channels associated with group $g$, corresponding to the $(g{-}1)L{+}1$ to $gL$ columns of $\mathbf{H}_\mathrm{B}$ and rows of $\mathbf{H}_\mathrm{F}$, respectively, and $\mathbf{H}_g \triangleq \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}$ is the indirect channel via group $g$.
		Since unitary matrices constitute an algebraic group with respect to multiplication, the scattering matrix of group $g$ can be decomposed as
		\begin{equation}
			\mathbf{\Theta}_g = \mathbf{L}_g \mathbf{R}_g^\mathsf{H},
		\end{equation}
		where $\mathbf{L}_g, \mathbf{R}_g \in \mathbb{U}^{L \times L}$ are two unitary factor matrices.
		Let $\mathbf{H}_{\mathrm{B/F},g} = \mathbf{U}_{\mathrm{B/F},g} \mathbf{\Sigma}_{\mathrm{B/F},g} \mathbf{V}_{\mathrm{B/F},g}^\mathsf{H}$ be the \gls{svd} of the backward and forward channels, respectively.
		The equivalent channel is thus
		\begin{equation}
			\label{eq:channel_svd}
			\mathbf{H} = \overbrace{\mathbf{H}_\mathrm{D} + \sum_g \mathbf{U}_{\mathrm{B},g} \mathbf{\Sigma}_{\mathrm{B},g} \underbrace{\mathbf{V}_{\mathrm{B},g}^\mathsf{H} \mathbf{L}_g \mathbf{R}_g^\mathsf{H} \mathbf{U}_{\mathrm{F},g}}_\text{backward-forward} \mathbf{\Sigma}_{\mathrm{F},g} \mathbf{V}_{\mathrm{F},g}^\mathsf{H}}^\text{direct-indirect}.
		\end{equation}

		\begin{remark}
			In \eqref{eq:channel_svd}, the \gls{bd}-\gls{ris} performs a blockwise unitary transformation to combine the backward-forward (intra-group, multiplicative) channels and direct-indirect (inter-group, additive) channels.
			These two attributes are refined as:
			\begin{itemize}
				\item \emph{Branch matching:} It refers to pairing and combining the branches (i.e., entries) of $\mathbf{H}_{\mathrm{B},g}$ and $\mathbf{H}_{\mathrm{F},g}$ through $\mathbf{\Theta}_g$.
				\item \emph{Mode alignment:} It refers to aligning and ordering the modes (i.e., singular vectors) of $\{\mathbf{H}_g\}_{g \in [G]}$ with those of $\mathbf{H}_\mathrm{D}$ through $\{\mathbf{\Theta}_g\}_{g \in [G]}$.
			\end{itemize}
		\end{remark}

		\begin{example}[\gls{siso} channel gain maximization]
			\label{eg:siso}
			Denote the direct, backward, forward channels as $h_\mathrm{D}$, $\mathbf{h}_\mathrm{B} \in \mathbb{C}^{N_\mathrm{S} \times 1}$, and $\mathbf{h}_\mathrm{F}^\mathsf{H} \in \mathbb{C}^{1 \times N_\mathrm{S}}$, respectively.
			In this case, mode alignment boils down to phase matching and any $L \in [N_\mathrm{S}]$, including \gls{d}-\gls{ris}, suffices for perfect mode alignment using
			\begin{equation}
				\mathbf{\Theta}_{\textnormal{P-max},g}^\textnormal{SISO} = \frac{h_\mathrm{D}}{\lvert h_\mathrm{D} \rvert} \mathbf{V}_{\mathrm{B},g} \mathbf{U}_{\mathrm{F},g}^\mathsf{H}, \quad \forall g,
			\end{equation}
			where $\mathbf{V}_{\mathrm{B},g} = \bigl[\mathbf{h}_{\mathrm{B},g}/\lVert \mathbf{h}_{\mathrm{B},g} \rVert, \mathbf{N}_{\mathrm{B},g}\bigr] \in \mathbb{U}^{L \times L}$, $\mathbf{U}_{\mathrm{F},g} = \bigl[\mathbf{h}_{\mathrm{F},g}/\lVert \mathbf{h}_{\mathrm{F},g} \rVert, \mathbf{N}_{\mathrm{F},g}\bigr] \in \mathbb{U}^{L \times L}$, and $\mathbf{N}_{\mathrm{B/F},g} \in \mathbb{C}^{L \times (L-1)}$ are the orthonormal bases of kernels of $\mathbf{h}_{\mathrm{B/F},g}$.
			Evidently, the maximum channel gain is a function of $L$
			\begin{equation}
				\ \lvert h \rvert _{\max} = \lvert h_\mathrm{D} \rvert + \sum_g \sum_l \lvert h_{\mathrm{B},g,\pi_{\mathrm{B},g}(l)} \rvert \lvert h_{\mathrm{F},g,\pi_{\mathrm{F},g}(l)} \rvert,
			\end{equation}
			where $h_{\mathrm{B/F},g,l}$ are the $l$-th entries of $\mathbf{h}_{\mathrm{B/F},g}$, and $\pi_{\mathrm{B/F},g}$ are permutations of $[L]$ sorting their magnitude in similar orders.
			That is, the maximum \gls{siso} channel gain is attained when each \gls{bd}-\gls{ris} group, apart from phase shifting, matches the $l$-th strongest backward and forward channel branches therein.
			A larger $L$ provides more flexible branch matching and thus higher channel gain.
		\end{example}

		Example~\ref{eg:siso} clarifies the difference between branch matching and mode alignment and show their impacts on channel shaping.
		When it comes to \gls{mimo}, the advantage of \gls{bd}-\gls{ris} in branch matching improves since the number of available branches is proportional to $N_\mathrm{T} N_\mathrm{R}$. On the other hand, the limitation of \gls{d}-\gls{ris} in mode alignment worsens since each element can only apply a phase shift to the indirect channel of $N \triangleq \min(N_\mathrm{T}, N_\mathrm{R})$ modes.
	\end{subsection}

	\begin{subsection}{MIMO Interference Channel}
		We also consider a \gls{bd}-\gls{ris} aided \gls{mimo} \gls{ic} of $K$ transceiver pairs where each transmitter and receiver has $N_\mathrm{T}$ and $N_\mathrm{R}$ antennas, respectively, and the \gls{bd}-\gls{ris} has $N_\mathrm{S}$ scattering elements.
		This configuration is denoted as $(N_\mathrm{T} \times N_\mathrm{S} \times N_\mathrm{R})^K$.
		Let $\mathbf{H}_\mathrm{D}^{(kj)} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$, $\mathbf{H}_\mathrm{B}^{(k)} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{S}}$, $\mathbf{H}_\mathrm{F}^{(j)} \in \mathbb{C}^{N_\mathrm{S} \times N_\mathrm{T}}$ denote the direct channel from transmitter $j$ to receiver $k$, the backward channel of receiver $k$, and the forward channel of transmitter $j$, respectively, where $(j,k) \in [K]^2$.
		Assume all transmitter-\gls{ris}-receiver paths share the same \gls{bd}-\gls{ris} scattering matrix $\mathbf{\Theta}$.
		The equivalent channel from transmitter $j$ to receiver $k$ is
		\begin{equation}
			\label{eq:channel_interference}
			\mathbf{H}^{(kj)} = \mathbf{H}_\mathrm{D}^{(kj)} + \mathbf{H}_\mathrm{B}^{(k)} \mathbf{\Theta} \mathbf{H}_\mathrm{F}^{(j)} = \mathbf{H}_\mathrm{D}^{(kj)} + \sum_g \mathbf{H}_{\mathrm{B},g}^{(k)} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}^{(j)},
		\end{equation}
		where $\mathbf{H}_{\mathrm{B},g}^{(k)} \in \mathbb{C}^{N_\mathrm{R} \times L}$ and $\mathbf{H}_{\mathrm{F},g}^{(j)} \in \mathbb{C}^{L \times N_\mathrm{T}}$ are associated with \gls{ris} group $g$, corresponding to the $(g{-}1)L{+}1$ to $gL$ columns of $\mathbf{H}_{\mathrm{B},g}^{(k)}$ and rows of $\mathbf{H}_{\mathrm{F},g}^{(j)}$, respectively,
	\end{subsection}
\end{section}

\begin{section}{Channel Shaping}
	In this section, we first provide an example demonstrating the \gls{mimo} channel shaping advantages of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris}, then derive some analytical bounds related to channel singular values under specific channel conditions, and provide closed-form \gls{bd}-\gls{ris} solution for several cases of interest.
	Finally, we propose a numerical method to optimize the \gls{bd}-\gls{ris} for a special class of singular value function under general channel conditions.

	\begin{example}[$2 \times 2 \times 2$ shaping]
		\label{eg:shaping_potential}
		Here \gls{d}-\gls{ris} and fully-connected \gls{bd}-\gls{ris} can be modeled by 2 and 4 independent angular parameters, respectively:
		\begin{equation*}
			\mathbf{\Theta}_\mathrm{D} = \diag(e^{\jmath \theta_1}, e^{\jmath \theta_2}), \quad
			\mathbf{\Theta}_\mathrm{BD} = e^{\jmath \phi} \begin{bmatrix}
				e^{\jmath \alpha} \cos \psi  & e^{\jmath \beta} \sin \psi   \\
				-e^{-\jmath \beta} \sin \psi & e^{-\jmath \alpha} \cos \psi
			\end{bmatrix},
		\end{equation*}
		We restrict the discussion to a special case where the \gls{bd}-\gls{ris} is symmetric (i.e., $\beta = \pi / 2$) and the direct channel is negligible such that $\phi$ has no impact on $\sv(\mathbf{H})$, since $\sv(e^{\jmath \phi} \mathbf{A}) = \sv(\mathbf{A})$.
		The singular value shaping capabilities of $\mathbf{\Theta}_\mathrm{D}$ and $\mathbf{\Theta}_\mathrm{BD}$ can thus be compared visually over 2 tunable parameters.
		\begin{figure}
			\centering
			\includegraphics[width=\columnwidth]{../assets/simulation/pc_singular_trend.eps}
			\caption{$2 \times 2 \times 2$ singular value shaping by \gls{d}-\gls{ris} and symmetric fully-connected \gls{bd}-\gls{ris} when the direct channel is negligible. $\sigma_1(\mathbf{H})$ and $\sigma_2(\mathbf{H})$ refer to the most and least dominant singular values, respectively.
				Their maximum and minimum are marked explicitly on the plot.}
			\label{fg:shaping_potential}
		\end{figure}
		With an exhaustive grid search over $(\theta_1, \theta_2)$ and $(\alpha, \psi)$, Fig.~\ref{fg:shaping_potential} shows the achievable singular values of a specific channel realization
		\begin{equation*}
			\begin{split}
				\mathbf{H}_\mathrm{B} & =
				\begin{bmatrix}
					-0.2059 + 0.5914 \jmath & -0.0909 + 0.5861 \jmath \\
					0.4131 + 0.2651 \jmath  & -0.1960 + 0.4650 \jmath
				\end{bmatrix},
				\\
				\mathbf{H}_\mathrm{F} & =
				\begin{bmatrix}
					-0.6362 + 0.1332 \jmath & -0.1572 + 1.5538 \jmath \\
					0.0196 + 0.4011 \jmath  & -0.3170 - 0.2303 \jmath
				\end{bmatrix}.
			\end{split}
		\end{equation*}
		In this example, both singular values can be manipulated up to\footnote{The percentage for manipulating $\sigma_n(\mathbf{H})$ is calculated by $\eta_n^+ = \frac{\max \sigma_n(\mathbf{H}) - \mathrm{avg} \sigma_n(\mathbf{H})}{\mathrm{avg} \sigma_n(\mathbf{H})} \times 100\%$ and  $\eta_n^- = \frac{\min \sigma_n(\mathbf{H}) - \mathrm{avg} \sigma_n(\mathbf{H})}{\mathrm{avg} \sigma_n(\mathbf{H})} \times 100\%$.} $\pm 9\%$ by \gls{d}-\gls{ris} and $\pm 42\%$ by symmetric fully-connected \gls{bd}-\gls{ris}.
		It is noteworthy that the former requires 2 circuit components and the latter requires 3.
	\end{example}

	Example~\ref{eg:shaping_potential} suggests that the physical interconnection of \gls{ris} elements, even if using symmetric circuit components, can create a ``cooperation effect'' that significantly enhances the dynamic range of channel singular values.
	This motivates the analytical and numerical channel shaping studies in Section~\ref{sc:shaping_analytical} and \ref{sc:shaping_numerical}, respectively.

	\begin{subsection}{Analytical Shaping Bounds}
		\label{sc:shaping_analytical}
		The main results of this subsection are presented in the following Propositions and Corollaries.
		\begin{proposition}[Degrees of freedom]
			\label{pp:dof}
			\gls{bd}-\gls{ris} may achieve a larger or smaller number of \gls{mimo} \gls{dof}\footnote{\gls{dof} refers to the maximum number of independent streams that can be transmitted in parallel over a \gls{mimo} channel. It is defined as $\mathrm{DoF}(\mathbf{H}) = \lim_{\rho \to \infty} \frac{\log \det(\mathbf{I} + \rho \mathbf{H} \mathbf{H}^\mathsf{H})}{\log \rho}$ where $\rho$ is the \gls{snr}.} than \gls{d}-\gls{ris}.
		\end{proposition}
		\begin{proof}
			Please refer to Appendix~\ref{ap:dof}.
		\end{proof}

		Proposition \ref{pp:dof} suggests that we can expect more parallel streams or less interference when shaping the channel with \gls{bd}-\gls{ris}.
		We now take a step further to examine the limits of redistributing channel singular values under specific channel conditions.

		\begin{proposition}[Rank-deficient channel]
			\label{pp:rd}
			If the minimum rank of backward and forward channels is $k$ ($k \le N$),
			then for \gls{d}-\gls{ris} or \gls{bd}-\gls{ris} of arbitrary number of elements, the $n$-th singular value of the equivalent channel is bounded above and below respectively by
			\begin{subequations}
				\label{iq:sv_rd}
				\begin{align}
					\sigma_n(\mathbf{H}) & \le \sigma_{n-k}(\mathbf{T}), &  & \text{if } n > k, \label{iq:sv_rd_max}          \\
					\sigma_n(\mathbf{H}) & \ge \sigma_n(\mathbf{T}),     &  & \text{if } n < N - k + 1, \label{iq:sv_rd_min}
				\end{align}
			\end{subequations}
			where $\mathbf{T}$ is arbitrary auxiliary matrix satisfying
			\begin{equation}
				\label{eq:auxiliary_rd}
				\mathbf{T} \mathbf{T}^\mathsf{H} =
				\begin{cases}
					\mathbf{H}_\mathrm{D} (\mathbf{I} - \mathbf{V}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}) \mathbf{H}_\mathrm{D}^\mathsf{H}, & \text{if } \rank(\mathbf{H}_\mathrm{F}) = k, \\
					\mathbf{H}_\mathrm{D}^\mathsf{H} (\mathbf{I} - \mathbf{U}_\mathrm{B} \mathbf{U}_\mathrm{B}^\mathsf{H}) \mathbf{H}_\mathrm{D}, & \text{if } \rank(\mathbf{H}_\mathrm{B}) = k,
				\end{cases}
			\end{equation}
			and $\mathbf{V}_\mathrm{F}$ and $\mathbf{U}_\mathrm{B}$ are any right and left singular matrices of $\mathbf{H}_\mathrm{F}$ and $\mathbf{H}_\mathrm{B}$, respectively.
		\end{proposition}
		\begin{proof}
			Please refer to Appendix~\ref{ap:rank_deficient}.
		\end{proof}

		Inequality \eqref{iq:sv_rd_max} states that
		if $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ are at least rank $k$, then
		with a \gls{d}-\gls{ris} or \gls{bd}-\gls{ris} of sufficiently large $N_\mathrm{S}$,
		the $n$-th singular value of $\mathbf{H}$ can be enlarged to the $(n-k)$-th singular value of $\mathbf{T}$, or suppressed to the $n$-th singular value of $\mathbf{T}$.
		Moreover, the first $k$ channel singular values are unbounded above\footnote{The energy conservation law $\sum_{n=1}^N \sigma_n^2(\mathbf{H}) \le 1$ still has to be respected in all cases. This constraint is omitted in context for brevity.} while the last $k$ channel singular values can be suppressed to zero.
		A special case is Corollary \ref{co:los} for \gls{los} channel\footnote{A similar eigenvalue result has been derived for \gls{d}-\gls{ris} only \cite{Semmler2023}.}.


		\begin{corollary}[\gls{los} channel]
			\label{co:los}
			If at least one of backward and forward channels is \gls{los}, then a \gls{d}-\gls{ris} or \gls{bd}-\gls{ris} can at most enlarge the $n$-th ($n \ge 2$) channel singular value to the $(n-1)$-th singular value of $\mathbf{T}$, or suppress the $n$-th channel singular value to the $n$-th singular value of $\mathbf{T}$.
			That is,
			\begin{equation}
				\label{iq:sv_los}
				\sigma_1(\mathbf{H}) \ge \sigma_1(\mathbf{T}) \ge {\sigma_2(\mathbf{H})} \ge \ldots \ge \sigma_{N-1}(\mathbf{T}) \ge {\sigma_N(\mathbf{H})} \ge \sigma_N(\mathbf{T}).
			\end{equation}
		\end{corollary}

		\begin{proof}
			This is a direct result of \eqref{iq:sv_rd} with $k = 1$.
		\end{proof}

		We emphasize that Proposition \ref{pp:rd} and Corollary \ref{co:los} apply to both \gls{d}- and \gls{bd}-\gls{ris} configurations regardless of the status of the direct channel.
		Out of $2N$ bounds in \eqref{iq:sv_rd} or \eqref{iq:sv_los}, $N$ of them can be \emph{simultaneously} tight as $N_\mathrm{S} \to \infty$, namely, when the direct channel becomes negligible\footnote{Negligible direct channel refers to the case where the power of the signal arriving at the receiver through the direct path is negligible compared to that through the scattering of \gls{ris}, i.e., $\mathbf{H} \approx \sum_g \mathbf{H}_g$. This can result from a very large number of \gls{ris} elements (as discussed in Proposition~\ref{pp:rd}) or physical obstacles in the propagation path (as discussed in Proposition~\ref{pp:nd}).}.
		For a finite $N_\mathrm{S}$, the \gls{ris} may prioritize a subset of those by aligning the corresponding modes, and we will later show by simulation that \gls{bd}-\gls{ris} outperforms \gls{d}-\gls{ris} on this purpose.
		Proposition \ref{pp:rd} provides a reference on the selection of $N_\mathrm{S}$ in low-multipath application scenarios.
		Next, we shift the focus to another popular \gls{ris} deployment scenario where the direct channel is blocked.


		\begin{proposition}[Negligible direct channel]
			\label{pp:nd}
			If the direct channel is negligible, then a fully-connected \gls{bd}-\gls{ris} can manipulate the channel singular values up to
			\begin{equation}
				\sv(\mathbf{H}) = \sv(\mathbf{BF}),
			\end{equation}
			where $\mathbf{B}$ and $\mathbf{F}$ are arbitrary matrices with $\sv(\mathbf{B})=\sv(\mathbf{H}_\mathrm{B})$ and $\sv(\mathbf{F})=\sv(\mathbf{H}_\mathrm{F})$.
		\end{proposition}

		\begin{proof}
			Please refer to Appendix~\ref{ap:nd}.
		\end{proof}

		Proposition \ref{pp:nd} says that if the direct channel is negligible and the \gls{bd}-\gls{ris} is fully-connected, the only singular value bounds on the equivalent channel are those on the product of unitary-transformed backward and forward channels.
		It is \emph{not necessarily} an asymptotic result and does \emph{not} depend on any relationship between $N_\mathrm{R}$, $N_\mathrm{S}$, and $N_\mathrm{T}$.
		Its importance lies in the fact that our initial channel shaping question can be recast as a linear algebra question: \emph{How the singular values of matrix product are bounded by the singular values of its individual factors?}
		The question is partially answered in Corollaries \ref{co:nd_sv_prod_subset}--\ref{co:nd_sv_indl} over definition\footnote{This is equivalent to padding zero blocks at the end of $\mathbf{H}, \mathbf{H}_\mathrm{B}, \mathbf{H}_\mathrm{F}$ to make square matrices of dimension $\bar{N}$.} $\bar{N} = \max(N_\mathrm{T},N_\mathrm{S},N_\mathrm{R})$ and $\sigma_n(\mathbf{H})=\sigma_n(\mathbf{H}_\mathrm{F})=\sigma_n(\mathbf{H}_\mathrm{B})=0, \ \forall n \in [\bar{N}] \setminus [N]$.
		The results are by no means complete and interested readers are referred to \cite[Chapter 16, 24]{Hogben2013} and \cite[Chapter 3]{Horn1994} for more information.


		\begin{corollary}[Product of subset of singular values]
			\label{co:nd_sv_prod_subset}
			If the direct channel is negligible,
			then the product of subset of singular values of $\mathbf{H}$ is bounded from above by those of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$, that is,
			\begin{equation}
				\label{iq:horn}
				\prod_{k \in {K}} \sigma_k(\mathbf{H}) \le \prod_{i \in {I}} \sigma_i(\mathbf{H}_\mathrm{B}) \prod_{j \in {J}} \sigma_j(\mathbf{H}_\mathrm{F}),
			\end{equation}
			for all admissible triples $(I, J, K) \in T_r^{\bar{N}}$ with $r < \bar{N}$, where
			\begin{equation*}
				\begin{split}
					T_r^{\bar{N}} \triangleq \Bigl\{(I, J, K) \in U_r^{\bar{N}} \bigm\vert & \forall p < r, \ \forall (F, G, H) \in T_p^r,                                              \\
																							& \sum_{f \in F} i_f + \sum_{g \in G} j_g \le \sum_{h \in H} k_h + \frac{p(p+1)}{2} \Bigr\},
				\end{split}
			\end{equation*}
			\begin{equation*}
				U_r^{\bar{N}} \triangleq \Bigl\{(I, J, K) \subseteq [\bar{N}]^3 \bigm\vert \sum_{i \in I} i + \sum_{j \in J} j = \sum_{k \in K} k + \frac{r(r+1)}{2}\Bigr\}.
			\end{equation*}
		\end{corollary}

		\begin{proof}
			Please refer to \cite[Theorem~8]{Fulton2000}.
		\end{proof}

		Inequality \eqref{iq:horn}, also recognized as a variation of Horn's inequality \cite{Bhatia2001}, is one of the most comprehensive result over Proposition \ref{pp:nd}.
		However, the number of admissible triples increases exponentially\footnote{For example, the number of inequalities described by \eqref{iq:horn} grows from 12 to 2062 when $N_\mathrm{S}$ increases from 3 to 7.} with $N_\mathrm{S}$ despite some resulting bounds can be redundant.
		We will shortly see \eqref{iq:horn} can also induce lower bounds on channel singular values.
		Those facts render the shaping limit analysis non-trivial for large-scale \gls{ris}-aided \gls{mimo} systems.
		Below we showcase some useful bounds therein.

		\begin{corollary}[Product of some largest or smallest singular values]
			\label{co:nd_sv_prod_tail}
			If the direct channel is negligible,
			then the product of the first (resp. last\footnote{The lower bounds coincide at zero when $N \ne N$ (i.e., $N_\mathrm{T} = N_\mathrm{S} = N_\mathrm{R}$ being false).}) $k$ singular values of $\mathbf{H}$ is bounded from above (resp. below) by those of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$, that is,
			\begin{subequations}
				\begin{align}
					\prod_{n=1}^k \sigma_n(\mathbf{H})                   & \le \prod_{n=1}^k \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}), \label{iq:sv_nd_prod_largest}                    \\
					\prod_{n=\bar{N}}^{\mathclap{\bar{N}-k+1}} \sigma_n(\mathbf{H}) & \ge \prod_{n=\bar{N}}^{\mathclap{\bar{N}-k+1}} \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}). \label{iq:sv_nd_prod_smallest}
				\end{align}
			\end{subequations}
		\end{corollary}

		\begin{proof}
			Please refer to Appendix~\ref{ap:nd_sv_prod_tail}.
		\end{proof}

		\begin{corollary}[Individual singular value]
			\label{co:nd_sv_indl}
			If the direct channel is negligible,
			then the $n$-th channel singular value can be manipulated up to
			\begin{equation}
				\label{iq:sv_nd_indl}
				\max_{\mathclap{i+j=n+N_\mathrm{S}}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) \le \sigma_n(\mathbf{H}) \le \min_{\mathclap{i+j=n+1}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}),
			\end{equation}
			where $(i, j) \in [N_\mathrm{S}]^2$.
			The upper and lower bounds are attained respectively at
			\begin{subequations}
				\label{eq:ris_nd_sv_indl}
				\begin{align}
					\mathbf{\Theta}_{\textnormal{sv-}n\textnormal{-max}}^\textnormal{MIMO-ND} & = \mathbf{V}_\mathrm{B} \mathbf{P} \mathbf{U}_\mathrm{F}^\mathsf{H}, \label{eq:ris_nd_sv_indl_max} \\
					\mathbf{\Theta}_{\textnormal{sv-}n\textnormal{-min}}^\textnormal{MIMO-ND} & = \mathbf{V}_\mathrm{B} \mathbf{Q} \mathbf{U}_\mathrm{F}^\mathsf{H}, \label{eq:ris_nd_sv_indl_min}
				\end{align}
			\end{subequations}
			where $\mathbf{V}_\mathrm{B}, \mathbf{U}_\mathrm{F} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$ are any right and left singular matrices\footnote{
				\label{fn:svd_non_uniqueness}
				We highlight the non-uniqueness of $\mathbf{V}_\mathrm{B}$ and $\mathbf{U}_\mathrm{F}$. When a singular value has multiplicity $k$, the corresponding singular vectors can be any orthonormal basis of the $k$-dimensional subspace. Even if all singular values are distinct, the singular vectors of each can be scaled by a phase factor of choice.} of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$, respectively,
			and $\mathbf{P}$ and $\mathbf{Q}$ are arbitrary permutation matrices of dimension $N_\mathrm{S}$ satisfying:
			\begin{itemize}
				\item The $(i, j)$-th entry is $1$, where
					\begin{subnumcases}{(i, j) =}
						\ \underset{\mathclap{i+j=n+1}}{\arg\min} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) & for $\mathbf{P}$, \label{eq:idx_nd_sv_indl_max} \\
						\ \underset{\mathclap{i+j=n+N_\mathrm{S}}}{\arg\max} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) & for $\mathbf{Q}$, \label{eq:idx_nd_sv_indl_min}
					\end{subnumcases}
					and ties may be broken arbitrarily;
				\item After deleting the $i$-th row and $j$-th column, the resulting submatrix $\mathbf{Y}$ is arbitrary permutation matrix of dimension $N_\mathrm{S}-1$ satisfying
					\begin{subequations}
						\begin{alignat}{2}
							\sigma_{n{-}1}(\hat{\mathbf{\Sigma}}_{\mathrm{B}} \mathbf{Y} \hat{\mathbf{\Sigma}}_{\mathrm{F}}) & {\ge} \ \ \min_{\mathclap{i+j=n+1}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F})            &  & \text{ for } \mathbf{P}, \label{eq:perm_nd_sv_indl_max} \\
							\sigma_{n{+}1}(\hat{\mathbf{\Sigma}}_{\mathrm{B}} \mathbf{Y} \hat{\mathbf{\Sigma}}_{\mathrm{F}}) & {\le} \ \ \max_{\mathclap{i+j=n+N_\mathrm{S}}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) &  & \text{ for } \mathbf{Q}, \label{eq:perm_nd_sv_indl_min}
						\end{alignat}
					\end{subequations}
					where $\hat{\mathbf{\Sigma}}_{\mathrm{B}}$ and $\hat{\mathbf{\Sigma}}_{\mathrm{F}}$ are diagonal singular value matrices of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ with both $i$-th row and $j$-th column deleted, respectively.
			\end{itemize}
		\end{corollary}

		\begin{proof}
			Please refer to Appendix~\ref{ap:nd_sv_indl}.
		\end{proof}

		Corollary \ref{co:nd_sv_indl} and Proposition \ref{pp:rd} both reveal the shaping limits of individual channel singular values.
		They are derived under different assumptions are not special cases of each other.
		Importantly, Corollary \ref{co:nd_sv_indl} establishes upper and lower bounds for \emph{each} channel singular value (c.f. first and last few in Proposition \ref{pp:rd}), applies to fully-connected \gls{bd}-\gls{ris} of arbitrary size, and provides a general solution structure.
		We emphasize that in \eqref{eq:ris_nd_sv_indl} the mode alignment is realized by $\mathbf{V}_\mathrm{B}$ and $\mathbf{U}_\mathrm{F}$ while the ordering is enabled by permutation matrices $\mathbf{P}$ and $\mathbf{Q}$, which are special cases of unitary $\mathbf{X}$ defined in \eqref{eq:ris_decompose}.
		Specially, the extreme channel singular values can be manipulated up to
		\begin{subequations}
			\label{iq:sv_nd_extreme}
			\begin{gather}
				\max_{\mathclap{i+j=N_\mathrm{S}+1}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) {\le} \sigma_1(\mathbf{H}) {\le} \sigma_1(\mathbf{H}_\mathrm{B}) \sigma_1(\mathbf{H}_\mathrm{F}), \label{iq:sv_nd_largest} \\
				\min_{\mathclap{i+j=\bar{N}+1}} \ \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) {\ge} \sigma_{\bar{N}}(\mathbf{H}) {\ge} \sigma_{\bar{N}}(\mathbf{H}_\mathrm{B}) \sigma_{\bar{N}}(\mathbf{H}_\mathrm{F}). \label{iq:sv_nd_smallest}
			\end{gather}
		\end{subequations}
		We notice that the right halves in \eqref{iq:sv_nd_largest} and \eqref{iq:sv_nd_smallest} are special cases of \eqref{iq:sv_nd_prod_largest} and \eqref{iq:sv_nd_prod_smallest} when $k=1$.

		\begin{example}[Bounds on $3 \times 3 \times 3$ shaping]
			\label{eg:shaping_bounds}
			Consider a $3 \times 3 \times 3$ setup with $\mathbf{H}_\mathrm{D} = \mathbf{0}$, $\mathbf{H}_\mathrm{B} = \diag(3, 2, 1)$, and $\mathbf{H}_\mathrm{F} = \diag(4, 0, 5)$.
			\begin{itemize}
				\item \gls{d}-\gls{ris}: It is evident that any \gls{d}-\gls{ris} can only achieve $\sv(\mathbf{H}) = [12, 5, 0]^\mathsf{T}$ due to limited branch matching and mode alignment capability.
				\item \gls{bd}-\gls{ris}: According to \eqref{iq:sv_nd_indl}, a fully-connected \gls{bd}-\gls{ris} can manipulate the singular values up to
					\begin{equation*}
						8 \le \sigma_1(\mathbf{H}) \le 15, \quad 4 \le \sigma_2(\mathbf{H}) \le 10, \quad 0 \le \sigma_3(\mathbf{H}) \le 0.
					\end{equation*}
					To attain the upper and lower bounds, $(i,j)$ in \eqref{eq:ris_nd_sv_indl_max} and \eqref{eq:ris_nd_sv_indl_min} takes $(1, 1)$ and $(2, 2)$ when $n=1$, and $(2, 1)$ and $(3, 2)$ when $n=2$, respectively.
			\end{itemize}
		\end{example}

		We conclude from Example \ref{eg:shaping_bounds} that a fully-connected \gls{bd}-\gls{ris} can widen the dynamic range of channel singular values by properly aligning and ordering the modes of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$.
		However, when the problem of interest is a function of multiple singular values, their individual bounds \eqref{iq:sv_nd_indl} may not be simultaneously tight.
		Some case studies are presented below.

		\begin{corollary}[Channel power gain]
			\label{co:nd_power}
			If the direct channel is negligible, then the channel power gain is bounded from above (resp. below) by the inner product of squared singular values of $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ when they are sorted similarly (resp. oppositely), that is,
			\begin{equation}
				\label{iq:power_nd}
				\sum_{n=1}^N \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_{N_\mathrm{S}-n+1}^2(\mathbf{H}_\mathrm{F}) \le \lVert \mathbf{H} \rVert _\mathrm{F}^2 \le \sum_{n=1}^N \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F}),
			\end{equation}
			whose\footnote{As a side note, we notice \cite{Fang1994} discussed a similar bound using extreme singular values $\max\bigl(\sigma_{N}(\mathbf{H}_\mathrm{B}) \lVert \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2, \sigma_{N}(\mathbf{H}_\mathrm{F}) \lVert \mathbf{H}_\mathrm{B} \rVert _\mathrm{F}^2\bigr) \le \lVert \mathbf{H} \rVert _\mathrm{F}^2 \le \min\bigl(\sigma_1(\mathbf{H}_\mathrm{B}) \lVert \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2, \sigma_1(\mathbf{H}_\mathrm{F}) \lVert \mathbf{H}_\mathrm{B} \rVert _\mathrm{F}^2\bigr)$. This is a looser version of \eqref{iq:power_nd} and cannot take equalities unless the extreme singular values are of multiplicity $N$.} upper and lower bounds are attained respectively at
			\begin{subequations}
				\begin{align}
					\mathbf{\Theta}_\textnormal{P-max}^\textnormal{MIMO-ND} & = \mathbf{V}_\mathrm{B} \mathbf{U}_\mathrm{F}^\mathsf{H}, \label{eq:ris_nd_power_max}            \\
					\mathbf{\Theta}_\textnormal{P-min}^\textnormal{MIMO-ND} & = \mathbf{V}_\mathrm{B} \mathbf{J} \mathbf{U}_\mathrm{F}^\mathsf{H} \label{eq:ris_nd_power_min},
				\end{align}
			\end{subequations}
			where $\mathbf{J}$ is the exchange (a.k.a. backward identity) matrix of dimension $N_\mathrm{S}$.
		\end{corollary}
		\begin{proof}
			Please refer to Appendix~\ref{ap:nd_power}.
		\end{proof}

		We notice that \eqref{eq:ris_nd_power_max} and \eqref{eq:ris_nd_power_min} are special cases of \eqref{eq:ris_nd_sv_indl_max} and \eqref{eq:ris_nd_sv_indl_min} with $\mathbf{P} = \mathbf{I}$ and $\mathbf{Q} = \mathbf{J}$, which also attain the right and left halves of \eqref{iq:sv_nd_extreme}, respectively.
		% TODO relay
		As a side note, when both $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ follow Rayleigh fading, the expectation of maximum channel power gain can be numerically evaluated as
		\begin{equation}
			\label{eq:power_nd_rayleigh}
			\begin{split}
				\mathbb{E}\bigl\{ \lVert \mathbf{H} \rVert _ \mathrm{F}^2 \bigr\} = \sum_{n=1}^N
				& \int_0^\infty x f_{\lambda_n^{\min(N_\mathrm{R},N_\mathrm{S})}}(x) d x         \\
				& \times \int_0^\infty y f_{\lambda_n^{\min(N_\mathrm{S},N_\mathrm{T})}}(y) d y,
			\end{split}
		\end{equation}
		where $\lambda_n^{K}$ is the $n$-th eigenvalue of the complex $K \times K$ Wishart matrix with probability density function $f_{\lambda_n^{K}}(\cdot)$ given by \cite[(51)]{Zanella2009}.
		\eqref{eq:power_nd_rayleigh} generalizes the \gls{siso} channel power gain aided by \gls{bd}-\gls{ris} \cite[(58)]{Shen2020a} to \gls{mimo} under double Rayleigh fading, but a closed-form expression seems nontrivial.
		The next corollary has been derived in \cite{Bartoli2023} independently from Proposition \ref{pp:nd} and we include it here for completeness of results.
		\begin{corollary}[Channel capacity at general \gls{snr}]
			\label{co:nd_capacity_snr_general}
			If the direct channel is negligible, then the \gls{bd}-\gls{ris} aided \gls{mimo} channel capacity is
			\begin{equation}
				\label{eq:capacity_nd}
				C^\textnormal{MIMO-ND} = \sum_{n=1}^N \log \left(1 + \frac{s_n \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F})}{\eta}\right),
			\end{equation}
			where $\eta$ is the average noise power, $s_n = \mu - \frac{\eta}{\sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F})}$ is the power allocated to the $n$-th mode obtainable by the water-filling algorithm \cite{Clerckx2013}.
			The capacity-achieving \gls{bd}-\gls{ris} scattering matrix is
			\begin{equation}
				\label{eq:ris_nd_rate_max}
				\mathbf{\Theta}_\textnormal{R-max}^\textnormal{MIMO-ND} = \mathbf{V}_\mathrm{B} \mathbf{U}_\mathrm{F}^\mathsf{H}.
			\end{equation}
		\end{corollary}

		\begin{proof}
			Please refer to \cite[Appendix~A]{Bartoli2023}.
		\end{proof}

		Corollary \ref{co:nd_capacity_snr_general} also suggests that the power- and rate-optimal scattering matrices \eqref{eq:ris_nd_power_max} and \eqref{eq:ris_nd_rate_max} coincide with each other when the direct channel is negligible and the \gls{bd}-\gls{ris} is fully-connected.
		When either condition is not satisfied, active and passive beamforming are coupled and the rate-optimal solution involves alternating optimization.
		However, the power-optimal \gls{ris} still provides for a low-complexity decoupled solution.
		The details will be discussed in Section~\ref{sc:rate_pc}.

		\begin{corollary}[Channel capacity at extreme \gls{snr}]
			\label{co:nd_capacity_snr_extreme}
			If the direct channel is negligible, then the channel capacity when the \gls{snr} $\rho$ is very low and high are approximately bounded from above by
			\begin{subequations}
				\label{iq:capacity_nd_snr_extreme}
				\begin{align}
					C_{\rho_\downarrow} & \lessapprox \sigma_1^2(\mathbf{H}_\mathrm{B}) \sigma_1^2(\mathbf{H}_\mathrm{F}), \label{iq:capacity_nd_snr_low}                                           \\
					C_{\rho_\uparrow}   & \lessapprox N \log \frac{\rho}{N} + 2 \log \prod_{n=1}^N \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}). \label{iq:capacity_nd_snr_high}
				\end{align}
			\end{subequations}
		\end{corollary}

		\begin{proof}
			Please refer to Appendix~\ref{ap:nd_capacity}.
		\end{proof}

		The ergodic counterparts of \eqref{eq:capacity_nd} and \eqref{iq:capacity_nd_snr_extreme} when both $\mathbf{H}_\mathrm{B}$ and $\mathbf{H}_\mathrm{F}$ follow Rayleigh fading can be evaluated similarly to \eqref{eq:power_nd_rayleigh}.
		Proposition \ref{pp:dof}--\ref{pp:nd} and the resulting Corollaries provide a partial answer to the channel shaping question in terms of singular values and their functions.
		Extending the analysis to more general cases (e.g., non-negligible direct channel and arbitrary \gls{bd}-\gls{ris} group size) is non-trivial due to limited branch matching and mode alignment capabilities therein.
		A numerical solution will be discussed in Section~\ref{sc:shaping_numerical}.
	\end{subsection}

	\begin{subsection}{Numerical Shaping Solution}
		\label{sc:shaping_numerical}
		Consider a special class of channel shaping problem
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{f\bigl(\sv(\mathbf{H})\bigr)}{\label{op:shaping}}{\label{ob:shaping}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I},}{\quad \forall g,}{\label{cn:shaping_unitary}}
		\end{maxi!}
		where $f: \mathbb{R}^{N} \to \mathbb{R}$ is a symmetric gauge function (i.e., a norm invariant under sign change and argument permutation) \cite{Watson1992}.
		Examples of such $f$ include the Ky Fan $k$ norm, Schatten $p$ norm, $n$-th singular value, and channel power gain.
		Problem \eqref{op:shaping} is non-convex due to the unitary constraints \eqref{cn:shaping_unitary}.
		\begin{proposition}
			\label{pp:shaping}
			The sub-differential of \eqref{ob:shaping} with respect to \gls{bd}-\gls{ris} block $g$ is
			\begin{equation}
				\label{eq:shaping_subdiff}
				\partial_{\mathbf{\Theta}_g^*} f\bigl(\sv(\mathbf{H})\bigr) = \conv \bigl\{ \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{U} \mathbf{D} \mathbf{V}^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^\mathsf{H} \bigr\},
			\end{equation}
			where $\mathbf{D} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$ is a rectangular diagonal matrix with $[\mathbf{D}]_{n,n} \in \partial_{\sigma_n(\mathbf{H})} f\bigl(\sv(\mathbf{H})\bigr)$, $\forall n \in [N]$, and $\mathbf{U}$, $\mathbf{V}$ are any left and right singular matrices of $\mathbf{H}$.
		\end{proposition}

		\begin{proof}
			Please refer to Appendix~\ref{ap:shaping}.
		\end{proof}

		With Proposition \ref{pp:shaping}, one can apply the \emph{relax-then-project} method \cite{Shen2020a,Fang2023} or \emph{non-geodesic\footnote{A geodesic is a curve representing the shortest path between two points in a Riemannian manifold, whose tangent vectors remain parallel when transporting along the curve.} \gls{rcg}} \cite{Li2023b,Li2023c,Zhou2023} to solve Problem \eqref{op:shaping}.
		The former solves unconstrained problem \eqref{ob:shaping} by quasi-Newton methods and projects the solution back to domain \eqref{cn:shaping_unitary} without guarantee of optimality.
		The latter generalizes the conjugate gradient methods to Riemannian manifolds and updates the solution by addition and retraction, which constitutes a zigzag path departing from and returning to the manifold.
		Next, we introduce a group-wise \emph{geodesic \gls{rcg}} method modified from \cite{Abrudan2008,Abrudan2009} that performs multiplicative updates along the geodesics on the Stiefel manifold for faster convergence.
		It is applicable to a wide range of \gls{bd}-\gls{ris} design problems where the objective $f$ is smooth or convex non-smooth\footnote{$f$ is not necessarily the symmetric gauge function \eqref{ob:shaping}.} and the only constraint is group-wise unitarity \eqref{cn:shaping_unitary}.
		The steps for updating $\mathbf{\Theta}_g$ at iteration $r$ are summarized below:
		\begin{enumerate}
			\item \emph{Compute the Euclidean (sub-)gradient at $\mathbf{\Theta}_g^{(r)}$:} The (sub-)gradient of $f$ with respect to $\mathbf{\Theta}_g$ in the Euclidean space is
			% \cite[(A.3.6)]{Fischer2005}
				\begin{equation}
					\label{eq:gradient_eucl}
					\nabla_{\mathrm{E},g}^{(r)} = 2 \frac{\partial f(\mathbf{\Theta}_g^{(r)})}{\partial \mathbf{\Theta}_g^*};
				\end{equation}
			\item \emph{Translate to the Riemannian (sub-)gradient at $\mathbf{\Theta}_g^{(r)}$:} At point $\mathbf{\Theta}_g^{(r)}$, the Riemannian (sub-)gradient gives the steepest ascent direction on the manifold. It lies in the tangent space of the manifold $\mathcal{T}_{\mathbf{\Theta}_g^{(r)}}\mathbb{U}^{L \times L} \triangleq \{\mathbf{M} \in \mathbb{C}^{L \times L} \mid \mathbf{M}^\mathsf{H} \mathbf{\Theta}_g^{(r)} + {\mathbf{\Theta}_g^{(r)\mathsf{H}}} \mathbf{M} = \mathbf{0}\}$ and is obtainable by projection:
				\begin{equation}
					\label{eq:gradient_riem}
					\nabla_{\mathrm{R},g}^{(r)} = \nabla_{\mathrm{E},g}^{(r)} - \mathbf{\Theta}_g^{(r)} {\nabla_{\mathrm{E},g}^{(r)\mathsf{H}}} \mathbf{\Theta}_g^{(r)};
				\end{equation}
			\item \emph{Translate to the Riemannian (sub-)gradient at the identity:} The Riemannian (sub-)gradient should be translated back to the identity for exploiting the Lie algebra\footnote{Lie algebra refers to the tangent space of the Lie group at the identity element. A Lie group is simultaneously a continuous group and a differentiable manifold. In this example, $\mathbb{U}^{L \times L}$ formulates a Lie group and the corresponding Lie algebra consists of skew-Hermitian matrices $\mathfrak{u}(L) \triangleq \mathcal{T}_{\mathbf{I}}\mathbb{U}^{L \times L} = \{\mathbf{M} \in \mathbb{C}^{L \times L} \mid \mathbf{M}^\mathsf{H} + \mathbf{M} = \mathbf{0}\}$.}:
				\begin{equation}
					\label{eq:gradient_riem_tran}
					\tilde{\nabla}_{\mathrm{R},g}^{(r)} = \nabla_{\mathrm{R},g}^{(r)} \mathbf{\Theta}_g^{(r)\mathsf{H}} = \nabla_{\mathrm{E},g}^{(r)} \mathbf{\Theta}_g^{(r)\mathsf{H}} - \mathbf{\Theta}_g^{(r)} {\nabla_{\mathrm{E},g}^{(r)\mathsf{H}}}.
					% $\mathcal{O}(2 L^3)$
				\end{equation}
			\item \emph{Determine the conjugate direction:} The conjugate direction is obtained over the Riemannian (sub-)gradient and previous direction as
				\begin{equation}
					\label{eq:conjugate_dirn_geod}
					{\mathbf{D}}_g^{(r)} = \tilde{\nabla}_{\mathrm{R},g}^{(r)} + {\gamma}_g^{(r)} {\mathbf{D}}_g^{(r-1)},
				\end{equation}
				where $\gamma_g^{(r)}$ is the parameter that deviates the conjugate direction from the tangent space for accelerated convergence. A popular choice is the Polak-Ribi\`{e}re formula \cite{Hager2006}
				\begin{equation}
					\label{eq:conjugate_parm_geod}
					{\gamma}_g^{(r)} = \frac{\tr\bigl((\tilde{\nabla}_{\mathrm{R},g}^{(r)} - \tilde{\nabla}_{\mathrm{R},g}^{(r-1)}) {\tilde{\nabla}_{\mathrm{R},g}^{(r)\mathsf{H}}}\bigr)}{\tr\bigl(\tilde{\nabla}_{\mathrm{R},g}^{(r-1)} {\tilde{\nabla}_{\mathrm{R},g}^{(r-1)\mathsf{H}}}\bigr)}. % $\mathcal{O}(2 N_\mathrm{S}^3 + N_\mathrm{S}^2 + 2 N_\mathrm{S})$
				\end{equation}
			\item \emph{Evaluate the geodesic at the identity:} The geodesic emanating from the identity with velocity $\mathbf{D} \in \mathfrak{u}(L)$ is described by
				\begin{equation}
					\label{eq:geodesic_iden}
					\mathbf{G}_\mathbf{I}(\mu) = \exp(\mu \mathbf{D}),
				\end{equation}
				where $\exp(\mathbf{A}) = \sum_{k=0}^\infty (\mathbf{A}^k/k!)$ is the matrix exponential and $\mu$ is the step size (i.e., magnitude of the tangent vector).
			\item \emph{Translate to the geodesic at $\mathbf{\Theta}_g^{(r)}$:} The geodesic emanating from $\mathbf{\Theta}_g^{(r)}$ terminates at $\mathbf{\Theta}_g^{(r+1)}$ by multiplicative updates
				\begin{equation}
					\label{eq:geodesic_tran}
					\mathbf{\Theta}_g^{(r+1)} = \mathbf{G}_{\mathbf{\Theta}_g^{(r)}}(\mu) = \mathbf{G}_\mathbf{I}(\mu) \mathbf{\Theta}_g^{(r)} = \exp(\mu \mathbf{D}_g^{(r)}) \mathbf{\Theta}_g^{(r)},
				\end{equation}
				where $\mu$ is the step size refinable\footnote{To double the step size, one can simply square the rotation matrix instead of recomputing the matrix exponential, that is, $\exp^2(\mu \mathbf{D}_g^{(r)}) = \exp(2 \mu \mathbf{D}_g^{(r)})$.} by the Armijo rule \cite{Armijo1966}.
		\end{enumerate}

		\begin{algorithm}[!t]
			\caption{Group-wise geodesic \gls{rcg}}
			\label{ag:rcg}
			\begin{algorithmic}[1]
				\Require $f(\mathbf{\Theta})$, $G$
				\Ensure $\mathbf{\Theta}^\star$
				\Initialize {$r \gets 0$, $\mathbf{\Theta}^{(0)}$}
				\Repeat
				\For {$g \gets 1$ to $G$}
				\State $\nabla_{\mathrm{E},g}^{(r)} \gets$ \eqref{eq:gradient_eucl}, $\tilde{\nabla}_{\mathrm{R},g}^{(r)} \gets$ \eqref{eq:gradient_riem_tran}
				\State $\tilde{\gamma}_g^{(r)} \gets$ \eqref{eq:conjugate_parm_geod}, $\mathbf{D}_g^{(r)} \gets$ \eqref{eq:conjugate_dirn_geod}
				\If {$\Re\bigl\{\tr({\mathbf{D}_g^{(r)\mathsf{H}}} \tilde{\nabla}_{\mathrm{R},g}^{(r)})\bigr\} < 0$} \Comment{Not ascent}
				\State $\mathbf{D}_g^{(r)} \gets \tilde{\nabla}_{\mathrm{R},g}^{(r)}$
				\EndIf
				\State $\mu \gets 0.1$
				\State $\mathbf{G}_{\mathbf{\Theta}_g^{(r)}}(\mu) \gets$ \eqref{eq:geodesic_tran}
				\While {$ f\bigl(\mathbf{G}_{\mathbf{\Theta}_g^{(r)}}(2\mu)\bigr) - f(\mathbf{\Theta}_g^{(r)}) \ge \mu \cdot \frac{\tr(\mathbf{D}_g^{(r)} {\mathbf{D}_g^{(r)\mathsf{H}}})}{2}$}\label{ln:armijo_start}
				\State $\mu \gets 2 \mu$
				\EndWhile
				\While {$f\bigl(\mathbf{G}_{\mathbf{\Theta}_g^{(r)}}(\mu)\bigr) - f(\mathbf{\Theta}_g^{(r)}) < \frac{\mu}{2} \cdot \frac{\tr(\mathbf{D}_g^{(r)} {\mathbf{D}_g^{(r)\mathsf{H}}})}{2}$}
				\State $\mu \gets \mu / 2$
				\EndWhile \label{ln:armijo_end}
				\State $\mathbf{\Theta}_g^{(r+1)} \gets$ \eqref{eq:geodesic_tran}
				\EndFor
				\State $r \gets r+1$
				\Until $\lvert f(\mathbf{\Theta}^{(r)}) - f(\mathbf{\Theta}^{(r-1)}) \rvert / f(\mathbf{\Theta}^{(r-1)}) \le \epsilon$
			\end{algorithmic}
		\end{algorithm}

		Algorithm~\ref{ag:rcg} summarizes the introduced group-wise geodesic \gls{rcg} method.
		Compared to the non-geodesic approach, it leverages Lie algebra to replace the add-then-retract update with a multiplicative update \eqref{eq:geodesic_tran} along the geodesics of the Stiefel manifold.
		This appropriate parameter space leads to faster convergence and easier step size tuning.
		Convergence to a local optimum is still guaranteed if not initialized at a stationary point.
		The group-wise updates can be performed in parallel to facilitate large-scale \gls{bd}-\gls{ris} design problems.
		One can also directly operate on $\mathbf{\Theta}$ and pinching (i.e., keeping the main block diagonal and nulling others) relevant expressions to accelerate the algorithm for a large $G$.

		We now analyze the computational complexity of solving singular value shaping problem \eqref{op:shaping} by Algorithm~\ref{ag:rcg}.
		To update each \gls{bd}-\gls{ris} group, \gls{svd} of $\mathbf{H}$ requires $\mathcal{O}(N N_\mathrm{T} N_\mathrm{R})$, Euclidean sub-gradient \eqref{eq:shaping_subdiff} requires $\mathcal{O}\bigl(L N (N_\mathrm{T}+N_\mathrm{R}+L) \bigr)$, Riemannian sub-gradient translation \eqref{eq:gradient_riem_tran} requires $\mathcal{O}(L^3)$, deviation parameter \eqref{eq:conjugate_parm_geod} and conjugate direction \eqref{eq:conjugate_dirn_geod} together require $\mathcal{O}(L^2)$, and matrix exponential \eqref{eq:geodesic_tran} requires $\mathcal{O}(L^3)$ operations \cite{Moler2003}.
		The overall complexity is thus $\mathcal{O}\bigl(I_\text{RCG} G \bigl(N N_\mathrm{T} N_\mathrm{R} + L N (N_\mathrm{T}+N_\mathrm{R}+L) + I_\text{BLS} L^3\bigr)\bigr)$, where $I_\text{RCG}$ and $I_\text{BLS}$ are the number of iterations for geodesic \gls{rcg} and backtracking line search (i.e., line \ref{ln:armijo_start}--\ref{ln:armijo_end} of Algorithm \ref{ag:rcg}), respectively.
		That is, $\mathcal{O}_\mathrm{D}\bigl(N_\mathrm{S}\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(N_\mathrm{S}^3\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
		% That is, $\mathcal{O}_\mathrm{D}\bigl(I_\text{RCG} N_\mathrm{S} \bigl(N N_\mathrm{T} N_\mathrm{R} + N (N_\mathrm{T}+N_\mathrm{R}) + I_\text{BLS}\bigr)\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(I_\text{RCG} \bigl(N N_\mathrm{T} N_\mathrm{R} + N_\mathrm{S} N (N_\mathrm{T}+N_\mathrm{R}+N_\mathrm{S}) + I_\text{BLS} N_\mathrm{S}^3\bigr)\bigr)$ for fully-connected \gls{bd}-\gls{ris}.

		To validate Algorithm~\ref{ag:rcg} and quantify the shaping capability of \gls{bd}-\gls{ris}, we characterize the achievable singular value region of \gls{bd}-\gls{ris}-aided \gls{mimo} channel by considering the Pareto optimization problem
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{\sum_{n=1}^N \rho_n \sigma_n(\mathbf{H})}{\label{op:pareto}}{\label{ob:pareto}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I},}{\quad \forall g,}{\label{cn:pareto_unitary}}
		\end{maxi!}
		where $\rho_n \ge 0$ is the weight associated with the $n$-th channel singular value.
		Varying those weights help to characterize the Pareto frontier of singular values that encloses the achievable region.
		While the objective \eqref{ob:pareto} does not suggest any meaningful performance metric (e.g., capacity or power gain), there exists an implicit relation since stronger channel shaping capability translates to better wireless performance.
		Problem \eqref{op:pareto} also generalizes the \gls{dof} problem in Proposition \ref{pp:dof} and the individual singular value shaping problem in Corollary \ref{co:nd_sv_indl} and Proposition \ref{pp:rd}.
		It can be solved optimally by Algorithm~\ref{ag:rcg} with $\mathbf{D}_{[n,n]} = \rho_n$ in \eqref{eq:shaping_subdiff}.
	\end{subsection}
\end{section}


	\begin{section}{Rate Maximization}
		\label{sc:rate}
		In this section, we first solve rate maximization problem for \gls{bd}-\gls{ris}-aided \gls{mimo} point-to-point and interference channels optimally by joint beamforming design, and then exploit channel shaping for a low-complexity two-stage solution.

		\begin{subsection}{MIMO Point-to-Point Channel}
			\label{sc:rate_pc}
			The achievable rate maximization problem for \gls{bd}-\gls{ris}-aided \gls{mimo} point-to-point channel is formulated as
			\begin{maxi!}
				{\scriptstyle{\mathbf{W},\mathbf{\Theta}}}{R = \log \det \biggl(\mathbf{I} + \frac{\mathbf{W}^\mathsf{H}\mathbf{H}^\mathsf{H}\mathbf{H}\mathbf{W}}{\eta}\biggr)}{\label{op:rate}}{\label{ob:rate}}
				\addConstraint{\lVert \mathbf{W} \rVert _\mathrm{F}^2}{\le P}
				\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g}{=\mathbf{I}, \quad \forall g,\label{cn:rate_unitary}}
			\end{maxi!}
			where $\mathbf{W}$ is the transmit precoder, $R$ is the achievable rate, $\eta$ is the average noise power, and $P$ is maximum average transmit power.
			Problem \eqref{op:rate} is non-convex due to the block-unitary constraint \eqref{cn:rate_unitary} and the coupling between variables.
			Two approaches are proposed to solve it optimally or efficiently.
			% We propose a local-optimal approach based on \gls{ao} and a low-complexity approach based on channel shaping.

			\begin{subsubsection}{Alternating Optimization}
				This approach updates $\mathbf{\Theta}$ and $\mathbf{W}$ iteratively until convergence.
				For a given $\mathbf{W}$, the passive beamforming subproblem is
				\begin{maxi!}
					{\scriptstyle{\mathbf{\Theta}}}{\log \det \biggl(\mathbf{I} + \frac{\mathbf{H} \mathbf{Q} \mathbf{H}^\mathsf{H}}{\eta}\biggr)}{\label{op:rate_ris}}{\label{ob:rate_ris}}
					\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
				\end{maxi!}
				where $\mathbf{Q} \triangleq \mathbf{W} \mathbf{W}^\mathsf{H}$ is the transmit covariance matrix.
				Problem \eqref{op:rate_ris} can be solved optimally by Algorithm \ref{ag:rcg} with the partial derivative given in Lemma \ref{lm:rate}.
				\begin{lemma}
					\label{lm:rate}
					The partial derivative of \eqref{ob:rate_ris} with respect to \gls{bd}-\gls{ris} block $g$ is
					\begin{equation}
						\label{eq:gradient_eucl_rate}
						\frac{\partial R}{\partial \mathbf{\Theta}_g^*} = \frac{1}{\eta} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \biggl(\mathbf{I} + \frac{\mathbf{H}\mathbf{Q}\mathbf{H}^\mathsf{H}}{\eta}\biggr)^{-1} \mathbf{H} \mathbf{Q} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}.
					\end{equation}
				\end{lemma}

				\begin{proof}
					Please refer to Appendix~\ref{ap:rate}.
				\end{proof}
				For a given $\mathbf{\Theta}$, the optimal transmit precoder is given by eigenmode transmission \cite{Clerckx2013}
				\begin{equation}
					\label{eq:precoder_rate}
					\mathbf{W}^\star = \mathbf{V} {\diag(\mathbf{s}^\star)}^{1/2},
				\end{equation}
				where $\mathbf{V}$ is the right singular matrix of $\mathbf{H}$ and $\mathbf{s}^\star$ is the optimal water-filling power allocation \cite{Clerckx2013}.
				The \gls{ao} algorithm is guaranteed to converge to local-optimal points of problem \eqref{op:rate} since each subproblem is solved optimally and the objective is bounded above.
				The computational complexity of solving subproblem \eqref{op:rate_ris} by geodesic \gls{rcg} is $\mathcal{O}\bigl(I_\text{RCG} G (NL^2 + L N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} L^3)\bigr)$.
				On the other hand, the complexity of solving active beamforming subproblem by \eqref{eq:precoder_rate} is $\mathcal{O}\bigl(N N_\mathrm{T} N_\mathrm{R}\bigr)$.
				The overall complexity is thus $\mathcal{O}\bigl(I_\text{AO}\bigl(I_\text{RCG} G (NL^2 + L N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} L^3) + N N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$, where $I_\text{AO}$ is the number of iterations for \gls{ao}.
				That is, $\mathcal{O}_\mathrm{D}\bigl(N_\mathrm{S}\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(N_\mathrm{S}^3\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
				% That is, $\mathcal{O}_\mathrm{D}\bigl(I_\text{AO}\bigl(I_\text{RCG} N_\mathrm{S} (N + N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS}) + N N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(I_\text{AO}\bigl(I_\text{RCG} (NN_\mathrm{S}^2 + N_\mathrm{S} N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} N_\mathrm{S}^3) + N N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
			\end{subsubsection}

			\begin{subsubsection}{Low-Complexity Solution}
				\label{sc:rate_pc_lc}
				To reduce the computational complexity, we suboptimally decouple the beamforming design by first shape the channel by \gls{ris} for maximum power gain and then optimize the active beamforming.
				The channel power gain maximization problem is formulated as\footnote{Problem \eqref{op:power} has been studied in \gls{siso} \cite{Shen2020a} and \gls{miso} equivalents \cite{Santamaria2023,Fang2023,Nerini2023,Nerini2023b} where only one mode is available. Generalizing those to \gls{mimo} is non-trivial due to trade-off between modes.}
				\begin{maxi!}
					{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2}{\label{op:power}}{\label{ob:power}}
					\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g.}{\label{cn:power_unitary}}{}
				\end{maxi!}
				Inspired by \cite{Nie2017}, we propose a closed-form iterative solution that converges to a stationary point of Problem \eqref{op:power}.
				The idea is to approximate the quadratic objective \eqref{ob:power} successively by Taylor expansion and solve each subproblem by group-wise \gls{svd}.

				\begin{proposition}
					\label{pp:power}
					Starting from any feasible $\mathbf{\Theta}^{(0)}$, the sequence
					\begin{equation}
						\label{eq:ris_power}
						\mathbf{\Theta}_g^{(r+1)} = \mathbf{U}_g^{(r)} \mathbf{V}_g^{(r)}, \quad \forall g
					\end{equation}
					leads to a convergence of the objective function \eqref{ob:power} towards a stationary point,\footnote{However, \eqref{eq:ris_power} might not converge to a single solution point due to the non-uniqueness of \gls{svd}, especially when $\mathbf{M}_g$ is rank-deficient.}
					% Multiple solutions may yield similar objective function convergence behavior.}
					where $\mathbf{U}_g^{(r)}$ and $\mathbf{V}_g^{(r)}$ are any left and right singular matrices of\footnote{We notice that the orthogonal projection of $\mathbf{M}_g$ onto the Stiefel manifold $\pi(\mathbf{M}_g) = {\arg\min}_{\mathbf{X}_g \in \mathbb{U}^{L \times L}} \lVert \mathbf{M}_g - \mathbf{X}_g \rVert _\mathrm{F} = \mathbf{U}_g \mathbf{V}_g$ coincides with $\mathbf{\Theta}_g$.} % \cite{Manton2002}
					\begin{equation}
						\label{eq:auxiliary_power}
						\mathbf{M}_g^{(r)} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \Bigl(\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \diag\bigl(\mathbf{\Theta}_{[1:g-1]}^{(r+1)},\mathbf{\Theta}_{[g:G]}^{(r)}\bigr) \mathbf{H}_\mathrm{F}\Bigr) \mathbf{H}_{\mathrm{F},g}^\mathsf{H}.
					\end{equation}
				\end{proposition}

				\begin{proof}
					Please refer to Appendix~\ref{ap:power}.
				\end{proof}

				To update each \gls{bd}-\gls{ris} group, matrix multiplication \eqref{eq:auxiliary_power} requires $\mathcal{O}\bigl(N_\mathrm{T} N_\mathrm{R} + NL^2+N_\mathrm{T} N_\mathrm{R} L\bigr)$ operations and its \gls{svd} requires $\mathcal{O}(L^3)$ operations.
				The overall complexity is thus $\mathcal{O}\bigl(I_\text{SAA} G \bigl(N_\mathrm{T} N_\mathrm{R} + NL^2+N_\mathrm{T} N_\mathrm{R} L + L^3\bigr)\bigr)$, where $I_\text{SAA}$ is the number iterations for successive affine approximation.
				That is, $\mathcal{O}_\mathrm{D}\bigl(N_\mathrm{S}\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(N_\mathrm{S}^3\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
				% That is, $\mathcal{O}_\mathrm{D}\bigl(I_\text{SAA} N_\mathrm{S} \bigl(N_\mathrm{T} N_\mathrm{R} + N+N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(I_\text{SAA} \bigl(N_\mathrm{T} N_\mathrm{R} + NN_\mathrm{S}^2+N_\mathrm{T} N_\mathrm{R} N_\mathrm{S} + N_\mathrm{S}^3\bigr)\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
				% It is noteworthy that the computational complexity can be further reduced
				For the latter, the computational complexity can be further reduced:
				\begin{itemize}
					\item \emph{Negligible direct channel:} The optimal solution to \eqref{op:power} has been solved in closed form by \eqref{eq:ris_nd_power_max}.
					\item \emph{Non-negligible direct channel:} In terms of maximizing the inner product $\langle \mathbf{H}_\mathrm{D}, \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rangle$, \eqref{op:power} is reminiscent of the weighted orthogonal Procrustes problem \cite{Gower2004}
					\begin{mini!}
						{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{D} - \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2}{\label{op:procrustes_wt}}{}
						\addConstraint{\mathbf{\Theta}^\mathsf{H} \mathbf{\Theta}=\mathbf{I},}{\label{cn:procrustes_wt}}{}
					\end{mini!}
					which still has no trivial solution.
					One \emph{lossy} transformation \cite{Bell2003} shifts $\mathbf{\Theta}$ to sides of the product by Moore-Penrose inverse, formulating standard orthogonal Procrustes problems
					\begin{mini!}
						{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{B}^\dagger \mathbf{H}_\mathrm{D} - \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2 \text{ or } \lVert \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\dagger - \mathbf{H}_\mathrm{B} \mathbf{\Theta} \rVert _\mathrm{F}^2}{\label{op:procrustes}}{}
						\addConstraint{\mathbf{\Theta}^\mathsf{H} \mathbf{\Theta}=\mathbf{I},}{}{}
					\end{mini!}
					with optimal solutions \cite[(6.4.1)]{Golub2013}
					\begin{equation}
						\label{eq:ris_procrustes}
						\mathbf{\Theta}_\textnormal{P-max-approx}^\textnormal{MIMO-HD} = \mathbf{U} \mathbf{V}^\mathsf{H},
					\end{equation}
					where $\mathbf{U}$ and $\mathbf{V}$ are respectively any left and right singular matrices of $\mathbf{H}_\mathrm{B}^\dagger \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}$ or $\mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\dagger$.
				\end{itemize}

				Although \eqref{eq:ris_nd_power_max} and \eqref{eq:ris_procrustes} are of similar form, the latter is neither optimal nor a generalization of the former due to the lossy transformation.
				We will show in Section \ref{sc:simulation} that $\mathbf{\Theta}_\textnormal{P-max-approx}^\textnormal{MIMO-HD}$ is very close to optimal especially for a large $N_\mathrm{S}$.
				Once the channel is shaped by \eqref{eq:ris_power} or \eqref{eq:ris_nd_power_max} or \eqref{eq:ris_procrustes}, the active beamforming is retrieved by \eqref{eq:precoder_rate}.
				This two-stage solution avoids outer iterations and efficiently handles (or avoids) inner iterations.
			\end{subsubsection}
		\end{subsection}

		\begin{subsection}{MIMO Interference Channel}
			On top of \eqref{eq:channel_interference}, the achievable rate of transmission $k$ is
			\begin{equation}
				R_k = \log \det \biggl(\mathbf{I} + \mathbf{W}_k {\mathbf{H}^{(kj)\mathsf{H}}} \mathbf{Q}_k^{-1} {\mathbf{H}^{(kj)}} \mathbf{W}_k\biggr),
			\end{equation}
			where $\mathbf{W}_k$ is the precoder at transmitter $k$ and $\mathbf{Q}_k = \sum_{j \ne k} {\mathbf{H}^{(kj)}} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} {\mathbf{H}^{(kj)\mathsf{H}}} + \eta \mathbf{I}$ is the interference-plus-noise covariance matrix at receiver $k$.
			The weighted sum-rate maximization problem for \gls{bd}-\gls{ris}-aided \gls{mimo} interference channel is formulated as
			\begin{maxi!}
				{\scriptstyle{\mathbf{\Theta}, \{\mathbf{W}_k\}_{k \in [K]}}}{\sum_{k=1}^K \rho_k R_k}{\label{op:wsr}}{\label{ob:wsr}}
				\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g}{}{}
				\addConstraint{\lVert \mathbf{W}_k \rVert _\mathrm{F}^2 \le P_k. \quad \forall k}{}{}
			\end{maxi!}
			where $\rho_k \ge 0$ is the weight associated with transmission $k$.
			This non-convex problem can be solved by extending both solutions covered in Section \ref{sc:rate_pc} as detailed below.

			\begin{subsubsection}{Alternating Optimization}
				This approach updates $\mathbf{\Theta}$ and $\{\mathbf{W}_k\}_{k \in [K]}$ iteratively until convergence.
				For a given precoder set, the passive beamforming subproblem is
				\begin{maxi!}
					{\scriptstyle{\mathbf{\Theta}}}{\sum_{k=1}^K \rho_k R_k}{\label{op:wsr_ris}}{\label{ob:wsr_ris}}
					\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
				\end{maxi!}
				which can be solved optimally by Algorithm \ref{ag:rcg} with the partial derivative given in Lemma \ref{lm:wsr}.

				\begin{lemma}
					\label{lm:wsr}
					The partial derivative of \eqref{ob:wsr_ris} with respect to \gls{bd}-\gls{ris} block $g$ is
					\begin{equation}
						\label{eq:gradient_eucl_wsr}
						\begin{split}
							\frac{\partial \rho_k R_k}{\partial \mathbf{\Theta}_g^*} = \sum_{k=1}^K & \rho_k {\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} \mathbf{Q}_k^{-1} {\mathbf{H}^{(kk)}} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \\
							& \times \bigl({\mathbf{H}_{\mathrm{F},g}^{(k)\mathsf{H}}} - {\mathbf{H}^{(kk)\mathsf{H}}} \mathbf{Q}_k^{-1} \sum_{j \ne k} {\mathbf{H}^{(kj)}} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} {\mathbf{H}^{(j)\mathsf{H}}_{\mathrm{F},g}}\bigr),
						\end{split}
					\end{equation}
					where $\mathbf{E}_k = \bigl(\mathbf{I} + {\mathbf{W}_k^\mathsf{H}} {\mathbf{H}^{(kk)\mathsf{H}}} \mathbf{Q}_k {\mathbf{H}^{(kk)}} \mathbf{W}_k\bigr)^{-1}$ is the error matrix of receiver $k$.
				\end{lemma}

				\begin{proof}
					Please refer to Appendix~\ref{ap:wsr}.
				\end{proof}

				For a given $\mathbf{\Theta}$, problem \eqref{op:wsr} reduces to conventional precoding design for interference channel.
				A closed-form iterative solution based on mutual information-\gls{mmse} relationship has been proposed in \cite{Shin2012,Negro2010} and we summarize the steps as follows.
				At iteration $r$, the \gls{mmse} combiner at receiver $k$ is
				\begin{equation}
					\begin{split}
						\mathbf{G}_k^{(r)} &= {\mathbf{W}_k^{(r-1)\mathsf{H}}} {\mathbf{H}^{(kk)\mathsf{H}}} \\
						& \quad \times \bigl(\mathbf{Q}_k^{(r-1)} + {\mathbf{H}^{(kk)}} \mathbf{W}_k^{(r-1)} {\mathbf{W}_k^{(r-1)\mathsf{H}}} {\mathbf{H}^{(kk)\mathsf{H}}}\bigr)^{-1},
					\end{split}
				\end{equation}
				the corresponding error matrix is
				\begin{equation}
					\mathbf{E}_k^{(r)} = \bigl(\mathbf{I} + {\mathbf{W}_k^{(r-1)\mathsf{H}}} {\mathbf{H}^{(kk)\mathsf{H}}} \mathbf{Q}_k^{(r-1)} {\mathbf{H}^{(kk)}} \mathbf{W}_k^{(r-1)}\bigr)^{-1},
				\end{equation}
				and the optimal precoder at transmitter $k$ is given by
				\begin{equation}
					\label{eq:precoder_wsr}
					\begin{split}
						\mathbf{W}_k^{(r)} & = \Bigl(\sum_{j=1}^K {\mathbf{H}^{(jk)\mathsf{H}}} {\mathbf{G}_j^{(r)\mathsf{H}}} \mathbf{\Omega}_k^{(r)} \mathbf{G}_j^{(r)} \mathbf{H}^{(jk)} + \lambda_k^{(r)} \mathbf{I} \Bigr)^{-1} \\
						& \quad \times {\mathbf{H}^{(kk)\mathsf{H}}} {\mathbf{G}_j^{(r)\mathsf{H}}} \mathbf{\Omega}_k^{(r)},
					\end{split}
				\end{equation}
				where $\mathbf{\Omega}_k^{(r)} = \rho_k {\mathbf{E}_k^{(r)-1}}$ is the mean-square error weight and $\lambda_k^{(r)}$ is the Lagrange multiplier retrievable by bisection \cite{Shin2012} or in closed form \cite{Negro2010}
				\begin{equation}
					\lambda_k^{(r)} = \frac{\mathrm{tr}\bigl(\eta \mathbf{\Omega}_k^{(r)} \mathbf{G}_k^{(r)}{\mathbf{G}_k^{(r)\mathsf{H}}} + \sum_{j=1}^K (\mathbf{Z}_{kj}^{(r)} - \mathbf{Z}_{jk}^{(r)}) \bigr)}{P_k},
					% \lambda_k^{(r)} = \frac{\mathrm{tr}\bigl(\eta \mathbf{\Omega}_k^{(r)} \mathbf{G}_k^{(r)}{\mathbf{G}_k^{(r)\mathsf{H}}} + \sum_j \mathbf{\Omega}_k^{(r)}\mathbf{T}_{kj}^{(r)} {\mathbf{T}_{kj}^{(r)\mathsf{H}}} - \mathbf{\Omega}_j^{(r)}\mathbf{T}_{jk}^{(r)} {\mathbf{T}_{jk}^{(r)\mathsf{H}}} \bigr)}{P_k},
				\end{equation}
				where $\mathbf{Z}_{kj}^{(r)} = \mathbf{\Omega}_k^{(r)}\mathbf{T}_{kj}^{(r)} {\mathbf{T}_{kj}^{(r)\mathsf{H}}}$ and $\mathbf{T}_{kj}^{(r)} = \mathbf{G}_k^{(r)} {\mathbf{H}^{(kj)}} \mathbf{W}_j^{(r)}$.

				The computational complexity of solving subproblem \eqref{op:wsr_ris} by geodesic \gls{rcg} is $\mathcal{O}\bigl(I_\text{RCG} G (N_\mathrm{T} d^2 + N_\mathrm{T}^2 d + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + K (N_\mathrm{T} N_\mathrm{R} d + N_\mathrm{T} N_\mathrm{R} L) + I_\text{BLS}L^3)\bigr)$.
				That is, $\mathcal{O}_\mathrm{D}\bigl(N_\mathrm{S}\bigr)$ for \gls{d}-\gls{ris} and $\mathcal{O}_\mathrm{BD}\bigl(N_\mathrm{S}^3\bigr)$ for fully-connected \gls{bd}-\gls{ris}.
			\end{subsubsection}

			\begin{subsubsection}{Low-Complexity Solution}
				Similar to Section \ref{sc:rate_pc_lc}, we suboptimally decouple the beamforming design by first shape the channel by \gls{ris} for minimum leakage interference and then optimize the active beamforming.
				The leakage interference minimization problem is formulated as
				\begin{mini!}
					{\scriptstyle{\mathbf{\Theta}}}{I = \sum_{k=1}^K \sum_{j \ne k} \left\lVert {\mathbf{H}}^{(kj)}_\mathrm{D} + {\mathbf{H}}^{(k)}_\mathrm{B} \mathbf{\Theta} {\mathbf{H}}^{(j)}_\mathrm{F} \right\rVert _{\mathrm{F}}^2}{\label{op:interference}}{\label{ob:interference}}
					\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
				\end{mini!}
				which can be solved iteratively in closed form.

				\begin{proposition}
					\label{pp:interference}
					Starting from any feasible $\mathbf{\Theta}^{(0)}$, the sequence
					\begin{equation}
						\mathbf{\Theta}_g^{(r+1)} = \mathbf{U}_g^{(r)} \mathbf{V}_g^{(r)}, \quad \forall g
						\label{eq:scatter_leakage}
					\end{equation}
					converges to a stationary point of \eqref{op:interference}, where $\mathbf{U}_g^{(r)}$ and $\mathbf{V}_g^{(r)}$ are any left and right singular matrices of
					\begin{equation}
						\mathbf{M}_g^{(r)} = \sum_{k=1}^K \sum_{j \ne k} \bigl(\mathbf{B}_g^{(k)} \mathbf{\Theta}_g^{(r)} \mathbf{H}^{(j)}_{\mathrm{F},g} - {\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} {\mathbf{D}^{(kj)(r)}_{g}}\bigr) {\mathbf{H}^{(j)\mathsf{H}}_{\mathrm{F},g}},
					\end{equation}
					where $\mathbf{B}_g^{(k)} = \lambda_1\bigl({\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} \mathbf{H}^{(k)}_{\mathrm{B},g}\bigr) \mathbf{I} - {\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} \mathbf{H}^{(k)}_{\mathrm{B},g}$ and ${\mathbf{D}^{(kj)(r)}_{g}} = \mathbf{H}^{(kj)}_\mathrm{D} + \sum_{g'<g} {\mathbf{H}_{\mathrm{B},g'}^{(k)\mathsf{H}}} \mathbf{\Theta}_{g'}^{(r+1)} \mathbf{H}_{\mathrm{F},g'}^{(k)} + \sum_{g'>g} {\mathbf{H}_{\mathrm{B},g'}^{(k)\mathsf{H}}} \mathbf{\Theta}_{g'}^{(r)} \mathbf{H}_{\mathrm{F},g'}^{(k)}.$
				\end{proposition}
				\begin{proof}
					Please refer to Appendix~\ref{ap:interference}.
				\end{proof}
			\end{subsubsection}
			Once the channel is shaped by \eqref{eq:scatter_leakage}, the active beamforming is retrieved iteratively by \eqref{eq:precoder_wsr}.
			This Two-stage solution avoids outer iterations and efficiently handles inner iterations.
		\end{subsection}

			% \begin{subsection}{Leakage Interference Minimization}
			% 	Leakage interference refers to the sum of all interference terms in \gls{ic}.
			% 	Assume all transmitter sends $N_\mathrm{E} \le N \triangleq \min(N_\mathrm{T}, N_\mathrm{R})$ data streams to its intended receiver.
			% 	The leakage interference minimization problem is formulated with respect to all transmit precoders, all receiver combiners, and the scattering matrix as
			% 	\begin{mini!}
			% 		{\scriptstyle{\mathbf{\Theta}, \{\mathbf{G}_k\}, \{\mathbf{W}_k\}_{k \in [K]}}}{\mathop{\sum\sum}_{j \neq k} \left\lVert \mathbf{G}_k (\mathbf{H}^{(kj)}_\mathrm{D} + \mathbf{H}^{(k)}_\mathrm{B} \mathbf{\Theta} \mathbf{H}^{(j)}_{\mathrm{F}}) \mathbf{W}_j \right\rVert _{\mathrm{F}}^2}{\label{op:leakage}}{}
			% 		\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad}{\forall g}{\label{co:scatter}}
			% 		\addConstraint{\mathbf{G}_k \mathbf{G}_k^\mathsf{H}=\mathbf{I}, \quad}{\forall k}{\label{co:combiner}}
			% 		\addConstraint{\mathbf{W}_j^\mathsf{H} \mathbf{W}_j=\mathbf{I}, \quad}{\forall j,}{\label{co:precoder}}
			% 	\end{mini!}
			% 	where $\mathbf{G}_k \in \mathbb{C}^{N_\mathrm{D} \times N_\mathrm{R}}$ is the combiner at receiver $k$ and $\mathbf{W}_j \in \mathbb{C}^{N_\mathrm{T} \times N_\mathrm{D}}$ is the precoder at transmitter $j$.
			% 	It is worth noting that $\mathbf{\Theta}_g$ is a square unitary matrix and $\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}$ is equivalent to $\mathbf{\Theta}_g \mathbf{\Theta}_g^\mathsf{H}=\mathbf{I}$, while $\mathbf{G}_k$ and $\mathbf{W}_j$ may be respectively ``fat'' and ``tall'' rectangular semi-unitary matrices such that \eqref{co:combiner} and \eqref{co:precoder} are required.
			% 	The non-convex problem can be solved iteratively by the \gls{bcd} method detailed below.

			% 	\begin{subsubsection}{Combiner and Precoder Design}
			% 		For a given $\mathbf{\Theta}$, problem \eqref{op:leakage} reduces to conventional linear beamforming problem, for which an iterative algorithm alternating between the original and reciprocal networks is proposed in \cite{Gomadam2011,Clerckx2013}.
			% 		At iteration $r$, the combiner at receiver $k$ is updated as
			% 		\begin{equation}
			% 			\mathbf{G}_k^{(r)} = {\mathbf{U}_{k,N}^{(r-1)}}^\mathsf{H},
			% 			\label{eq:combiner_leakage}
			% 		\end{equation}
			% 		where $\mathbf{U}_{k,N}^{(r-1)}$ is the eigenvectors corresponding to $N$ smallest eigenvalues of the interference covariance matrix $\mathbf{Q}_k^{(r-1)} = \sum_{j \ne k} {\mathbf{H}^{(kj)}} \mathbf{W}_j^{(r-1)} {\mathbf{W}_j^{(r-1)}}^\mathsf{H} {\mathbf{H}^{(kj)\mathsf{H}}}$.
			% 		The precoder at transmitter $j$ is updated as
			% 		\begin{equation}
			% 			\mathbf{W}_j^{(r)} = \bar{\mathbf{U}}_{j,N}^{(r)},
			% 			\label{eq:precoder_leakage}
			% 		\end{equation}
			% 		where $\bar{\mathbf{U}}_{j,N}^{(r)}$ corresponds $\bar{\mathbf{Q}}_j^{(r)} = \sum_{k \ne j} {\mathbf{H}^{(kj)\mathsf{H}}} {\mathbf{G}_k^{(r)\mathsf{H}}} \mathbf{G}_k^{(r)} {\mathbf{H}^{(kj)}}$ in the reciprocal network.
			% 	\end{subsubsection}

			% 	\begin{subsubsection}{Scattering Matrix Design}
			% 		Once $\{\mathbf{G}_k\}$ and $\{\mathbf{W}_j\}$ are determined, we define $\bar{\mathbf{H}}^{(kj)}_\mathrm{D} \triangleq \mathbf{G}_k \mathbf{H}^{(kj)}_\mathrm{D} \mathbf{W}_j$, $\bar{\mathbf{H}}^{(k)}_\mathrm{B} \triangleq \mathbf{G}_k \mathbf{H}^{(k)}_\mathrm{B}$, and $\bar{\mathbf{H}}^{(j)}_\mathrm{F} \triangleq \mathbf{H}^{(j)}_\mathrm{F} \mathbf{W}_j$.
			% 		The \gls{bd}-\gls{ris} subproblem boils down to
			% 		\begin{mini!}
			% 			{\scriptstyle{\mathbf{\Theta}}}{\mathop{\sum\sum}_{j \neq k} \left\lVert (\bar{\mathbf{H}}^{(kj)}_\mathrm{D} + \bar{\mathbf{H}}^{(k)}_\mathrm{B} \mathbf{\Theta} \bar{\mathbf{H}}^{(j)}_\mathrm{F}) \right\rVert _{\mathrm{F}}^2}{\label{op:ic_interference_ris}}{}
			% 			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
			% 		\end{mini!}
			% 		which can be viewed as a channel shaping problem on $\bar{\mathbf{H}}^{(kj)}_\mathrm{D}$, $\bar{\mathbf{H}}^{(k)}_\mathrm{B}$, and $\bar{\mathbf{H}}^{(j)}_\mathrm{F}$.

			% 		\begin{proposition}
			% 			Start from any $\mathbf{\Theta}^{(0)}$, the sequence
			% 			\begin{equation}
			% 				\mathbf{\Theta}_g^{(r+1)} = \mathbf{U}_g^{(r)} \mathbf{V}_g^{(r)}, \quad \forall g
			% 				\label{eq:scatter_leakage}
			% 			\end{equation}
			% 			converges to a stationary point of \eqref{op:ic_interference_ris}, where $\mathbf{U}_g^{(r)}$ and $\mathbf{V}_g^{(r)}$ are left and right singular matrix of
			% 			\begin{equation}
			% 				\mathbf{M}_g^{(r)} = \mathop{\sum\sum}_{j \neq k} \bigl(\mathbf{B}_{k,g} \mathbf{\Theta}_g^{(r)} \mathbf{H}^{(j)}_{\mathrm{F},g} - {\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} {\mathbf{D}^{(kj)}_{g}}^{(r)}\bigr) {\mathbf{H}^{(j)\mathsf{H}}_{\mathrm{F},g}},
			% 			\end{equation}
			% 			where $\mathbf{B}_{k,g} = \lambda_1\bigl({\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} \mathbf{H}^{(k)}_{\mathrm{B},g}\bigr) \mathbf{I} - {\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} \mathbf{H}^{(k)}_{\mathrm{B},g}$ and
			% 			\begin{equation}
			% 				{\mathbf{D}^{(kj)}_{g}}^{(r)} = \mathbf{H}^{(kj)}_\mathrm{D} + \sum_{g'<g} {\mathbf{H}_{k,g'}^\mathrm{B}}^\mathsf{H} \mathbf{\Theta}_{g'}^{(r+1)} \mathbf{H}_{k,g'}^\mathrm{F} + \sum_{g'>g} {\mathbf{H}_{k,g'}^\mathrm{B}}^\mathsf{H} \mathbf{\Theta}_{g'}^{(r)} \mathbf{H}_{k,g'}^\mathrm{F}.
			% 			\end{equation}
			% 		\end{proposition}
			% 		\begin{proof}
			% 			The proof is similar to Appendix~\ref{ap:power} and omitted here.
			% 		\end{proof}
			% 	\end{subsubsection}

			% 	Problem \eqref{op:leakage} can be solved iteratively by \eqref{eq:combiner_leakage}, \eqref{eq:precoder_leakage}, and \eqref{eq:scatter_leakage}.
			% 	Convergence to local-optimal points is guaranteed since each subproblem is solved optimally and the objective is bounded above.

			% \end{subsection}

			% \begin{subsection}{Weighted Sum-Rate Maximization}
			% 	Finally, we consider weighted sum-rate maximization in \gls{mimo}-\gls{ic} by joint active beamforming design at the transmitters and passive beamforming design at the \gls{ris}.
			% 	The achievable rate of transmission $k$ is given by
			% 	\begin{equation}
			% 		R_k = \log \det \biggl(\mathbf{I} + \mathbf{W}_k {\mathbf{H}^{(kj)\mathsf{H}}} \mathbf{Q}_k^{-1} {\mathbf{H}^{(kj)}} \mathbf{W}_k\biggr),
			% 	\end{equation}
			% 	where $\mathbf{Q}_k$ is the interference-plus-noise covariance matrix at receiver $k$
			% 	\begin{equation}
			% 		\mathbf{Q}_k = \sum_{j \ne k} {\mathbf{H}^{(kj)}} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} {\mathbf{H}^{(kj)\mathsf{H}}} + \eta \mathbf{I},
			% 	\end{equation}
			% 	and $\eta$ is the average noise power.
			% 	The optimization problem is formulated as
			% 	\begin{maxi!}
			% 		{\scriptstyle{\mathbf{\Theta}, \{\mathbf{W}_k\}_{k \in [K]}}}{\sum_k \rho_k R_k}{\label{op:ic_rate}}{\label{ob:ic_rate}}
			% 		\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g}{}{}
			% 		\addConstraint{\lVert \mathbf{W}_k \rVert _\mathrm{F}^2 \le P_k. \quad \forall k}{}{}
			% 	\end{maxi!}
			% 	where $\rho_k$ is the weight that denotes the priority of transmission $k$.
			% 	The problem is non-convex and can be solved by the \gls{ao} method detailed below.

			% 	\begin{subsubsection}{Precoder Design}
			% 		For a given $\mathbf{\Theta}$, \eqref{op:ic_rate} reduces to conventional linear beamforming problem, for which a closed-form iterative solution has been proposed in \cite{Negro2010} based on mutual information-\gls{mmse} relationship \cite{Guo2005}.
			% 		We restate the steps as follows.

			% 		At iteration $r$, the \gls{mmse} combiner at receiver $k$ is
			% 		\begin{equation}
			% 			\mathbf{G}_k^{(r)} = {\mathbf{W}_k^{(r-1)\mathsf{H}}} {\mathbf{H}^{(kk)\mathsf{H}}} \bigl(\mathbf{Q}_k^{(r-1)} + {\mathbf{H}^{(kk)}} \mathbf{W}_k^{(r-1)} {\mathbf{W}_k^{(r-1)\mathsf{H}}} {\mathbf{H}^{(kk)\mathsf{H}}}\bigr)^{-1},
			% 		\end{equation}
			% 		the corresponding error matrix is
			% 		\begin{equation}
			% 			\mathbf{E}_k^{(r)} = \bigl(\mathbf{I} + {\mathbf{W}_k^{(r-1)\mathsf{H}}} {\mathbf{H}^{(kk)\mathsf{H}}} \mathbf{Q}_k^{(r-1)} {\mathbf{H}^{(kk)}} \mathbf{W}_k^{(r-1)}\bigr)^{-1},
			% 		\end{equation}
			% 		the \gls{mse} weight is
			% 		\begin{equation}
			% 			\mathbf{\Omega}_k^{(r)} = \rho_k {\mathbf{E}_k^{(r)}}^{-1},
			% 		\end{equation}
			% 		the Lagrange multiplier is
			% 		\begin{equation}
			% 			\lambda_k^{(r)} = \frac{\mathrm{tr}\bigl(\eta \mathbf{\Omega}_k^{(r)} \mathbf{G}_k^{(r)}{\mathbf{G}_k^{(r)\mathsf{H}}} + \sum_j \mathbf{\Omega}_k^{(r)}\mathbf{T}_{kj}^{(r)} {\mathbf{T}_{kj}^{(r)\mathsf{H}}} - \mathbf{\Omega}_j^{(r)}\mathbf{T}_{jk}^{(r)} {\mathbf{T}_{jk}^{(r)}}^\mathsf{H} \bigr)}{P_k},
			% 		\end{equation}
			% 		where $\mathbf{T}_{kj}^{(r)} = \mathbf{G}_k^{(r)} {\mathbf{H}^{(kj)}} \mathbf{W}_j^{(r)}$.
			% 		The optimal precoder at transmitter $k$ is given by
			% 		\begin{equation}
			% 			\mathbf{W}_k^{(r)} = \Bigl(\sum_j {\mathbf{H}^{(jk)\mathsf{H}}} {\mathbf{G}_j^{(r)\mathsf{H}}} \mathbf{\Omega}_k^{(r)} \mathbf{G}_j^{(r)} \mathbf{H}^{(jk)} + \lambda_k^{(r)} \mathbf{I} \Bigr)^{-1} {\mathbf{H}^{(kk)\mathsf{H}}} {\mathbf{G}_j^{(r)\mathsf{H}}} \mathbf{\Omega}_k^{(r)}.
			% 		\end{equation}
			% 	\end{subsubsection}

			% 	\begin{subsubsection}{Scattering Matrix Design}
			% 		Once $\{\mathbf{W}_k\}$ is determined, the complex derivative of \eqref{ob:ic_rate} with respect to \gls{ris} block $g$ is
			% 		\begin{equation}
			% 			\frac{\partial \rho_k R_k}{\partial \mathbf{\Theta}_g^*} = \sum_k \rho_k {\mathbf{H}^{(k)\mathsf{H}}_{\mathrm{B},g}} \mathbf{Q}_k^{-1} {\mathbf{H}^{(kk)}} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \bigl({\mathbf{H}_{\mathrm{F},g}^{(k)\mathsf{H}}} - {\mathbf{H}^{(kk)\mathsf{H}}} \mathbf{Q}_k^{-1} \sum_{j \ne k} {\mathbf{H}^{(kj)}} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} {\mathbf{H}^{(j)\mathsf{H}}_{\mathrm{F},g}}\bigr).
			% 			\label{eq:ic_rate_gradient_ris}
			% 		\end{equation}
			% 	\end{subsubsection}
			% 	The \gls{ris} subproblem can be solved by \gls{rcg} Algorithm~\ref{ag:rcg} where line ?? uses \eqref{eq:ic_rate_gradient_ris} explicitly.
			% \end{subsection}
		% \end{subsection}
\end{section}


	% ! shit


% \begin{section}{Power Gain and Achievable Rate Maximization}
% 	\label{sc:power_rate}
% 	In this section, we solve channel power gain maximization problem in closed-form and then extend the discussion to achievable rate maximization problem.
% 	The implication of the former on the latter is investigated.

% 	\begin{subsection}{Channel Power Gain}\label{sc:power}
% 		The \gls{mimo} channel power gain maximization problem is formulated with respect to the \gls{bd}-\gls{ris} scattering matrix
% 		\begin{maxi!}
% 			{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2}{\label{op:power}}{\label{ob:power}}
% 			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{\label{cn:power_unitary}}{}
% 		\end{maxi!}
% 		which generalizes the problem of \gls{siso} \cite{Shen2020a}, \gls{miso} \cite{Santamaria2023,Fang2023}, single-stream \gls{mimo} \cite{Nerini2023,Nerini2023b}, and \gls{mimo} with negligible direct channel and fully-connected \gls{bd}-\gls{ris} ??.
% 		Solving \eqref{op:power} calls for a balance between the additive direct-indirect combining and the multiplicative backward-forward combining.
% 		% The key of solving \eqref{op:power} is to balance the additive and multiplicative space alignments.

% 		\begin{remark}
% 			Interestingly, in terms of maximizing the inner product $\langle \mathbf{H}_\mathrm{D}, \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rangle$, \eqref{op:power} is reminiscent of the weighted orthogonal Procrustes problem \cite{Gower2004}
% 			\begin{mini!}
% 				{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{D} - \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2}{\label{op:procrustes_wt}}{}
% 				\addConstraint{\mathbf{\Theta}^\mathsf{H} \mathbf{\Theta}=\mathbf{I},}{\label{cn:procrustes_wt}}{}
% 			\end{mini!}
% 			which relaxes the block-unitary constraint \eqref{cn:power_unitary} to unitary \eqref{cn:procrustes_wt} but still has no trivial solution.
% 			One lossy transformation exploits the Moore-Penrose inverse and moves $\mathbf{\Theta}$ to one side of the product \cite{Bell2003}, formulating two standard orthogonal Procrustes problems
% 			\begin{mini!}
% 				{\scriptstyle{\mathbf{\Theta}}}{\lVert \mathbf{H}_\mathrm{B}^\dagger \mathbf{H}_\mathrm{D} - \mathbf{\Theta} \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2 \text{ or } \lVert \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\dagger - \mathbf{H}_\mathrm{B} \mathbf{\Theta} \rVert _\mathrm{F}^2}{\label{op:procrustes}}{}
% 				\addConstraint{\mathbf{\Theta}^\mathsf{H} \mathbf{\Theta}=\mathbf{I},}{}{}
% 			\end{mini!}
% 			which have global optimal solutions
% 			\begin{equation}
% 				\mathbf{\Theta} = \mathbf{U} \mathbf{V}^\mathsf{H},
% 				\label{eq:ris_procrustes}
% 			\end{equation}
% 			where $\mathbf{U}$ and $\mathbf{V}$ are respectively the left and right compact singular matrices of $\mathbf{H}_\mathrm{B}^\dagger \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}$ or $\mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\dagger$ \cite{Golub2013}.
% 		\end{remark}

% 		It is worth noting that ?? and \eqref{eq:ris_procrustes} are valid fully-connected \gls{bd}-\gls{ris} solutions to \eqref{op:power} when the direct channel is negligible and significant, respectively.
% 		However, the latter is neither optimal nor a generalization of the former due to the lossy transformation.
% 		Inspired by \cite{Nie2017}, we propose an optimal solution to problem \eqref{op:power} with arbitrary group size.
% 		The idea is to successively approximate the quadratic objective \eqref{ob:power} by local Taylor expansions and solve each step in closed form by group-wise \gls{svd}.

% 		\begin{proposition}\label{pp:power}
% 			Starting from any feasible $\mathbf{\Theta}^{(0)}$, the sequence
% 			\begin{equation}
% 				\mathbf{\Theta}_g^{(r+1)} = \mathbf{U}_g^{(r)} \mathbf{V}_g^{(r)}, \quad \forall g.
% 				\label{eq:ris_power}
% 			\end{equation}
% 			converges to a stationary point of \eqref{op:power}, where $\mathbf{U}_g^{(r)}$ and $\mathbf{V}_g^{(r)}$ are any left and right compact singular matrices of
% 			\begin{equation}
% 				\mathbf{M}_g^{(r)} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \Bigl(\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \diag\bigl(\mathbf{\Theta}_{[1:g-1]}^{(r+1)},\mathbf{\Theta}_{[g:G]}^{(r)}\bigr) \mathbf{H}_\mathrm{F}\Bigr) \mathbf{H}_{\mathrm{F},g}^\mathsf{H}
% 				\label{eq:auxiliary_power}
% 			\end{equation}
% 			% \begin{equation}
% 			% 	% \begin{split}
% 			% 		\mathbf{M}_g^{(r)} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \Bigl(\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \diag\bigl(\mathbf{\Theta}_{1}^{(r+1)},\ldots,\mathbf{\Theta}_{g-1}^{(r+1)},\mathbf{\Theta}_{g}^{(r)},\ldots,\mathbf{\Theta}_{G}^{(r)}\bigr) \mathbf{H}_\mathrm{F}\Bigr) \mathbf{H}_{\mathrm{F},g}^\mathsf{H}
% 			% 	% \end{split}
% 			% 	\label{eq:auxiliary_power}
% 			% \end{equation}
% 		\end{proposition}

% 		\begin{proof}
% 			Please refer to Appendix~\ref{ap:power}.
% 		\end{proof}

% 		We now analyze the computational complexity of solving channel gain maximization problem \eqref{op:power} by Proposition \ref{pp:power}.
% 		To update each \gls{bd}-\gls{ris} group, matrix multiplication \eqref{eq:auxiliary_power} requires $\mathcal{O}\bigl(N_\mathrm{T} N_\mathrm{R} + (G+1)(NL^2+N_\mathrm{T} N_\mathrm{R} L)\bigr)$ operations and its compact \gls{svd} requires $\mathcal{O}(L^3)$ operations.
% 		The overall complexity is thus $\mathcal{O}\bigl(I_\text{SAA} G \bigl(N_\mathrm{T} N_\mathrm{R} + (G+1)(NL^2+N_\mathrm{T} N_\mathrm{R} L) + L^3\bigr)\bigr)$, where $I_\text{SAA}$ is the number iterations for successive affine approximation.
% 	\end{subsection}

% 	\begin{subsection}{Achievable Rate Maximization}\label{sc:rate_pc}
% 		We aim to maximize the achievable rate of the \gls{bd}-\gls{ris}-aided \gls{mimo} system by jointly optimizing the active and passive beamforming
% 		\begin{maxi!}
% 			{\scriptstyle{\mathbf{W},\mathbf{\Theta}}}{R = \log \det \biggl(\mathbf{I} + \frac{\mathbf{W}^\mathsf{H}\mathbf{H}^\mathsf{H}\mathbf{H}\mathbf{W}}{\eta}\biggr)}{\label{op:rate}}{\label{ob:rate}}
% 			\addConstraint{\lVert \mathbf{W} \rVert _\mathrm{F}^2}{\le P}
% 			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g}{=\mathbf{I}, \quad \forall g,\label{cn:rate_unitary}}
% 		\end{maxi!}
% 		where $\mathbf{W}$ is the transmit precoder, $R$ is the achievable rate, $\eta$ is the average noise power, and $P$ is the transmit power constraint.
% 		Problem \eqref{op:rate} is non-convex due to the block-unitary constraint \eqref{cn:rate_unitary} and the coupling between variables.
% 		We propose a local-optimal approach via \gls{ao} and a low-complexity approach based on channel shaping.

% 		\begin{subsubsection}{Alternating Optimization}
% 			This approach updates $\mathbf{\Theta}$ and $\mathbf{W}$ iteratively until convergence.
% 			For a given $\mathbf{W}$, the passive beamforming subproblem is
% 			\begin{maxi!}
% 				{\scriptstyle{\mathbf{\Theta}}}{\log \det \biggl(\mathbf{I} + \frac{\mathbf{H} \mathbf{Q} \mathbf{H}^\mathsf{H}}{\eta}\biggr)}{\label{op:rate_ris}}{\label{ob:rate_ris}}
% 				\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
% 			\end{maxi!}
% 			where $\mathbf{Q} \triangleq \mathbf{W} \mathbf{W}^\mathsf{H}$ is the transmit covariance matrix.
% 			Problem \eqref{op:rate_ris} can be solved optimally by Algorithm \ref{ag:rcg} with the Euclidean gradient given in Lemma \ref{lm:rate}.
% 			\begin{lemma}\label{lm:rate}
% 				The Euclidean gradient of \eqref{ob:rate_ris} with respect to \gls{bd}-\gls{ris} block $g$ is
% 				\begin{equation}
% 					\frac{\partial R}{\partial \mathbf{\Theta}_g^*} = \frac{1}{\eta} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \biggl(\mathbf{I} + \frac{\mathbf{H}\mathbf{Q}\mathbf{H}^\mathsf{H}}{\eta}\biggr)^{-1} \mathbf{H} \mathbf{Q} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}.
% 					\label{eq:gradient_eucl_rate}
% 				\end{equation}
% 			\end{lemma}

% 			\begin{proof}
% 				Please refer to Appendix~\ref{ap:rate}.
% 			\end{proof}
% 			For a given $\mathbf{\Theta}$, the global optimal transmit precoder is given by eigenmode transmission \cite{Clerckx2013}
% 			\begin{equation}
% 				\mathbf{W}^\star = \mathbf{V} {\diag(\mathbf{s}^\star)}^{1/2},
% 				\label{eq:precoder}
% 			\end{equation}
% 			where $\mathbf{V}$ is the right singular matrix of the equivalent channel and $\mathbf{s}^\star$ is the optimal water-filling power allocation obtainable by the iterative method \cite{Clerckx2013}.

% 			The \gls{ao} algorithm is guaranteed to converge to local-optimal points of problem \eqref{op:rate} since each subproblem is solved optimally and the objective is bounded above.
% 			Similar to the analysis in Section \ref{sc:pareto}, the computational complexity of solving subproblem \eqref{op:rate_ris} by geodesic \gls{rcg} is $\mathcal{O}\bigl(I_\text{RCG} G (NL^2 + L N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} L^3)\bigr)$.
% 			On the other hand, the complexity of solving active beamforming subproblem by \eqref{eq:precoder} is $\mathcal{O}\bigl(N N_\mathrm{T} N_\mathrm{R}\bigr)$.
% 			The overall complexity is thus $\mathcal{O}\bigl(I_\text{AO}\bigl(I_\text{RCG} G (NL^2 + L N_\mathrm{T} N_\mathrm{R} + N_\mathrm{T}^2 N_\mathrm{R} + N_\mathrm{T} N_\mathrm{R}^2 + N_\mathrm{R}^3 + I_\text{BLS} L^3) + N N_\mathrm{T} N_\mathrm{R}\bigr)\bigr)$, where $I_\text{AO}$ is the number of iterations for \gls{ao}.
% 		\end{subsubsection}

% 		\begin{subsubsection}{Low-Complexity Solution}\label{sc:low_complexity}
% 			We finally propose a suboptimal two-stage solution to problem \eqref{op:rate} that decouples the joint \gls{ris}-transceiver design.
% 			The idea is to first consider channel shaping and replace the rate maximization subproblem \eqref{op:rate_ris} by channel power gain maximization problem \eqref{op:power}, then proceed to conventional eigenmode transmission \eqref{eq:precoder}.
% 			Both steps are solved in closed form and the computational complexity is $\mathcal{O}\bigl(I_\text{SAA} G \bigl(N_\mathrm{T} N_\mathrm{R} + (G+1)(NL^2+N_\mathrm{T} N_\mathrm{R} L) + L^3\bigr) + N N_\mathrm{T} N_\mathrm{R}\bigr)$.
% 			While suboptimal, this shaping-inspired solution avoids outer iterations and efficiently handles inner iterations.
% 		\end{subsubsection}
% 	\end{subsection}
% \end{section}

\begin{section}{Simulation Results}
	\label{sc:simulation}
 In this section, we provide numerical results to evaluate the proposed \gls{bd}-\gls{ris} designs.\footnote{Source code is available at \url{https://github.com/snowztail/channel-shaping}.}
 Consider a distance-dependent path loss model $\Lambda(d) = \Lambda_0 d^{-\gamma}$ where $\Lambda_0$ is the reference path loss at distance \qty{1}{m}, $d$ is the propagation distance, and $\gamma$ is the path loss exponent.
 The small-scale fading model is $\mathbf{H} = \sqrt{\kappa/(1+\kappa)} \mathbf{H}_\text{LoS} + \sqrt{1/(1+\kappa)} \mathbf{H}_\text{NLoS}$, where $\kappa$ is the Rician K-factor, $\mathbf{H}_\text{LoS}$ is the deterministic \gls{los} component, and $\mathbf{H}_\text{NLoS} \sim \mathcal{N}_{\mathbb{C}}(\mathbf{0}, \mathbf{I})$ is the Rayleigh component.
 We set $\Lambda_0=\qty{-30}{dB}$, $d_\mathrm{D}=\qty{14.7}{m}$, $d_\mathrm{F}=\qty{10}{m}$, $d_\mathrm{B}=\qty{6.3}{m}$, $\gamma_\mathrm{D}=3$, $\gamma_\mathrm{F}=2.4$ and $\gamma_\mathrm{B}=2$ for reference, which corresponds to a typical indoor environment with $\Lambda_\mathrm{D}=\qty{-65}{dB}$, $\Lambda_\mathrm{F}=\qty{-54}{dB}$, $\Lambda_\mathrm{B}=\qty{-46}{dB}$.
 The indirect path via \gls{ris} is thus \qty{35}{\dB} weaker than the direct path.
 Rayleigh fading (i.e., $\kappa = 0$) is assumed for all channels unless otherwise specified.

 \begin{subsection}{Algorithm Evaluation}
	 \begin{table*}[!t]
		 \caption{Average Performance of Geodesic and Non-Geodesic \gls{rcg} Algorithms on Problem \eqref{op:pareto}}
		 \label{tb:complexity}
		 \centering
		 \begin{tabular}{ccccccc}
			 \toprule
			 \multirow{2}{*}{\gls{rcg} path} & \multicolumn{3}{c}{$N_\mathrm{S}=16$} & \multicolumn{3}{c}{$N_\mathrm{S}=256$}                                                               \\ \cmidrule(lr){2-4} \cmidrule(lr){5-7}
			                                 & Objective                             & Iterations                             & Time [s]         & Objective        & Iterations & Time [s] \\ \midrule
			 Geodesic                        & $\num{4.359e-3}$                      & 11.59                                  & $\num{1.839e-2}$ & $\num{1.163e-2}$ & 25.58      & 3.461    \\
			 Non-geodesic                    & $\num{4.329e-3}$                      & 30.92                                  & $\num{5.743e-2}$ & $\num{1.116e-2}$ & 61.40      & 13.50    \\ \bottomrule
		 \end{tabular}
	 \end{table*}
	 We first compare in Table \ref{tb:complexity} the geodesic and non-geodesic \gls{rcg} algorithm on problem \eqref{op:pareto} in an $N_\mathrm{T}=N_\mathrm{R}=4$ system with \gls{bd}-\gls{ris} group size $L=4$.
	 The statistics are averaged over \num{100} independent runs.
	 It is observed that the geodesic \gls{rcg} method achieves a slightly higher objective value with significantly (down to 1/3) lower number of iterations and shorter (down to 1/4) computational time than the non-geodesic method.
	 The results demonstrate the efficiency of the proposed geodesic \gls{rcg} algorithm especially for large-scale \gls{bd}-\gls{ris} design problems.
 \end{subsection}

 \begin{subsection}{Channel Singular Values Redistribution}
	 \begin{subsubsection}{Pareto Frontier}
		 \begin{figure}[!t]
			 \centering
			 \subfloat[$2 \times 32 \times 2$ (no direct)]{
				\label{fg:singular_pareto_sx32_nd}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_singular_pareto_sx32_nd.tex}

				 }
			 }
			 \subfloat[$2 \times 32 \times 2$]{
				\label{fg:singular_pareto_sx32}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_singular_pareto_sx32.tex}
				 }
			 }
			 \\
			 \subfloat[$2 \times 64 \times 2$]{
				\label{fg:singular_pareto_sx64}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_singular_pareto_sx64.tex}
				 }
			 }
			 \subfloat[$2 \times 128 \times 2$]{
				\label{fg:singular_pareto_sx128}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_singular_pareto_sx128.tex}
				 }
			 }
			 \caption{Pareto frontiers of singular values of an $N_\mathrm{T}=N_\mathrm{R}=2$ channel reshaped by \gls{bd}-\gls{ris}.}
			 \label{fg:singular_pareto}
		 \end{figure}
		 % Fig. \ref{fg:singular_pareto} shows the Pareto frontiers of channel singular values reshaped by \gls{bd}-\gls{ris}.
		 Fig. \ref{fg:singular_pareto} shows the Pareto singular values of an $N_\mathrm{T}=N_\mathrm{R}=2$ \gls{mimo} reshaped by a \gls{ris}.
		 When the direct channel is negligible, the achievable regions in Fig. \subref*{fg:singular_pareto_sx32_nd} are shaped like pizza slices.
		 This is because $\sigma_1(\mathbf{H}) \ge \sigma_2(\mathbf{H}) \ge 0$ and there exists a trade-off between the alignment of two spaces.
		 %  since $\sigma_1(\mathbf{H}) \ge \sigma_2(\mathbf{H}) \ge 0$.
		 We observe that the smallest singular value can be enhanced up to \num{2e-4} by \gls{d}-\gls{ris} and \num{3e-4} by fully-connected \gls{bd}-\gls{ris}, corresponding to a \qty{50}{\percent} gain.
		 When the direct channel is significant, the shape of the singular value region depends heavily on the relative strength of the indirect channels.
		 In Fig. \subref*{fg:singular_pareto_sx32}, a 32-element \gls{ris} is insufficient to compensate the \qty{35}{dB} path loss imbalance and results in a limited singular value region that is symmetric around the direct point.
		 As the group size $L$ increases, the shape of the region evolves from elliptical to square.
		 This transformation not only improves the dynamic range of $\sigma_1(\mathbf{H})$ and $\sigma_2(\mathbf{H})$ by \qty{22}{\percent} and \qty{38}{\percent}, but also provides a better trade-off in manipulating both singular values.
		 It suggests the design flexibility from larger group size allows better alignment of multiple singular vector spaces simultaneously.
		 % not only provides a better trade-off in channel manipulation but also improves the dynamic range of $\sigma_1(\mathbf{H})$ and $\sigma_2(\mathbf{H})$ by \qty{22}{\percent} and \qty{38}{\percent}, respectively.
		 The singular value region also enlarges as the number of scattering elements $N_\mathrm{S}$ increases.
		 In particular, Fig. \subref*{fg:singular_pareto_sx128} shows that the equivalent channel can be completely nulled (corresponding to the origin) by a 128-element \gls{bd}-\gls{ris} thanks to its superior channel shaping capability, but not by a diagonal one.
		 Those results demonstrate the superior channel shaping capability of \gls{bd}-\gls{ris} and emphasizes the importance of reconfigurable inter-connections between elements.
	 \end{subsubsection}

	 \begin{subsubsection}{Analytical Bounds and Numerical Results}
		 \begin{figure}[!t]
			 \centering
			 \subfloat[$4 \times 32 \times 4$ (rank-1)]{
				\label{fg:singular_bound_rank1_sx32}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_singular_bound_rank1_sx32.tex}
				 }
			 }
			 \subfloat[$4 \times 64 \times 4$ (rank-1)]{
				\label{fg:singular_bound_rank1_sx64}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_singular_bound_rank1_sx64.tex}
				 }
			 }
			 \\
			 \subfloat[$4 \times 128 \times 4$ (rank-2)]{
				\label{fg:singular_bound_rank2_sx128}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_singular_bound_rank2_sx128.tex}
				 }
			 }
			 \subfloat[$4 \times 256 \times 4$ (rank-4)]{
				\label{fg:singular_bound_rank4_sx256}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_singular_bound_rank4_sx256.tex}
				 }
			 }
			 \caption{
				 Achievable channel singular values: analytical bounds (lines) and numerical results (bars).
				 Baselines of bars denote the singular values of the direct channel.
				 Blue (resp. red) bars denote the lower (resp. upper) dynamic range of singular values obtained by solving \eqref{op:pareto} with $\rho_n/\rho_{n'} \to 0$ (resp. $\to \infty$), $\forall n, \ n' \ne n$.
				 `D' means \gls{d}-\gls{ris} and `BD' refers to fully-connected \gls{bd}-\gls{ris}.
				 `rank-$k$' refers to the rank of the forward channel.
			 }
			 \label{fg:singular_bound}
		 \end{figure}
		 Fig. \ref{fg:singular_bound} illustrates the analytical singular value bounds in Proposition \ref{pp:rd} and the numerical results obtained by solving problem \eqref{op:pareto}.
		 Here we consider a rank-$k$ forward channel without loss of generality.
		 When the \gls{ris} is in the vicinity of the transmitter, Figs. \subref*{fg:singular_bound_rank1_sx32} and \subref*{fg:singular_bound_rank1_sx64} show that the achievable channel singular values indeed satisfy Corollary \ref{co:los}, namely $\sigma_1(\mathbf{H}) \ge \sigma_1(\mathbf{T})$, $\sigma_2(\mathbf{T}) \le \sigma_2(\mathbf{H}) \le \sigma_1(\mathbf{T})$, etc.
		 It is obvious that \gls{bd}-\gls{ris} can approach those bounds better than \gls{d}-\gls{ris} especially for a small $N_\mathrm{S}$.
		 % Another example is given in Fig. \subref*{fg:singular_bound_rank2_sx128} where the forward channel is rank-2.
		 Another example is given in Fig. \subref*{fg:singular_bound_rank2_sx128} with rank-2 forward channel.
		 % The observations align with Proposition \ref{pp:rd} that t
		 The first two channel singular values are unbounded above and bounded below by the first two singular values of $\mathbf{T}$, while the last two singular values can be suppressed to zero and bounded above by the first two singular values of $\mathbf{T}$.
		 Those observations align with Proposition \ref{pp:rd}.
		 Finally, Fig. \subref*{fg:singular_bound_rank4_sx256} confirms there are no extra singular value bounds when both backward and forward channels are full-rank.
		 This can be predicted from \eqref{eq:auxiliary_rd} where the singular matrix $\mathbf{V}_\mathrm{F}$ becomes unitary and $\mathbf{T}=\mathbf{0}$.
		 The numerical results are consistent with the analytical bounds, and we conclude that the channel shaping advantage of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} scales with backward and forward channel ranks.


		 \begin{figure}[!t]
			 \centering
			 \subfloat[$1 \times 256 \times 1$ (no direct)]{
				\label{fg:power_bond_txrx1_nd}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_power_bond_txrx1_nd.tex}
				 }
			 }
			 \subfloat[$4 \times 256 \times 4$ (no direct)]{
				\label{fg:power_bond_txrx4_nd}
				 \resizebox{!}{3.25cm}{
					 \input{../assets/simulation/pc_power_bond_txrx4_nd.tex}
				 }
			 }
			 \caption{
				 Average maximum channel power gain versus \gls{bd}-\gls{ris} group size and \gls{mimo} dimensions.
				 The direct channel is negligible.
				 `Cascaded' refers to the available power of the cascaded channel, i.e., the sum of (sorted) element-wise power product of backward and forward channels.
			 }
			 \label{fg:power_bond}
		 \end{figure}

		 Fig. \ref{fg:power_bond} compares the analytical channel power bound in Corollary \ref{co:nd_power} and the numerical results obtained by solving problem \eqref{op:power} when the direct channel is negligible.
		 Here, a fully-connected \gls{bd}-\gls{ris} can attain the upper bound either in closed form \eqref{eq:ris_nd_power_max} or via optimization approach \eqref{eq:ris_power}.
		 % Recall that a fully-connected \gls{bd}-\gls{ris} in closed form \eqref{eq:scattering_fc_tight} can attain the bound.
		 % We observe that the bound is also tight for fully-connected \gls{bd}-\gls{ris}.
		 % Increasing the group size of \gls{bd}-\gls{ris} significantly improves the channel power especially for a large \gls{mimo}.
		 % Apparently, \gls{bd}-\gls{ris} with a larger group size can approach the bound better, and a fully-connected one can achieve the bound.
		 % The bound here indicates how much power can potentially be extracted from the forward and backward channels.
		 % We observe that using a larger group size can approach the bound better, and full
		 % We observe that the bound is tight for fully-connected \gls{bd}-\gls{ris} in \gls{siso} and \gls{mimo}.
		 For the \gls{siso} case in Fig. \subref*{fg:power_bond_txrx1_nd}, the maximum channel power gain is approximately \num{4e-6} by \gls{d}-\gls{ris} and \num{6.5e-6} by fully-connected \gls{bd}-\gls{ris}, corresponding to a \qty{62.5}{\percent} gain.
		 It comes purely from branch matching and agrees with the asymptotic power scaling law derived for \gls{siso} in \cite[(30)]{Shen2020a}.
		 Interestingly, this relative power gain surges to \qty{270}{\percent} in $N_\mathrm{T}=N_\mathrm{R}=4$ \gls{mimo} as shown in Fig. \subref*{fg:power_bond_txrx4_nd}, which can also be predicted from the expectation analysis \eqref{eq:power_nd_rayleigh}.
		 We thus conclude that the power gain of \gls{bd}-\gls{ris} scales with group size and \gls{mimo} dimensions.
	 \end{subsubsection}

	 % The Pareto singular value frontiers of a $2 \times 2$ \gls{mimo} with a 32-element \gls{bd}-\gls{ris} is shown in Fig.~\ref{fg:singular_pareto}.
	 % The Pareto frontier of channel singular values reshaped by \gls{bd}-\gls{ris} is shown in Fig. \ref{fg:singular_pareto}.
	 % The Pareto frontier of channel singular values reshaped by \gls{bd}-\gls{ris} is shown in Fig. \ref{fg:singular_pareto}.
	 % Clearly, a larger group size provides
	 % and evolving trend of channel singular values are shown in Fig.~\ref{fg:singular_pareto} and \ref{fg:pc_singular_bound}.
	 % Clearly, \gls{bd}-\gls{ris} with a larger group size can redistribute the channel singular values to a wider range.
 \end{subsection}

 \begin{subsection}{Power Gain and Achievable Rate Maximization}
	 \begin{figure}[!t]
		 \centering
		 \subfloat[$16 \times N_\mathrm{S} \times 16$ (no direct)]{
			\label{fg:power_sx_txrx16_nd}
			 \resizebox{!}{3.0625cm}{
				 \input{../assets/simulation/pc_power_sx_txrx16_nd.tex}
			 }
		 }
		 \subfloat[$16 \times N_\mathrm{S} \times 16$]{
			\label{fg:power_sx_txrx16}
			 \resizebox{!}{3.0625cm}{
				 \input{../assets/simulation/pc_power_sx_txrx16.tex}
			 }
		 }
		 \caption{
			 Average maximum channel power gain versus \gls{ris} configuration.
			 `OP-left' and `OP-right' refer to the suboptimal solutions to problem \eqref{op:power} by lossy transformation \eqref{op:procrustes} where $\mathbf{\Theta}$ is to the left and right of the product, respectively.
		 }
		 \label{fg:power_sx}
	 \end{figure}

	 We first focus on channel power gain maximization problem \eqref{op:power}.
	 Fig. \ref{fg:power_sx} shows the maximum channel power under different \gls{ris} configurations.
	 An interesting observation is that the relative power gain of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} is even larger when the direct channel is significant.
	 For example, a 64-element fully \gls{bd}-\gls{ris} can almost provide the same channel power gain as a 256-element \gls{d}-\gls{ris} in Fig. \subref*{fg:power_sx_txrx16}, but not in Fig. \subref*{fg:power_sx_txrx16_nd}.
	 % This again credits to the superior space alignment capability of \gls{bd}-\gls{ris}.
	 This is because the \gls{ris} needs to balance the multiplicative forward-backward combining and the additive direct-indirect combining, such that the mode alignment advantage of \gls{bd}-\gls{ris} becomes more pronounced.
	 We also notice that the suboptimal solutions \eqref{eq:ris_procrustes} for fully-connected \gls{bd}-\gls{ris} by lossy transformation \eqref{op:procrustes} are very close to optimal especially for a large $N_\mathrm{S}$.

	 \begin{figure}[!t]
		 \centering
		 \subfloat[$4 \times 128 \times 4$]{
			\label{fg:rate_beamforming}
			 \resizebox{!}{3.25cm}{
				 \input{../assets/simulation/pc_rate_beamforming.tex}
			 }
		 }
		 \subfloat[$N_\mathrm{T} \times 128 \times N_\mathrm{R}$]{
			\label{fg:rate_txrx}
			 \resizebox{!}{3.25cm}{
				 \input{../assets/simulation/pc_rate_txrx.tex}
			 }
		 }
		 \\
		 \subfloat[$4 \times N_\mathrm{S} \times 4$]{
			\label{fg:rate_sx}
			 \resizebox{!}{3.25cm}{
				 \input{../assets/simulation/pc_rate_sx.tex}
			 }
		 }
		 \subfloat[$4 \times 128 \times 4$]{
			\label{fg:rate_kfactor}
			 \resizebox{!}{3.25cm}{
				 \input{../assets/simulation/pc_rate_kfactor.tex}
			 }
		 }
		 \caption{
			 Average achievable rate versus \gls{mimo} and \gls{ris} configurations.
			 The noise power is $\eta = \qty{-75}{dB}$, corresponding to a direct \gls{snr} of \num{-10} to \qty{30}{dB}.
			 `Alternate' refers to the alternating optimization and `Decouple' refers to the low-complexity design.
			 `D' means \gls{d}-\gls{ris} and `BD' refers to fully-connected \gls{bd}-\gls{ris}.
		 }
		 \label{fg:rate}
	 \end{figure}

	 Fig. \ref{fg:rate} presents the achievable rate under different \gls{mimo} and \gls{ris} configurations.
	 At a transmit power $P = \qty{10}{dB}$, Fig. \subref*{fg:rate_beamforming} shows that introducing a 128-element \gls{d}-\gls{ris} to $N_\mathrm{T}=N_\mathrm{R}=4$ \gls{mimo} can improve the achievable rate from \qty{22.2}{bps/Hz} to \qty{29.2}{bps/Hz} ($+\qty{31.5}{\percent}$).
	 A \gls{bd}-\gls{ris} of group size 4 and 128 can further elevate those to \qty{32.1}{bps/Hz} ($+\qty{44.6}{\percent}$) and \qty{34}{bps/Hz}  ($+\qty{53.2}{\percent}$), respectively.
	 An interesting observation is that the rate gap between the optimal \gls{ao} approach \eqref{op:rate_ris}--\eqref{eq:precoder} and the shaping-inspired solution \eqref{eq:ris_power}, \eqref{eq:precoder} narrows at larger group size and completely vanishes for a fully-connected \gls{bd}-\gls{ris}.
	 This implies that joint \gls{ris}-transceiver designs can be decoupled by first shaping the wireless channel and then optimizing the active beamformer, which significantly simplifies the process at marginal performance cost.
	 Figs. \subref*{fg:rate_txrx} and \subref*{fg:rate_sx} also show that both \emph{absolute and relative} rate gains of \gls{bd}-\gls{ris} versus \gls{d}-\gls{ris}
	 increases with the number of transmit and receive antennas and scattering elements, especially at high \gls{snr}.
	 % Being consistent with the power gain results in Fig. \ref{fg:power_sx}, this phenomenon is more pronounced at a high \gls{snr}.
	 For $N_\mathrm{S}=128$ and $P = \qty{20}{dB}$,
	 the achievable rate ratio of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} is \num{1.04}, \num{1.11}, and \num{1.13} for $N_\mathrm{T}=N_\mathrm{R}=1$, \num{4}, and \num{16}, respectively.
	 % increases from \num{1.04} in \gls{siso} to \num{1.11} for $N_\mathrm{T}=N_\mathrm{R}=4$ and \num{1.13} for $N_\mathrm{T}=N_\mathrm{R}=16$.
	 For $N_\mathrm{T}=N_\mathrm{R}=4$ and $P = \qty{20}{dB}$, this ratio amounts to \num{1.03}, \num{1.08}, and \num{1.13} for $N_\mathrm{S}=16$, \num{64}, and \num{256}, respectively.
	 Those observations align with the power gain results in Fig. \ref{fg:power_sx} and highlight the rate benefits of \gls{bd}-\gls{ris} over \gls{d}-\gls{ris} in large-scale \gls{mimo} systems.
	 In the low power regime (\num{-20} to \qty{-10}{dB}), we also notice that the slope of the achievable rate of \gls{bd}-\gls{ris} is steeper than that of \gls{d}-\gls{ris}.
	 That is, \gls{bd}-\gls{ris} can help to activate more streams and achieve the asymptotic \gls{dof} at a low transmit \gls{snr}.
	 This is particularly visible in Fig. \subref*{fg:rate_sx} where the topmost curve is almost a linear function of the transmit power.
	 % It is interesting to see that the topmost curve of Fig. \subref*{fg:rate_sx} is almost a linear function of the transmit power, suggesting that \gls{bd}-\gls{ris} can help to activate multiple streams and achieve full \gls{dof} at low transmit \gls{snr}.
	 It is expected from the shaping results in Fig. \ref{fg:singular_pareto} that \gls{bd}-\gls{ris} can significantly enlarge all channel singular values for higher receive \gls{snr}.
	 Finally, Fig. \subref*{fg:rate_kfactor} shows that the gap between \gls{d}- and \gls{bd}-\gls{ris} narrows as the Rician K-factor increases and becomes indistinguishable in \gls{los} environment.
	 The observation is expected from previous studies \cite{Shen2020a,Li2023b,Nerini2023} and aligns with Corollary \ref{co:los}, which suggests that the \gls{bd}-\gls{ris} should be deployed in rich-scattering environments to exploit its channel shaping potential.
 \end{subsection}
\end{section}

\begin{section}{Conclusion}
 This paper analyzes the channel shaping capability of \gls{ris} in terms of singular values redistribution.
 We consider a general \gls{bd} architecture that allows elements within the same group to interact, enabling more sophisticated manipulation than \gls{d}-\gls{ris}.
 This translates to a wider dynamic range of and better trade-off between singular values and significant power and rate gains, especially in large-scale \gls{mimo} systems.
 We characterize the Pareto frontiers of channel singular values via optimization approach and provide analytical bounds for practical deployment scenarios.
 Specifically, the former is done by proposing an efficient \gls{rcg} algorithm for \gls{bd}-\gls{ris} optimization problems, which converges much faster than existing methods.
 We also present two beamforming designs for rate maximization problem, one for optimal performance and the other exploits channel shaping for lower complexity.
 Extensive simulations show that the shaping advantage of \gls{bd}-\gls{ris} stems from its superior branch matching and mode alignment potentials, which scales with the number of elements, group size, and \gls{mimo} dimensions.

 % It would be interesting to investigate the impact of channel shaping through \gls{ris} on other wireless applications such as sensing and far-field power transfer.
 % One future direction is introducing \gls{bd}-\gls{ris} to \gls{mimo} interference channel for interference alignment or cancellation.
 % Another open issue is to exploit different groups of \gls{bd}-\gls{ris} to enhance the channel response (and possibly ride extra information) at different frequencies.
 % Incorporating a \gls{ris} at both transmitter and receiver sides provides even stronger manipulation that potentially align both direct-indirect and forward-backward spaces simultaneously.
 % Finally, integrating the \gls{ris} into the \gls{mimo} precoding and combining design is also an interesting topic for future research.
 % into the \gls{mimo} precoding and combining design is also an interesting topic for future research.
 % even better channel shaping can be achieved by incorporating the \gls{ris} into the \gls{mimo} precoding and combining design.
\end{section}

% achieving comparable channel power with significantly fewer elements, showcasing its potential for energy-efficient and cost-effective wireless communication systems, particularly in scenarios with direct link availability.


\begin{appendix}
	\begin{subsection}{Proof of Proposition \ref{pp:dof}}
		\label{ap:dof}
		It suffices to consider the rank of the indirect channel.
		Denote the \gls{svd} of the backward and forward channels as
		\begin{equation*}
			\mathbf{H}_\mathrm{B/F} = \begin{bmatrix}
				\mathbf{U}_{\mathrm{B/F},1} & \mathbf{U}_{\mathrm{B/F},2}
			\end{bmatrix}
			\begin{bmatrix}
				\mathbf{\Sigma}_{\mathrm{B/F},1} & \mathbf{0} \\
				\mathbf{0}                     & \mathbf{0}
			\end{bmatrix}
			\begin{bmatrix}
				\mathbf{V}_{\mathrm{B/F},1}^\mathsf{H} \\
				\mathbf{V}_{\mathrm{B/F},2}^\mathsf{H}
			\end{bmatrix},
		\end{equation*}
		where $\mathbf{U}_{\mathrm{B/F},1}$ and $\mathbf{V}_{\mathrm{B/F},1}$ are any left and right singular matrices of $\mathbf{H}_\mathrm{B/F}$ corresponding to non-zero singular values $\mathbf{\Sigma}_{\mathrm{B/F},1}$, and $\mathbf{U}_{\mathrm{B/F},2}$ and $\mathbf{V}_{\mathrm{B/F},2}$ are those corresponding to zero singular values.
		The rank of the indirect channel is \cite[(16.5.10.b)]{Hogben2013}
		\begin{equation*}
			\begin{split}
				\rank(\mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F})
				& = \rank(\mathbf{H}_\mathrm{B}) - \dim \bigl(\ker(\mathbf{H}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H}) \cap \ran(\mathbf{H}_\mathrm{B}^\mathsf{H})\bigr) \\
				& = \rank(\mathbf{H}_\mathrm{B}) - \dim \bigl(\ran(\mathbf{\Theta} \mathbf{U}_{\mathrm{F},2}) \cap \ran(\mathbf{V}_{\mathrm{B},1})\bigr) \\
				& \triangleq r_\mathrm{B} - r_\mathrm{L}(\mathbf{\Theta}),
			\end{split}
		\end{equation*}
		where we define $r_\mathrm{L}(\mathbf{\Theta}) \triangleq \dim \bigl(\ran(\mathbf{\Theta} \mathbf{U}_{\mathrm{F},2}) \cap \ran(\mathbf{V}_{\mathrm{B},1})\bigr)$ and $r_\mathrm{B/F} \triangleq \rank(\mathbf{H}_\mathrm{B/F})$.
		Since $\mathbf{U}_{\mathrm{F},2} \in \mathbb{U}^{N_\mathrm{S} \times (N_\mathrm{S} - r_\mathrm{F})}$ and $\mathbf{V}_{\mathrm{B},1} \in \mathbb{U}^{N_\mathrm{S} \times r_\mathrm{B}}$, we have $\max(r_\mathrm{B} - r_\mathrm{F}, 0) \le r_\mathrm{L}(\mathbf{\Theta}) \le \min(N_\mathrm{S} - r_\mathrm{F}, r_\mathrm{B})$
		and thus
		\begin{equation}
			\label{iq:rank_indirect}
			\max(r_\mathrm{B} + r_\mathrm{F} - N_\mathrm{S}, 0) \le \rank(\mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F}) \le \min(r_\mathrm{B}, r_\mathrm{F}).
		\end{equation}
		To attain the upper bound in \eqref{iq:rank_indirect}, the \gls{ris} needs to minimize $r_\mathrm{L}(\mathbf{\Theta})$ by aligning the ranges of $\mathbf{\Theta} \mathbf{U}_{\mathrm{F},2}$ and $\mathbf{V}_{\mathrm{B},2}$ as much as possible.
		This is achieved by
		\begin{equation}
			\label{eq:ris_dof_max}
			\mathbf{\Theta}_{\textnormal{DoF-max}}^{\textnormal{MIMO}} = \mathbf{Q}_{\mathrm{B},2} \mathbf{Q}_{\mathrm{F},2}^\mathsf{H},
		\end{equation}
		where $\mathbf{Q}_{\mathrm{B},2}$ and $\mathbf{Q}_{\mathrm{F},2}$ are the unitary matrices of the QR decomposition of $\mathbf{V}_{\mathrm{B},2}$ and $\mathbf{U}_{\mathrm{F},2}$, respectively.
		Similarly, the lower bound in \eqref{iq:rank_indirect} is attained at
		\begin{equation}
			\label{eq:ris_dof_min}
			\mathbf{\Theta}_{\textnormal{DoF-min}}^{\textnormal{MIMO}} = \mathbf{Q}_{\mathrm{B},1} \mathbf{Q}_{\mathrm{F},2}^\mathsf{H},
		\end{equation}
		where $\mathbf{Q}_{\mathrm{B},1}$ is the unitary matrix of the QR decomposition of $\mathbf{V}_{\mathrm{B},1}$.
		While the \gls{dof}-optimal structures \eqref{eq:ris_dof_max} and \eqref{eq:ris_dof_min} are always feasible for fully-connected \gls{bd}-\gls{ris}, they are generally infeasible for \gls{d}-\gls{ris} unless there exist some QR decomposition that diagonalize $\mathbf{Q}_{\mathrm{B},2} \mathbf{Q}_{\mathrm{F},2}^\mathsf{H}$ and $\mathbf{Q}_{\mathrm{B},1} \mathbf{Q}_{\mathrm{F},2}^\mathsf{H}$ simultaneously.
		That is, \gls{bd}-\gls{ris} may achieve a larger or smaller number of \gls{dof} of indirect channel, and thus equivalent channel, than \gls{d}-\gls{ris}.
	\end{subsection}

	\begin{subsection}{Proof of Proposition \ref{pp:rd}}
		\label{ap:rank_deficient}
		We consider rank-$k$ forward channel and the proof follows similarly for rank-$k$ backward channel.
		Let $\mathbf{H}_\mathrm{F} = \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}$ be the \gls{svd} of the forward channel.
		The channel Gram matrix $\mathbf{G} \triangleq \mathbf{H} \mathbf{H}^\mathsf{H} $ can be written as
		\begin{equation*}
			\begin{split}
				\mathbf{G}
				& = \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{D}^\mathsf{H} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F}^\mathsf{H} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H}                                                         \\
				& \quad + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H} \mathbf{H}_\mathrm{D}^\mathsf{H} + \mathbf{H}_\mathrm{D} \mathbf{V}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H}       \\
				& = \mathbf{H}_\mathrm{D} (\mathbf{I} - \mathbf{V}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}) \mathbf{H}_\mathrm{D}^\mathsf{H}                                                                                                                                                                                                               \\
				& \quad + (\mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} + \mathbf{H}_\mathrm{D} \mathbf{V}_\mathrm{F}) (\mathbf{\Sigma}_\mathrm{F} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{\Theta}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} + \mathbf{V}_\mathrm{F}^\mathsf{H} \mathbf{H}_\mathrm{D}^\mathsf{H}) \\
				& = \mathbf{Y} + \mathbf{Z} \mathbf{Z}^\mathsf{H},
			\end{split}
		\end{equation*}
		where we define $\mathbf{Y} \triangleq \mathbf{H}_\mathrm{D} (\mathbf{I} - \mathbf{V}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}) \mathbf{H}_\mathrm{D}^\mathsf{H} \in \mathbb{H}^{N_\mathrm{R} \times N_\mathrm{R}}$ and $\mathbf{Z} \triangleq \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} + \mathbf{H}_\mathrm{D} \mathbf{V}_\mathrm{F} \in \mathbb{C}^{N_\mathrm{R} \times k}$.
		That is to say, $\mathbf{G}$ can be expressed as a Hermitian matrix plus $k$ rank-1 perturbations.
		According to the Cauchy interlacing formula \cite[Theorem 8.4.3]{Golub2013}, the $n$-th eigenvalue of $\mathbf{G}$ is bounded by
		\begin{align}
			\lambda_n(\mathbf{G}) & \le \lambda_{n-k}(\mathbf{Y}), &  & \text{if } n > k, \label{iq:ev_rd_max}          \\
			\lambda_n(\mathbf{G}) & \ge \lambda_n(\mathbf{Y}),     &  & \text{if } n < N - k + 1 \label{iq:ev_rd_min}.
		\end{align}
		Since $\mathbf{Y} = \mathbf{T} \mathbf{T}^\mathsf{H}$ is positive semi-definite, taking the square roots of \eqref{iq:ev_rd_max} and \eqref{iq:ev_rd_min} gives \eqref{iq:sv_rd_max} and \eqref{iq:sv_rd_min}.
	\end{subsection}

	\begin{subsection}{Proof of Proposition \ref{pp:nd}}
		\label{ap:nd}
		Let $\mathbf{H}_\mathrm{B} = \mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{V}_\mathrm{B}^\mathsf{H}$ and $\mathbf{H}_\mathrm{F} = \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}$ be the \gls{svd} of the backward and forward channels, respectively.
		The scattering matrix of fully-connected \gls{bd}-\gls{ris} can be decomposed as
		\begin{equation}
			\label{eq:ris_decompose}
			\mathbf{\Theta} = \mathbf{V}_\mathrm{B} \mathbf{X} \mathbf{U}_\mathrm{F}^\mathsf{H},
		\end{equation}
		where $\mathbf{X} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$ is a unitary matrix to be designed.
		The equivalent channel is thus a function of $\mathbf{X}$
		\begin{equation}
			\label{eq:channel_nd}
			\mathbf{H} = \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F} = \mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}.
		\end{equation}
		Since $\sv(\mathbf{U} \mathbf{A} \mathbf{V}^\mathsf{H}) = \sv(\mathbf{A})$ for unitary $\mathbf{U}$ and $\mathbf{V}$, we have
		\begin{equation}
			\label{eq:sv_factor}
			\begin{split}
				\sv(\mathbf{H}) & = \sv(\mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H})                                                                     \\
								& = \sv(\mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F})                                                                                                                            \\
								& = \sv(\bar{\mathbf{U}}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{\bar{V}}_\mathrm{B}^\mathsf{H} \bar{\mathbf{U}}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{\bar{V}}_\mathrm{F}^\mathsf{H}) \\
								& = \sv(\mathbf{BF}),
			\end{split}
		\end{equation}
		where $\bar{\mathbf{U}}_{\mathrm{B}} \in \mathbb{U}^{N_\mathrm{R} \times N_\mathrm{R}}$, $\bar{\mathbf{V}}_\mathrm{B}, \bar{\mathbf{U}}_\mathrm{F} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$, and $\bar{\mathbf{V}}_\mathrm{F} \in \mathbb{U}^{N_\mathrm{T} \times N_\mathrm{T}}$ can be designed arbitrarily.
	\end{subsection}

	\begin{subsection}{Proof of Corollary \ref{co:nd_sv_prod_tail}}
		\label{ap:nd_sv_prod_tail}
		\eqref{iq:sv_nd_prod_largest} follows from \eqref{iq:horn} when $r = k$.
		On the other hand, if we can prove
		\begin{equation}
			\label{eq:sv_prod_all_ext}
			\prod_{n=1}^{\bar{N}} \sigma_n(\mathbf{H}) = \prod_{n=1}^{\bar{N}} \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}),
		\end{equation}
		then \eqref{iq:sv_nd_prod_smallest} follows from \eqref{iq:sv_nd_prod_largest} and the non-negativity of singular values.
		To see \eqref{eq:sv_prod_all_ext}, we start from a stricter result
		\begin{equation}
			\label{eq:sv_product_all}
			\prod_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{H}) = \prod_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}),
		\end{equation}
		which is provable by cases.
		When $N_\mathrm{S} > N$, both sides of \eqref{eq:sv_product_all} become zero since $\sigma_n(\mathbf{H}) = \sigma_n(\mathbf{H}_\mathrm{B}) = \sigma_n(\mathbf{H}_\mathrm{F}) = 0$ for $n > N$.
		When $N_\mathrm{S} \le N$, we have
		\begin{equation*}
			\begin{split}
				\prod\nolimits_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{H})
				& = \prod\nolimits_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F})             \\
				& = \prod\nolimits_{n=1}^{N_\mathrm{S}} \sigma_n(\hat{\mathbf{\Sigma}}_\mathrm{B} \mathbf{X} \hat{\mathbf{\Sigma}}_\mathrm{F}) \\
				& = \det\bigl(\hat{\mathbf{\Sigma}}_\mathrm{B} \mathbf{X} \hat{\mathbf{\Sigma}}_\mathrm{F}\bigr)                               \\
				& = \det\bigl(\hat{\mathbf{\Sigma}}_\mathrm{B}\bigr) \det(\mathbf{X}) \det\bigl(\hat{\mathbf{\Sigma}}_\mathrm{F}\bigr)         \\
				& = \prod\nolimits_{n=1}^{N_\mathrm{S}} \sigma_n(\mathbf{\Sigma}_\mathrm{B}) \sigma_n(\mathbf{\Sigma}_\mathrm{F}),
			\end{split}
		\end{equation*}
		where the first equality follows from \eqref{eq:sv_factor} and $\hat{\mathbf{\Sigma}}_\mathrm{B}, \hat{\mathbf{\Sigma}}_\mathrm{F}$ truncate $\mathbf{\Sigma}_\mathrm{B}, \mathbf{\Sigma}_\mathrm{F}$ to square matrices of dimension $N_\mathrm{S}$, respectively.
		It is evident that \eqref{eq:sv_product_all} implies \eqref{eq:sv_prod_all_ext} and thus \eqref{iq:sv_nd_prod_smallest}.
	\end{subsection}

	\begin{subsection}{Proof of Corollary \ref{co:nd_sv_indl}}
		\label{ap:nd_sv_indl}
		In \eqref{iq:sv_nd_indl}, the set of upper bounds
		\begin{equation}
			\label{iq:sv_nd_indl_set_max}
			\bigl\{\sigma_n(\mathbf{H}) \le \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) \mid [i,j,k] \in [N_\mathrm{S}]^3, i+j=n+1\bigr\}
		\end{equation}
		is a special case of \eqref{iq:horn} with $(I, J, K) \in [N_\mathrm{S}]^3$.
		The minimum\footnote{One may think to take the \emph{maximum} of those upper bounds as the problem of interest is the attainable dynamic range of $n$-th singular value. However, this is infeasible since the singular values will be reordered therein.} of \eqref{iq:sv_nd_indl_set_max} is selected as the tightest upper bound in \eqref{iq:sv_nd_indl}.
		On the other hand, the set of lower bounds
		\begin{equation}
			\label{iq:sv_nd_indl_set_min}
			\bigl\{\sigma_n(\mathbf{H}) \ge \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F}) \mid [i,j,k] \in [N_\mathrm{S}]^3, i+j=n+N_\mathrm{S}\bigr\}
		\end{equation}
		can be induced by \eqref{iq:sv_nd_indl_set_max}, \eqref{eq:sv_product_all}, and the non-negativity of singular values.
		The maximum of \eqref{iq:sv_nd_indl_set_min} is selected as the tightest lower bound in \eqref{iq:sv_nd_indl}.
		Interested readers are also referred to \cite[(2.0.3)]{Zhang2005}.

		To attain the upper bound, the \gls{bd}-\gls{ris} needs to maximize the minimum of the first $n$ channel singular values.
		It follows from \eqref{eq:ris_nd_sv_indl_max} that
		\begin{equation*}
			\begin{split}
				\sv(\mathbf{H})
				& = \sv(\mathbf{H}_\mathrm{B} \mathbf{V}_\mathrm{B} \mathbf{P} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{H}_\mathrm{F})                                                                                                                         \\
				& = \sv(\mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{V}_\mathrm{B}^\mathsf{H} \mathbf{V}_\mathrm{B} \mathbf{P} \mathbf{U}_\mathrm{F}^\mathsf{H} \mathbf{U}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F} \mathbf{U}_\mathrm{F}^\mathsf{H}) \\
				& = \sv(\mathbf{\Sigma}_\mathrm{B} \mathbf{P} \mathbf{\Sigma}_\mathrm{F}).
			\end{split}
		\end{equation*}
		On the one hand, $\mathbf{P}_{ij}=1$ with $(i, j)$ satisfying \eqref{eq:idx_nd_sv_indl_max} ensures $\min_{i+j=n+1} \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F})$ is a singular value of $\mathbf{H}$.
		It is actually among the first $n$ since the number of pairs $(i',j')$ not majorized by $(i,j)$ is $n-1$.
		On the other hand, \eqref{eq:perm_nd_sv_indl_max} ensures the first $(n-1)$-th singular values are no smaller than $\min_{i+j=n+1} \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F})$.
		Combining both facts, we claim the upper bound $\sigma_n(\mathbf{H}) = \min_{i+j=n+1} \sigma_i(\mathbf{H}_\mathrm{B}) \sigma_j(\mathbf{H}_\mathrm{F})$ is attainable by \eqref{eq:ris_nd_sv_indl_max}.
		The attainability of the lower bound can be proved similarly and the details are omitted.
	\end{subsection}

	\begin{subsection}{Proof of Corollary \ref{co:nd_power}}
		\label{ap:nd_power}
		From \eqref{eq:ris_decompose} and \eqref{eq:channel_nd} we have
		\begin{equation}
			\begin{split}
				\lVert \mathbf{H} \rVert _\mathrm{F}^2
				& = \tr \bigl(\mathbf{V}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F}^\mathsf{H} \mathbf{X}^\mathsf{H} \mathbf{\Sigma}_\mathrm{B}^\mathsf{H} \mathbf{U}_\mathrm{B}^\mathsf{H} \mathbf{U}_\mathrm{B} \mathbf{\Sigma}_\mathrm{B} \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{V}_\mathrm{F}^\mathsf{H}\bigr) \\
				& = \tr \bigl(\mathbf{\Sigma}_\mathrm{B}^\mathsf{H} \mathbf{\Sigma}_\mathrm{B} \cdot \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F}^\mathsf{H} \mathbf{X}^\mathsf{H}\bigr)                                                                                                         \\
				& \triangleq \tr \bigl(\tilde{\mathbf{B}} \tilde{\mathbf{F}}\bigr),
			\end{split}
		\end{equation}
		where $\mathbf{X} \triangleq \mathbf{V}_\mathrm{B}^\mathsf{H} \mathbf{\Theta} \mathbf{U}_\mathrm{F} \in \mathbb{U}^{N_\mathrm{S} \times N_\mathrm{S}}$, $\tilde{\mathbf{B}} \triangleq \mathbf{\Sigma}_\mathrm{B}^\mathsf{H} \mathbf{\Sigma}_\mathrm{B} \in \mathbb{H}_+^{N_\mathrm{S} \times N_\mathrm{S}}$, and $\tilde{\mathbf{F}} \triangleq \mathbf{X} \mathbf{\Sigma}_\mathrm{F} \mathbf{\Sigma}_\mathrm{F}^\mathsf{H} \mathbf{X}^\mathsf{H} \in \mathbb{H}_+^{N_\mathrm{S} \times N_\mathrm{S}}$.
		By Ruhe's trace inequality for positive semi-definite matrices \cite[(H.1.g) and (H.1.h)]{Marshall2010},
		\begin{equation*}
			\sum_{n=1}^N \lambda_n(\tilde{\mathbf{B}}) \lambda_{N_\mathrm{S}-n+1}(\tilde{\mathbf{F}}) \le \tr \bigl(\tilde{\mathbf{B}} \tilde{\mathbf{F}}\bigr) \le \sum_{n=1}^N \lambda_n(\tilde{\mathbf{B}}) \lambda_n(\tilde{\mathbf{F}}),
		\end{equation*}
		which simplifies to \eqref{iq:power_nd}.
		The upper bound is attained when $\mathbf{X}$ is chosen to match the singular values of $\tilde{\mathbf{F}}$ to those of $\tilde{\mathbf{B}}$ in similar order.
		Apparently this occurs at $\mathbf{X} = \mathbf{I}$ and $\mathbf{\Theta} = \mathbf{V}_\mathrm{B} \mathbf{U}_\mathrm{F}^\mathsf{H}$.
		On the other hand, the lower bound is attained when the singular values of $\tilde{\mathbf{F}}$ and $\tilde{\mathbf{B}}$ are matched in reverse order, namely $\mathbf{X} = \mathbf{J}$ and $\mathbf{\Theta} = \mathbf{V}_\mathrm{B} \mathbf{J} \mathbf{U}_\mathrm{F}^\mathsf{H}$.
	\end{subsection}

	\begin{subsection}{Proof of Corollary \ref{co:nd_capacity_snr_extreme}}
		\label{ap:nd_capacity}
		When perfect \gls{csi} is available at the transmitter, in the low-\gls{snr} regime, the capacity is achieved by dominant eigenmode transmission \cite[(5.26)]{Clerckx2013}
		\begin{align*}
			C_{\rho_\downarrow}
			& = \log\bigl(1 + \rho \lambda_1(\mathbf{H}^\mathsf{H} \mathbf{H})\bigr)        \\
			& = \log\bigl(1 + \rho \sigma_1^2(\mathbf{H})\bigr)                             \\
			& \approx \rho \sigma_1^2(\mathbf{H})                                           \\
			& \le \rho \sigma_1^2(\mathbf{H}_\mathrm{B}) \sigma_1^2(\mathbf{H}_\mathrm{F}),
		\end{align*}
		where the approximation is $\log(1 + x) \approx x$ for small $x$ and the inequality follows from \eqref{iq:sv_nd_prod_largest} with $k=1$.
		In the high-\gls{snr} regime, the capacity is achieved by multiple eigenmode transmission with uniform power location \cite[(5.27)]{Clerckx2013}
		\begin{align*}
			C_{\rho_\uparrow}
			& = \sum\nolimits_{n=1}^N \log\Bigl(1 + \frac{\rho}{N} \lambda_n(\mathbf{H}^\mathsf{H} \mathbf{H})\Bigr)                     \\
			& \approx \sum\nolimits_{n=1}^N \log\Bigl(\frac{\rho}{N} \sigma_n^2(\mathbf{H})\Bigr)                                        \\
			& = N \log \frac{\rho}{N} + \sum\nolimits_{n=1}^N \log \sigma_n^2(\mathbf{H})                                                \\
			& = N \log \frac{\rho}{N} + \log \prod\nolimits_{n=1}^N \sigma_n^2(\mathbf{H})                                               \\
			& \le N \log \frac{\rho}{N} + 2 \log \prod\nolimits_{n=1}^N \sigma_n(\mathbf{H}_\mathrm{B}) \sigma_n(\mathbf{H}_\mathrm{F}),
		\end{align*}
		where the approximation is $\log(1 + x) \approx \log(x)$ for large $x$ and the inequality follows from \eqref{iq:sv_nd_prod_largest} with $k=N$.

		We now show \eqref{eq:ris_nd_rate_max} can achieve the upper bounds in \eqref{iq:capacity_nd_snr_low} and \eqref{iq:capacity_nd_snr_high} simultaneously.
		On the one hand, \eqref{eq:ris_nd_rate_max} is a special case of \eqref{eq:ris_nd_sv_indl_max} with $\mathbf{P} = \mathbf{I}$, which satisfies \eqref{eq:idx_nd_sv_indl_max} and \eqref{eq:perm_nd_sv_indl_max} for $n=1$ and thus attain $\sigma_1(\mathbf{H}) = \sigma_1(\mathbf{H}_\mathrm{B}) \sigma_1(\mathbf{H}_\mathrm{F})$.
		On the other hand, since $\log(\cdot)$ is a monotonic function, we can prove similar to Appendix \ref{ap:nd_power} that $\sum_{n=1}^N \log \sigma_n^2(\mathbf{H}) \le \sum_{n=1}^N \log \sigma_n^2(\mathbf{H}_\mathrm{B}) \sigma_n^2(\mathbf{H}_\mathrm{F})$ and the bound is tight at \eqref{eq:ris_nd_rate_max}.
		The proof is complete.
	\end{subsection}

	\begin{subsection}{Proof of Proposition \ref{pp:shaping}}
		\label{ap:shaping}
		The sub-differential of a symmetric gauge function of singular values of a matrix with respect to the matrix itself is given by \cite[Theorem 2]{Watson1992}
		\begin{equation}
			\partial_{\mathbf{H}^*} f\bigl(\sv(\mathbf{H})\bigr) = \conv \bigl\{ \mathbf{U} \mathbf{D} \mathbf{V}^\mathsf{H} \bigr\},
		\end{equation}
		where $\mathbf{D} \in \mathbb{C}^{N_\mathrm{R} \times N_\mathrm{T}}$ is a rectangular diagonal matrix with $[\mathbf{D}]_{n,n} \in \partial_{\sigma_n(\mathbf{H})} f\bigl(\sv(\mathbf{H})\bigr)$, $\forall n \in [N]$, and $\mathbf{U}$, $\mathbf{V}$ are any left and right singular matrices of $\mathbf{H}$.
		It implies
		\begin{align*}
			\partial f\bigl(\sv(\mathbf{H})\bigr)
			& \ni \tr \bigl(\mathbf{V}^* \mathbf{D}^\mathsf{T} \mathbf{U}^\mathsf{T} \partial \mathbf{H}^*\bigr) \\
			& = \tr \bigl(\mathbf{V}^* \mathbf{D}^\mathsf{T} \mathbf{U}^\mathsf{T} \mathbf{H}_{\mathrm{B},g}^* \partial {\mathbf{\Theta}_g^*} \mathbf{H}_{\mathrm{F},g}^*\bigr) \\
			& = \tr \bigl(\mathbf{H}_{\mathrm{F},g}^* \mathbf{V}^* \mathbf{D}^\mathsf{T} \mathbf{U}^\mathsf{T} \mathbf{H}_{\mathrm{B},g}^* \partial {\mathbf{\Theta}_g^*} \bigr),
		\end{align*}
		% \begin{align*}
		% 	\partial f\bigl(\sv(\mathbf{H})\bigr)
		% 	& = \tr \bigl(\conv \{ \mathbf{V}^* \mathbf{D}^\mathsf{T} \mathbf{U}^\mathsf{T} \} \partial \mathbf{H}^*\bigr) \\
		% 	& = \tr \bigl(\conv \{ \mathbf{V}^* \mathbf{D}^\mathsf{T} \mathbf{U}^\mathsf{T} \mathbf{H}_{\mathrm{B},g}^* \partial {\mathbf{\Theta}_g^*} \mathbf{H}_{\mathrm{F},g}^* \}\bigr) \\
		% 	& = \tr \bigl(\conv \{ \mathbf{H}_{\mathrm{F},g}^* \mathbf{V}^* \mathbf{D}^\mathsf{T} \mathbf{U}^\mathsf{T} \mathbf{H}_{\mathrm{B},g}^* \}\partial {\mathbf{\Theta}_g^*} \bigr)
		% \end{align*}
		and therefore $\mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{U} \mathbf{D} \mathbf{V}^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}$ constitutes a sub-gradient of $f\bigl(\sv(\mathbf{H})\bigr)$ with respect to $\mathbf{\Theta}_g$.
		The convex hull of those sub-gradients is the sub-differential \eqref{eq:shaping_subdiff}.
	\end{subsection}

	\begin{subsection}{Proof of Lemma \ref{lm:rate}}
		\label{ap:rate}
		The differential of $R$ with respect to $\mathbf{\Theta}_g^*$ is \cite{Hjorungnes2007}
		\begin{align*}
			\partial R
			& = \frac{1}{\eta} \tr \biggl\{ \partial \mathbf{H}^* \cdot \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T} \Bigl(\mathbf{I} + \frac{\mathbf{H}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T}}{\eta}\Bigr)^{-1} \biggr\}                                                                      \\
			& = \frac{1}{\eta} \tr \biggl\{ \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \cdot \mathbf{H}_{\mathrm{F},g}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T} \Bigl(\mathbf{I} + \frac{\mathbf{H}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T}}{\eta}\Bigr)^{-1} \biggr\} \\
			& = \frac{1}{\eta} \tr \biggl\{ \mathbf{H}_{\mathrm{F},g}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T} \Bigl(\mathbf{I} + \frac{\mathbf{H}^* \mathbf{Q}^\mathsf{T} \mathbf{H}^\mathsf{T}}{\eta}\Bigr)^{-1} \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \biggr\},
		\end{align*}
		and the corresponding complex derivative is \eqref{eq:gradient_eucl_rate}.
	\end{subsection}

	\begin{subsection}{Proof of Proposition \ref{pp:power}}
		\label{ap:power}
		The differential of \eqref{ob:power} with respect to $\mathbf{\Theta}_g^*$ is
		\begin{align*}
			\partial \lVert \mathbf{H} \rVert _\mathrm{F}^2
			& = \tr\bigl(\mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^* \cdot \mathbf{H}_{\mathrm{F},g}^* (\mathbf{H}_\mathrm{D}^\mathsf{T} + \mathbf{H}_\mathrm{F}^\mathsf{T} \mathbf{\Theta}^\mathsf{T} \mathbf{H}_\mathrm{B}^\mathsf{T})\bigr) \\
			& = \tr\bigl(\mathbf{H}_{\mathrm{F},g}^* (\mathbf{H}_\mathrm{D}^\mathsf{T} + \mathbf{H}_\mathrm{F}^\mathsf{T} \mathbf{\Theta}^\mathsf{T} \mathbf{H}_\mathrm{B}^\mathsf{T}) \mathbf{H}_{\mathrm{B},g}^* \cdot \partial \mathbf{\Theta}_g^*\bigr)
		\end{align*}
		and the corresponding complex derivative is
		\begin{equation}
			\frac{\partial \lVert \mathbf{H} \rVert _\mathrm{F}^2}{\partial \mathbf{\Theta}_g^*} = \mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta} \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H} \triangleq \mathbf{M}_g,
		\end{equation}
		whose \gls{svd} is denoted as $\mathbf{M}_g = \mathbf{U}_g \mathbf{\Sigma}_g \mathbf{V}_g^\mathsf{H}$.
		The quadratic objective \eqref{ob:power} can be successively approximated by its first-order Taylor expansion, resulting in the subproblem
		\begin{maxi!}
			{\scriptstyle{\mathbf{\Theta}}}{\sum_g 2 \Re\bigl\{ \tr(\mathbf{\Theta}_g^\mathsf{H} \mathbf{M}_g) \bigr\}}{\label{op:power_ris_taylor}}{\label{ob:power_ris_taylor}}
			\addConstraint{\mathbf{\Theta}_g^\mathsf{H} \mathbf{\Theta}_g=\mathbf{I}, \quad \forall g,}{}{}
		\end{maxi!}
		whose optimal solution is
		\begin{equation}
			\label{eq:ris_power_taylor}
			\tilde{\mathbf{\Theta}}_g = \mathbf{U}_g \mathbf{V}_g^\mathsf{H}, \quad \forall g.
		\end{equation}
		This is because $\Re \bigl\{\tr(\mathbf{\Theta}_g^\mathsf{H} \mathbf{M}_g)\bigr\} = \Re \bigl\{ \tr(\mathbf{\Sigma}_g \mathbf{V}_g^\mathsf{H} \mathbf{\Theta}_g^\mathsf{H} \mathbf{U}_g) \bigr\} \le \tr(\mathbf{\Sigma}_g)$ and the bound is tight when $\mathbf{V}_g^\mathsf{H} \mathbf{\Theta}_g^\mathsf{H} \mathbf{U}_g = \mathbf{I}$.

		Next, we prove that solving the affine approximation \eqref{op:power_ris_taylor} by \eqref{eq:ris_power_taylor} does not decrease \eqref{ob:power}.
		Since $\tilde{\mathbf{\Theta}} = \diag(\tilde{\mathbf{\Theta}}_1, \ldots, \tilde{\mathbf{\Theta}}_G)$ is optimal for \eqref{op:power_ris_taylor}, we have
		\begin{equation}
			\label{iq:power_ris_taylor}
			\begin{split}
				2 \Re \bigl\{ & \sum\limits_g \tr(\tilde{\mathbf{\Theta}}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}) \\
				& + \sum\limits_{g_1,g_2} \tr(\tilde{\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \mathbf{\Theta}_{g_2} \mathbf{H}_{\mathrm{F},g_2} \mathbf{H}_{\mathrm{F},g_1}^\mathsf{H})\bigr\} \\
				\ge 2 \Re \bigl\{ &\sum\limits_g \tr({\mathbf{\Theta}}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_{\mathrm{F},g}^\mathsf{H}) \\
				& + \sum\limits_{g_1,g_2} \tr({\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \mathbf{\Theta}_{g_2} \mathbf{H}_{\mathrm{F},g_2} \mathbf{H}_{\mathrm{F},g_1}^\mathsf{H})\bigr\}.
			\end{split}
		\end{equation}
		Besides, $\lVert \sum_g \mathbf{H}_{\mathrm{B},g} \tilde{\mathbf{\Theta}}_g \mathbf{H}_{\mathrm{F},g} - \sum_g \mathbf{H}_{\mathrm{B},g} \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g} \rVert _\mathrm{F}^2 \ge 0$ implies
		\begin{equation}
			\label{iq:auxiliary_nonnegative}
			\begin{split}
				& \sum\limits_{g_1,g_2} \tr(\mathbf{H}_{\mathrm{F},g_1}^\mathsf{H} \tilde{\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \tilde{\mathbf{\Theta}}_{g_2} \mathbf{H}_{\mathrm{F},g_2}) \\
				& \quad + \sum\limits_{g_1,g_2} \tr(\mathbf{H}_{\mathrm{F},g_1}^\mathsf{H} {\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} {\mathbf{\Theta}}_{g_2} \mathbf{H}_{\mathrm{F},g_2}) \\
				\ge & 2 \Re \bigl\{\sum\limits_{g_1,g_2} \tr(\mathbf{H}_{\mathrm{F},g_1}^\mathsf{H} \tilde{\mathbf{\Theta}}_{g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_1}^\mathsf{H} \mathbf{H}_{\mathrm{B},g_2} \mathbf{\Theta}_{g_2} \mathbf{H}_{\mathrm{F},g_2})\bigr\}.
			\end{split}
		\end{equation}
		Adding \eqref{iq:power_ris_taylor} and \eqref{iq:auxiliary_nonnegative}, we have
		\begin{equation}
			\begin{split}
				& 2 \Re \bigl\{\tr(\tilde{\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}) \bigr\} + \tr(\mathbf{H}_\mathrm{F}^\mathsf{H} \tilde{\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{B} \tilde{\mathbf{\Theta}} \mathbf{H}_\mathrm{F}) \\
				\ge & 2 \Re \bigl\{\tr({\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{D} \mathbf{H}_\mathrm{F}^\mathsf{H}) \bigr\} + \tr(\mathbf{H}_\mathrm{F}^\mathsf{H} {\mathbf{\Theta}}^\mathsf{H} \mathbf{H}_\mathrm{B}^\mathsf{H} \mathbf{H}_\mathrm{B} {\mathbf{\Theta}} \mathbf{H}_\mathrm{F}),
			\end{split}
		\end{equation}
		which suggests that \eqref{ob:power} is non-decreasing as the solution iterates over \eqref{eq:ris_power_taylor}.
		Since \eqref{ob:power} is also bounded from above, the sequence of objective values converges.

		Finally, we prove that any solution when \eqref{ob:power} converges, denoted by $\tilde{\mathbf{\Theta}}^?$, is a stationary point of \eqref{op:power}.
		The \gls{kkt} conditions of \eqref{op:power} and \eqref{op:power_ris_taylor} are equivalent in terms of primal/dual feasibility and complementary slackness, while the stationary conditions are respectively, $\forall g$,
		\begin{gather}
			\mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta}^\star \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H} - \mathbf{\Theta}_g^\star \mathbf{\Lambda}_g^\mathsf{H} = 0,\label{eq:power_ris_optimal}\\
			\mathbf{M}_g - \mathbf{\Theta}_g^\star \mathbf{\Lambda}_g^\mathsf{H} = 0.\label{eq:power_ris_taylor_optimal}
		\end{gather}
		On convergence of \eqref{ob:power}, we have $\lVert \mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta}^? \mathbf{H}_\mathrm{F} \rVert _\mathrm{F}^2$

		\eqref{eq:power_ris_taylor_optimal} becomes $\mathbf{H}_{\mathrm{B},g}^\mathsf{H} (\mathbf{H}_\mathrm{D} + \mathbf{H}_\mathrm{B} \mathbf{\Theta}^? \mathbf{H}_\mathrm{F}) \mathbf{H}_{\mathrm{F},g}^\mathsf{H} - \mathbf{\Theta}_g^? \mathbf{\Lambda}_g^\mathsf{H} = 0$ and reduces to \eqref{eq:power_ris_optimal}.
		The proof is thus completed.
	\end{subsection}

	\begin{subsection}{Proof of Lemma \ref{lm:wsr}}
		\label{ap:wsr}
		The differential of $f = \sum_{k=1}^K \rho_k R_k$ with respect to $\mathbf{\Theta}_g^*$ is
		\begin{align*}
			\partial f
			& = \sum_{k=1}^K \rho_k \tr \Bigl\{ \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \Bigl( \mathbf{H}_{\mathrm{F},g}^{(k)\mathsf{H}} \partial \mathbf{\Theta}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \\
			& \quad + \mathbf{H}^{(kk)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}_{\mathrm{B},g}^{(k)} \partial \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}^{(k)} - \mathbf{H}^{(kk)\mathsf{H}} \mathbf{Q}_k^{(-1)} \\
			& \quad \times \sum_{j \ne k} \Bigl(\mathbf{H}_{\mathrm{B},g}^{(k)} \partial \mathbf{\Theta}_g \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} \mathbf{H}^{(kj)\mathsf{H}} \\
			& \quad + \mathbf{H}^{(kj)} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \partial \mathbf{\Theta}_g^\mathsf{H} \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \Bigr) \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \Bigr) \mathbf{W}_k \Bigr\} \\
			& = \sum_{k=1}^K \rho_k \Bigl( \tr \Bigl\{ \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^{(k)\mathsf{H}} \partial \mathbf{\Theta}_g^\mathsf{H}\Bigr\} \\
			& \quad + \tr \Bigl\{ \mathbf{H}_{\mathrm{F},g}^{(k)\mathsf{H}} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \mathbf{H}^{(kk)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \partial \mathbf{\Theta}_g \Bigr\} \\
			& \quad - \tr \Bigl\{ \sum_{j \ne k} \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \mathbf{W}_k \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \mathbf{H}^{(kk)\mathsf{H}} \\
			& \quad \quad \times \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kj)} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \partial \mathbf{\Theta}_g^\mathsf{H} \Bigr\} \\
			& \quad - \tr \Bigl\{ \sum_{j \ne k} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{W}_j \mathbf{W}_j^\mathsf{H} \mathbf{H}^{(kj)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}^{(kk)} \mathbf{W}_k \\
			& \quad \quad \times \mathbf{E}_k \mathbf{W}_k^\mathsf{H} \mathbf{H}^{(kk)\mathsf{H}} \mathbf{Q}_k^{(-1)} \mathbf{H}_{\mathrm{B},g}^{(k)} \partial \mathbf{\Theta}_g \Bigr\} \Bigr),
		\end{align*}
		and the corresponding complex derivative is \eqref{eq:gradient_eucl_wsr}.
	\end{subsection}

	\begin{subsection}{Proof of Proposition \ref{pp:interference}}
		\label{ap:interference}
		Minimizing \eqref{ob:interference} is equivalent to maximizing
		% \begin{align*}
		% 	f &= \sum_{k=1}^K \sum_{j \ne k} \tr \Bigl\{ \sum_g \bigl(- \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{H}_{\mathrm{D}}^{(kj)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)} \mathbf{\Theta}_g - \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{D}}^{(kj)} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{\Theta}_g^\mathsf{H}\bigr)\Bigr\}
		% \end{align*}
		\begin{align*}
			f(\mathbf{\Theta}) & = - I + \sum_g \beta_g^{(k)} \tr \Bigl\{ \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{H}_{\mathrm{F},g}^{(j)} \Bigr\} \\
			& = \sum_{k=1}^K \sum_{j \ne k} - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{H}_{\mathrm{D}}^{(kj)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)} \mathbf{\Theta}_g\Bigr\} \\
			& \quad - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{D}}^{(kj)} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{\Theta}_g^\mathsf{H} \Bigr\} \\
			& \quad - \tr \Bigl\{ \sum_{g_1=1}^G \sum_{g_2 \ne g_1} \mathbf{H}_{\mathrm{B},g_2}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g_1}^{(k)} \mathbf{\Theta}_{g_1} \mathbf{H}_{\mathrm{F},g_1}^{(j)} \mathbf{H}_{\mathrm{F},g_2}^{(j)\mathsf{H}} \mathbf{\Theta}_{g_2}^\mathsf{H}\Bigr\} \\
			& \quad - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)} \mathbf{\Theta}_{g} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{\Theta}_{g}^\mathsf{H} \Bigr\} \\
			& \quad + \tr \Bigl\{ \sum_g \beta_g^{(k)} \mathbf{\Theta}_{g} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{\Theta}_{g}^\mathsf{H} \Bigr\} \\
			& = \sum_{k=1}^K \sum_{j \ne k} - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{H}_{\mathrm{D}}^{(kj)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)} \mathbf{\Theta}_g\Bigr\} \\
			& \quad - \tr \Bigl\{ \sum_g \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{D}}^{(kj)} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{\Theta}_g^\mathsf{H} \Bigr\} \\
			& \quad - \tr \Bigl\{ \sum_{g_1=1}^G \sum_{g_2 \ne g_1} \mathbf{H}_{\mathrm{B},g_2}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g_1}^{(k)} \mathbf{\Theta}_{g_1} \mathbf{H}_{\mathrm{F},g_1}^{(j)} \mathbf{H}_{\mathrm{F},g_2}^{(j)\mathsf{H}} \mathbf{\Theta}_{g_2}^\mathsf{H}\Bigr\} \\
			& \quad + \tr \Bigl\{ \sum_g \mathbf{B}_{g}^{(k)} \mathbf{\Theta}_{g} \mathbf{H}_{\mathrm{F},g}^{(j)\mathsf{H}} \mathbf{H}_{\mathrm{F},g}^{(j)} \mathbf{\Theta}_{g}^\mathsf{H} \Bigr\},
		\end{align*}
		where $\mathbf{B}_{g}^{(k)} = \beta_g^{(k)} \mathbf{I} - \mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)}$ and the relaxation constant $\beta_g^{(k)}$ can be chosen arbitrarily.
		One can choose $\beta_g^{(k)} = \lambda_1(\mathbf{H}_{\mathrm{B},g}^{(k)\mathsf{H}} \mathbf{H}_{\mathrm{B},g}^{(k)})$ to ensure the positive semi-definiteness of $\mathbf{B}_{g}^{(k)}$ and formulate a quadratic function to be maximized.
		The remaining proof is similar to Appendix \ref{ap:power} and omitted here.
	\end{subsection}
\end{appendix}

\begin{section}{Acknowledgement}
	The authors would like to thank the anonymous reviewers for their insightful criticisms and suggestions that helped us correct some technical errors and improve the clarity of the manuscript.
\end{section}

\bibliographystyle{IEEEtran}
\bibliography{library.bib}
\end{document}
